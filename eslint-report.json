[{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\e2e\\tickets.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\eslint.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\i18next-scanner.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\jest.setup.js","messages":[{"ruleId":null,"nodeType":null,"fatal":true,"severity":2,"message":"Parsing error: Unexpected token, expected \",\" (27:19)","line":27,"column":19}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import '@testing-library/jest-dom';\r\n\r\n// Mock Next.js router\r\njest.mock('next/navigation', () => ({\r\n    useRouter() {\r\n        return {\r\n            push: jest.fn(),\r\n            replace: jest.fn(),\r\n            prefetch: jest.fn(),\r\n            back: jest.fn(),\r\n            pathname: '/',\r\n            query: {},\r\n            asPath: '/',\r\n        };\r\n    },\r\n    useSearchParams() {\r\n        return new URLSearchParams();\r\n    },\r\n    usePathname() {\r\n        return '/';\r\n    },\r\n}));\r\n\r\n// Mock Next.js Image component\r\njest.mock('next/image', () => ({\r\n    __esModule: true,\r\n    default: (props: any) => {\r\n        // eslint-disable-next-line @next/next/no-img-element, jsx-a11y/alt-text\r\n        return <img {...props} />;\r\n    },\r\n}));\r\n\r\n// Mock window.matchMedia\r\nObject.defineProperty(window, 'matchMedia', {\r\n    writable: true,\r\n    value: jest.fn().mockImplementation(query => ({\r\n        matches: false,\r\n        media: query,\r\n        onchange: null,\r\n        addListener: jest.fn(),\r\n        removeListener: jest.fn(),\r\n        addEventListener: jest.fn(),\r\n        removeEventListener: jest.fn(),\r\n        dispatchEvent: jest.fn(),\r\n    })),\r\n});\r\n\r\n// Mock IntersectionObserver\r\nglobal.IntersectionObserver = class IntersectionObserver {\r\n    constructor() { }\r\n    disconnect() { }\r\n    observe() { }\r\n    takeRecords() {\r\n        return [];\r\n    }\r\n    unobserve() { }\r\n} as any;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\next.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\playwright.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\postcss.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\prisma.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\prisma\\seed.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\public\\sw.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\scripts\\ai-translate-placeholders.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\scripts\\apply-ai-translations.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\scripts\\auto-translate-ar.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\scripts\\auto-translate-i18n.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\scripts\\batch-translate.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\scripts\\check-missing-translations.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\scripts\\complete-translations.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\scripts\\generate-encryption-key.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\scripts\\generate-i18n-summary.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\scripts\\i18n-auto-fix.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\scripts\\i18n-check.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\scripts\\mark-untranslated.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\scripts\\reset-admin-password.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\scripts\\reset-data.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\scripts\\scan-i18n-comprehensive.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\scripts\\scan-i18n-hardcoded.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\scripts\\sync-translations.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\scripts\\translate-placeholders.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\scripts\\update-version.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\(main)\\contact-messages\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\(main)\\customers\\[id]\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\(main)\\customers\\new\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\(main)\\customers\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\(main)\\dashboard\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\(main)\\finance\\expenses\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchExpenses'. Either include it or remove the dependency array.","line":83,"column":8,"nodeType":"ArrayExpression","endLine":83,"endColumn":38,"suggestions":[{"desc":"Update the dependencies array to be: [page, typeFilter, searchTerm, fetchExpenses]","fix":{"range":[2397,2427],"text":"[page, typeFilter, searchTerm, fetchExpenses]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect, useMemo } from 'react';\r\nimport { useLanguage } from '@/contexts/language-context';\r\nimport { ExpenseFormModal } from '@/components/finance/ExpenseFormModal';\r\nimport Link from 'next/link';\r\nimport {\r\n    ArrowLeftIcon,\r\n    RectangleStackIcon,\r\n    TableCellsIcon,\r\n    PlusIcon,\r\n    WalletIcon,\r\n    ShoppingBagIcon,\r\n    BuildingStorefrontIcon,\r\n    ExclamationTriangleIcon,\r\n    TagIcon,\r\n    MagnifyingGlassIcon,\r\n    ArrowPathIcon,\r\n    ReceiptPercentIcon,\r\n    CalendarDaysIcon,\r\n    CubeIcon,\r\n    UserIcon,\r\n    TrashIcon,\r\n    ChevronLeftIcon,\r\n    ChevronRightIcon,\r\n} from '@heroicons/react/24/outline';\r\nimport { ComponentType, SVGProps } from 'react';\r\n\r\ninterface Expense {\r\n    id: string;\r\n    name: string;\r\n    amount: number;\r\n    type: string;\r\n    notes: string | null;\r\n    createdAt: string;\r\n    part?: {\r\n        name: string;\r\n        sku: string;\r\n    };\r\n    createdByUser: {\r\n        name: string | null;\r\n        username: string;\r\n    };\r\n}\r\n\r\nconst typeConfig: Record<string, { Icon: ComponentType<SVGProps<SVGSVGElement>>; gradient: string; bgLight: string }> = {\r\n    PURCHASE: {\r\n        Icon: ShoppingBagIcon,\r\n        gradient: 'from-blue-500 to-indigo-600',\r\n        bgLight: 'bg-blue-50 dark:bg-blue-900/20',\r\n    },\r\n    SHOP: {\r\n        Icon: BuildingStorefrontIcon,\r\n        gradient: 'from-emerald-500 to-teal-600',\r\n        bgLight: 'bg-emerald-50 dark:bg-emerald-900/20',\r\n    },\r\n    PART_LOSS: {\r\n        Icon: ExclamationTriangleIcon,\r\n        gradient: 'from-red-500 to-rose-600',\r\n        bgLight: 'bg-red-50 dark:bg-red-900/20',\r\n    },\r\n    MISC: {\r\n        Icon: TagIcon,\r\n        gradient: 'from-amber-500 to-orange-600',\r\n        bgLight: 'bg-amber-50 dark:bg-amber-900/20',\r\n    },\r\n};\r\n\r\nexport default function ExpensesPage() {\r\n    const { t } = useLanguage();\r\n    const [expenses, setExpenses] = useState<Expense[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [page, setPage] = useState(1);\r\n    const [total, setTotal] = useState(0);\r\n    const [typeFilter, setTypeFilter] = useState('');\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [showAddModal, setShowAddModal] = useState(false);\r\n    const [viewMode, setViewMode] = useState<'cards' | 'table'>('cards');\r\n    const limit = 25;\r\n\r\n    useEffect(() => {\r\n        fetchExpenses();\r\n    }, [page, typeFilter, searchTerm]);\r\n\r\n    const fetchExpenses = async () => {\r\n        setLoading(true);\r\n        try {\r\n            const params = new URLSearchParams({\r\n                page: page.toString(),\r\n                limit: limit.toString(),\r\n            });\r\n\r\n            if (typeFilter) params.append('type', typeFilter);\r\n            if (searchTerm) params.append('search', searchTerm);\r\n\r\n            const response = await fetch(`/api/v2/expenses?${params}`);\r\n            if (!response.ok) throw new Error('Failed to fetch expenses');\r\n\r\n            const data = await response.json();\r\n            setExpenses(data.data);\r\n            setTotal(data.pagination.total);\r\n        } catch (error) {\r\n            console.error('Error fetching expenses:', error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleDelete = async (id: string) => {\r\n        if (!confirm(t('finance.messages.deleteExpenseConfirm'))) return;\r\n\r\n        try {\r\n            const response = await fetch(`/api/v2/expenses/${id}`, {\r\n                method: 'DELETE',\r\n            });\r\n\r\n            if (!response.ok) throw new Error('Failed to delete expense');\r\n            fetchExpenses();\r\n        } catch (error) {\r\n            console.error('Error deleting expense:', error);\r\n            alert(t('finance.messages.deleteExpenseConfirm'));\r\n        }\r\n    };\r\n\r\n    // Calculate stats\r\n    const stats = useMemo(() => {\r\n        const totalAmount = expenses.reduce((acc, e) => acc + e.amount, 0);\r\n        const typeTotals = expenses.reduce((acc, e) => {\r\n            acc[e.type] = (acc[e.type] || 0) + e.amount;\r\n            return acc;\r\n        }, {} as Record<string, number>);\r\n\r\n        return { totalAmount, typeTotals, count: expenses.length };\r\n    }, [expenses]);\r\n\r\n    const types = ['PURCHASE', 'SHOP', 'PART_LOSS', 'MISC'];\r\n\r\n    // Group expenses by date\r\n    const groupedExpenses = useMemo(() => {\r\n        const groups: Record<string, Expense[]> = {};\r\n        expenses.forEach((expense) => {\r\n            const date = new Date(expense.createdAt).toLocaleDateString();\r\n            if (!groups[date]) groups[date] = [];\r\n            groups[date].push(expense);\r\n        });\r\n        return groups;\r\n    }, [expenses]);\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-gradient-to-br from-gray-50 via-gray-50 to-rose-50 dark:from-gray-900 dark:via-gray-900 dark:to-rose-950\">\r\n            <div className=\"p-6 lg:p-8 max-w-7xl mx-auto\">\r\n                {/* Header */}\r\n                <div className=\"mb-8\">\r\n                    <Link\r\n                        href=\"/finance\"\r\n                        className=\"inline-flex items-center gap-2 text-gray-500 hover:text-primary transition-colors mb-6 group\"\r\n                    >\r\n                        <ArrowLeftIcon className=\"h-5 w-5 group-hover:-translate-x-1 transition-transform\" />\r\n                        <span className=\"text-sm font-medium\">{t('finance.backToFinance')}</span>\r\n                    </Link>\r\n\r\n                    <div className=\"flex flex-col lg:flex-row lg:items-end lg:justify-between gap-4\">\r\n                        <div>\r\n                            <h1 className=\"text-3xl lg:text-4xl font-bold bg-gradient-to-r from-gray-900 to-gray-600 dark:from-white dark:to-gray-400 bg-clip-text text-transparent\">\r\n                                {t('finance.expenses') || 'Business Expenses'}\r\n                            </h1>\r\n                            <p className=\"mt-2 text-gray-500 dark:text-gray-400 max-w-2xl\">\r\n                                {t('finance.expenses.pageDescription')}\r\n                            </p>\r\n                        </div>\r\n\r\n                        <div className=\"flex items-center gap-3\">\r\n                            {/* View Toggle */}\r\n                            <div className=\"flex items-center gap-2 bg-white dark:bg-gray-800 rounded-xl p-1 shadow-theme-sm\">\r\n                                <button\r\n                                    onClick={() => setViewMode('cards')}\r\n                                    className={`flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-all ${viewMode === 'cards'\r\n                                        ? 'bg-primary text-white shadow-md'\r\n                                        : 'text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700'\r\n                                        }`}\r\n                                >\r\n                                    <RectangleStackIcon className=\"h-[18px] w-[18px]\" />\r\n                                </button>\r\n                                <button\r\n                                    onClick={() => setViewMode('table')}\r\n                                    className={`flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-all ${viewMode === 'table'\r\n                                        ? 'bg-primary text-white shadow-md'\r\n                                        : 'text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700'\r\n                                        }`}\r\n                                >\r\n                                    <TableCellsIcon className=\"h-[18px] w-[18px]\" />\r\n                                </button>\r\n                            </div>\r\n\r\n                            {/* Add Button */}\r\n                            <button\r\n                                onClick={() => setShowAddModal(true)}\r\n                                className=\"flex items-center gap-2 px-5 py-3 bg-gradient-to-r from-primary to-blue-600 text-white rounded-xl hover:shadow-lg hover:shadow-primary/25 transition-all font-medium\"\r\n                            >\r\n                                <PlusIcon className=\"h-5 w-5\" />\r\n                                {t('finance.expenses.addExpense')}\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Stats Cards */}\r\n                <div className=\"grid grid-cols-2 lg:grid-cols-5 gap-4 mb-8\">\r\n                    <div className=\"col-span-2 lg:col-span-1 bg-white dark:bg-gray-800 rounded-2xl p-5 shadow-theme-sm border border-gray-100 dark:border-gray-700\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <div className=\"w-12 h-12 rounded-xl bg-gradient-to-br from-red-500 to-rose-600 flex items-center justify-center\">\r\n                                <WalletIcon className=\"h-6 w-6 text-white\" />\r\n                            </div>\r\n                            <div>\r\n                                <p className=\"text-sm text-gray-500 dark:text-gray-400\">{t('finance.expenses.totalExpenses') || 'Total'}</p>\r\n                                <p className=\"text-2xl font-bold text-red-600 dark:text-red-400\">${stats.totalAmount.toFixed(2)}</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {types.map((type) => {\r\n                        const config = typeConfig[type];\r\n                        return (\r\n                            <div key={type} className=\"bg-white dark:bg-gray-800 rounded-2xl p-5 shadow-theme-sm border border-gray-100 dark:border-gray-700\">\r\n                                <div className=\"flex items-center gap-3\">\r\n                                    <div className={`w-10 h-10 rounded-xl bg-gradient-to-br ${config.gradient} flex items-center justify-center`}>\r\n                                        <config.Icon className=\"h-5 w-5 text-white\" />\r\n                                    </div>\r\n                                    <div>\r\n                                        <p className=\"text-xs text-gray-500 dark:text-gray-400\">{t(`finance.expenseTypes.${type}`)}</p>\r\n                                        <p className=\"text-lg font-bold text-gray-900 dark:text-white\">${(stats.typeTotals[type] || 0).toFixed(2)}</p>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        );\r\n                    })}\r\n                </div>\r\n\r\n                {/* Filters */}\r\n                <div className=\"bg-white dark:bg-gray-800 rounded-2xl shadow-theme-sm border border-gray-100 dark:border-gray-700 p-5 mb-6\">\r\n                    <div className=\"flex flex-col lg:flex-row gap-4 items-start lg:items-center\">\r\n                        {/* Search */}\r\n                        <div className=\"flex-1 w-full lg:w-auto\">\r\n                            <div className=\"relative\">\r\n                                <MagnifyingGlassIcon className=\"h-5 w-5 absolute left-4 top-1/2 -translate-y-1/2 text-gray-400\" />\r\n                                <input\r\n                                    type=\"text\"\r\n                                    value={searchTerm}\r\n                                    onChange={(e) => setSearchTerm(e.target.value)}\r\n                                    placeholder={t('finance.expenses.searchPlaceholder')}\r\n                                    className=\"w-full pl-12 pr-4 py-3 bg-gray-50 dark:bg-gray-700/50 border border-gray-200 dark:border-gray-600 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all text-sm\"\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Type Filter Pills */}\r\n                        <div className=\"flex flex-wrap gap-2\">\r\n                            <button\r\n                                onClick={() => setTypeFilter('')}\r\n                                className={`px-4 py-2 rounded-full text-sm font-medium transition-all ${typeFilter === ''\r\n                                    ? 'bg-primary text-white shadow-md shadow-primary/25'\r\n                                    : 'bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600'\r\n                                    }`}\r\n                            >\r\n                                {t('finance.expenses.allTypes')}\r\n                            </button>\r\n                            {types.map((type) => {\r\n                                const config = typeConfig[type];\r\n                                return (\r\n                                    <button\r\n                                        key={type}\r\n                                        onClick={() => setTypeFilter(type)}\r\n                                        className={`flex items-center gap-2 px-4 py-2 rounded-full text-sm font-medium transition-all ${typeFilter === type\r\n                                            ? `bg-gradient-to-r ${config.gradient} text-white shadow-md`\r\n                                            : 'bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600'\r\n                                            }`}\r\n                                    >\r\n                                        <config.Icon className=\"h-[18px] w-[18px]\" />\r\n                                        {t(`finance.expenseTypes.${type}`)}\r\n                                    </button>\r\n                                );\r\n                            })}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Content */}\r\n                {loading ? (\r\n                    <div className=\"flex flex-col items-center justify-center py-20\">\r\n                        <div className=\"w-16 h-16 rounded-2xl bg-gradient-to-br from-red-500 to-rose-600 flex items-center justify-center animate-pulse\">\r\n                            <ArrowPathIcon className=\"h-8 w-8 text-white animate-spin\" />\r\n                        </div>\r\n                        <p className=\"mt-4 text-gray-500 dark:text-gray-400\">{t('finance.expenses.loading')}</p>\r\n                    </div>\r\n                ) : expenses.length === 0 ? (\r\n                    <div className=\"flex flex-col items-center justify-center py-20 bg-white dark:bg-gray-800 rounded-2xl shadow-theme-sm border border-gray-100 dark:border-gray-700\">\r\n                        <div className=\"w-24 h-24 rounded-3xl bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-700 dark:to-gray-600 flex items-center justify-center mb-6\">\r\n                            <ReceiptPercentIcon className=\"h-12 w-12 text-gray-400 dark:text-gray-500\" />\r\n                        </div>\r\n                        <h3 className=\"text-xl font-semibold text-gray-900 dark:text-white mb-2\">{t('finance.expenses.noExpenses')}</h3>\r\n                        <p className=\"text-gray-500 dark:text-gray-400 text-center max-w-md mb-6\">{t('finance.expenses.createOne')}</p>\r\n                        <button\r\n                            onClick={() => setShowAddModal(true)}\r\n                            className=\"flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-primary to-blue-600 text-white rounded-xl hover:shadow-lg hover:shadow-primary/25 transition-all font-medium\"\r\n                        >\r\n                            <PlusIcon className=\"h-5 w-5\" />\r\n                            {t('finance.expenses.addExpense')}\r\n                        </button>\r\n                    </div>\r\n                ) : viewMode === 'cards' ? (\r\n                    /* Timeline Cards View */\r\n                    <div className=\"space-y-6\">\r\n                        {Object.entries(groupedExpenses).map(([date, dateExpenses]) => (\r\n                            <div key={date}>\r\n                                {/* Date Header */}\r\n                                <div className=\"flex items-center gap-3 mb-4\">\r\n                                    <div className=\"w-10 h-10 rounded-xl bg-gray-100 dark:bg-gray-800 flex items-center justify-center\">\r\n                                        <CalendarDaysIcon className=\"h-5 w-5 text-gray-500\" />\r\n                                    </div>\r\n                                    <div>\r\n                                        <p className=\"font-semibold text-gray-900 dark:text-white\">{date}</p>\r\n                                        <p className=\"text-xs text-gray-500\">{dateExpenses.length} expense{dateExpenses.length > 1 ? 's' : ''}</p>\r\n                                    </div>\r\n                                    <div className=\"flex-1 h-px bg-gray-200 dark:bg-gray-700 ml-4\" />\r\n                                    <p className=\"text-sm font-semibold text-red-600 dark:text-red-400\">\r\n                                        ${dateExpenses.reduce((acc, e) => acc + e.amount, 0).toFixed(2)}\r\n                                    </p>\r\n                                </div>\r\n\r\n                                {/* Expense Cards */}\r\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 ml-5 pl-8 border-l-2 border-gray-200 dark:border-gray-700\">\r\n                                    {dateExpenses.map((expense) => {\r\n                                        const config = typeConfig[expense.type] || typeConfig.MISC;\r\n                                        return (\r\n                                            <div\r\n                                                key={expense.id}\r\n                                                className=\"group bg-white dark:bg-gray-800 rounded-2xl shadow-theme-sm border border-gray-100 dark:border-gray-700 overflow-hidden hover:shadow-theme-lg hover:border-primary/20 transition-all duration-300\"\r\n                                            >\r\n                                                <div className={`h-1.5 bg-gradient-to-r ${config.gradient}`} />\r\n\r\n                                                <div className=\"p-5\">\r\n                                                    <div className=\"flex items-start justify-between mb-4\">\r\n                                                        <div className=\"flex items-center gap-3\">\r\n                                                            <div className={`w-11 h-11 rounded-xl bg-gradient-to-br ${config.gradient} flex items-center justify-center shadow-lg`}>\r\n                                                                <config.Icon className=\"h-5 w-5 text-white\" />\r\n                                                            </div>\r\n                                                            <div>\r\n                                                                <p className=\"font-semibold text-gray-900 dark:text-white\">{expense.name}</p>\r\n                                                                <span className={`inline-block px-2 py-0.5 rounded-full text-xs font-medium ${config.bgLight} text-gray-700 dark:text-gray-300`}>\r\n                                                                    {expense.type.replace('_', ' ')}\r\n                                                                </span>\r\n                                                            </div>\r\n                                                        </div>\r\n\r\n                                                        <p className=\"text-xl font-bold text-red-500\">-${expense.amount.toFixed(2)}</p>\r\n                                                    </div>\r\n\r\n                                                    {expense.notes && (\r\n                                                        <p className=\"text-sm text-gray-500 dark:text-gray-400 mb-4 line-clamp-2\">{expense.notes}</p>\r\n                                                    )}\r\n\r\n                                                    <div className=\"pt-4 border-t border-gray-100 dark:border-gray-700 flex items-center justify-between\">\r\n                                                        <div className=\"flex items-center gap-4 text-sm text-gray-500 dark:text-gray-400\">\r\n                                                            {expense.part && (\r\n                                                                <div className=\"flex items-center gap-1.5\">\r\n                                                                    <CubeIcon className=\"h-[18px] w-[18px]\" />\r\n                                                                    <span>{expense.part.name}</span>\r\n                                                                </div>\r\n                                                            )}\r\n                                                            <div className=\"flex items-center gap-1.5\">\r\n                                                                <UserIcon className=\"h-[18px] w-[18px]\" />\r\n                                                                <span>{expense.createdByUser.name || expense.createdByUser.username}</span>\r\n                                                            </div>\r\n                                                        </div>\r\n\r\n                                                        <button\r\n                                                            onClick={() => handleDelete(expense.id)}\r\n                                                            className=\"p-2 rounded-lg text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors opacity-0 group-hover:opacity-100\"\r\n                                                            title={t('finance.expenses.deleteTitle')}\r\n                                                        >\r\n                                                            <TrashIcon className=\"h-5 w-5\" />\r\n                                                        </button>\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n                                        );\r\n                                    })}\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                ) : (\r\n                    /* Table View */\r\n                    <div className=\"bg-white dark:bg-gray-800 rounded-2xl shadow-theme-sm border border-gray-100 dark:border-gray-700 overflow-hidden\">\r\n                        <div className=\"overflow-x-auto\">\r\n                            <table className=\"min-w-full\">\r\n                                <thead>\r\n                                    <tr className=\"bg-gray-50 dark:bg-gray-700/50 border-b border-gray-100 dark:border-gray-700\">\r\n                                        <th className=\"px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider\">{t('finance.expenseName')}</th>\r\n                                        <th className=\"px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider\">{t('finance.amount')}</th>\r\n                                        <th className=\"px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider\">{t('finance.type')}</th>\r\n                                        <th className=\"px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider\">{t('finance.expenses.part')}</th>\r\n                                        <th className=\"px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider\">{t('finance.date')}</th>\r\n                                        <th className=\"px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider\">{t('finance.expenses.createdBy')}</th>\r\n                                        <th className=\"px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider\">{t('finance.actions')}</th>\r\n                                    </tr>\r\n                                </thead>\r\n                                <tbody className=\"divide-y divide-gray-100 dark:divide-gray-700\">\r\n                                    {expenses.map((expense) => {\r\n                                        const config = typeConfig[expense.type] || typeConfig.MISC;\r\n                                        return (\r\n                                            <tr key={expense.id} className=\"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors\">\r\n                                                <td className=\"px-6 py-4\">\r\n                                                    <p className=\"font-medium text-gray-900 dark:text-white\">{expense.name}</p>\r\n                                                    {expense.notes && <p className=\"text-xs text-gray-500 mt-1 line-clamp-1\">{expense.notes}</p>}\r\n                                                </td>\r\n                                                <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                                                    <span className=\"text-base font-semibold text-red-500\">-${expense.amount.toFixed(2)}</span>\r\n                                                </td>\r\n                                                <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                                                    <span className={`inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-medium bg-gradient-to-r ${config.gradient} text-white`}>\r\n                                                        <config.Icon className=\"h-4 w-4\" />\r\n                                                        {expense.type.replace('_', ' ')}\r\n                                                    </span>\r\n                                                </td>\r\n                                                <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                                                    {expense.part ? (\r\n                                                        <div>\r\n                                                            <p className=\"text-sm text-gray-900 dark:text-white\">{expense.part.name}</p>\r\n                                                            <p className=\"text-xs text-gray-500\">{expense.part.sku}</p>\r\n                                                        </div>\r\n                                                    ) : (\r\n                                                        <span className=\"text-sm text-gray-400\">{t('finance.common.na')}</span>\r\n                                                    )}\r\n                                                </td>\r\n                                                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-gray-300\">\r\n                                                    {new Date(expense.createdAt).toLocaleDateString()}\r\n                                                </td>\r\n                                                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-gray-300\">\r\n                                                    {expense.createdByUser.name || expense.createdByUser.username}\r\n                                                </td>\r\n                                                <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                                                    <button\r\n                                                        onClick={() => handleDelete(expense.id)}\r\n                                                        className=\"p-2 rounded-lg text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors\"\r\n                                                        title={t('finance.expenses.deleteTitle')}\r\n                                                    >\r\n                                                        <TrashIcon className=\"h-5 w-5\" />\r\n                                                    </button>\r\n                                                </td>\r\n                                            </tr>\r\n                                        );\r\n                                    })}\r\n                                </tbody>\r\n                            </table>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Pagination */}\r\n                {total > 0 && (\r\n                    <div className=\"mt-6 flex flex-col sm:flex-row items-center justify-between gap-4 bg-white dark:bg-gray-800 rounded-2xl shadow-theme-sm border border-gray-100 dark:border-gray-700 p-4\">\r\n                        <p className=\"text-sm text-gray-500 dark:text-gray-400\">\r\n                            {t('finance.expenses.showing', { from: (page - 1) * limit + 1, to: Math.min(page * limit, total), total })}\r\n                        </p>\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <button\r\n                                onClick={() => setPage((p) => Math.max(1, p - 1))}\r\n                                disabled={page === 1}\r\n                                className=\"flex items-center gap-1 px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-xl hover:bg-gray-200 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-sm font-medium\"\r\n                            >\r\n                                <ChevronLeftIcon className=\"h-[18px] w-[18px]\" />\r\n                                Previous\r\n                            </button>\r\n                            <span className=\"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300\">\r\n                                Page {page} of {Math.ceil(total / limit)}\r\n                            </span>\r\n                            <button\r\n                                onClick={() => setPage((p) => p + 1)}\r\n                                disabled={page * limit >= total}\r\n                                className=\"flex items-center gap-1 px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-xl hover:bg-gray-200 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-sm font-medium\"\r\n                            >\r\n                                Next\r\n                                <ChevronRightIcon className=\"h-[18px] w-[18px]\" />\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Add Expense Modal */}\r\n                {showAddModal && (\r\n                    <ExpenseFormModal\r\n                        onClose={() => setShowAddModal(false)}\r\n                        onSuccess={() => {\r\n                            setShowAddModal(false);\r\n                            fetchExpenses();\r\n                        }}\r\n                    />\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\(main)\\finance\\page.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchSummary'. Either include it or remove the dependency array.","line":143,"column":8,"nodeType":"ArrayExpression","endLine":143,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [fetchSummary, period]","fix":{"range":[4876,4884],"text":"[fetchSummary, period]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\(main)\\finance\\payments\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchPayments'. Either include it or remove the dependency array.","line":82,"column":8,"nodeType":"ArrayExpression","endLine":82,"endColumn":40,"suggestions":[{"desc":"Update the dependencies array to be: [page, searchTerm, methodFilter, fetchPayments]","fix":{"range":[2229,2261],"text":"[page, searchTerm, methodFilter, fetchPayments]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect, useMemo } from 'react';\r\nimport { useLanguage } from '@/contexts/language-context';\r\nimport Link from 'next/link';\r\nimport { formatId } from '@/lib/utils';\r\nimport {\r\n    ArrowLeftIcon,\r\n    Squares2X2Icon,\r\n    TableCellsIcon,\r\n    DocumentTextIcon,\r\n    ArrowTrendingUpIcon,\r\n    ArrowTrendingDownIcon,\r\n    WalletIcon,\r\n    MagnifyingGlassIcon,\r\n    ArrowPathIcon,\r\n    BanknotesIcon,\r\n    CreditCardIcon,\r\n    DevicePhoneMobileIcon,\r\n    CurrencyDollarIcon,\r\n    ArrowUturnLeftIcon,\r\n    UserIcon,\r\n    TicketIcon,\r\n    ReceiptPercentIcon,\r\n    IdentificationIcon,\r\n    ChevronLeftIcon,\r\n    ChevronRightIcon,\r\n} from '@heroicons/react/24/outline';\r\nimport type { ComponentType, SVGProps } from 'react';\r\n\r\ntype HeroIcon = ComponentType<SVGProps<SVGSVGElement>>;\r\n\r\ninterface Payment {\r\n    id: string;\r\n    ticketId: string | null;\r\n    amount: number;\r\n    method: string;\r\n    currency: string | null;\r\n    reference: string | null;\r\n    createdAt: string;\r\n    paymentNumber?: string;\r\n    ticket?: {\r\n        ticketNumber: string;\r\n        customer: {\r\n            name: string;\r\n            phone: string;\r\n        };\r\n    };\r\n    performedByUser: {\r\n        name: string | null;\r\n        username: string;\r\n    };\r\n}\r\n\r\nconst methodIcons: Record<string, HeroIcon> = {\r\n    CASH: BanknotesIcon,\r\n    CARD: CreditCardIcon,\r\n    MOBILE: DevicePhoneMobileIcon,\r\n    OTHER: CurrencyDollarIcon,\r\n};\r\n\r\nconst methodGradients: Record<string, string> = {\r\n    CASH: 'from-emerald-500 to-teal-600',\r\n    CARD: 'from-violet-500 to-purple-600',\r\n    MOBILE: 'from-blue-500 to-cyan-600',\r\n    OTHER: 'from-amber-500 to-orange-600',\r\n};\r\n\r\nexport default function PaymentsPage() {\r\n    const { t } = useLanguage();\r\n    const [payments, setPayments] = useState<Payment[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [page, setPage] = useState(1);\r\n    const [total, setTotal] = useState(0);\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [methodFilter, setMethodFilter] = useState('');\r\n    const [viewMode, setViewMode] = useState<'cards' | 'table'>('cards');\r\n    const limit = 25;\r\n\r\n    useEffect(() => {\r\n        fetchPayments();\r\n    }, [page, searchTerm, methodFilter]);\r\n\r\n    const fetchPayments = async () => {\r\n        setLoading(true);\r\n        try {\r\n            const params = new URLSearchParams({\r\n                page: page.toString(),\r\n                limit: limit.toString(),\r\n            });\r\n\r\n            if (searchTerm) params.append('search', searchTerm);\r\n            if (methodFilter) params.append('method', methodFilter);\r\n\r\n            const response = await fetch(`/api/v2/payments?${params}`);\r\n            if (!response.ok) throw new Error('Failed to fetch payments');\r\n\r\n            const data = await response.json();\r\n            setPayments(data.data);\r\n            setTotal(data.pagination.total);\r\n        } catch (error) {\r\n            console.error('Error fetching payments:', error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    // Calculate stats\r\n    const stats = useMemo(() => {\r\n        const totalAmount = payments.reduce((acc, p) => acc + (p.amount > 0 ? p.amount : 0), 0);\r\n        const totalRefunds = payments.reduce((acc, p) => acc + (p.amount < 0 ? Math.abs(p.amount) : 0), 0);\r\n        const methodCounts = payments.reduce((acc, p) => {\r\n            acc[p.method] = (acc[p.method] || 0) + 1;\r\n            return acc;\r\n        }, {} as Record<string, number>);\r\n\r\n        return { totalAmount, totalRefunds, methodCounts, count: payments.length };\r\n    }, [payments]);\r\n\r\n    const handleSearch = (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        setPage(1);\r\n        fetchPayments();\r\n    };\r\n\r\n    const methods = ['CASH', 'CARD', 'MOBILE', 'OTHER'];\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-gradient-to-br from-gray-50 via-gray-50 to-blue-50 dark:from-gray-900 dark:via-gray-900 dark:to-blue-950\">\r\n            <div className=\"p-6 lg:p-8 max-w-7xl mx-auto\">\r\n                {/* Header */}\r\n                <div className=\"mb-8\">\r\n                    <Link\r\n                        href=\"/finance\"\r\n                        className=\"inline-flex items-center gap-2 text-gray-500 hover:text-primary transition-colors mb-6 group\"\r\n                    >\r\n                        <ArrowLeftIcon className=\"h-5 w-5 group-hover:-translate-x-1 transition-transform\" />\r\n                        <span className=\"text-sm font-medium\">{t('finance.backToFinance')}</span>\r\n                    </Link>\r\n\r\n                    <div className=\"flex flex-col lg:flex-row lg:items-end lg:justify-between gap-4\">\r\n                        <div>\r\n                            <h1 className=\"text-3xl lg:text-4xl font-bold bg-gradient-to-r from-gray-900 to-gray-600 dark:from-white dark:to-gray-400 bg-clip-text text-transparent\">\r\n                                {t('finance.payments') || 'Payment History'}\r\n                            </h1>\r\n                            <p className=\"mt-2 text-gray-500 dark:text-gray-400 max-w-2xl\">\r\n                                {t('finance.payments.pageDescription')}\r\n                            </p>\r\n                        </div>\r\n\r\n                        {/* View Toggle */}\r\n                        <div className=\"flex items-center gap-2 bg-white dark:bg-gray-800 rounded-xl p-1 shadow-theme-sm\">\r\n                            <button\r\n                                onClick={() => setViewMode('cards')}\r\n                                className={`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all ${viewMode === 'cards'\r\n                                    ? 'bg-primary text-white shadow-md'\r\n                                    : 'text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700'\r\n                                    }`}\r\n                            >\r\n                                <Squares2X2Icon className=\"h-5 w-5\" />\r\n                                Cards\r\n                            </button>\r\n                            <button\r\n                                onClick={() => setViewMode('table')}\r\n                                className={`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all ${viewMode === 'table'\r\n                                    ? 'bg-primary text-white shadow-md'\r\n                                    : 'text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700'\r\n                                    }`}\r\n                            >\r\n                                <TableCellsIcon className=\"h-5 w-5\" />\r\n                                Table\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Stats Cards */}\r\n                <div className=\"grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8\">\r\n                    <div className=\"bg-white dark:bg-gray-800 rounded-2xl p-5 shadow-theme-sm border border-gray-100 dark:border-gray-700\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <div className=\"w-12 h-12 rounded-xl bg-gradient-to-br from-primary to-blue-600 flex items-center justify-center\">\r\n                                <DocumentTextIcon className=\"h-6 w-6 text-white\" />\r\n                            </div>\r\n                            <div>\r\n                                <p className=\"text-sm text-gray-500 dark:text-gray-400\">{t('finance.payments.totalPayments') || 'Total Payments'}</p>\r\n                                <p className=\"text-2xl font-bold text-gray-900 dark:text-white\">{total}</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"bg-white dark:bg-gray-800 rounded-2xl p-5 shadow-theme-sm border border-gray-100 dark:border-gray-700\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <div className=\"w-12 h-12 rounded-xl bg-gradient-to-br from-emerald-500 to-green-600 flex items-center justify-center\">\r\n                                <ArrowTrendingUpIcon className=\"h-6 w-6 text-white\" />\r\n                            </div>\r\n                            <div>\r\n                                <p className=\"text-sm text-gray-500 dark:text-gray-400\">{t('finance.payments.collected') || 'Collected'}</p>\r\n                                <p className=\"text-2xl font-bold text-emerald-600 dark:text-emerald-400\">${stats.totalAmount.toFixed(2)}</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"bg-white dark:bg-gray-800 rounded-2xl p-5 shadow-theme-sm border border-gray-100 dark:border-gray-700\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <div className=\"w-12 h-12 rounded-xl bg-gradient-to-br from-red-500 to-rose-600 flex items-center justify-center\">\r\n                                <ArrowTrendingDownIcon className=\"h-6 w-6 text-white\" />\r\n                            </div>\r\n                            <div>\r\n                                <p className=\"text-sm text-gray-500 dark:text-gray-400\">{t('finance.payments.refunds') || 'Refunds'}</p>\r\n                                <p className=\"text-2xl font-bold text-red-600 dark:text-red-400\">${stats.totalRefunds.toFixed(2)}</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"bg-white dark:bg-gray-800 rounded-2xl p-5 shadow-theme-sm border border-gray-100 dark:border-gray-700\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <div className=\"w-12 h-12 rounded-xl bg-gradient-to-br from-violet-500 to-purple-600 flex items-center justify-center\">\r\n                                <WalletIcon className=\"h-6 w-6 text-white\" />\r\n                            </div>\r\n                            <div>\r\n                                <p className=\"text-sm text-gray-500 dark:text-gray-400\">{t('finance.payments.netAmount') || 'Net Amount'}</p>\r\n                                <p className=\"text-2xl font-bold text-gray-900 dark:text-white\">${(stats.totalAmount - stats.totalRefunds).toFixed(2)}</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Filters */}\r\n                <div className=\"bg-white dark:bg-gray-800 rounded-2xl shadow-theme-sm border border-gray-100 dark:border-gray-700 p-5 mb-6\">\r\n                    <div className=\"flex flex-col lg:flex-row gap-4 items-start lg:items-center\">\r\n                        {/* Search */}\r\n                        <form onSubmit={handleSearch} className=\"flex-1 w-full lg:w-auto\">\r\n                            <div className=\"relative\">\r\n                                <MagnifyingGlassIcon className=\"h-5 w-5 absolute left-4 top-1/2 -translate-y-1/2 text-gray-400\" />\r\n                                <input\r\n                                    type=\"text\"\r\n                                    value={searchTerm}\r\n                                    onChange={(e) => setSearchTerm(e.target.value)}\r\n                                    placeholder={t('finance.payments.searchPlaceholder')}\r\n                                    className=\"w-full pl-12 pr-4 py-3 bg-gray-50 dark:bg-gray-700/50 border border-gray-200 dark:border-gray-600 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all text-sm\"\r\n                                />\r\n                            </div>\r\n                        </form>\r\n\r\n                        {/* Method Filter Pills */}\r\n                        <div className=\"flex flex-wrap gap-2\">\r\n                            <button\r\n                                onClick={() => setMethodFilter('')}\r\n                                className={`px-4 py-2 rounded-full text-sm font-medium transition-all ${methodFilter === ''\r\n                                    ? 'bg-primary text-white shadow-md shadow-primary/25'\r\n                                    : 'bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600'\r\n                                    }`}\r\n                            >\r\n                                {t('finance.payments.allMethods')}\r\n                            </button>\r\n                            {methods.map((method) => (\r\n                                <button\r\n                                    key={method}\r\n                                    onClick={() => setMethodFilter(method)}\r\n                                    className={`flex items-center gap-2 px-4 py-2 rounded-full text-sm font-medium transition-all ${methodFilter === method\r\n                                        ? `bg-gradient-to-r ${methodGradients[method]} text-white shadow-md`\r\n                                        : 'bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600'\r\n                                        }`}\r\n                                >\r\n                                    {(() => { const Icon = methodIcons[method]; return <Icon className=\"h-5 w-5\" />; })()}\r\n                                    {t(`finance.paymentMethods.${method}`)}\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Content */}\r\n                {loading ? (\r\n                    <div className=\"flex flex-col items-center justify-center py-20\">\r\n                        <div className=\"w-16 h-16 rounded-2xl bg-gradient-to-br from-primary to-blue-600 flex items-center justify-center animate-pulse\">\r\n                            <ArrowPathIcon className=\"h-8 w-8 text-white animate-spin\" />\r\n                        </div>\r\n                        <p className=\"mt-4 text-gray-500 dark:text-gray-400\">{t('finance.payments.loading')}</p>\r\n                    </div>\r\n                ) : payments.length === 0 ? (\r\n                    <div className=\"flex flex-col items-center justify-center py-20 bg-white dark:bg-gray-800 rounded-2xl shadow-theme-sm border border-gray-100 dark:border-gray-700\">\r\n                        <div className=\"w-24 h-24 rounded-3xl bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-700 dark:to-gray-600 flex items-center justify-center mb-6\">\r\n                            <DocumentTextIcon className=\"h-12 w-12 text-gray-400 dark:text-gray-500\" />\r\n                        </div>\r\n                        <h3 className=\"text-xl font-semibold text-gray-900 dark:text-white mb-2\">{t('finance.payments.noPayments')}</h3>\r\n                        <p className=\"text-gray-500 dark:text-gray-400 text-center max-w-md\">{t('finance.payments.adjustFilters')}</p>\r\n                    </div>\r\n                ) : viewMode === 'cards' ? (\r\n                    /* Cards View */\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4\">\r\n                        {payments.map((payment) => (\r\n                            <div\r\n                                key={payment.id}\r\n                                className=\"group bg-white dark:bg-gray-800 rounded-2xl shadow-theme-sm border border-gray-100 dark:border-gray-700 overflow-hidden hover:shadow-theme-lg hover:border-primary/20 transition-all duration-300\"\r\n                            >\r\n                                {/* Card Header with Method Badge */}\r\n                                <div className={`h-2 bg-gradient-to-r ${methodGradients[payment.method] || methodGradients.OTHER}`} />\r\n\r\n                                <div className=\"p-5\">\r\n                                    <div className=\"flex items-start justify-between mb-4\">\r\n                                        <div className=\"flex items-center gap-3\">\r\n                                            <div className={`w-11 h-11 rounded-xl bg-gradient-to-br ${methodGradients[payment.method] || methodGradients.OTHER} flex items-center justify-center shadow-lg`}>\r\n                                                {(() => { const Icon = methodIcons[payment.method] || CurrencyDollarIcon; return <Icon className=\"h-5 w-5 text-white\" />; })()}\r\n                                            </div>\r\n                                            <div>\r\n                                                <p className=\"font-mono text-sm text-gray-500 dark:text-gray-400\">\r\n                                                    {payment.paymentNumber || formatId(payment.id)}\r\n                                                </p>\r\n                                                <p className=\"text-xs text-gray-400 dark:text-gray-500\">\r\n                                                    {new Date(payment.createdAt).toLocaleDateString()} ÔÇó {new Date(payment.createdAt).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\r\n                                                </p>\r\n                                            </div>\r\n                                        </div>\r\n\r\n                                        <div className=\"text-right\">\r\n                                            <p className={`text-xl font-bold ${payment.amount < 0 ? 'text-red-500' : 'text-emerald-500'}`}>\r\n                                                {payment.amount < 0 ? '-' : '+'}${Math.abs(payment.amount).toFixed(2)}\r\n                                            </p>\r\n                                            {payment.amount < 0 && (\r\n                                                <span className=\"inline-flex items-center gap-1 px-2 py-0.5 bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 text-xs font-medium rounded-full\">\r\n                                                    <ArrowUturnLeftIcon className=\"h-3.5 w-3.5\" />\r\n                                                    {t('finance.payments.refund')}\r\n                                                </span>\r\n                                            )}\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    {/* Customer & Ticket Info */}\r\n                                    <div className=\"space-y-3 pt-4 border-t border-gray-100 dark:border-gray-700\">\r\n                                        {payment.ticket ? (\r\n                                            <>\r\n                                                <div className=\"flex items-center gap-3\">\r\n                                                    <div className=\"w-8 h-8 rounded-lg bg-gray-100 dark:bg-gray-700 flex items-center justify-center\">\r\n                                                        <UserIcon className=\"h-5 w-5 text-gray-500\" />\r\n                                                    </div>\r\n                                                    <div className=\"flex-1 min-w-0\">\r\n                                                        <p className=\"text-sm font-medium text-gray-900 dark:text-white truncate\">{payment.ticket.customer.name}</p>\r\n                                                        <p className=\"text-xs text-gray-500 dark:text-gray-400\">{payment.ticket.customer.phone}</p>\r\n                                                    </div>\r\n                                                </div>\r\n\r\n                                                <Link\r\n                                                    href={`/tickets/${payment.ticketId}`}\r\n                                                    className=\"flex items-center gap-3 group/link\"\r\n                                                >\r\n                                                    <div className=\"w-8 h-8 rounded-lg bg-primary/10 flex items-center justify-center\">\r\n                                                        <TicketIcon className=\"h-5 w-5 text-primary\" />\r\n                                                    </div>\r\n                                                    <span className=\"text-sm font-medium text-primary group-hover/link:underline\">{payment.ticket.ticketNumber}</span>\r\n                                                </Link>\r\n                                            </>\r\n                                        ) : (\r\n                                            <div className=\"flex items-center gap-3\">\r\n                                                <div className=\"w-8 h-8 rounded-lg bg-gray-100 dark:bg-gray-700 flex items-center justify-center\">\r\n                                                    <ReceiptPercentIcon className=\"h-5 w-5 text-gray-400\" />\r\n                                                </div>\r\n                                                <span className=\"text-sm text-gray-400\">{t('finance.common.na')}</span>\r\n                                            </div>\r\n                                        )}\r\n\r\n                                        <div className=\"flex items-center gap-3\">\r\n                                            <div className=\"w-8 h-8 rounded-lg bg-gray-100 dark:bg-gray-700 flex items-center justify-center\">\r\n                                                <IdentificationIcon className=\"h-5 w-5 text-gray-500\" />\r\n                                            </div>\r\n                                            <p className=\"text-sm text-gray-600 dark:text-gray-300\">\r\n                                                {payment.performedByUser.name || payment.performedByUser.username}\r\n                                            </p>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                ) : (\r\n                    /* Table View */\r\n                    <div className=\"bg-white dark:bg-gray-800 rounded-2xl shadow-theme-sm border border-gray-100 dark:border-gray-700 overflow-hidden\">\r\n                        <div className=\"overflow-x-auto\">\r\n                            <table className=\"min-w-full\">\r\n                                <thead>\r\n                                    <tr className=\"bg-gray-50 dark:bg-gray-700/50 border-b border-gray-100 dark:border-gray-700\">\r\n                                        <th className=\"px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider\">{t('finance.payments.paymentId')}</th>\r\n                                        <th className=\"px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider\">{t('finance.ticket')}</th>\r\n                                        <th className=\"px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider\">{t('finance.customer')}</th>\r\n                                        <th className=\"px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider\">{t('finance.amount')}</th>\r\n                                        <th className=\"px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider\">{t('finance.method')}</th>\r\n                                        <th className=\"px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider\">{t('finance.date')}</th>\r\n                                        <th className=\"px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider\">{t('finance.performedBy')}</th>\r\n                                    </tr>\r\n                                </thead>\r\n                                <tbody className=\"divide-y divide-gray-100 dark:divide-gray-700\">\r\n                                    {payments.map((payment) => (\r\n                                        <tr key={payment.id} className=\"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors\">\r\n                                            <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                                                <span className=\"font-mono text-sm text-gray-900 dark:text-white\">{payment.paymentNumber || formatId(payment.id)}</span>\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                                                {payment.ticket ? (\r\n                                                    <Link href={`/tickets/${payment.ticketId}`} className=\"text-sm font-medium text-primary hover:underline\">\r\n                                                        {payment.ticket.ticketNumber}\r\n                                                    </Link>\r\n                                                ) : (\r\n                                                    <span className=\"text-sm text-gray-400\">{t('finance.common.na')}</span>\r\n                                                )}\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4\">\r\n                                                <p className=\"text-sm font-medium text-gray-900 dark:text-white\">{payment.ticket?.customer.name || 'N/A'}</p>\r\n                                                {payment.ticket?.customer.phone && (\r\n                                                    <p className=\"text-xs text-gray-500\">{payment.ticket.customer.phone}</p>\r\n                                                )}\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                                                <span className={`text-base font-semibold ${payment.amount < 0 ? 'text-red-500' : 'text-emerald-500'}`}>\r\n                                                    {payment.amount < 0 ? '-' : ''}${Math.abs(payment.amount).toFixed(2)}\r\n                                                </span>\r\n                                                {payment.amount < 0 && (\r\n                                                    <span className=\"ml-2 px-2 py-0.5 bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 text-xs font-medium rounded-full\">\r\n                                                        Refund\r\n                                                    </span>\r\n                                                )}\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                                                <span className={`inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-medium bg-gradient-to-r ${methodGradients[payment.method]} text-white`}>\r\n                                                    {(() => { const Icon = methodIcons[payment.method]; return <Icon className=\"h-3.5 w-3.5\" />; })()}\r\n                                                    {payment.method}\r\n                                                </span>\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-gray-300\">\r\n                                                {new Date(payment.createdAt).toLocaleDateString()} {new Date(payment.createdAt).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-gray-300\">\r\n                                                {payment.performedByUser.name || payment.performedByUser.username}\r\n                                            </td>\r\n                                        </tr>\r\n                                    ))}\r\n                                </tbody>\r\n                            </table>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Pagination */}\r\n                {total > 0 && (\r\n                    <div className=\"mt-6 flex flex-col sm:flex-row items-center justify-between gap-4 bg-white dark:bg-gray-800 rounded-2xl shadow-theme-sm border border-gray-100 dark:border-gray-700 p-4\">\r\n                        <p className=\"text-sm text-gray-500 dark:text-gray-400\">\r\n                            {t('finance.payments.showing', { from: (page - 1) * limit + 1, to: Math.min(page * limit, total), total })}\r\n                        </p>\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <button\r\n                                onClick={() => setPage((p) => Math.max(1, p - 1))}\r\n                                disabled={page === 1}\r\n                                className=\"flex items-center gap-1 px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-xl hover:bg-gray-200 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-sm font-medium\"\r\n                            >\r\n                                <ChevronLeftIcon className=\"h-5 w-5\" />\r\n                                Previous\r\n                            </button>\r\n                            <span className=\"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300\">\r\n                                Page {page} of {Math.ceil(total / limit)}\r\n                            </span>\r\n                            <button\r\n                                onClick={() => setPage((p) => p + 1)}\r\n                                disabled={page * limit >= total}\r\n                                className=\"flex items-center gap-1 px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-xl hover:bg-gray-200 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-sm font-medium\"\r\n                            >\r\n                                Next\r\n                                <ChevronRightIcon className=\"h-5 w-5\" />\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\(main)\\finance\\refunds\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchReturns'. Either include it or remove the dependency array.","line":96,"column":8,"nodeType":"ArrayExpression","endLine":96,"endColumn":22,"suggestions":[{"desc":"Update the dependencies array to be: [fetchReturns, statusFilter]","fix":{"range":[2866,2880],"text":"[fetchReturns, statusFilter]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect, useMemo } from 'react';\r\nimport { useLanguage } from '@/contexts/language-context';\r\nimport { ApproveReturnModal } from '@/components/finance/ApproveReturnModal';\r\nimport Link from 'next/link';\r\nimport { CreateReturnModal } from '@/components/returns/create-return-modal';\r\nimport {\r\n    ArrowLeftIcon,\r\n    PlusIcon,\r\n    ClockIcon,\r\n    CheckCircleIcon,\r\n    XCircleIcon,\r\n    ShieldCheckIcon,\r\n    HandThumbUpIcon,\r\n    NoSymbolIcon,\r\n    ArrowPathIcon,\r\n    ArrowUturnLeftIcon,\r\n    UserIcon,\r\n    ChatBubbleLeftIcon,\r\n    CalendarIcon,\r\n    IdentificationIcon,\r\n    CheckIcon,\r\n    XMarkIcon,\r\n} from '@heroicons/react/24/outline';\r\nimport type { ComponentType, SVGProps } from 'react';\r\n\r\ntype HeroIcon = ComponentType<SVGProps<SVGSVGElement>>;\r\n\r\ninterface Return {\r\n    id: string;\r\n    ticketId: string;\r\n    reason: string;\r\n    refundAmount: number;\r\n    status: string;\r\n    notes: string | null;\r\n    createdAt: string;\r\n    handledAt: string | null;\r\n    isRefunded: boolean;\r\n    refundedAt: string | null;\r\n    ticket: {\r\n        ticketNumber: string;\r\n        customer: {\r\n            name: string;\r\n            phone: string;\r\n        };\r\n    };\r\n    createdByUser: {\r\n        name: string | null;\r\n        username: string;\r\n    };\r\n    handledByUser?: {\r\n        name: string | null;\r\n        username: string;\r\n    };\r\n}\r\n\r\nconst statusConfig: Record<string, { Icon: HeroIcon; gradient: string; bgLight: string; text: string }> = {\r\n    PENDING: {\r\n        Icon: ClockIcon,\r\n        gradient: 'from-amber-500 to-orange-600',\r\n        bgLight: 'bg-amber-50 dark:bg-amber-900/20',\r\n        text: 'text-amber-600 dark:text-amber-400',\r\n    },\r\n    APPROVED: {\r\n        Icon: CheckCircleIcon,\r\n        gradient: 'from-emerald-500 to-teal-600',\r\n        bgLight: 'bg-emerald-50 dark:bg-emerald-900/20',\r\n        text: 'text-emerald-600 dark:text-emerald-400',\r\n    },\r\n    REJECTED: {\r\n        Icon: XCircleIcon,\r\n        gradient: 'from-red-500 to-rose-600',\r\n        bgLight: 'bg-red-50 dark:bg-red-900/20',\r\n        text: 'text-red-600 dark:text-red-400',\r\n    },\r\n    REFUNDED: {\r\n        Icon: ShieldCheckIcon,\r\n        gradient: 'from-blue-500 to-indigo-600',\r\n        bgLight: 'bg-blue-50 dark:bg-blue-900/20',\r\n        text: 'text-blue-600 dark:text-blue-400',\r\n    },\r\n};\r\n\r\nexport default function RefundsPage() {\r\n    const { t } = useLanguage();\r\n    const [returns, setReturns] = useState<Return[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [statusFilter, setStatusFilter] = useState('');\r\n    const [selectedReturn, setSelectedReturn] = useState<Return | null>(null);\r\n    const [showApproveModal, setShowApproveModal] = useState(false);\r\n    const [showCreateModal, setShowCreateModal] = useState(false);\r\n\r\n    useEffect(() => {\r\n        fetchReturns();\r\n    }, [statusFilter]);\r\n\r\n    const fetchReturns = async () => {\r\n        setLoading(true);\r\n        try {\r\n            const params = new URLSearchParams();\r\n            if (statusFilter) params.append('status', statusFilter);\r\n\r\n            const response = await fetch(`/api/returns?${params}`);\r\n            if (!response.ok) throw new Error('Failed to fetch returns');\r\n\r\n            const data = await response.json();\r\n            setReturns(data);\r\n        } catch (error) {\r\n            console.error('Error fetching returns:', error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleApprove = (returnData: Return) => {\r\n        setSelectedReturn(returnData);\r\n        setShowApproveModal(true);\r\n    };\r\n\r\n    const handleReject = async (returnId: string) => {\r\n        const reason = prompt(t('finance.refunds.rejectReasonPrompt'));\r\n        if (!reason) return;\r\n\r\n        try {\r\n            const response = await fetch(`/api/v2/returns/${returnId}/reject`, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ reason }),\r\n            });\r\n\r\n            if (!response.ok) throw new Error('Failed to reject return');\r\n            fetchReturns();\r\n        } catch (error) {\r\n            console.error('Error rejecting return:', error);\r\n            alert(t('finance.refunds.rejectFailed'));\r\n        }\r\n    };\r\n\r\n    // Calculate stats\r\n    const stats = useMemo(() => {\r\n        const pending = returns.filter((r) => r.status === 'PENDING');\r\n        const approved = returns.filter((r) => r.status === 'APPROVED');\r\n        const rejected = returns.filter((r) => r.status === 'REJECTED');\r\n        const refunded = returns.filter((r) => r.isRefunded);\r\n        const totalRefundAmount = refunded.reduce((acc, r) => acc + r.refundAmount, 0);\r\n        const pendingAmount = pending.reduce((acc, r) => acc + r.refundAmount, 0);\r\n\r\n        return {\r\n            pending: pending.length,\r\n            approved: approved.length,\r\n            rejected: rejected.length,\r\n            refunded: refunded.length,\r\n            totalRefundAmount,\r\n            pendingAmount,\r\n            total: returns.length,\r\n        };\r\n    }, [returns]);\r\n\r\n    const getDisplayStatus = (returnItem: Return) => {\r\n        if (returnItem.isRefunded) return 'REFUNDED';\r\n        return returnItem.status;\r\n    };\r\n\r\n    const statuses = ['PENDING', 'APPROVED', 'REJECTED'];\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-gradient-to-br from-gray-50 via-gray-50 to-amber-50 dark:from-gray-900 dark:via-gray-900 dark:to-amber-950\">\r\n            <div className=\"p-6 lg:p-8 max-w-7xl mx-auto\">\r\n                {/* Header */}\r\n                <div className=\"mb-8\">\r\n                    <Link\r\n                        href=\"/finance\"\r\n                        className=\"inline-flex items-center gap-2 text-gray-500 hover:text-primary transition-colors mb-6 group\"\r\n                    >\r\n                        <ArrowLeftIcon className=\"h-5 w-5 group-hover:-translate-x-1 transition-transform\" />\r\n                        <span className=\"text-sm font-medium\">{t('finance.backToFinance')}</span>\r\n                    </Link>\r\n\r\n                    <div className=\"flex flex-col lg:flex-row lg:items-end lg:justify-between gap-4\">\r\n                        <div>\r\n                            <h1 className=\"text-3xl lg:text-4xl font-bold bg-gradient-to-r from-gray-900 to-gray-600 dark:from-white dark:to-gray-400 bg-clip-text text-transparent\">\r\n                                {t('finance.refunds') || 'Returns & Refunds'}\r\n                            </h1>\r\n                            <p className=\"mt-2 text-gray-500 dark:text-gray-400 max-w-2xl\">\r\n                                {t('finance.refunds.pageDescription')}\r\n                            </p>\r\n                        </div>\r\n\r\n                        <button\r\n                            onClick={() => setShowCreateModal(true)}\r\n                            className=\"flex items-center gap-2 px-5 py-3 bg-gradient-to-r from-primary to-blue-600 text-white rounded-xl hover:shadow-lg hover:shadow-primary/25 transition-all font-medium\"\r\n                        >\r\n                            <PlusIcon className=\"h-5 w-5\" />\r\n                            {t('createReturn')}\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Stats Cards */}\r\n                <div className=\"grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8\">\r\n                    <div className=\"bg-white dark:bg-gray-800 rounded-2xl p-5 shadow-theme-sm border border-gray-100 dark:border-gray-700\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <div className=\"w-12 h-12 rounded-xl bg-gradient-to-br from-amber-500 to-orange-600 flex items-center justify-center relative\">\r\n                                <ClockIcon className=\"h-6 w-6 text-white\" />\r\n                                {stats.pending > 0 && (\r\n                                    <span className=\"absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs font-bold rounded-full flex items-center justify-center animate-pulse\">\r\n                                        {stats.pending}\r\n                                    </span>\r\n                                )}\r\n                            </div>\r\n                            <div>\r\n                                <p className=\"text-sm text-gray-500 dark:text-gray-400\">{t('finance.statuses.PENDING') || 'Pending'}</p>\r\n                                <p className=\"text-2xl font-bold text-amber-600 dark:text-amber-400\">${stats.pendingAmount.toFixed(2)}</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"bg-white dark:bg-gray-800 rounded-2xl p-5 shadow-theme-sm border border-gray-100 dark:border-gray-700\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <div className=\"w-12 h-12 rounded-xl bg-gradient-to-br from-emerald-500 to-teal-600 flex items-center justify-center\">\r\n                                <HandThumbUpIcon className=\"h-6 w-6 text-white\" />\r\n                            </div>\r\n                            <div>\r\n                                <p className=\"text-sm text-gray-500 dark:text-gray-400\">{t('finance.statuses.APPROVED') || 'Approved'}</p>\r\n                                <p className=\"text-2xl font-bold text-emerald-600 dark:text-emerald-400\">{stats.approved}</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"bg-white dark:bg-gray-800 rounded-2xl p-5 shadow-theme-sm border border-gray-100 dark:border-gray-700\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <div className=\"w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center\">\r\n                                <ShieldCheckIcon className=\"h-6 w-6 text-white\" />\r\n                            </div>\r\n                            <div>\r\n                                <p className=\"text-sm text-gray-500 dark:text-gray-400\">{t('finance.refunds.totalRefunded') || 'Refunded'}</p>\r\n                                <p className=\"text-2xl font-bold text-blue-600 dark:text-blue-400\">${stats.totalRefundAmount.toFixed(2)}</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"bg-white dark:bg-gray-800 rounded-2xl p-5 shadow-theme-sm border border-gray-100 dark:border-gray-700\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <div className=\"w-12 h-12 rounded-xl bg-gradient-to-br from-red-500 to-rose-600 flex items-center justify-center\">\r\n                                <NoSymbolIcon className=\"h-6 w-6 text-white\" />\r\n                            </div>\r\n                            <div>\r\n                                <p className=\"text-sm text-gray-500 dark:text-gray-400\">{t('finance.statuses.REJECTED') || 'Rejected'}</p>\r\n                                <p className=\"text-2xl font-bold text-red-600 dark:text-red-400\">{stats.rejected}</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Status Filter Pills */}\r\n                <div className=\"bg-white dark:bg-gray-800 rounded-2xl shadow-theme-sm border border-gray-100 dark:border-gray-700 p-5 mb-6\">\r\n                    <div className=\"flex flex-wrap gap-2\">\r\n                        <button\r\n                            onClick={() => setStatusFilter('')}\r\n                            className={`px-4 py-2 rounded-full text-sm font-medium transition-all ${statusFilter === ''\r\n                                ? 'bg-primary text-white shadow-md shadow-primary/25'\r\n                                : 'bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600'\r\n                                }`}\r\n                        >\r\n                            {t('finance.refunds.allStatus')} ({stats.total})\r\n                        </button>\r\n                        {statuses.map((status) => {\r\n                            const config = statusConfig[status];\r\n                            const count = status === 'PENDING' ? stats.pending : status === 'APPROVED' ? stats.approved : stats.rejected;\r\n                            return (\r\n                                <button\r\n                                    key={status}\r\n                                    onClick={() => setStatusFilter(status)}\r\n                                    className={`flex items-center gap-2 px-4 py-2 rounded-full text-sm font-medium transition-all ${statusFilter === status\r\n                                        ? `bg-gradient-to-r ${config.gradient} text-white shadow-md`\r\n                                        : 'bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600'\r\n                                        }`}\r\n                                >\r\n                                    <config.Icon className=\"h-5 w-5\" />\r\n                                    {t(`finance.statuses.${status}`)} ({count})\r\n                                </button>\r\n                            );\r\n                        })}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Content */}\r\n                {loading ? (\r\n                    <div className=\"flex flex-col items-center justify-center py-20\">\r\n                        <div className=\"w-16 h-16 rounded-2xl bg-gradient-to-br from-amber-500 to-orange-600 flex items-center justify-center animate-pulse\">\r\n                            <ArrowPathIcon className=\"h-8 w-8 text-white animate-spin\" />\r\n                        </div>\r\n                        <p className=\"mt-4 text-gray-500 dark:text-gray-400\">{t('finance.refunds.loading')}</p>\r\n                    </div>\r\n                ) : returns.length === 0 ? (\r\n                    <div className=\"flex flex-col items-center justify-center py-20 bg-white dark:bg-gray-800 rounded-2xl shadow-theme-sm border border-gray-100 dark:border-gray-700\">\r\n                        <div className=\"w-24 h-24 rounded-3xl bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-700 dark:to-gray-600 flex items-center justify-center mb-6\">\r\n                            <ArrowUturnLeftIcon className=\"h-12 w-12 text-gray-400 dark:text-gray-500\" />\r\n                        </div>\r\n                        <h3 className=\"text-xl font-semibold text-gray-900 dark:text-white mb-2\">{t('finance.refunds.noReturns')}</h3>\r\n                        <p className=\"text-gray-500 dark:text-gray-400 text-center max-w-md mb-6\">No return requests found for the selected filter.</p>\r\n                        <button\r\n                            onClick={() => setShowCreateModal(true)}\r\n                            className=\"flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-primary to-blue-600 text-white rounded-xl hover:shadow-lg hover:shadow-primary/25 transition-all font-medium\"\r\n                        >\r\n                            <PlusIcon className=\"h-5 w-5\" />\r\n                            {t('createReturn')}\r\n                        </button>\r\n                    </div>\r\n                ) : (\r\n                    /* Returns Cards */\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4\">\r\n                        {returns.map((returnItem) => {\r\n                            const displayStatus = getDisplayStatus(returnItem);\r\n                            const config = statusConfig[displayStatus];\r\n\r\n                            return (\r\n                                <div\r\n                                    key={returnItem.id}\r\n                                    className=\"group bg-white dark:bg-gray-800 rounded-2xl shadow-theme-sm border border-gray-100 dark:border-gray-700 overflow-hidden hover:shadow-theme-lg transition-all duration-300\"\r\n                                >\r\n                                    {/* Status Bar */}\r\n                                    <div className={`h-2 bg-gradient-to-r ${config.gradient}`} />\r\n\r\n                                    <div className=\"p-5\">\r\n                                        {/* Header */}\r\n                                        <div className=\"flex items-start justify-between mb-4\">\r\n                                            <div className=\"flex items-center gap-3\">\r\n                                                <div className={`w-11 h-11 rounded-xl bg-gradient-to-br ${config.gradient} flex items-center justify-center shadow-lg`}>\r\n                                                    <config.Icon className=\"h-5 w-5 text-white\" />\r\n                                                </div>\r\n                                                <div>\r\n                                                    <Link\r\n                                                        href={`/tickets/${returnItem.ticketId}`}\r\n                                                        className=\"font-semibold text-primary hover:underline\"\r\n                                                    >\r\n                                                        {returnItem.ticket.ticketNumber}\r\n                                                    </Link>\r\n                                                    <span className={`block px-2 py-0.5 rounded-full text-xs font-medium ${config.bgLight} ${config.text} w-fit mt-1`}>\r\n                                                        {displayStatus}\r\n                                                    </span>\r\n                                                </div>\r\n                                            </div>\r\n\r\n                                            <div className=\"text-right\">\r\n                                                <p className=\"text-xl font-bold text-red-500\">-${returnItem.refundAmount.toFixed(2)}</p>\r\n                                                {returnItem.isRefunded && (\r\n                                                    <span className=\"inline-flex items-center gap-1 text-xs text-blue-600 dark:text-blue-400 font-medium\">\r\n                                                        <ShieldCheckIcon className=\"h-4 w-4\" />\r\n                                                        {t('finance.refunds.refunded')}\r\n                                                    </span>\r\n                                                )}\r\n                                            </div>\r\n                                        </div>\r\n\r\n                                        {/* Customer Info */}\r\n                                        <div className=\"space-y-3 pt-4 border-t border-gray-100 dark:border-gray-700\">\r\n                                            <div className=\"flex items-center gap-3\">\r\n                                                <div className=\"w-8 h-8 rounded-lg bg-gray-100 dark:bg-gray-700 flex items-center justify-center\">\r\n                                                    <UserIcon className=\"h-5 w-5 text-gray-500\" />\r\n                                                </div>\r\n                                                <div className=\"flex-1 min-w-0\">\r\n                                                    <p className=\"text-sm font-medium text-gray-900 dark:text-white truncate\">{returnItem.ticket.customer.name}</p>\r\n                                                    <p className=\"text-xs text-gray-500 dark:text-gray-400\">{returnItem.ticket.customer.phone}</p>\r\n                                                </div>\r\n                                            </div>\r\n\r\n                                            {/* Reason */}\r\n                                            <div className=\"flex items-start gap-3\">\r\n                                                <div className=\"w-8 h-8 rounded-lg bg-gray-100 dark:bg-gray-700 flex items-center justify-center flex-shrink-0\">\r\n                                                    <ChatBubbleLeftIcon className=\"h-5 w-5 text-gray-500\" />\r\n                                                </div>\r\n                                                <p className=\"text-sm text-gray-600 dark:text-gray-300 line-clamp-2\">{returnItem.reason}</p>\r\n                                            </div>\r\n\r\n                                            {/* Meta Info */}\r\n                                            <div className=\"flex items-center gap-4 text-xs text-gray-500 dark:text-gray-400\">\r\n                                                <div className=\"flex items-center gap-1.5\">\r\n                                                    <CalendarIcon className=\"h-4 w-4\" />\r\n                                                    {new Date(returnItem.createdAt).toLocaleDateString()}\r\n                                                </div>\r\n                                                {returnItem.handledByUser && (\r\n                                                    <div className=\"flex items-center gap-1.5\">\r\n                                                        <IdentificationIcon className=\"h-4 w-4\" />\r\n                                                        {returnItem.handledByUser.name || returnItem.handledByUser.username}\r\n                                                    </div>\r\n                                                )}\r\n                                            </div>\r\n                                        </div>\r\n\r\n                                        {/* Actions */}\r\n                                        {returnItem.status === 'PENDING' && !returnItem.isRefunded && (\r\n                                            <div className=\"flex gap-2 mt-4 pt-4 border-t border-gray-100 dark:border-gray-700\">\r\n                                                <button\r\n                                                    onClick={() => handleApprove(returnItem)}\r\n                                                    className=\"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-gradient-to-r from-emerald-500 to-teal-600 text-white rounded-xl hover:shadow-lg hover:shadow-emerald-500/25 transition-all font-medium text-sm\"\r\n                                                >\r\n                                                    <CheckIcon className=\"h-5 w-5\" />\r\n                                                    {t('finance.approveReturn')}\r\n                                                </button>\r\n                                                <button\r\n                                                    onClick={() => handleReject(returnItem.id)}\r\n                                                    className=\"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-gradient-to-r from-red-500 to-rose-600 text-white rounded-xl hover:shadow-lg hover:shadow-red-500/25 transition-all font-medium text-sm\"\r\n                                                >\r\n                                                    <XMarkIcon className=\"h-5 w-5\" />\r\n                                                    {t('finance.rejectReturn')}\r\n                                                </button>\r\n                                            </div>\r\n                                        )}\r\n\r\n                                        {returnItem.status === 'APPROVED' && returnItem.isRefunded && (\r\n                                            <div className=\"flex items-center justify-center gap-2 mt-4 pt-4 border-t border-gray-100 dark:border-gray-700\">\r\n                                                <CheckCircleIcon className=\"h-5 w-5 text-blue-500\" />\r\n                                                <span className=\"text-sm font-medium text-blue-600 dark:text-blue-400\">{t('finance.refunds.complete')}</span>\r\n                                            </div>\r\n                                        )}\r\n\r\n                                        {returnItem.status === 'REJECTED' && (\r\n                                            <div className=\"flex items-center justify-center gap-2 mt-4 pt-4 border-t border-gray-100 dark:border-gray-700\">\r\n                                                <XCircleIcon className=\"h-5 w-5 text-red-500\" />\r\n                                                <span className=\"text-sm font-medium text-red-600 dark:text-red-400\">{t('finance.refunds.rejected')}</span>\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n                                </div>\r\n                            );\r\n                        })}\r\n                    </div>\r\n                )}\r\n\r\n                {/* Approve Modal */}\r\n                {showApproveModal && selectedReturn && (\r\n                    <ApproveReturnModal\r\n                        returnData={{\r\n                            id: selectedReturn.id,\r\n                            refundAmount: selectedReturn.refundAmount,\r\n                            ticketId: selectedReturn.ticketId,\r\n                            reason: selectedReturn.reason,\r\n                        }}\r\n                        onClose={() => {\r\n                            setShowApproveModal(false);\r\n                            setSelectedReturn(null);\r\n                        }}\r\n                        onSuccess={() => {\r\n                            setShowApproveModal(false);\r\n                            setSelectedReturn(null);\r\n                            fetchReturns();\r\n                        }}\r\n                    />\r\n                )}\r\n\r\n                {/* Create Return Modal */}\r\n                <CreateReturnModal\r\n                    isOpen={showCreateModal}\r\n                    onClose={() => setShowCreateModal(false)}\r\n                    onSuccess={fetchReturns}\r\n                />\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\(main)\\forgot-password\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\(main)\\inventory\\inventory-adjustments\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchAdjustments'. Either include it or remove the dependency array.","line":84,"column":8,"nodeType":"ArrayExpression","endLine":84,"endColumn":26,"suggestions":[{"desc":"Update the dependencies array to be: [fetchAdjustments, page, searchTerm]","fix":{"range":[2414,2432],"text":"[fetchAdjustments, page, searchTerm]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect, useMemo } from 'react';\r\nimport { useLanguage } from '@/contexts/language-context';\r\nimport Link from 'next/link';\r\nimport { InventoryAdjustmentFormModal } from '@/components/finance/InventoryAdjustmentFormModal';\r\nimport {\r\n    ArrowLeftIcon,\r\n    RectangleStackIcon,\r\n    TableCellsIcon,\r\n    PlusIcon,\r\n    ArrowUpIcon,\r\n    ArrowDownIcon,\r\n    ShoppingBagIcon,\r\n    ArrowsRightLeftIcon,\r\n    MagnifyingGlassIcon,\r\n    PlusCircleIcon,\r\n    MinusCircleIcon,\r\n    ArrowPathIcon,\r\n    CubeIcon,\r\n    CalendarDaysIcon,\r\n    CurrencyDollarIcon,\r\n    ClockIcon,\r\n    UserIcon,\r\n    LinkIcon,\r\n    ChevronLeftIcon,\r\n    ChevronRightIcon,\r\n} from '@heroicons/react/24/outline';\r\nimport { ComponentType, SVGProps } from 'react';\r\n\r\ninterface InventoryAdjustment {\r\n    id: string;\r\n    partId: string;\r\n    qtyChange: number;\r\n    cost: number;\r\n    costPerUnit: number | null;\r\n    reason: string;\r\n    relatedReturnId: string | null;\r\n    createdAt: string;\r\n    part: {\r\n        name: string;\r\n        sku: string;\r\n        quantity: number;\r\n        supplier: {\r\n            id: string;\r\n            name: string;\r\n        } | null;\r\n    };\r\n    createdByUser: {\r\n        name: string | null;\r\n        username: string;\r\n    };\r\n}\r\n\r\nconst adjustmentTypeConfig = {\r\n    increase: {\r\n        Icon: PlusCircleIcon,\r\n        gradient: 'from-emerald-500 to-teal-600',\r\n        bgLight: 'bg-emerald-50 dark:bg-emerald-900/20',\r\n        text: 'text-emerald-600 dark:text-emerald-400',\r\n    },\r\n    decrease: {\r\n        Icon: MinusCircleIcon,\r\n        gradient: 'from-red-500 to-rose-600',\r\n        bgLight: 'bg-red-50 dark:bg-red-900/20',\r\n        text: 'text-red-600 dark:text-red-400',\r\n    },\r\n};\r\n\r\nexport default function InventoryAdjustmentsPage() {\r\n    const { t } = useLanguage();\r\n    const [adjustments, setAdjustments] = useState<InventoryAdjustment[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [page, setPage] = useState(1);\r\n    const [total, setTotal] = useState(0);\r\n    const [showAddModal, setShowAddModal] = useState(false);\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [typeFilter, setTypeFilter] = useState<'all' | 'increase' | 'decrease'>('all');\r\n    const [viewMode, setViewMode] = useState<'cards' | 'table'>('cards');\r\n    const limit = 25;\r\n\r\n    useEffect(() => {\r\n        fetchAdjustments();\r\n    }, [page, searchTerm]);\r\n\r\n    const fetchAdjustments = async () => {\r\n        setLoading(true);\r\n        try {\r\n            const params = new URLSearchParams({\r\n                page: page.toString(),\r\n                limit: limit.toString(),\r\n            });\r\n\r\n            const response = await fetch(`/api/v2/inventory-adjustments?${params}`);\r\n            if (!response.ok) throw new Error('Failed to fetch inventory adjustments');\r\n\r\n            const data = await response.json();\r\n            setAdjustments(data.data);\r\n            setTotal(data.pagination.total);\r\n        } catch (error) {\r\n            console.error('Error fetching inventory adjustments:', error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    // Calculate stats\r\n    const stats = useMemo(() => {\r\n        const increases = adjustments.filter((a) => a.qtyChange > 0);\r\n        const decreases = adjustments.filter((a) => a.qtyChange < 0);\r\n        const totalIncrease = increases.reduce((acc, a) => acc + a.qtyChange, 0);\r\n        const totalDecrease = decreases.reduce((acc, a) => acc + Math.abs(a.qtyChange), 0);\r\n        const totalCostIn = increases.reduce((acc, a) => acc + a.cost, 0);\r\n        const totalCostOut = decreases.reduce((acc, a) => acc + a.cost, 0);\r\n\r\n        return {\r\n            increases: increases.length,\r\n            decreases: decreases.length,\r\n            totalIncrease,\r\n            totalDecrease,\r\n            totalCostIn,\r\n            totalCostOut,\r\n            netChange: totalIncrease - totalDecrease,\r\n        };\r\n    }, [adjustments]);\r\n\r\n    // Filter adjustments\r\n    const filteredAdjustments = useMemo(() => {\r\n        let filtered = adjustments;\r\n\r\n        if (typeFilter === 'increase') {\r\n            filtered = filtered.filter((a) => a.qtyChange > 0);\r\n        } else if (typeFilter === 'decrease') {\r\n            filtered = filtered.filter((a) => a.qtyChange < 0);\r\n        }\r\n\r\n        if (searchTerm) {\r\n            const term = searchTerm.toLowerCase();\r\n            filtered = filtered.filter(\r\n                (a) =>\r\n                    a.part.name.toLowerCase().includes(term) ||\r\n                    a.part.sku.toLowerCase().includes(term) ||\r\n                    a.reason.toLowerCase().includes(term)\r\n            );\r\n        }\r\n\r\n        return filtered;\r\n    }, [adjustments, typeFilter, searchTerm]);\r\n\r\n    // Group adjustments by date\r\n    const groupedAdjustments = useMemo(() => {\r\n        const groups: Record<string, InventoryAdjustment[]> = {};\r\n        filteredAdjustments.forEach((adjustment) => {\r\n            const date = new Date(adjustment.createdAt).toLocaleDateString();\r\n            if (!groups[date]) groups[date] = [];\r\n            groups[date].push(adjustment);\r\n        });\r\n        return groups;\r\n    }, [filteredAdjustments]);\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-gradient-to-br from-gray-50 via-gray-50 to-indigo-50 dark:from-gray-900 dark:via-gray-900 dark:to-indigo-950\">\r\n            <div className=\"p-6 lg:p-8 max-w-7xl mx-auto\">\r\n                {/* Header */}\r\n                <div className=\"mb-8\">\r\n                    <Link\r\n                        href=\"/inventory/stock\"\r\n                        className=\"inline-flex items-center gap-2 text-gray-500 hover:text-primary transition-colors mb-6 group\"\r\n                    >\r\n                        <ArrowLeftIcon className=\"h-5 w-5 group-hover:-translate-x-1 transition-transform\" />\r\n                        <span className=\"text-sm font-medium\">{t('inventory.backToInventory')}</span>\r\n                    </Link>\r\n\r\n                    <div className=\"flex flex-col lg:flex-row lg:items-end lg:justify-between gap-4\">\r\n                        <div>\r\n                            <h1 className=\"text-3xl lg:text-4xl font-bold bg-gradient-to-r from-gray-900 to-gray-600 dark:from-white dark:to-gray-400 bg-clip-text text-transparent\">\r\n                                {t('finance.inventory') || 'Inventory Adjustments'}\r\n                            </h1>\r\n                            <p className=\"mt-2 text-gray-500 dark:text-gray-400 max-w-2xl\">\r\n                                {t('finance.inventory.pageDescription')}\r\n                            </p>\r\n                        </div>\r\n\r\n                        <div className=\"flex items-center gap-3\">\r\n                            {/* View Toggle */}\r\n                            <div className=\"flex items-center gap-1 bg-white dark:bg-gray-800 rounded-xl p-1 shadow-theme-sm\">\r\n                                <button\r\n                                    onClick={() => setViewMode('cards')}\r\n                                    className={`flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-all ${viewMode === 'cards'\r\n                                        ? 'bg-primary text-white shadow-md'\r\n                                        : 'text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700'\r\n                                        }`}\r\n                                >\r\n                                    <RectangleStackIcon className=\"h-[18px] w-[18px]\" />\r\n                                </button>\r\n                                <button\r\n                                    onClick={() => setViewMode('table')}\r\n                                    className={`flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-all ${viewMode === 'table'\r\n                                        ? 'bg-primary text-white shadow-md'\r\n                                        : 'text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700'\r\n                                        }`}\r\n                                >\r\n                                    <TableCellsIcon className=\"h-[18px] w-[18px]\" />\r\n                                </button>\r\n                            </div>\r\n\r\n                            {/* Add Button */}\r\n                            <button\r\n                                onClick={() => setShowAddModal(true)}\r\n                                className=\"flex items-center gap-2 px-5 py-3 bg-gradient-to-r from-primary to-blue-600 text-white rounded-xl hover:shadow-lg hover:shadow-primary/25 transition-all font-medium\"\r\n                            >\r\n                                <PlusIcon className=\"h-5 w-5\" />\r\n                                {t('finance.inventory.addAdjustment')}\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Stats Cards */}\r\n                <div className=\"grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8\">\r\n                    <div className=\"bg-white dark:bg-gray-800 rounded-2xl p-5 shadow-theme-sm border border-gray-100 dark:border-gray-700\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <div className=\"w-12 h-12 rounded-xl bg-gradient-to-br from-emerald-500 to-teal-600 flex items-center justify-center\">\r\n                                <ArrowUpIcon className=\"h-6 w-6 text-white\" />\r\n                            </div>\r\n                            <div>\r\n                                <p className=\"text-sm text-gray-500 dark:text-gray-400\">{t('finance.inventory.stockIn') || 'Stock In'}</p>\r\n                                <p className=\"text-2xl font-bold text-emerald-600 dark:text-emerald-400\">+{stats.totalIncrease}</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"bg-white dark:bg-gray-800 rounded-2xl p-5 shadow-theme-sm border border-gray-100 dark:border-gray-700\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <div className=\"w-12 h-12 rounded-xl bg-gradient-to-br from-red-500 to-rose-600 flex items-center justify-center\">\r\n                                <ArrowDownIcon className=\"h-6 w-6 text-white\" />\r\n                            </div>\r\n                            <div>\r\n                                <p className=\"text-sm text-gray-500 dark:text-gray-400\">{t('finance.inventory.stockOut') || 'Stock Out'}</p>\r\n                                <p className=\"text-2xl font-bold text-red-600 dark:text-red-400\">-{stats.totalDecrease}</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"bg-white dark:bg-gray-800 rounded-2xl p-5 shadow-theme-sm border border-gray-100 dark:border-gray-700\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <div className=\"w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center\">\r\n                                <ShoppingBagIcon className=\"h-6 w-6 text-white\" />\r\n                            </div>\r\n                            <div>\r\n                                <p className=\"text-sm text-gray-500 dark:text-gray-400\">{t('finance.inventory.costIn') || 'Cost (In)'}</p>\r\n                                <p className=\"text-2xl font-bold text-blue-600 dark:text-blue-400\">${stats.totalCostIn.toFixed(2)}</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"bg-white dark:bg-gray-800 rounded-2xl p-5 shadow-theme-sm border border-gray-100 dark:border-gray-700\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <div className={`w-12 h-12 rounded-xl bg-gradient-to-br ${stats.netChange >= 0 ? 'from-emerald-500 to-teal-600' : 'from-red-500 to-rose-600'} flex items-center justify-center`}>\r\n                                <ArrowsRightLeftIcon className=\"h-6 w-6 text-white\" />\r\n                            </div>\r\n                            <div>\r\n                                <p className=\"text-sm text-gray-500 dark:text-gray-400\">{t('finance.inventory.netChange') || 'Net Change'}</p>\r\n                                <p className={`text-2xl font-bold ${stats.netChange >= 0 ? 'text-emerald-600 dark:text-emerald-400' : 'text-red-600 dark:text-red-400'}`}>\r\n                                    {stats.netChange >= 0 ? '+' : ''}{stats.netChange}\r\n                                </p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Filters */}\r\n                <div className=\"bg-white dark:bg-gray-800 rounded-2xl shadow-theme-sm border border-gray-100 dark:border-gray-700 p-5 mb-6\">\r\n                    <div className=\"flex flex-col lg:flex-row gap-4 items-start lg:items-center\">\r\n                        {/* Search */}\r\n                        <div className=\"flex-1 w-full lg:w-auto\">\r\n                            <div className=\"relative\">\r\n                                <MagnifyingGlassIcon className=\"h-5 w-5 absolute left-4 top-1/2 -translate-y-1/2 text-gray-400\" />\r\n                                <input\r\n                                    type=\"text\"\r\n                                    value={searchTerm}\r\n                                    onChange={(e) => setSearchTerm(e.target.value)}\r\n                                    placeholder=\"Search by part name, SKU, or reason...\"\r\n                                    className=\"w-full pl-12 pr-4 py-3 bg-gray-50 dark:bg-gray-700/50 border border-gray-200 dark:border-gray-600 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all text-sm\"\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Type Filter Pills */}\r\n                        <div className=\"flex flex-wrap gap-2\">\r\n                            <button\r\n                                onClick={() => setTypeFilter('all')}\r\n                                className={`px-4 py-2 rounded-full text-sm font-medium transition-all ${typeFilter === 'all'\r\n                                    ? 'bg-primary text-white shadow-md shadow-primary/25'\r\n                                    : 'bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600'\r\n                                    }`}\r\n                            >\r\n                                All ({adjustments.length})\r\n                            </button>\r\n                            <button\r\n                                onClick={() => setTypeFilter('increase')}\r\n                                className={`flex items-center gap-2 px-4 py-2 rounded-full text-sm font-medium transition-all ${typeFilter === 'increase'\r\n                                    ? 'bg-gradient-to-r from-emerald-500 to-teal-600 text-white shadow-md'\r\n                                    : 'bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600'\r\n                                    }`}\r\n                            >\r\n                                <PlusCircleIcon className=\"h-[18px] w-[18px]\" />\r\n                                Stock In ({stats.increases})\r\n                            </button>\r\n                            <button\r\n                                onClick={() => setTypeFilter('decrease')}\r\n                                className={`flex items-center gap-2 px-4 py-2 rounded-full text-sm font-medium transition-all ${typeFilter === 'decrease'\r\n                                    ? 'bg-gradient-to-r from-red-500 to-rose-600 text-white shadow-md'\r\n                                    : 'bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600'\r\n                                    }`}\r\n                            >\r\n                                <MinusCircleIcon className=\"h-[18px] w-[18px]\" />\r\n                                Stock Out ({stats.decreases})\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Content */}\r\n                {loading ? (\r\n                    <div className=\"flex flex-col items-center justify-center py-20\">\r\n                        <div className=\"w-16 h-16 rounded-2xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center animate-pulse\">\r\n                            <ArrowPathIcon className=\"h-8 w-8 text-white animate-spin\" />\r\n                        </div>\r\n                        <p className=\"mt-4 text-gray-500 dark:text-gray-400\">{t('finance.inventory.loading')}</p>\r\n                    </div>\r\n                ) : filteredAdjustments.length === 0 ? (\r\n                    <div className=\"flex flex-col items-center justify-center py-20 bg-white dark:bg-gray-800 rounded-2xl shadow-theme-sm border border-gray-100 dark:border-gray-700\">\r\n                        <div className=\"w-24 h-24 rounded-3xl bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-700 dark:to-gray-600 flex items-center justify-center mb-6\">\r\n                            <CubeIcon className=\"h-12 w-12 text-gray-400 dark:text-gray-500\" />\r\n                        </div>\r\n                        <h3 className=\"text-xl font-semibold text-gray-900 dark:text-white mb-2\">{t('finance.inventory.noAdjustments')}</h3>\r\n                        <p className=\"text-gray-500 dark:text-gray-400 text-center max-w-md mb-6\">No inventory adjustments found for the selected filters.</p>\r\n                        <button\r\n                            onClick={() => setShowAddModal(true)}\r\n                            className=\"flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-primary to-blue-600 text-white rounded-xl hover:shadow-lg hover:shadow-primary/25 transition-all font-medium\"\r\n                        >\r\n                            <PlusIcon className=\"h-5 w-5\" />\r\n                            {t('finance.inventory.addAdjustment')}\r\n                        </button>\r\n                    </div>\r\n                ) : viewMode === 'cards' ? (\r\n                    /* Timeline Cards View */\r\n                    <div className=\"space-y-6\">\r\n                        {Object.entries(groupedAdjustments).map(([date, dateAdjustments]) => {\r\n                            const dayIn = dateAdjustments.filter((a) => a.qtyChange > 0).reduce((acc, a) => acc + a.qtyChange, 0);\r\n                            const dayOut = dateAdjustments.filter((a) => a.qtyChange < 0).reduce((acc, a) => acc + Math.abs(a.qtyChange), 0);\r\n\r\n                            return (\r\n                                <div key={date}>\r\n                                    {/* Date Header */}\r\n                                    <div className=\"flex items-center gap-3 mb-4\">\r\n                                        <div className=\"w-10 h-10 rounded-xl bg-gray-100 dark:bg-gray-800 flex items-center justify-center\">\r\n                                            <CalendarDaysIcon className=\"h-5 w-5 text-gray-500\" />\r\n                                        </div>\r\n                                        <div>\r\n                                            <p className=\"font-semibold text-gray-900 dark:text-white\">{date}</p>\r\n                                            <p className=\"text-xs text-gray-500\">{dateAdjustments.length} adjustment{dateAdjustments.length > 1 ? 's' : ''}</p>\r\n                                        </div>\r\n                                        <div className=\"flex-1 h-px bg-gray-200 dark:bg-gray-700 ml-4\" />\r\n                                        <div className=\"flex items-center gap-3 text-sm font-medium\">\r\n                                            {dayIn > 0 && <span className=\"text-emerald-600 dark:text-emerald-400\">+{dayIn}</span>}\r\n                                            {dayOut > 0 && <span className=\"text-red-600 dark:text-red-400\">-{dayOut}</span>}\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    {/* Adjustment Cards */}\r\n                                    <div className=\"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 ml-5 pl-8 border-l-2 border-gray-200 dark:border-gray-700\">\r\n                                        {dateAdjustments.map((adjustment) => {\r\n                                            const isIncrease = adjustment.qtyChange > 0;\r\n                                            const config = isIncrease ? adjustmentTypeConfig.increase : adjustmentTypeConfig.decrease;\r\n\r\n                                            return (\r\n                                                <div\r\n                                                    key={adjustment.id}\r\n                                                    className=\"group bg-white dark:bg-gray-800 rounded-2xl shadow-theme-sm border border-gray-100 dark:border-gray-700 overflow-hidden hover:shadow-theme-lg hover:border-primary/20 transition-all duration-300\"\r\n                                                >\r\n                                                    <div className={`h-1.5 bg-gradient-to-r ${config.gradient}`} />\r\n\r\n                                                    <div className=\"p-5\">\r\n                                                        <div className=\"flex items-start justify-between mb-4\">\r\n                                                            <div className=\"flex items-center gap-3\">\r\n                                                                <div className={`w-11 h-11 rounded-xl bg-gradient-to-br ${config.gradient} flex items-center justify-center shadow-lg`}>\r\n                                                                    <config.Icon className=\"h-5 w-5 text-white\" />\r\n                                                                </div>\r\n                                                                <div>\r\n                                                                    <p className=\"font-semibold text-gray-900 dark:text-white\">{adjustment.part.name}</p>\r\n                                                                    <span className=\"inline-block px-2 py-0.5 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 text-xs font-mono rounded\">\r\n                                                                        {adjustment.part.sku}\r\n                                                                    </span>\r\n                                                                </div>\r\n                                                            </div>\r\n\r\n                                                            <div className=\"text-right\">\r\n                                                                <p className={`text-xl font-bold ${config.text}`}>\r\n                                                                    {isIncrease ? '+' : ''}{adjustment.qtyChange}\r\n                                                                </p>\r\n                                                                <p className=\"text-xs text-gray-500\">{t('finance.inventory.units')}</p>\r\n                                                            </div>\r\n                                                        </div>\r\n\r\n                                                        {/* Reason */}\r\n                                                        <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-4 line-clamp-2\">{adjustment.reason}</p>\r\n\r\n                                                        {/* Meta Info */}\r\n                                                        <div className=\"pt-4 border-t border-gray-100 dark:border-gray-700\">\r\n                                                            <div className=\"grid grid-cols-2 gap-3 text-sm\">\r\n                                                                <div className=\"flex items-center gap-2\">\r\n                                                                    <CurrencyDollarIcon className=\"h-[18px] w-[18px] text-gray-400\" />\r\n                                                                    <div>\r\n                                                                        <p className=\"text-xs text-gray-500\">{t('finance.inventory.totalCost')}</p>\r\n                                                                        <p className={`font-semibold ${isIncrease ? 'text-red-500' : 'text-emerald-500'}`}>\r\n                                                                            ${adjustment.cost.toFixed(2)}\r\n                                                                        </p>\r\n                                                                    </div>\r\n                                                                </div>\r\n                                                                <div className=\"flex items-center gap-2\">\r\n                                                                    <CubeIcon className=\"h-[18px] w-[18px] text-gray-400\" />\r\n                                                                    <div>\r\n                                                                        <p className=\"text-xs text-gray-500\">{t('finance.currentStock')}</p>\r\n                                                                        <p className=\"font-semibold text-gray-900 dark:text-white\">{adjustment.part.quantity}</p>\r\n                                                                    </div>\r\n                                                                </div>\r\n                                                            </div>\r\n\r\n                                                            <div className=\"flex items-center justify-between mt-3 pt-3 border-t border-gray-100 dark:border-gray-700\">\r\n                                                                <div className=\"flex items-center gap-1.5 text-xs text-gray-500\">\r\n                                                                    <ClockIcon className=\"h-4 w-4\" />\r\n                                                                    {new Date(adjustment.createdAt).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\r\n                                                                </div>\r\n                                                                <div className=\"flex items-center gap-1.5 text-xs text-gray-500\">\r\n                                                                    <UserIcon className=\"h-4 w-4\" />\r\n                                                                    {adjustment.createdByUser.name || adjustment.createdByUser.username}\r\n                                                                </div>\r\n                                                            </div>\r\n\r\n                                                            {adjustment.relatedReturnId && (\r\n                                                                <div className=\"mt-3 flex items-center gap-2 px-3 py-2 bg-blue-50 dark:bg-blue-900/20 rounded-lg\">\r\n                                                                    <LinkIcon className=\"h-4 w-4 text-blue-500\" />\r\n                                                                    <span className=\"text-xs font-medium text-blue-600 dark:text-blue-400\">{t('finance.linkedToReturn')}</span>\r\n                                                                </div>\r\n                                                            )}\r\n                                                        </div>\r\n                                                    </div>\r\n                                                </div>\r\n                                            );\r\n                                        })}\r\n                                    </div>\r\n                                </div>\r\n                            );\r\n                        })}\r\n                    </div>\r\n                ) : (\r\n                    /* Table View */\r\n                    <div className=\"bg-white dark:bg-gray-800 rounded-2xl shadow-theme-sm border border-gray-100 dark:border-gray-700 overflow-hidden\">\r\n                        <div className=\"overflow-x-auto\">\r\n                            <table className=\"min-w-full\">\r\n                                <thead>\r\n                                    <tr className=\"bg-gray-50 dark:bg-gray-700/50 border-b border-gray-100 dark:border-gray-700\">\r\n                                        <th className=\"px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider\">{t('finance.expenses.part')}</th>\r\n                                        <th className=\"px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider\">{t('finance.inventory.sku')}</th>\r\n                                        <th className=\"px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider\">{t('finance.qtyChange')}</th>\r\n                                        <th className=\"px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider\">{t('finance.inventory.totalCost')}</th>\r\n                                        <th className=\"px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider\">{t('finance.costPerUnit')}</th>\r\n                                        <th className=\"px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider\">{t('finance.currentStock')}</th>\r\n                                        <th className=\"px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider\">{t('finance.reason')}</th>\r\n                                        <th className=\"px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider\">{t('finance.date')}</th>\r\n                                        <th className=\"px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider\">{t('finance.expenses.createdBy')}</th>\r\n                                    </tr>\r\n                                </thead>\r\n                                <tbody className=\"divide-y divide-gray-100 dark:divide-gray-700\">\r\n                                    {filteredAdjustments.map((adjustment) => {\r\n                                        const isIncrease = adjustment.qtyChange > 0;\r\n                                        const config = isIncrease ? adjustmentTypeConfig.increase : adjustmentTypeConfig.decrease;\r\n\r\n                                        return (\r\n                                            <tr key={adjustment.id} className=\"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors\">\r\n                                                <td className=\"px-6 py-4\">\r\n                                                    <p className=\"font-medium text-gray-900 dark:text-white\">{adjustment.part.name}</p>\r\n                                                </td>\r\n                                                <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                                                    <span className=\"px-2 py-1 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 text-xs font-mono rounded\">\r\n                                                        {adjustment.part.sku}\r\n                                                    </span>\r\n                                                </td>\r\n                                                <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                                                    <span className={`inline-flex items-center gap-1 text-base font-semibold ${config.text}`}>\r\n                                                        {isIncrease ? <PlusIcon className=\"h-[18px] w-[18px]\" /> : <MinusCircleIcon className=\"h-[18px] w-[18px]\" />}\r\n                                                        {Math.abs(adjustment.qtyChange)}\r\n                                                    </span>\r\n                                                </td>\r\n                                                <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                                                    <span className={`font-medium ${isIncrease ? 'text-red-500' : 'text-emerald-500'}`}>\r\n                                                        ${adjustment.cost.toFixed(2)}\r\n                                                    </span>\r\n                                                </td>\r\n                                                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-gray-300\">\r\n                                                    ${(adjustment.costPerUnit || 0).toFixed(2)}\r\n                                                </td>\r\n                                                <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                                                    <span className=\"px-3 py-1 bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white text-sm font-medium rounded-full\">\r\n                                                        {adjustment.part.quantity}\r\n                                                    </span>\r\n                                                </td>\r\n                                                <td className=\"px-6 py-4 max-w-xs\">\r\n                                                    <p className=\"text-sm text-gray-600 dark:text-gray-300 line-clamp-2\">{adjustment.reason}</p>\r\n                                                    {adjustment.relatedReturnId && (\r\n                                                        <div className=\"flex items-center gap-1 mt-1 text-xs text-blue-500\">\r\n                                                            <LinkIcon className=\"h-4 w-4\" />\r\n                                                            {t('finance.linkedToReturn')}\r\n                                                        </div>\r\n                                                    )}\r\n                                                </td>\r\n                                                <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                                                    <p className=\"text-sm text-gray-900 dark:text-white\">{new Date(adjustment.createdAt).toLocaleDateString()}</p>\r\n                                                    <p className=\"text-xs text-gray-500\">{new Date(adjustment.createdAt).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</p>\r\n                                                </td>\r\n                                                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-gray-300\">\r\n                                                    {adjustment.createdByUser.name || adjustment.createdByUser.username}\r\n                                                </td>\r\n                                            </tr>\r\n                                        );\r\n                                    })}\r\n                                </tbody>\r\n                            </table>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Pagination */}\r\n                {total > 0 && (\r\n                    <div className=\"mt-6 flex flex-col sm:flex-row items-center justify-between gap-4 bg-white dark:bg-gray-800 rounded-2xl shadow-theme-sm border border-gray-100 dark:border-gray-700 p-4\">\r\n                        <p className=\"text-sm text-gray-500 dark:text-gray-400\">\r\n                            {t('finance.inventory.showing', { from: (page - 1) * limit + 1, to: Math.min(page * limit, total), total })}\r\n                        </p>\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <button\r\n                                onClick={() => setPage((p) => Math.max(1, p - 1))}\r\n                                disabled={page === 1}\r\n                                className=\"flex items-center gap-1 px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-xl hover:bg-gray-200 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-sm font-medium\"\r\n                            >\r\n                                <ChevronLeftIcon className=\"h-[18px] w-[18px]\" />\r\n                                Previous\r\n                            </button>\r\n                            <span className=\"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300\">\r\n                                Page {page} of {Math.ceil(total / limit)}\r\n                            </span>\r\n                            <button\r\n                                onClick={() => setPage((p) => p + 1)}\r\n                                disabled={page * limit >= total}\r\n                                className=\"flex items-center gap-1 px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-xl hover:bg-gray-200 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-sm font-medium\"\r\n                            >\r\n                                Next\r\n                                <ChevronRightIcon className=\"h-[18px] w-[18px]\" />\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Add Adjustment Modal */}\r\n                {showAddModal && (\r\n                    <InventoryAdjustmentFormModal\r\n                        onClose={() => setShowAddModal(false)}\r\n                        onSuccess={() => {\r\n                            setShowAddModal(false);\r\n                            fetchAdjustments();\r\n                        }}\r\n                    />\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\(main)\\inventory\\stock\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\(main)\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\(main)\\login\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\(main)\\notifications\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\(main)\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\(main)\\reset-password\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\(main)\\settings\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\(main)\\suppliers\\[id]\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\(main)\\suppliers\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\(main)\\tickets\\[id]\\page.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":79,"column":76,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[2335,2379],"text":"The ticket you&apos;re looking for doesn't exist."},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[2335,2379],"text":"The ticket you&lsquo;re looking for doesn't exist."},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[2335,2379],"text":"The ticket you&#39;re looking for doesn't exist."},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[2335,2379],"text":"The ticket you&rsquo;re looking for doesn't exist."},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":79,"column":97,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[2335,2379],"text":"The ticket you're looking for doesn&apos;t exist."},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[2335,2379],"text":"The ticket you're looking for doesn&lsquo;t exist."},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[2335,2379],"text":"The ticket you're looking for doesn&#39;t exist."},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[2335,2379],"text":"The ticket you're looking for doesn&rsquo;t exist."},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"@next/next/no-html-link-for-pages","severity":2,"message":"Do not use an `<a>` element to navigate to `/tickets/`. Use `<Link />` from `next/link` instead. See: https://nextjs.org/docs/messages/no-html-link-for-pages","line":80,"column":9,"nodeType":"JSXOpeningElement","endLine":83,"endColumn":10}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { redirect } from 'next/navigation';\r\nimport { auth } from '@/lib/auth';\r\nimport { prisma } from '@/lib/prisma';\r\nimport { TicketDetailsClient } from '@/components/tickets/ticket-details-client';\r\nimport { TicketDetailHeader } from '@/components/tickets/ticket-detail-header';\r\nimport { TicketSidebar } from '@/components/tickets/ticket-sidebar';\r\nimport { TicketMainContent } from '@/components/tickets/ticket-main-content';\r\nimport { MagnifyingGlassIcon, ArrowLeftIcon } from '@heroicons/react/24/outline';\r\n\r\nexport default async function TicketDetailsPage({ params }: { params: Promise<{ id: string }> }) {\r\n  const session = await auth();\r\n  if (!session) {\r\n    redirect('/login');\r\n  }\r\n\r\n  const { id } = await params;\r\n  const ticket = await prisma.ticket.findUnique({\r\n    where: { id },\r\n    include: {\r\n      customer: {\r\n        include: {\r\n          _count: {\r\n            select: { tickets: true },\r\n          },\r\n          tickets: {\r\n            select: {\r\n              id: true,\r\n              ticketNumber: true,\r\n              status: true,\r\n              deviceBrand: true,\r\n              deviceModel: true,\r\n              createdAt: true,\r\n            },\r\n            orderBy: { createdAt: 'desc' },\r\n            take: 10,\r\n          },\r\n        },\r\n      },\r\n      assignedTo: {\r\n        select: {\r\n          id: true,\r\n          name: true,\r\n          username: true,\r\n        },\r\n      },\r\n      statusHistory: {\r\n        orderBy: { createdAt: 'desc' },\r\n      },\r\n      parts: {\r\n        include: {\r\n          part: true,\r\n        },\r\n      },\r\n      priceAdjustments: {\r\n        include: {\r\n          user: {\r\n            select: {\r\n              name: true,\r\n              username: true,\r\n            },\r\n          },\r\n        },\r\n        orderBy: { createdAt: 'desc' },\r\n      },\r\n      returns: {\r\n        orderBy: { createdAt: 'desc' },\r\n      },\r\n      payments: {\r\n        orderBy: { createdAt: 'desc' },\r\n      },\r\n    },\r\n  });\r\n\r\n  if (!ticket) {\r\n    return (\r\n      <div className=\"flex flex-col items-center justify-center py-20\">\r\n        <MagnifyingGlassIcon className=\"h-16 w-16 text-gray-300 dark:text-gray-600 mb-4\" />\r\n        <h1 className=\"text-2xl font-bold text-gray-900 dark:text-white mb-2\">Ticket Not Found</h1>\r\n        <p className=\"text-gray-600 dark:text-gray-400 mb-6\">The ticket you're looking for doesn't exist.</p>\r\n        <a\r\n          href=\"/tickets\"\r\n          className=\"inline-flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors\"\r\n        >\r\n          <ArrowLeftIcon className=\"h-4 w-4\" />\r\n          Back to Tickets\r\n        </a>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Calculate payment amounts\r\n  const totalPaid = ticket.payments?.reduce((sum, p) => sum + p.amount, 0) ?? 0;\r\n  const finalPrice = ticket.finalPrice ?? ticket.estimatedPrice;\r\n  const outstandingAmount = Math.max(0, finalPrice - totalPaid);\r\n\r\n  // Prepare ticket object for client components\r\n  const enrichedTicket = {\r\n    ...ticket,\r\n    totalPaid,\r\n    outstandingAmount,\r\n    parts: ticket.parts?.map(p => ({\r\n      id: p.id,\r\n      partId: p.partId,\r\n      quantity: p.quantity,\r\n      part: {\r\n        id: p.part.id,\r\n        name: p.part.name,\r\n        sku: p.part.sku,\r\n        unitPrice: p.part.unitPrice,\r\n        quantity: p.part.quantity,\r\n      },\r\n    })),\r\n  };\r\n\r\n  return (\r\n    <div className=\"max-w-7xl mx-auto px-4 sm:px-6 py-6 space-y-6\">\r\n      {/* Header */}\r\n      <TicketDetailHeader\r\n        ticketNumber={ticket.ticketNumber}\r\n        createdAt={ticket.createdAt}\r\n        ticket={enrichedTicket}\r\n      />\r\n\r\n      {/* Progress Bar */}\r\n      <div className=\"bg-white dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-800 p-4 shadow-sm\">\r\n        <TicketDetailsClient ticket={enrichedTicket} userRole={session.user.role} />\r\n      </div>\r\n\r\n      {/* Two Column Layout */}\r\n      <div className=\"flex flex-col lg:flex-row gap-6\">\r\n        {/* Main Content - Left Column (2/3 on desktop) */}\r\n        <div className=\"flex-1 lg:w-2/3 order-2 lg:order-1\">\r\n          <TicketMainContent ticket={enrichedTicket} userRole={session.user.role} />\r\n        </div>\r\n\r\n        {/* Sidebar - Right Column (1/3 on desktop) */}\r\n        <div className=\"lg:w-80 xl:w-96 flex-shrink-0 order-1 lg:order-2\">\r\n          <div className=\"lg:sticky lg:top-6\">\r\n            <TicketSidebar ticket={enrichedTicket} userRole={session.user.role} />\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\(main)\\tickets\\new\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\(main)\\tickets\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\(setup)\\complete\\complete-page-content.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\(setup)\\complete\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\(setup)\\install\\components\\install-wizard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\(setup)\\install\\components\\steps\\admin-step.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\(setup)\\install\\components\\steps\\branding-step.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\(setup)\\install\\components\\steps\\company-step.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\(setup)\\install\\components\\steps\\database-step.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\(setup)\\install\\components\\steps\\finalize-step.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\(setup)\\install\\components\\steps\\preferences-step.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\(setup)\\install\\components\\steps\\sample-data-step.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\(setup)\\install\\components\\steps\\welcome-step.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\(setup)\\install\\components\\wizard-progress.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\(setup)\\install\\components\\wizard-sidebar.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":105,"column":25,"nodeType":"JSXOpeningElement","endLine":109,"endColumn":27}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useLanguage } from '@/contexts/language-context';\r\nimport {\r\n    CheckCircleIcon,\r\n    SparklesIcon,\r\n    QuestionMarkCircleIcon,\r\n    BuildingOffice2Icon\r\n} from '@heroicons/react/24/outline';\r\nimport type { InstallState } from '../lib/validation';\r\n\r\ninterface WizardSidebarProps {\r\n    currentStep: number;\r\n    totalSteps: number;\r\n    installState: InstallState;\r\n}\r\n\r\nconst STEP_TIPS: Record<number, { icon: React.ReactNode; tipKey: string; defaultTip: string }> = {\r\n    0: {\r\n        icon: <SparklesIcon className=\"h-5 w-5\" />,\r\n        tipKey: 'install.sidebar.tip.welcome',\r\n        defaultTip: 'We\\'ll check your environment to ensure everything is configured correctly.',\r\n    },\r\n    1: {\r\n        icon: <SparklesIcon className=\"h-5 w-5\" />,\r\n        tipKey: 'install.sidebar.tip.database',\r\n        defaultTip: 'Make sure your database connection is properly configured in .env file.',\r\n    },\r\n    2: {\r\n        icon: <BuildingOffice2Icon className=\"h-5 w-5\" />,\r\n        tipKey: 'install.sidebar.tip.company',\r\n        defaultTip: 'This information will appear on invoices and customer communications.',\r\n    },\r\n    3: {\r\n        icon: <SparklesIcon className=\"h-5 w-5\" />,\r\n        tipKey: 'install.sidebar.tip.branding',\r\n        defaultTip: 'Upload your logo to personalize the system. You can skip this step.',\r\n    },\r\n    4: {\r\n        icon: <SparklesIcon className=\"h-5 w-5\" />,\r\n        tipKey: 'install.sidebar.tip.admin',\r\n        defaultTip: 'Choose a strong password. This account will have full system access.',\r\n    },\r\n    5: {\r\n        icon: <SparklesIcon className=\"h-5 w-5\" />,\r\n        tipKey: 'install.sidebar.tip.preferences',\r\n        defaultTip: 'Configure your timezone and notification preferences.',\r\n    },\r\n    6: {\r\n        icon: <SparklesIcon className=\"h-5 w-5\" />,\r\n        tipKey: 'install.sidebar.tip.sampleData',\r\n        defaultTip: 'Sample data helps you explore the system before adding real data.',\r\n    },\r\n    7: {\r\n        icon: <CheckCircleIcon className=\"h-5 w-5\" />,\r\n        tipKey: 'install.sidebar.tip.finalize',\r\n        defaultTip: 'Review your settings before completing the installation.',\r\n    },\r\n};\r\n\r\nexport function WizardSidebar({ currentStep, totalSteps, installState }: WizardSidebarProps) {\r\n    const { t } = useLanguage();\r\n    const progress = Math.round(((currentStep + 1) / totalSteps) * 100);\r\n    const tip = STEP_TIPS[currentStep] || STEP_TIPS[0];\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Progress Card */}\r\n            <div className=\"bg-white dark:bg-slate-800 rounded-2xl shadow-sm p-6 border border-gray-100 dark:border-slate-700\">\r\n                <div className=\"text-center mb-4\">\r\n                    <div className=\"text-4xl font-bold text-primary\">{progress}%</div>\r\n                    <div className=\"text-sm text-gray-500 dark:text-gray-400 mt-1\">\r\n                        {t('install.sidebar.progress') || 'Installation Progress'}\r\n                    </div>\r\n                </div>\r\n                <div className=\"w-full bg-gray-200 dark:bg-slate-700 rounded-full h-2.5 overflow-hidden\">\r\n                    <div\r\n                        className=\"bg-gradient-to-r from-primary to-primary/80 h-2.5 rounded-full transition-all duration-500 ease-out\"\r\n                        style={{ width: `${progress}%` }}\r\n                    />\r\n                </div>\r\n                <div className=\"text-xs text-center text-gray-400 mt-2\">\r\n                    {t('install.sidebar.stepOf') || 'Step'} {currentStep + 1} / {totalSteps}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Tip Card */}\r\n            <div className=\"bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-slate-800 dark:to-slate-700 rounded-2xl shadow-sm p-6 border border-blue-100 dark:border-slate-600\">\r\n                <div className=\"flex items-center gap-2 text-blue-600 dark:text-blue-400 mb-3\">\r\n                    <QuestionMarkCircleIcon className=\"h-5 w-5\" />\r\n                    <span className=\"text-sm font-medium\">{t('install.sidebar.tipTitle') || 'Quick Tip'}</span>\r\n                </div>\r\n                <p className=\"text-sm text-gray-600 dark:text-gray-300 leading-relaxed\">\r\n                    {t(tip.tipKey) || tip.defaultTip}\r\n                </p>\r\n            </div>\r\n\r\n            {/* Logo Preview (if uploaded) */}\r\n            {installState.branding?.logo && (\r\n                <div className=\"bg-white dark:bg-slate-800 rounded-2xl shadow-sm p-6 border border-gray-100 dark:border-slate-700 animate-fadeIn\">\r\n                    <div className=\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3\">\r\n                        {t('install.sidebar.logoPreview') || 'Your Logo'}\r\n                    </div>\r\n                    <div className=\"flex justify-center p-4 bg-gray-50 dark:bg-slate-700 rounded-xl\">\r\n                        <img\r\n                            src={installState.branding.logo}\r\n                            alt=\"Company Logo\"\r\n                            className=\"max-h-20 object-contain\"\r\n                        />\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Company Summary (if entered) */}\r\n            {installState.company?.company_name && (\r\n                <div className=\"bg-white dark:bg-slate-800 rounded-2xl shadow-sm p-6 border border-gray-100 dark:border-slate-700 animate-fadeIn\">\r\n                    <div className=\"flex items-center gap-2 text-gray-700 dark:text-gray-300 mb-3\">\r\n                        <BuildingOffice2Icon className=\"h-5 w-5\" />\r\n                        <span className=\"text-sm font-medium\">{t('install.sidebar.companySummary') || 'Company'}</span>\r\n                    </div>\r\n                    <div className=\"text-sm text-gray-600 dark:text-gray-400 space-y-1\">\r\n                        <p className=\"font-medium text-gray-800 dark:text-white\">{installState.company.company_name}</p>\r\n                        {installState.company.company_email && <p>{installState.company.company_email}</p>}\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Help Links */}\r\n            <div className=\"text-center text-xs text-gray-400 space-y-1\">\r\n                <p>{t('install.sidebar.needHelp') || 'Need help?'}</p>\r\n                <a\r\n                    href=\"https://github.com/cranknet/repairflow/discussions\"\r\n                    target=\"_blank\"\r\n                    rel=\"noopener noreferrer\"\r\n                    className=\"text-primary hover:underline\"\r\n                >\r\n                    {t('install.sidebar.visitDocs') || 'Visit Documentation'}\r\n                </a>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\(setup)\\install\\lib\\validation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\(setup)\\install\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\(setup)\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\ai\\detect-device\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\auth\\[...nextauth]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\auth\\forgot-password\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\auth\\reset-password\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\auth\\validate-reset-token\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\chats\\[id]\\attachments\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\chats\\[id]\\messages\\[messageId]\\reactions\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\chats\\[id]\\messages\\[messageId]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\chats\\[id]\\messages\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\chats\\[id]\\participants\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\chats\\[id]\\read\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\chats\\[id]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\chats\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\chats\\unread-count\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\contact\\[id]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\contact\\messages\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\contact\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\customers\\[id]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\customers\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\dashboard\\sales\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\finance\\metrics\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\install\\admin\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\install\\branding\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\install\\company\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\install\\database\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\install\\environment\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\install\\finalize\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\install\\preferences\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\install\\sample-data\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\install\\status\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\notifications\\[id]\\read\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\notifications\\[id]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\notifications\\mark-all-read\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\notifications\\preferences\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\notifications\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\notifications\\unread-count\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\parts\\[id]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\parts\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\print\\route.tsx","messages":[{"ruleId":"react-hooks/error-boundaries","severity":2,"message":"Error: Avoid constructing JSX within try/catch\n\nReact does not immediately render components when JSX is rendered, so any errors from this component will not be caught by the try/catch. To catch errors in rendering a given component, wrap that component in an error boundary. (https://react.dev/reference/react/Component#catching-rendering-errors-with-an-error-boundary).\n\nC:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\print\\route.tsx:56:17\n  54 |             // Generate PDF\n  55 |             const stream = await renderToStream(\n> 56 |                 <InvoicePDF\n     |                 ^^^^^^^^^^^\n> 57 |                     ticket={ticket}\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 58 |                     settings={settings}\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 59 |                     language={language as 'en' | 'fr' | 'ar'}\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 60 |                 />\n     | ^^^^^^^^^^^^^^^^^^^ Avoid constructing JSX within try/catch\n  61 |             );\n  62 |\n  63 |             // Convert stream to buffer to return (or stream directly)","line":56,"column":17,"nodeType":null,"endLine":60,"endColumn":19}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport React from 'react';\r\nimport { renderToStream } from '@react-pdf/renderer';\r\nimport { InvoicePDF } from '@/lib/pdf-generator';\r\nimport { prisma } from '@/lib/prisma';\r\n\r\nexport async function POST(req: NextRequest) {\r\n    try {\r\n        const body = await req.json();\r\n        const { ticketId, format, language = 'en' } = body;\r\n\r\n        if (!ticketId) {\r\n            return NextResponse.json({ error: 'Ticket ID is required' }, { status: 400 });\r\n        }\r\n\r\n        // Fetch Full Ticket Data\r\n        const ticket = await prisma.ticket.findUnique({\r\n            where: { id: ticketId },\r\n            include: {\r\n                customer: true,\r\n                parts: {\r\n                    include: {\r\n                        part: true\r\n                    }\r\n                },\r\n                payments: {\r\n                    orderBy: {\r\n                        createdAt: 'desc'\r\n                    }\r\n                },\r\n                priceAdjustments: true,\r\n            }\r\n        });\r\n\r\n        if (!ticket) {\r\n            return NextResponse.json({ error: 'Ticket not found' }, { status: 404 });\r\n        }\r\n\r\n        // Fetch Settings\r\n        const settingsRaw = await prisma.settings.findMany({\r\n            where: {\r\n                key: {\r\n                    in: ['company_name', 'company_address', 'company_phone', 'company_email', 'invoice_footer_text', 'invoice_terms_text']\r\n                }\r\n            }\r\n        });\r\n\r\n        const settings = settingsRaw.reduce((acc: Record<string, string>, curr) => {\r\n            acc[curr.key] = curr.value;\r\n            return acc;\r\n        }, {} as Record<string, string>);\r\n\r\n        if (format === 'invoice') {\r\n            // Generate PDF\r\n            const stream = await renderToStream(\r\n                <InvoicePDF\r\n                    ticket={ticket}\r\n                    settings={settings}\r\n                    language={language as 'en' | 'fr' | 'ar'}\r\n                />\r\n            );\r\n\r\n            // Convert stream to buffer to return (or stream directly)\r\n            // Next.js App Router can return a Response with a ReadableStream\r\n\r\n            return new NextResponse(stream as any, {\r\n                headers: {\r\n                    'Content-Type': 'application/pdf',\r\n                    'Content-Disposition': `inline; filename=\"Invoice-${ticket.ticketNumber}.pdf\"`,\r\n                },\r\n            });\r\n        }\r\n\r\n        // For labels and receipts, we might still handle them client-side or return data here\r\n        // But for now, if format is not invoice, we just return the data for client-side rendering\r\n        // or extend this API to generate those images too. \r\n        // Given the plan to keep window.print for labels (Phase 1), we return success.\r\n\r\n        return NextResponse.json({ success: true, message: 'Format handled client-side' });\r\n\r\n    } catch (error) {\r\n        console.error('Print API Error:', error);\r\n        const errorMessage = error instanceof Error ? error.message : 'Unknown error';\r\n        const errorStack = error instanceof Error ? error.stack : '';\r\n        console.error('Error details:', { message: errorMessage, stack: errorStack });\r\n        return NextResponse.json({ error: 'Internal Server Error', details: errorMessage }, { status: 500 });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\returns\\[id]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\returns\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\returns\\validate\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\settings\\ai-vision\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\settings\\ai-vision\\test\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\settings\\database\\export\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\settings\\database\\import\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\settings\\database\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\settings\\database\\test\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\settings\\email\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\settings\\email\\test\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\settings\\public\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\settings\\reset\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\settings\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\settings\\upload\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\sms\\ports\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\sms\\send\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\sms\\templates\\[id]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\sms\\templates\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\suppliers\\[id]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\suppliers\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\tickets\\[id]\\parts\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\tickets\\[id]\\pay\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\tickets\\[id]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\tickets\\[id]\\satisfaction\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\tickets\\[id]\\verify-customer\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\tickets\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\tickets\\search\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\track\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\users\\[id]\\login-logs\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\users\\[id]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\users\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\users\\search\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\users\\staff\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\v2\\expenses\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\v2\\inventory-adjustments\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\v2\\payments\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\v2\\receipt-scanner\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\v2\\returns\\[id]\\approve\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\api\\v2\\returns\\[id]\\reject\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\offline\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\sw.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\track\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\app\\uploads\\[filename]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\auth\\login-sidebar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\chat\\chat-bell.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\chat\\chat-panel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\chat\\chat-window.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":120,"column":37,"nodeType":"JSXOpeningElement","endLine":124,"endColumn":39}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect, useRef, useCallback } from 'react';\r\nimport { format, isToday, isYesterday } from 'date-fns';\r\nimport {\r\n    ArrowLeftIcon,\r\n    XMarkIcon,\r\n    UserCircleIcon,\r\n    EllipsisVerticalIcon,\r\n    TicketIcon,\r\n    TrashIcon,\r\n    LockClosedIcon,\r\n    LockOpenIcon,\r\n    PencilIcon,\r\n    ChatBubbleOvalLeftIcon,\r\n    PaperClipIcon,\r\n} from '@heroicons/react/24/outline';\r\nimport { MentionInput } from './mention-input';\r\nimport Link from 'next/link';\r\nimport { useSession } from 'next-auth/react';\r\nimport { useLanguage } from '@/contexts/language-context';\r\n\r\ninterface Reaction {\r\n    id: string;\r\n    emoji: string;\r\n    userId: string;\r\n}\r\n\r\ninterface ReplyTo {\r\n    id: string;\r\n    content: string;\r\n    sender: { name: string | null; username: string };\r\n}\r\n\r\ninterface Message {\r\n    id: string;\r\n    content: string;\r\n    createdAt: string;\r\n    isEdited?: boolean;\r\n    sender: {\r\n        id: string;\r\n        name: string | null;\r\n        username: string;\r\n    };\r\n    reactions?: Reaction[];\r\n    replyTo?: ReplyTo | null;\r\n    attachments?: string; // JSON string\r\n}\r\n\r\ninterface ChatWindowProps {\r\n    chatId: string;\r\n    onBack: () => void;\r\n    onClose: () => void;\r\n}\r\n\r\ninterface TicketInfo {\r\n    id: string;\r\n    ticketNumber: string;\r\n    deviceBrand: string;\r\n    deviceModel: string;\r\n}\r\n\r\nexport function ChatWindow({ chatId, onBack, onClose }: ChatWindowProps) {\r\n    const { data: session } = useSession();\r\n    const { t } = useLanguage();\r\n    const [messages, setMessages] = useState<Message[]>([]);\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const [chatName, setChatName] = useState('Chat');\r\n    const [chatStatus, setChatStatus] = useState<'OPEN' | 'CLOSED'>('OPEN');\r\n    const [ticketInfo, setTicketInfo] = useState<TicketInfo | null>(null);\r\n    const [showMenu, setShowMenu] = useState(false);\r\n    const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);\r\n    const [isDeleting, setIsDeleting] = useState(false);\r\n    const [hasMore, setHasMore] = useState(false);\r\n\r\n    // Reply and edit state\r\n    const [replyingTo, setReplyingTo] = useState<Message | null>(null);\r\n    const [editingMessage, setEditingMessage] = useState<Message | null>(null);\r\n    const [activeMessageMenu, setActiveMessageMenu] = useState<string | null>(null);\r\n\r\n    const messagesEndRef = useRef<HTMLDivElement>(null);\r\n    const messagesContainerRef = useRef<HTMLDivElement>(null);\r\n\r\n    // Common emoji reactions\r\n    const EMOJI_OPTIONS = ['­ƒæì', 'ÔØñ´©Å', '­ƒÿé', '­ƒÿ«', '­ƒÿó', '­ƒÄë'];\r\n\r\n    // Helper to render a text segment, detecting @mentions\r\n    const renderMentions = (text: string, baseKey: string) => {\r\n        const mentionRegex = /@(\\w+)/g;\r\n        const parts = text.split(mentionRegex);\r\n\r\n        return parts.map((part, index) => {\r\n            if (index % 2 === 1) {\r\n                return (\r\n                    <span key={`${baseKey}-mention-${index}`} className=\"text-blue-600 dark:text-blue-400 font-medium\">\r\n                        @{part}\r\n                    </span>\r\n                );\r\n            }\r\n            return part;\r\n        });\r\n    };\r\n\r\n    // Helper to render attachments\r\n    const renderAttachments = (attachmentsJson?: string) => {\r\n        if (!attachmentsJson) return null;\r\n        try {\r\n            const attachments = JSON.parse(attachmentsJson) as string[];\r\n            if (!Array.isArray(attachments) || attachments.length === 0) return null;\r\n\r\n            return (\r\n                <div className=\"flex flex-wrap gap-2 mt-2\">\r\n                    {attachments.map((url, idx) => {\r\n                        const isImage = /\\.(jpg|jpeg|png|gif|webp)$/i.test(url);\r\n                        const filename = url.split('/').pop() || 'file';\r\n\r\n                        if (isImage) {\r\n                            return (\r\n                                <a key={idx} href={url} target=\"_blank\" rel=\"noopener noreferrer\" className=\"block relative group\">\r\n                                    <img\r\n                                        src={url}\r\n                                        alt={filename}\r\n                                        className=\"h-32 rounded-lg object-cover border border-gray-200 dark:border-gray-700 hover:opacity-90 transition-opacity\"\r\n                                    />\r\n                                </a>\r\n                            );\r\n                        }\r\n\r\n                        return (\r\n                            <a\r\n                                key={idx}\r\n                                href={url}\r\n                                target=\"_blank\"\r\n                                rel=\"noopener noreferrer\"\r\n                                className=\"flex items-center gap-2 p-2 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors\"\r\n                            >\r\n                                <PaperClipIcon className=\"h-4 w-4 text-gray-500\" />\r\n                                <span className=\"text-xs text-blue-600 dark:text-blue-400 underline truncate max-w-[150px]\">\r\n                                    {filename.replace(/^\\d+-/, '')}\r\n                                </span>\r\n                            </a>\r\n                        );\r\n                    })}\r\n                </div>\r\n            );\r\n        } catch (e) {\r\n            console.error('Error parsing attachments:', e);\r\n            return null;\r\n        }\r\n    };\r\n\r\n    // Helper to render message content with highlighted mentions and clickable ticket IDs\r\n    const renderMessageContent = (content: string) => {\r\n        // First, split by ticket references (#TKT-xxx or just #xxx)\r\n        const ticketRegex = /(#(?:TKT-)?[\\w-]+)/gi;\r\n        const segments = content.split(ticketRegex);\r\n\r\n        return segments.map((segment, index) => {\r\n            // Check if this segment is a ticket reference\r\n            if (ticketRegex.test(segment)) {\r\n                // Reset the regex lastIndex after test\r\n                ticketRegex.lastIndex = 0;\r\n                const ticketNumber = segment.replace('#', '');\r\n                return (\r\n                    <a\r\n                        key={`ticket-${index}`}\r\n                        href={`/tickets?search=${encodeURIComponent(ticketNumber)}`}\r\n                        className=\"text-orange-600 dark:text-orange-400 font-medium hover:underline\"\r\n                        onClick={(e) => {\r\n                            e.stopPropagation();\r\n                        }}\r\n                    >\r\n                        {segment}\r\n                    </a>\r\n                );\r\n            }\r\n            // Otherwise, render with mention detection\r\n            return <span key={`segment-${index}`}>{renderMentions(segment, `seg-${index}`)}</span>;\r\n        });\r\n    };\r\n\r\n    const fetchMessages = useCallback(async () => {\r\n        try {\r\n            const response = await fetch(`/api/chats/${chatId}/messages`);\r\n            if (response.ok) {\r\n                const data = await response.json();\r\n                setMessages(data.messages || []);\r\n                setHasMore(data.hasMore || false);\r\n            }\r\n        } catch (error) {\r\n            console.error('Error fetching messages:', error);\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    }, [chatId]);\r\n\r\n    const fetchChatDetails = useCallback(async () => {\r\n        try {\r\n            const response = await fetch(`/api/chats/${chatId}`);\r\n            if (response.status === 404) {\r\n                // Chat was deleted - close the window\r\n                onClose();\r\n                return;\r\n            }\r\n            if (response.ok) {\r\n                const data = await response.json();\r\n                const chat = data.chat;\r\n                if (chat.isTicketChat && chat.ticket) {\r\n                    setChatName(`#${chat.ticket.ticketNumber}`);\r\n                    setTicketInfo({\r\n                        id: chat.ticketId,\r\n                        ticketNumber: chat.ticket.ticketNumber,\r\n                        deviceBrand: chat.ticket.deviceBrand,\r\n                        deviceModel: chat.ticket.deviceModel,\r\n                    });\r\n                } else if (chat.name) {\r\n                    setChatName(chat.name);\r\n                }\r\n                setChatStatus(chat.status || 'OPEN');\r\n            }\r\n        } catch (error) {\r\n            console.error('Error fetching chat details:', error);\r\n        }\r\n    }, [chatId, onClose]);\r\n\r\n    const markAsRead = useCallback(async () => {\r\n        try {\r\n            await fetch(`/api/chats/${chatId}/read`, { method: 'POST' });\r\n        } catch (error) {\r\n            console.error('Error marking as read:', error);\r\n        }\r\n    }, [chatId]);\r\n\r\n    useEffect(() => {\r\n        fetchChatDetails();\r\n        fetchMessages();\r\n        markAsRead();\r\n\r\n        // Poll for new messages and status changes every 2 seconds\r\n        const interval = setInterval(() => {\r\n            fetchMessages();\r\n            fetchChatDetails(); // Also check for status/deletion\r\n        }, 2000);\r\n\r\n        return () => clearInterval(interval);\r\n    }, [fetchChatDetails, fetchMessages, markAsRead]);\r\n\r\n    // Auto-scroll to bottom when new messages arrive\r\n    useEffect(() => {\r\n        if (messagesEndRef.current) {\r\n            messagesEndRef.current.scrollIntoView({ behavior: 'smooth' });\r\n        }\r\n    }, [messages]);\r\n\r\n    // Send message handler for MentionInput\r\n    const handleSendMessage = useCallback(async (content: string, attachments?: string[]) => {\r\n        try {\r\n            if (editingMessage) {\r\n                // Edit existing message\r\n                const response = await fetch(\r\n                    `/api/chats/${chatId}/messages/${editingMessage.id}`,\r\n                    {\r\n                        method: 'PATCH',\r\n                        headers: { 'Content-Type': 'application/json' },\r\n                        body: JSON.stringify({ content }),\r\n                    }\r\n                );\r\n                if (response.ok) {\r\n                    setEditingMessage(null);\r\n                    fetchMessages();\r\n                }\r\n            } else {\r\n                // Send new message (optionally as reply)\r\n                const body: { content: string; replyToId?: string; attachments?: string[] } = { content };\r\n                if (replyingTo) {\r\n                    body.replyToId = replyingTo.id;\r\n                }\r\n                if (attachments && attachments.length > 0) {\r\n                    body.attachments = attachments;\r\n                }\r\n\r\n                const response = await fetch(`/api/chats/${chatId}/messages`, {\r\n                    method: 'POST',\r\n                    headers: { 'Content-Type': 'application/json' },\r\n                    body: JSON.stringify(body),\r\n                });\r\n\r\n                if (response.ok) {\r\n                    setReplyingTo(null);\r\n                    fetchMessages();\r\n                }\r\n            }\r\n        } catch (error) {\r\n            console.error('Error sending message:', error);\r\n        }\r\n    }, [chatId, fetchMessages, editingMessage, replyingTo]);\r\n\r\n    // Toggle reaction on a message\r\n    const handleReaction = async (messageId: string, emoji: string) => {\r\n        try {\r\n            await fetch(`/api/chats/${chatId}/messages/${messageId}/reactions`, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ emoji }),\r\n            });\r\n            fetchMessages();\r\n        } catch (error) {\r\n            console.error('Error toggling reaction:', error);\r\n        }\r\n    };\r\n\r\n    // Delete a message\r\n    const handleDeleteMessage = async (messageId: string) => {\r\n        try {\r\n            const response = await fetch(\r\n                `/api/chats/${chatId}/messages/${messageId}`,\r\n                { method: 'DELETE' }\r\n            );\r\n            if (response.ok) {\r\n                fetchMessages();\r\n            }\r\n        } catch (error) {\r\n            console.error('Error deleting message:', error);\r\n        }\r\n        setActiveMessageMenu(null);\r\n    };\r\n\r\n    // Group reactions by emoji\r\n    const groupReactions = (reactions: Reaction[] = []) => {\r\n        const grouped: Record<string, { count: number; userReacted: boolean }> = {};\r\n        reactions.forEach((r) => {\r\n            if (!grouped[r.emoji]) {\r\n                grouped[r.emoji] = { count: 0, userReacted: false };\r\n            }\r\n            grouped[r.emoji].count++;\r\n            if (r.userId === session?.user?.id) {\r\n                grouped[r.emoji].userReacted = true;\r\n            }\r\n        });\r\n        return grouped;\r\n    };\r\n\r\n    // Delete chat\r\n    const handleDeleteChat = async () => {\r\n        setIsDeleting(true);\r\n        try {\r\n            const response = await fetch(`/api/chats/${chatId}`, { method: 'DELETE' });\r\n            if (response.ok) {\r\n                onClose();\r\n            }\r\n        } catch (error) {\r\n            console.error('Error deleting chat:', error);\r\n        } finally {\r\n            setIsDeleting(false);\r\n            setShowDeleteConfirm(false);\r\n        }\r\n    };\r\n\r\n    // Toggle chat status (close/reopen)\r\n    const handleToggleStatus = async () => {\r\n        const newStatus = chatStatus === 'OPEN' ? 'CLOSED' : 'OPEN';\r\n        try {\r\n            const response = await fetch(`/api/chats/${chatId}`, {\r\n                method: 'PATCH',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ status: newStatus }),\r\n            });\r\n            if (response.ok) {\r\n                setChatStatus(newStatus);\r\n                setShowMenu(false);\r\n            }\r\n        } catch (error) {\r\n            console.error('Error updating chat status:', error);\r\n        }\r\n    };\r\n\r\n    function formatMessageTime(dateString: string) {\r\n        const date = new Date(dateString);\r\n        if (isToday(date)) return format(date, 'HH:mm');\r\n        if (isYesterday(date)) return `${t('chat.yesterday')} ${format(date, 'HH:mm')}`;\r\n        return format(date, 'MMM d, HH:mm');\r\n    }\r\n\r\n    function groupMessagesByDate(messages: Message[]) {\r\n        const groups: { date: string; messages: Message[] }[] = [];\r\n        let currentDate = '';\r\n\r\n        messages.forEach((message) => {\r\n            const messageDate = format(new Date(message.createdAt), 'yyyy-MM-dd');\r\n            if (messageDate !== currentDate) {\r\n                currentDate = messageDate;\r\n                groups.push({ date: messageDate, messages: [message] });\r\n            } else {\r\n                groups[groups.length - 1].messages.push(message);\r\n            }\r\n        });\r\n\r\n        return groups;\r\n    }\r\n\r\n    function formatDateHeader(dateString: string) {\r\n        const date = new Date(dateString);\r\n        if (isToday(date)) return t('chat.today');\r\n        if (isYesterday(date)) return t('chat.yesterday');\r\n        return format(date, 'EEEE, MMMM d');\r\n    }\r\n\r\n    const messageGroups = groupMessagesByDate(messages);\r\n\r\n    return (\r\n        <div className=\"flex flex-col h-[500px]\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center gap-2 px-4 py-3 border-b border-gray-200 dark:border-gray-700\">\r\n                <button\r\n                    onClick={onBack}\r\n                    className=\"p-1.5 text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg\"\r\n                    aria-label=\"Back\"\r\n                >\r\n                    <ArrowLeftIcon className=\"h-5 w-5\" />\r\n                </button>\r\n\r\n                <div className=\"flex-1 min-w-0\">\r\n                    <div className=\"flex items-center gap-2\">\r\n                        <h2 className=\"text-lg font-semibold text-gray-900 dark:text-white truncate\">\r\n                            {chatName}\r\n                        </h2>\r\n                        {chatStatus === 'CLOSED' && (\r\n                            <span className=\"px-1.5 py-0.5 text-xs font-medium bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400 rounded\">\r\n                                {t('chat.closed')}\r\n                            </span>\r\n                        )}\r\n                    </div>\r\n                    {ticketInfo && (\r\n                        <Link\r\n                            href={`/tickets/${ticketInfo.id}`}\r\n                            className=\"text-xs text-blue-600 dark:text-blue-400 hover:underline flex items-center gap-1\"\r\n                            onClick={(e) => e.stopPropagation()}\r\n                        >\r\n                            <TicketIcon className=\"h-3 w-3\" />\r\n                            {ticketInfo.deviceBrand} {ticketInfo.deviceModel}\r\n                        </Link>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Menu dropdown */}\r\n                <div className=\"relative\">\r\n                    <button\r\n                        onClick={() => setShowMenu(!showMenu)}\r\n                        className=\"p-1.5 text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg\"\r\n                        aria-label=\"Menu\"\r\n                    >\r\n                        <EllipsisVerticalIcon className=\"h-5 w-5\" />\r\n                    </button>\r\n\r\n                    {showMenu && (\r\n                        <div className=\"absolute right-0 mt-1 w-44 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 py-1 z-10\">\r\n                            <button\r\n                                onClick={handleToggleStatus}\r\n                                className=\"w-full px-3 py-2 text-left text-sm flex items-center gap-2 hover:bg-gray-100 dark:hover:bg-gray-700\"\r\n                            >\r\n                                {chatStatus === 'OPEN' ? (\r\n                                    <>\r\n                                        <LockClosedIcon className=\"h-4 w-4 text-gray-500\" />\r\n                                        {t('chat.closeChat')}\r\n                                    </>\r\n                                ) : (\r\n                                    <>\r\n                                        <LockOpenIcon className=\"h-4 w-4 text-green-500\" />\r\n                                        {t('chat.reopenChat')}\r\n                                    </>\r\n                                )}\r\n                            </button>\r\n                            <button\r\n                                onClick={() => {\r\n                                    setShowMenu(false);\r\n                                    setShowDeleteConfirm(true);\r\n                                }}\r\n                                className=\"w-full px-3 py-2 text-left text-sm flex items-center gap-2 hover:bg-gray-100 dark:hover:bg-gray-700 text-red-600\"\r\n                            >\r\n                                <TrashIcon className=\"h-4 w-4\" />\r\n                                {t('chat.deleteChat')}\r\n                            </button>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                <button\r\n                    onClick={onClose}\r\n                    className=\"p-1.5 text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg\"\r\n                    aria-label=\"Close\"\r\n                >\r\n                    <XMarkIcon className=\"h-5 w-5\" />\r\n                </button>\r\n            </div>\r\n\r\n            {/* Messages */}\r\n            <div\r\n                ref={messagesContainerRef}\r\n                className=\"flex-1 overflow-y-auto px-4 py-3 space-y-4\"\r\n            >\r\n                {isLoading ? (\r\n                    <div className=\"flex items-center justify-center h-full\">\r\n                        <div className=\"animate-spin h-6 w-6 border-2 border-blue-500 border-t-transparent rounded-full\" />\r\n                    </div>\r\n                ) : messages.length === 0 ? (\r\n                    <div className=\"flex flex-col items-center justify-center h-full text-gray-500 dark:text-gray-400\">\r\n                        <p className=\"text-sm\">{t('chat.noMessages')}</p>\r\n                        <p className=\"text-xs mt-1\">{t('chat.startConversation')}</p>\r\n                    </div>\r\n                ) : (\r\n                    messageGroups.map((group) => (\r\n                        <div key={group.date}>\r\n                            {/* Date header */}\r\n                            <div className=\"flex items-center justify-center my-4\">\r\n                                <span className=\"px-3 py-1 text-xs font-medium text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-700 rounded-full\">\r\n                                    {formatDateHeader(group.date)}\r\n                                </span>\r\n                            </div>\r\n                            {/* Messages */}\r\n                            <div className=\"space-y-3\">\r\n                                {group.messages.map((message) => {\r\n                                    const isOwn = message.sender.id === session?.user?.id;\r\n                                    const reactions = groupReactions(message.reactions);\r\n\r\n                                    return (\r\n                                        <div\r\n                                            key={message.id}\r\n                                            className=\"group flex items-start gap-2 relative\"\r\n                                            onMouseLeave={() => setActiveMessageMenu(null)}\r\n                                        >\r\n                                            <div className=\"flex-shrink-0\">\r\n                                                <UserCircleIcon className=\"h-8 w-8 text-gray-400\" />\r\n                                            </div>\r\n                                            <div className=\"flex-1 min-w-0\">\r\n                                                {/* Reply preview */}\r\n                                                {message.replyTo && (\r\n                                                    <div className=\"mb-1 pl-2 border-l-2 border-gray-300 dark:border-gray-600 text-xs text-gray-500 dark:text-gray-400\">\r\n                                                        <span className=\"font-medium\">{message.replyTo.sender.name || message.replyTo.sender.username}</span>\r\n                                                        <p className=\"truncate\">{message.replyTo.content}</p>\r\n                                                    </div>\r\n                                                )}\r\n\r\n                                                <div className=\"flex items-baseline gap-2\">\r\n                                                    <span className=\"font-medium text-sm text-gray-900 dark:text-white\">\r\n                                                        {message.sender.name || message.sender.username}\r\n                                                    </span>\r\n                                                    <span className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n                                                        {formatMessageTime(message.createdAt)}\r\n                                                    </span>\r\n                                                    {message.isEdited && (\r\n                                                        <span className=\"text-xs text-gray-400 italic\">({t('chat.edited')})</span>\r\n                                                    )}\r\n                                                </div>\r\n                                                <p className=\"text-sm text-gray-700 dark:text-gray-300 whitespace-pre-wrap break-words\">\r\n                                                    {renderMessageContent(message.content)}\r\n                                                </p>\r\n                                                {renderAttachments(message.attachments)}\r\n\r\n                                                {/* Reactions display */}\r\n                                                {Object.keys(reactions).length > 0 && (\r\n                                                    <div className=\"flex flex-wrap gap-1 mt-1\">\r\n                                                        {Object.entries(reactions).map(([emoji, data]) => (\r\n                                                            <button\r\n                                                                key={emoji}\r\n                                                                onClick={() => handleReaction(message.id, emoji)}\r\n                                                                className={`px-1.5 py-0.5 text-xs rounded-full border transition-colors ${data.userReacted\r\n                                                                    ? 'bg-blue-100 border-blue-300 dark:bg-blue-900/30 dark:border-blue-700'\r\n                                                                    : 'bg-gray-100 border-gray-200 dark:bg-gray-700 dark:border-gray-600 hover:bg-gray-200 dark:hover:bg-gray-600'\r\n                                                                    }`}\r\n                                                            >\r\n                                                                {emoji} {data.count}\r\n                                                            </button>\r\n                                                        ))}\r\n                                                    </div>\r\n                                                )}\r\n                                            </div>\r\n\r\n                                            {/* Hover actions */}\r\n                                            {chatStatus === 'OPEN' && (\r\n                                                <div className=\"absolute right-0 top-0 hidden group-hover:flex items-center gap-1 bg-white dark:bg-gray-800 rounded-lg shadow border border-gray-200 dark:border-gray-700 p-0.5\">\r\n                                                    {/* Emoji reactions */}\r\n                                                    {EMOJI_OPTIONS.slice(0, 3).map((emoji) => (\r\n                                                        <button\r\n                                                            key={emoji}\r\n                                                            onClick={() => handleReaction(message.id, emoji)}\r\n                                                            className=\"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-sm\"\r\n                                                            title={`React with ${emoji}`}\r\n                                                        >\r\n                                                            {emoji}\r\n                                                        </button>\r\n                                                    ))}\r\n                                                    {/* Reply */}\r\n                                                    <button\r\n                                                        onClick={() => setReplyingTo(message)}\r\n                                                        className=\"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded\"\r\n                                                        title=\"Reply\"\r\n                                                    >\r\n                                                        <ChatBubbleOvalLeftIcon className=\"h-4 w-4 text-gray-500\" />\r\n                                                    </button>\r\n                                                    {/* Edit/Delete for own messages */}\r\n                                                    {isOwn && (\r\n                                                        <>\r\n                                                            <button\r\n                                                                onClick={() => {\r\n                                                                    setEditingMessage(message);\r\n                                                                    setActiveMessageMenu(null);\r\n                                                                }}\r\n                                                                className=\"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded\"\r\n                                                                title=\"Edit\"\r\n                                                            >\r\n                                                                <PencilIcon className=\"h-4 w-4 text-gray-500\" />\r\n                                                            </button>\r\n                                                            <button\r\n                                                                onClick={() => handleDeleteMessage(message.id)}\r\n                                                                className=\"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded\"\r\n                                                                title=\"Delete\"\r\n                                                            >\r\n                                                                <TrashIcon className=\"h-4 w-4 text-red-500\" />\r\n                                                            </button>\r\n                                                        </>\r\n                                                    )}\r\n                                                </div>\r\n                                            )}\r\n                                        </div>\r\n                                    );\r\n                                })}\r\n                            </div>\r\n                        </div>\r\n                    ))\r\n                )}\r\n                <div ref={messagesEndRef} />\r\n            </div>\r\n\r\n            {/* Message composer */}\r\n            <div className=\"border-t border-gray-200 dark:border-gray-700\">\r\n                {/* Reply/Edit preview bar */}\r\n                {(replyingTo || editingMessage) && (\r\n                    <div className=\"px-4 py-2 bg-gray-50 dark:bg-gray-700/50 flex items-center justify-between border-b border-gray-200 dark:border-gray-700\">\r\n                        <div className=\"flex-1 min-w-0\">\r\n                            {replyingTo && (\r\n                                <div className=\"text-xs\">\r\n                                    <span className=\"text-gray-500 dark:text-gray-400\">{t('chat.replyingTo')} </span>\r\n                                    <span className=\"font-medium text-gray-700 dark:text-gray-300\">\r\n                                        {replyingTo.sender.name || replyingTo.sender.username}\r\n                                    </span>\r\n                                    <p className=\"text-gray-500 dark:text-gray-400 truncate\">{replyingTo.content}</p>\r\n                                </div>\r\n                            )}\r\n                            {editingMessage && (\r\n                                <div className=\"text-xs\">\r\n                                    <span className=\"text-blue-600 dark:text-blue-400 font-medium\">{t('chat.editingMessage')}</span>\r\n                                    <p className=\"text-gray-500 dark:text-gray-400 truncate\">{editingMessage.content}</p>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                        <button\r\n                            onClick={() => {\r\n                                setReplyingTo(null);\r\n                                setEditingMessage(null);\r\n                            }}\r\n                            className=\"p-1 hover:bg-gray-200 dark:hover:bg-gray-600 rounded\"\r\n                        >\r\n                            <XMarkIcon className=\"h-4 w-4 text-gray-500\" />\r\n                        </button>\r\n                    </div>\r\n                )}\r\n\r\n                <div className=\"px-4 py-3\">\r\n                    {chatStatus === 'CLOSED' ? (\r\n                        <div className=\"flex items-center justify-center gap-2 py-2 text-gray-500 dark:text-gray-400\">\r\n                            <LockClosedIcon className=\"h-4 w-4\" />\r\n                            <span className=\"text-sm\">{t('chat.chatClosedMessage')}</span>\r\n                        </div>\r\n                    ) : (\r\n                        <MentionInput\r\n                            onSend={handleSendMessage}\r\n                            disabled={isLoading}\r\n                            placeholder={editingMessage ? t('chat.editPlaceholder') : t('chat.messagePlaceholder')}\r\n                            initialValue={editingMessage?.content}\r\n                            chatId={chatId}\r\n                            key={editingMessage?.id || 'new'} // Reset input when editing different message\r\n                        />\r\n                    )}\r\n                </div>\r\n            </div>\r\n            {/* Delete Confirmation Modal */}\r\n            {showDeleteConfirm && (\r\n                <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50\" onClick={() => setShowDeleteConfirm(false)}>\r\n                    <div\r\n                        className=\"bg-white dark:bg-gray-800 rounded-xl shadow-2xl p-6 max-w-sm mx-4 transform transition-all\"\r\n                        onClick={(e) => e.stopPropagation()}\r\n                    >\r\n                        <div className=\"flex items-center justify-center w-12 h-12 mx-auto mb-4 bg-red-100 dark:bg-red-900/30 rounded-full\">\r\n                            <TrashIcon className=\"h-6 w-6 text-red-600\" />\r\n                        </div>\r\n                        <h3 className=\"text-lg font-semibold text-center text-gray-900 dark:text-white mb-2\">\r\n                            {t('chat.deleteChat')}\r\n                        </h3>\r\n                        <p className=\"text-sm text-center text-gray-600 dark:text-gray-400 mb-6\">\r\n                            {t('chat.deleteChatConfirm')}\r\n                        </p>\r\n                        <div className=\"flex gap-3\">\r\n                            <button\r\n                                onClick={() => setShowDeleteConfirm(false)}\r\n                                disabled={isDeleting}\r\n                                className=\"flex-1 px-4 py-2.5 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg transition-colors disabled:opacity-50\"\r\n                            >\r\n                                {t('cancel')}\r\n                            </button>\r\n                            <button\r\n                                onClick={handleDeleteChat}\r\n                                disabled={isDeleting}\r\n                                className=\"flex-1 px-4 py-2.5 text-sm font-medium text-white bg-red-600 hover:bg-red-700 rounded-lg transition-colors flex items-center justify-center gap-2 disabled:opacity-50\"\r\n                            >\r\n                                {isDeleting ? (\r\n                                    <>\r\n                                        <div className=\"h-4 w-4 border-2 border-white border-t-transparent rounded-full animate-spin\" />\r\n                                        {t('chat.deleting')}\r\n                                    </>\r\n                                ) : (\r\n                                    t('delete')\r\n                                )}\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\chat\\mention-input.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'handleSend'. Either include it or remove the dependency array.","line":142,"column":8,"nodeType":"ArrayExpression","endLine":142,"endColumn":68,"suggestions":[{"desc":"Update the dependencies array to be: [showSuggestions, suggestions, insertMention, selectedIndex, handleSend]","fix":{"range":[5277,5337],"text":"[showSuggestions, suggestions, insertMention, selectedIndex, handleSend]"}}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":287,"column":33,"nodeType":"JSXOpeningElement","endLine":287,"endColumn":163}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useRef, useCallback, KeyboardEvent, ChangeEvent } from 'react';\r\nimport { PaperAirplaneIcon, PaperClipIcon, XMarkIcon } from '@heroicons/react/24/outline';\r\nimport { useLanguage } from '@/contexts/language-context';\r\n\r\ninterface User {\r\n    id: string;\r\n    name: string | null;\r\n    username: string;\r\n}\r\n\r\ninterface MentionInputProps {\r\n    onSend: (content: string, attachments?: string[]) => void;\r\n    disabled?: boolean;\r\n    placeholder?: string;\r\n    initialValue?: string;\r\n    chatId?: string;\r\n}\r\n\r\ninterface Attachment {\r\n    url: string;\r\n    filename: string;\r\n    type: string;\r\n}\r\n\r\nexport function MentionInput({ onSend, disabled, placeholder = 'Type a message...', initialValue = '', chatId }: MentionInputProps) {\r\n    const { t } = useLanguage();\r\n    const [value, setValue] = useState(initialValue);\r\n    const [attachments, setAttachments] = useState<Attachment[]>([]);\r\n    const [isUploading, setIsUploading] = useState(false);\r\n    const [isSending, setIsSending] = useState(false);\r\n    const [showSuggestions, setShowSuggestions] = useState(false);\r\n    const [suggestions, setSuggestions] = useState<User[]>([]);\r\n    const [selectedIndex, setSelectedIndex] = useState(0);\r\n    const [mentionQuery, setMentionQuery] = useState('');\r\n    const [mentionStart, setMentionStart] = useState(-1);\r\n    const textareaRef = useRef<HTMLTextAreaElement>(null);\r\n\r\n    // Search for users when typing after @\r\n    const searchUsers = useCallback(async (query: string) => {\r\n        if (query.length < 1) {\r\n            setSuggestions([]);\r\n            setShowSuggestions(false);\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const response = await fetch(`/api/users/search?q=${encodeURIComponent(query)}&limit=5`);\r\n            if (response.ok) {\r\n                const data = await response.json();\r\n                setSuggestions(data.users || []);\r\n                setShowSuggestions(data.users?.length > 0);\r\n                setSelectedIndex(0);\r\n            }\r\n        } catch (error) {\r\n            console.error('Error searching users:', error);\r\n        }\r\n    }, []);\r\n\r\n    // Handle input changes and detect @ mentions\r\n    const handleChange = useCallback((e: React.ChangeEvent<HTMLTextAreaElement>) => {\r\n        const newValue = e.target.value;\r\n        const cursorPos = e.target.selectionStart || 0;\r\n        setValue(newValue);\r\n\r\n        // Check if we're in a mention context\r\n        const textBeforeCursor = newValue.slice(0, cursorPos);\r\n        const lastAtIndex = textBeforeCursor.lastIndexOf('@');\r\n\r\n        if (lastAtIndex !== -1) {\r\n            const textAfterAt = textBeforeCursor.slice(lastAtIndex + 1);\r\n            // Check if this is a valid mention context (no spaces after @)\r\n            if (!textAfterAt.includes(' ') && textAfterAt.length <= 20) {\r\n                setMentionStart(lastAtIndex);\r\n                setMentionQuery(textAfterAt);\r\n                searchUsers(textAfterAt);\r\n                return;\r\n            }\r\n        }\r\n\r\n        // Not in mention context\r\n        setShowSuggestions(false);\r\n        setMentionStart(-1);\r\n        setMentionQuery('');\r\n    }, [searchUsers]);\r\n\r\n    // Insert a mention\r\n    const insertMention = useCallback((user: User) => {\r\n        if (mentionStart === -1) return;\r\n\r\n        const beforeMention = value.slice(0, mentionStart);\r\n        const afterMention = value.slice(mentionStart + 1 + mentionQuery.length);\r\n        const mention = `@${user.username} `;\r\n        const newValue = beforeMention + mention + afterMention;\r\n\r\n        setValue(newValue);\r\n        setShowSuggestions(false);\r\n        setMentionStart(-1);\r\n        setMentionQuery('');\r\n\r\n        // Focus and set cursor position\r\n        setTimeout(() => {\r\n            if (textareaRef.current) {\r\n                const newCursorPos = mentionStart + mention.length;\r\n                textareaRef.current.focus();\r\n                textareaRef.current.setSelectionRange(newCursorPos, newCursorPos);\r\n            }\r\n        }, 0);\r\n    }, [value, mentionStart, mentionQuery]);\r\n\r\n    // Handle keyboard navigation in suggestions\r\n    const handleKeyDown = useCallback((e: KeyboardEvent<HTMLTextAreaElement>) => {\r\n        if (showSuggestions && suggestions.length > 0) {\r\n            switch (e.key) {\r\n                case 'ArrowDown':\r\n                    e.preventDefault();\r\n                    setSelectedIndex((prev) => (prev + 1) % suggestions.length);\r\n                    break;\r\n                case 'ArrowUp':\r\n                    e.preventDefault();\r\n                    setSelectedIndex((prev) => (prev - 1 + suggestions.length) % suggestions.length);\r\n                    break;\r\n                case 'Enter':\r\n                case 'Tab':\r\n                    e.preventDefault();\r\n                    insertMention(suggestions[selectedIndex]);\r\n                    break;\r\n                case 'Escape':\r\n                    e.preventDefault();\r\n                    setShowSuggestions(false);\r\n                    break;\r\n            }\r\n            return;\r\n        }\r\n\r\n        // Send on Enter (without Shift)\r\n        if (e.key === 'Enter' && !e.shiftKey) {\r\n            e.preventDefault();\r\n            handleSend();\r\n        }\r\n    }, [showSuggestions, suggestions, selectedIndex, insertMention]);\r\n\r\n    // Handle file selection\r\n    const handleFileSelect = useCallback(async (e: ChangeEvent<HTMLInputElement>) => {\r\n        const file = e.target.files?.[0];\r\n        if (!file || !chatId) return;\r\n\r\n        setIsUploading(true);\r\n        try {\r\n            const formData = new FormData();\r\n            formData.append('file', file);\r\n\r\n            const response = await fetch(`/api/chats/${chatId}/attachments`, {\r\n                method: 'POST',\r\n                body: formData,\r\n            });\r\n\r\n            if (response.ok) {\r\n                const data = await response.json();\r\n                setAttachments((prev) => [...prev, {\r\n                    url: data.url,\r\n                    filename: data.filename,\r\n                    type: data.type,\r\n                }]);\r\n            } else {\r\n                const error = await response.json();\r\n                console.error('Upload failed:', error.error);\r\n            }\r\n        } catch (error) {\r\n            console.error('Error uploading file:', error);\r\n        } finally {\r\n            setIsUploading(false);\r\n            // Reset file input\r\n            e.target.value = '';\r\n        }\r\n    }, [chatId]);\r\n\r\n    // Remove attachment\r\n    const removeAttachment = useCallback((index: number) => {\r\n        setAttachments((prev) => prev.filter((_, i) => i !== index));\r\n    }, []);\r\n\r\n    // Send message\r\n    const handleSend = useCallback(async () => {\r\n        const content = value.trim();\r\n        const attachmentUrls = attachments.map((a) => a.url);\r\n\r\n        if (!content && attachmentUrls.length === 0) return;\r\n        if (isSending) return;\r\n\r\n        setIsSending(true);\r\n        try {\r\n            await onSend(content, attachmentUrls.length > 0 ? attachmentUrls : undefined);\r\n            setValue('');\r\n            setAttachments([]);\r\n        } finally {\r\n            setIsSending(false);\r\n        }\r\n    }, [value, attachments, isSending, onSend]);\r\n\r\n    return (\r\n        <div className=\"relative\">\r\n            {/* Suggestions dropdown */}\r\n            {showSuggestions && suggestions.length > 0 && (\r\n                <div className=\"absolute bottom-full left-0 right-0 mb-1 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg overflow-hidden z-10\">\r\n                    {suggestions.map((user, index) => (\r\n                        <button\r\n                            key={user.id}\r\n                            onClick={() => insertMention(user)}\r\n                            className={`w-full px-3 py-2 flex items-center gap-2 text-left hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors ${index === selectedIndex ? 'bg-blue-50 dark:bg-blue-900/30' : ''\r\n                                }`}\r\n                        >\r\n                            <div className=\"w-7 h-7 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center text-xs font-medium\">\r\n                                {(user.name || user.username).charAt(0).toUpperCase()}\r\n                            </div>\r\n                            <div className=\"flex-1 min-w-0\">\r\n                                <p className=\"text-sm font-medium text-gray-900 dark:text-white truncate\">\r\n                                    {user.name || user.username}\r\n                                </p>\r\n                                <p className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n                                    @{user.username}\r\n                                </p>\r\n                            </div>\r\n                        </button>\r\n                    ))}\r\n                </div>\r\n            )}\r\n\r\n            {/* Input area */}\r\n            <div className=\"flex items-end gap-2\">\r\n                {/* Attachment button */}\r\n                {chatId && (\r\n                    <>\r\n                        <input\r\n                            type=\"file\"\r\n                            id=\"chat-file-input\"\r\n                            className=\"hidden\"\r\n                            accept=\"image/*,.pdf,.doc,.docx,.txt\"\r\n                            onChange={handleFileSelect}\r\n                            disabled={disabled || isUploading}\r\n                        />\r\n                        <label\r\n                            htmlFor=\"chat-file-input\"\r\n                            className={`flex-shrink-0 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer transition-colors ${isUploading ? 'opacity-50 cursor-not-allowed' : ''}`}\r\n                        >\r\n                            {isUploading ? (\r\n                                <div className=\"h-5 w-5 border-2 border-gray-400 border-t-transparent rounded-full animate-spin\" />\r\n                            ) : (\r\n                                <PaperClipIcon className=\"h-5 w-5 text-gray-500\" />\r\n                            )}\r\n                        </label>\r\n                    </>\r\n                )}\r\n\r\n                <textarea\r\n                    ref={textareaRef}\r\n                    value={value}\r\n                    onChange={handleChange}\r\n                    onKeyDown={handleKeyDown}\r\n                    placeholder={placeholder}\r\n                    disabled={disabled || isSending}\r\n                    rows={1}\r\n                    className=\"flex-1 resize-none rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 px-3 py-2 text-sm text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:opacity-50\"\r\n                    style={{ maxHeight: '100px' }}\r\n                />\r\n                <button\r\n                    onClick={handleSend}\r\n                    disabled={(!value.trim() && attachments.length === 0) || isSending || disabled}\r\n                    className=\"flex-shrink-0 p-2 rounded-lg bg-blue-500 text-white hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\r\n                    aria-label=\"Send\"\r\n                >\r\n                    {isSending ? (\r\n                        <div className=\"h-5 w-5 border-2 border-white border-t-transparent rounded-full animate-spin\" />\r\n                    ) : (\r\n                        <PaperAirplaneIcon className=\"h-5 w-5\" />\r\n                    )}\r\n                </button>\r\n            </div>\r\n\r\n            {/* Attachment previews */}\r\n            {attachments.length > 0 && (\r\n                <div className=\"flex flex-wrap gap-2 mt-2\">\r\n                    {attachments.map((att, idx) => (\r\n                        <div key={idx} className=\"relative group\">\r\n                            {att.type.startsWith('image/') ? (\r\n                                <img src={att.url} alt={att.filename} className=\"h-16 w-16 object-cover rounded-lg border border-gray-200 dark:border-gray-700\" />\r\n                            ) : (\r\n                                <div className=\"h-16 px-3 flex items-center bg-gray-100 dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600\">\r\n                                    <span className=\"text-xs text-gray-600 dark:text-gray-400 truncate max-w-[100px]\">{att.filename}</span>\r\n                                </div>\r\n                            )}\r\n                            <button\r\n                                onClick={() => removeAttachment(idx)}\r\n                                className=\"absolute -top-1 -right-1 p-0.5 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity\"\r\n                            >\r\n                                <XMarkIcon className=\"h-3 w-3\" />\r\n                            </button>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            )}\r\n\r\n            {/* Helper text */}\r\n            <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">\r\n                {t('chat.mentionHint')}\r\n            </p>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\contact\\contact-message-detail-modal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\contact\\contact-message-status-badge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\contact\\contact-messages-client.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchMessages'. Either include it or remove the dependency array.","line":108,"column":6,"nodeType":"ArrayExpression","endLine":108,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [fetchMessages, statusFilter]","fix":{"range":[3360,3374],"text":"[fetchMessages, statusFilter]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect, useMemo } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { format } from 'date-fns';\r\nimport { useLanguage } from '@/contexts/language-context';\r\nimport { useToast } from '@/components/ui/use-toast';\r\nimport { Button } from '@/components/ui/button';\r\nimport { ContactMessageStatusBadge } from './contact-message-status-badge';\r\nimport { ContactMessageDetailModal } from './contact-message-detail-modal';\r\nimport { ConfirmDialog } from '@/components/ui/confirm-dialog';\r\nimport Link from 'next/link';\r\nimport {\r\n  ArrowLeftIcon,\r\n  RectangleStackIcon,\r\n  TableCellsIcon,\r\n  TrashIcon,\r\n  EnvelopeIcon,\r\n  EnvelopeOpenIcon,\r\n  ArchiveBoxIcon,\r\n  MagnifyingGlassIcon,\r\n  ArrowPathIcon,\r\n  InboxIcon,\r\n  CalendarDaysIcon,\r\n  TicketIcon,\r\n  ClockIcon,\r\n  CheckIcon,\r\n  EyeIcon,\r\n} from '@heroicons/react/24/outline';\r\nimport { ComponentType, SVGProps } from 'react';\r\n\r\ninterface ContactMessage {\r\n  id: string;\r\n  ticketId: string | null;\r\n  name: string;\r\n  email: string;\r\n  phone: string | null;\r\n  message: string;\r\n  status: 'NEW' | 'READ' | 'ARCHIVED';\r\n  assignedToId: string | null;\r\n  createdAt: string;\r\n  ticket?: {\r\n    id: string;\r\n    ticketNumber: string;\r\n  } | null;\r\n  assignedTo?: {\r\n    id: string;\r\n    name: string | null;\r\n    username: string;\r\n  } | null;\r\n}\r\n\r\ninterface User {\r\n  id: string;\r\n  name: string | null;\r\n  username: string;\r\n}\r\n\r\ninterface ContactMessagesClientProps {\r\n  initialMessages: ContactMessage[];\r\n  canDelete: boolean;\r\n}\r\n\r\nconst statusConfig: Record<string, { Icon: ComponentType<SVGProps<SVGSVGElement>>; gradient: string; bgLight: string; text: string }> = {\r\n  NEW: {\r\n    Icon: EnvelopeIcon,\r\n    gradient: 'from-blue-500 to-indigo-600',\r\n    bgLight: 'bg-blue-50 dark:bg-blue-900/20',\r\n    text: 'text-blue-600 dark:text-blue-400',\r\n  },\r\n  READ: {\r\n    Icon: EnvelopeOpenIcon,\r\n    gradient: 'from-gray-500 to-slate-600',\r\n    bgLight: 'bg-gray-50 dark:bg-gray-900/20',\r\n    text: 'text-gray-600 dark:text-gray-400',\r\n  },\r\n  ARCHIVED: {\r\n    Icon: ArchiveBoxIcon,\r\n    gradient: 'from-amber-500 to-orange-600',\r\n    bgLight: 'bg-amber-50 dark:bg-amber-900/20',\r\n    text: 'text-amber-600 dark:text-amber-400',\r\n  },\r\n};\r\n\r\nexport function ContactMessagesClient({ initialMessages, canDelete }: ContactMessagesClientProps) {\r\n  const { t } = useLanguage();\r\n  const router = useRouter();\r\n  const { toast } = useToast();\r\n  const [messages, setMessages] = useState<ContactMessage[]>(initialMessages);\r\n  const [statusFilter, setStatusFilter] = useState<string>('ALL');\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [selectedMessage, setSelectedMessage] = useState<ContactMessage | null>(null);\r\n  const [isModalOpen, setIsModalOpen] = useState(false);\r\n  const [users, setUsers] = useState<User[]>([]);\r\n  const [deleteConfirmOpen, setDeleteConfirmOpen] = useState(false);\r\n  const [emptyInboxConfirmOpen, setEmptyInboxConfirmOpen] = useState(false);\r\n  const [messageToDelete, setMessageToDelete] = useState<ContactMessage | null>(null);\r\n  const [isDeleting, setIsDeleting] = useState(false);\r\n  const [viewMode, setViewMode] = useState<'cards' | 'table'>('cards');\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  useEffect(() => {\r\n    fetchUsers();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    fetchMessages();\r\n  }, [statusFilter]);\r\n\r\n  const fetchUsers = async () => {\r\n    try {\r\n      const response = await fetch('/api/users/staff');\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setUsers(data);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching users:', error);\r\n    }\r\n  };\r\n\r\n  const fetchMessages = async () => {\r\n    setLoading(true);\r\n    try {\r\n      const params = new URLSearchParams();\r\n      if (statusFilter !== 'ALL') {\r\n        params.append('status', statusFilter);\r\n      }\r\n\r\n      const response = await fetch(`/api/contact/messages?${params.toString()}`);\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setMessages(data);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching messages:', error);\r\n      toast({\r\n        title: t('error'),\r\n        description: t('failedToFetchData'),\r\n        variant: 'destructive',\r\n      });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Calculate stats\r\n  const stats = useMemo(() => {\r\n    const newCount = messages.filter((m) => m.status === 'NEW').length;\r\n    const readCount = messages.filter((m) => m.status === 'READ').length;\r\n    const archivedCount = messages.filter((m) => m.status === 'ARCHIVED').length;\r\n    const withTicket = messages.filter((m) => m.ticketId).length;\r\n\r\n    return {\r\n      total: messages.length,\r\n      new: newCount,\r\n      read: readCount,\r\n      archived: archivedCount,\r\n      withTicket,\r\n    };\r\n  }, [messages]);\r\n\r\n  // Filter messages\r\n  const filteredMessages = useMemo(() => {\r\n    let filtered = messages;\r\n\r\n    if (searchTerm) {\r\n      const term = searchTerm.toLowerCase();\r\n      filtered = filtered.filter(\r\n        (m) =>\r\n          m.name.toLowerCase().includes(term) ||\r\n          m.email.toLowerCase().includes(term) ||\r\n          m.message.toLowerCase().includes(term) ||\r\n          m.ticket?.ticketNumber.toLowerCase().includes(term)\r\n      );\r\n    }\r\n\r\n    return filtered;\r\n  }, [messages, searchTerm]);\r\n\r\n  // Group messages by date\r\n  const groupedMessages = useMemo(() => {\r\n    const groups: Record<string, ContactMessage[]> = {};\r\n    filteredMessages.forEach((message) => {\r\n      const date = new Date(message.createdAt).toLocaleDateString();\r\n      if (!groups[date]) groups[date] = [];\r\n      groups[date].push(message);\r\n    });\r\n    return groups;\r\n  }, [filteredMessages]);\r\n\r\n  const handleView = (message: ContactMessage) => {\r\n    setSelectedMessage(message);\r\n    setIsModalOpen(true);\r\n  };\r\n\r\n  const handleModalClose = () => {\r\n    setIsModalOpen(false);\r\n    setSelectedMessage(null);\r\n    fetchMessages();\r\n    router.refresh();\r\n  };\r\n\r\n  const handleStatusUpdate = async (messageId: string, newStatus: 'NEW' | 'READ' | 'ARCHIVED') => {\r\n    try {\r\n      const response = await fetch(`/api/contact/${messageId}`, {\r\n        method: 'PATCH',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ status: newStatus }),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error('Failed to update status');\r\n      }\r\n\r\n      toast({\r\n        title: t('success'),\r\n        description: t('contact.admin.mark_read'),\r\n      });\r\n      fetchMessages();\r\n      router.refresh();\r\n    } catch (error) {\r\n      toast({\r\n        title: t('error'),\r\n        description: t('failedToUpdate'),\r\n        variant: 'destructive',\r\n      });\r\n    }\r\n  };\r\n\r\n  const handleDelete = (message: ContactMessage) => {\r\n    if (!canDelete) return;\r\n    setMessageToDelete(message);\r\n    setDeleteConfirmOpen(true);\r\n  };\r\n\r\n  const confirmDelete = async () => {\r\n    if (!messageToDelete || !canDelete) return;\r\n\r\n    setIsDeleting(true);\r\n    try {\r\n      const response = await fetch(`/api/contact/${messageToDelete.id}`, {\r\n        method: 'DELETE',\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error('Failed to delete message');\r\n      }\r\n\r\n      toast({\r\n        title: t('success'),\r\n        description: t('contact.delete.success'),\r\n      });\r\n      fetchMessages();\r\n      router.refresh();\r\n    } catch (error) {\r\n      toast({\r\n        title: t('error'),\r\n        description: t('contact.delete.error'),\r\n        variant: 'destructive',\r\n      });\r\n    } finally {\r\n      setIsDeleting(false);\r\n      setDeleteConfirmOpen(false);\r\n      setMessageToDelete(null);\r\n    }\r\n  };\r\n\r\n  const handleEmptyInbox = () => {\r\n    if (!canDelete) return;\r\n    setEmptyInboxConfirmOpen(true);\r\n  };\r\n\r\n  const confirmEmptyInbox = async () => {\r\n    if (!canDelete) {\r\n      setEmptyInboxConfirmOpen(false);\r\n      return;\r\n    }\r\n    setIsDeleting(true);\r\n    try {\r\n      const response = await fetch('/api/contact/messages', {\r\n        method: 'DELETE',\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error('Failed to delete all messages');\r\n      }\r\n\r\n      const data = await response.json();\r\n      toast({\r\n        title: t('success'),\r\n        description: t('contact.empty.success').replace('{count}', data.deletedCount?.toString() || '0'),\r\n      });\r\n      fetchMessages();\r\n      router.refresh();\r\n    } catch (error) {\r\n      toast({\r\n        title: t('error'),\r\n        description: t('contact.empty.error'),\r\n        variant: 'destructive',\r\n      });\r\n    } finally {\r\n      setIsDeleting(false);\r\n      setEmptyInboxConfirmOpen(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-gray-50 via-gray-50 to-blue-50 dark:from-gray-900 dark:via-gray-900 dark:to-blue-950\">\r\n      <div className=\"p-6 lg:p-8 max-w-7xl mx-auto\">\r\n        {/* Header */}\r\n        <div className=\"mb-8\">\r\n          <Link\r\n            href=\"/dashboard\"\r\n            className=\"inline-flex items-center gap-2 text-gray-500 hover:text-primary transition-colors mb-6 group\"\r\n          >\r\n            <ArrowLeftIcon className=\"h-5 w-5 group-hover:-translate-x-1 transition-transform\" />\r\n            <span className=\"text-sm font-medium\">{t('backToDashboard')}</span>\r\n          </Link>\r\n\r\n          <div className=\"flex flex-col lg:flex-row lg:items-end lg:justify-between gap-4\">\r\n            <div>\r\n              <h1 className=\"text-3xl lg:text-4xl font-bold bg-gradient-to-r from-gray-900 to-gray-600 dark:from-white dark:to-gray-400 bg-clip-text text-transparent\">\r\n                {t('contact.admin.title')}\r\n              </h1>\r\n              <p className=\"mt-2 text-gray-500 dark:text-gray-400 max-w-2xl\">\r\n                {t('contact.admin.description') || 'Manage customer inquiries and support requests'}\r\n              </p>\r\n            </div>\r\n\r\n            <div className=\"flex items-center gap-3\">\r\n              {/* View Toggle */}\r\n              <div className=\"flex items-center gap-1 bg-white dark:bg-gray-800 rounded-xl p-1 shadow-theme-sm\">\r\n                <button\r\n                  onClick={() => setViewMode('cards')}\r\n                  className={`flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-all ${viewMode === 'cards'\r\n                    ? 'bg-primary text-white shadow-md'\r\n                    : 'text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700'\r\n                    }`}\r\n                >\r\n                  <RectangleStackIcon className=\"h-[18px] w-[18px]\" />\r\n                </button>\r\n                <button\r\n                  onClick={() => setViewMode('table')}\r\n                  className={`flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-all ${viewMode === 'table'\r\n                    ? 'bg-primary text-white shadow-md'\r\n                    : 'text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700'\r\n                    }`}\r\n                >\r\n                  <TableCellsIcon className=\"h-[18px] w-[18px]\" />\r\n                </button>\r\n              </div>\r\n\r\n              {/* Empty Inbox Button */}\r\n              {messages.length > 0 && canDelete && (\r\n                <button\r\n                  onClick={handleEmptyInbox}\r\n                  disabled={isDeleting}\r\n                  className=\"flex items-center gap-2 px-4 py-2.5 bg-red-500 hover:bg-red-600 text-white rounded-xl transition-colors text-sm font-medium disabled:opacity-50\"\r\n                >\r\n                  <TrashIcon className=\"h-[18px] w-[18px]\" />\r\n                  {t('contact.empty.inbox')}\r\n                </button>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Stats Cards */}\r\n        <div className=\"grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8\">\r\n          <div className=\"bg-white dark:bg-gray-800 rounded-2xl p-5 shadow-theme-sm border border-gray-100 dark:border-gray-700\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <div className=\"w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center relative\">\r\n                <EnvelopeIcon className=\"h-6 w-6 text-white\" />\r\n                {stats.new > 0 && (\r\n                  <span className=\"absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs font-bold rounded-full flex items-center justify-center animate-pulse\">\r\n                    {stats.new}\r\n                  </span>\r\n                )}\r\n              </div>\r\n              <div>\r\n                <p className=\"text-sm text-gray-500 dark:text-gray-400\">{t('contact.stats.total') || 'Total Messages'}</p>\r\n                <p className=\"text-2xl font-bold text-gray-900 dark:text-white\">{stats.total}</p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"bg-white dark:bg-gray-800 rounded-2xl p-5 shadow-theme-sm border border-gray-100 dark:border-gray-700\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <div className=\"w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center\">\r\n                <EnvelopeIcon className=\"h-6 w-6 text-white\" />\r\n              </div>\r\n              <div>\r\n                <p className=\"text-sm text-gray-500 dark:text-gray-400\">{t('contact.status.new')}</p>\r\n                <p className=\"text-2xl font-bold text-blue-600 dark:text-blue-400\">{stats.new}</p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"bg-white dark:bg-gray-800 rounded-2xl p-5 shadow-theme-sm border border-gray-100 dark:border-gray-700\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <div className=\"w-12 h-12 rounded-xl bg-gradient-to-br from-gray-500 to-slate-600 flex items-center justify-center\">\r\n                <EnvelopeOpenIcon className=\"h-6 w-6 text-white\" />\r\n              </div>\r\n              <div>\r\n                <p className=\"text-sm text-gray-500 dark:text-gray-400\">{t('contact.status.read')}</p>\r\n                <p className=\"text-2xl font-bold text-gray-600 dark:text-gray-400\">{stats.read}</p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"bg-white dark:bg-gray-800 rounded-2xl p-5 shadow-theme-sm border border-gray-100 dark:border-gray-700\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <div className=\"w-12 h-12 rounded-xl bg-gradient-to-br from-amber-500 to-orange-600 flex items-center justify-center\">\r\n                <ArchiveBoxIcon className=\"h-6 w-6 text-white\" />\r\n              </div>\r\n              <div>\r\n                <p className=\"text-sm text-gray-500 dark:text-gray-400\">{t('contact.status.archived')}</p>\r\n                <p className=\"text-2xl font-bold text-amber-600 dark:text-amber-400\">{stats.archived}</p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Filters */}\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-2xl shadow-theme-sm border border-gray-100 dark:border-gray-700 p-5 mb-6\">\r\n          <div className=\"flex flex-col lg:flex-row gap-4 items-start lg:items-center\">\r\n            {/* Search */}\r\n            <div className=\"flex-1 w-full lg:w-auto\">\r\n              <div className=\"relative\">\r\n                <MagnifyingGlassIcon className=\"h-5 w-5 absolute left-4 top-1/2 -translate-y-1/2 text-gray-400\" />\r\n                <input\r\n                  type=\"text\"\r\n                  value={searchTerm}\r\n                  onChange={(e) => setSearchTerm(e.target.value)}\r\n                  placeholder={t('contact.search.placeholder') || 'Search by name, email or message...'}\r\n                  className=\"w-full pl-12 pr-4 py-3 bg-gray-50 dark:bg-gray-700/50 border border-gray-200 dark:border-gray-600 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all text-sm\"\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Status Filter Pills */}\r\n            <div className=\"flex flex-wrap gap-2\">\r\n              <button\r\n                onClick={() => setStatusFilter('ALL')}\r\n                className={`px-4 py-2 rounded-full text-sm font-medium transition-all ${statusFilter === 'ALL'\r\n                  ? 'bg-primary text-white shadow-md shadow-primary/25'\r\n                  : 'bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600'\r\n                  }`}\r\n              >\r\n                {t('contact.admin.filters.all')} ({stats.total})\r\n              </button>\r\n              {(['NEW', 'READ', 'ARCHIVED'] as const).map((status) => {\r\n                const config = statusConfig[status];\r\n                const count = status === 'NEW' ? stats.new : status === 'READ' ? stats.read : stats.archived;\r\n                return (\r\n                  <button\r\n                    key={status}\r\n                    onClick={() => setStatusFilter(status)}\r\n                    className={`flex items-center gap-2 px-4 py-2 rounded-full text-sm font-medium transition-all ${statusFilter === status\r\n                      ? `bg-gradient-to-r ${config.gradient} text-white shadow-md`\r\n                      : 'bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600'\r\n                      }`}\r\n                  >\r\n                    <config.Icon className=\"h-[18px] w-[18px]\" />\r\n                    {t(`contact.status.${status.toLowerCase()}`)} ({count})\r\n                  </button>\r\n                );\r\n              })}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Content */}\r\n        {loading ? (\r\n          <div className=\"flex flex-col items-center justify-center py-20\">\r\n            <div className=\"w-16 h-16 rounded-2xl bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center animate-pulse\">\r\n              <ArrowPathIcon className=\"h-8 w-8 text-white animate-spin\" />\r\n            </div>\r\n            <p className=\"mt-4 text-gray-500 dark:text-gray-400\">{t('loading')}</p>\r\n          </div>\r\n        ) : filteredMessages.length === 0 ? (\r\n          <div className=\"flex flex-col items-center justify-center py-20 bg-white dark:bg-gray-800 rounded-2xl shadow-theme-sm border border-gray-100 dark:border-gray-700\">\r\n            <div className=\"w-24 h-24 rounded-3xl bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-700 dark:to-gray-600 flex items-center justify-center mb-6\">\r\n              <InboxIcon className=\"h-12 w-12 text-gray-400 dark:text-gray-500\" />\r\n            </div>\r\n            <h3 className=\"text-xl font-semibold text-gray-900 dark:text-white mb-2\">{t('contact.admin.no_messages')}</h3>\r\n            <p className=\"text-gray-500 dark:text-gray-400 text-center max-w-md\">\r\n              {t('contact.admin.no_messages_desc') || 'No contact messages found for the selected filter.'}\r\n            </p>\r\n          </div>\r\n        ) : viewMode === 'cards' ? (\r\n          /* Timeline Cards View */\r\n          <div className=\"space-y-6\">\r\n            {Object.entries(groupedMessages).map(([date, dateMessages]) => (\r\n              <div key={date}>\r\n                {/* Date Header */}\r\n                <div className=\"flex items-center gap-3 mb-4\">\r\n                  <div className=\"w-10 h-10 rounded-xl bg-gray-100 dark:bg-gray-800 flex items-center justify-center\">\r\n                    <CalendarDaysIcon className=\"h-5 w-5 text-gray-500\" />\r\n                  </div>\r\n                  <div>\r\n                    <p className=\"font-semibold text-gray-900 dark:text-white\">{date}</p>\r\n                    <p className=\"text-xs text-gray-500\">{dateMessages.length} message{dateMessages.length > 1 ? 's' : ''}</p>\r\n                  </div>\r\n                  <div className=\"flex-1 h-px bg-gray-200 dark:bg-gray-700 ml-4\" />\r\n                </div>\r\n\r\n                {/* Message Cards */}\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 ml-5 pl-8 border-l-2 border-gray-200 dark:border-gray-700\">\r\n                  {dateMessages.map((message) => {\r\n                    const config = statusConfig[message.status];\r\n                    return (\r\n                      <div\r\n                        key={message.id}\r\n                        className=\"group bg-white dark:bg-gray-800 rounded-2xl shadow-theme-sm border border-gray-100 dark:border-gray-700 overflow-hidden hover:shadow-theme-lg hover:border-primary/20 transition-all duration-300 cursor-pointer\"\r\n                        onClick={() => handleView(message)}\r\n                      >\r\n                        <div className={`h-1.5 bg-gradient-to-r ${config.gradient}`} />\r\n\r\n                        <div className=\"p-5\">\r\n                          <div className=\"flex items-start justify-between mb-4\">\r\n                            <div className=\"flex items-center gap-3\">\r\n                              <div className={`w-11 h-11 rounded-xl bg-gradient-to-br ${config.gradient} flex items-center justify-center shadow-lg`}>\r\n                                <config.Icon className=\"h-5 w-5 text-white\" />\r\n                              </div>\r\n                              <div>\r\n                                <p className=\"font-semibold text-gray-900 dark:text-white\">{message.name}</p>\r\n                                <a\r\n                                  href={`mailto:${message.email}`}\r\n                                  onClick={(e) => e.stopPropagation()}\r\n                                  className=\"text-xs text-primary hover:underline\"\r\n                                >\r\n                                  {message.email}\r\n                                </a>\r\n                              </div>\r\n                            </div>\r\n                            <ContactMessageStatusBadge status={message.status} />\r\n                          </div>\r\n\r\n                          {/* Message Preview */}\r\n                          <p className=\"text-sm text-gray-600 dark:text-gray-400 line-clamp-2 mb-4\">{message.message}</p>\r\n\r\n                          {/* Meta Info */}\r\n                          <div className=\"pt-4 border-t border-gray-100 dark:border-gray-700 flex items-center justify-between\">\r\n                            <div className=\"flex items-center gap-4 text-xs text-gray-500 dark:text-gray-400\">\r\n                              {message.ticket && (\r\n                                <Link\r\n                                  href={`/tickets/${message.ticket.id}`}\r\n                                  onClick={(e) => e.stopPropagation()}\r\n                                  className=\"flex items-center gap-1 text-primary hover:underline\"\r\n                                >\r\n                                  <TicketIcon className=\"h-4 w-4\" />\r\n                                  {message.ticket.ticketNumber}\r\n                                </Link>\r\n                              )}\r\n                              <div className=\"flex items-center gap-1\">\r\n                                <ClockIcon className=\"h-4 w-4\" />\r\n                                {format(new Date(message.createdAt), 'HH:mm')}\r\n                              </div>\r\n                            </div>\r\n\r\n                            <div className=\"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity\">\r\n                              {message.status === 'NEW' && (\r\n                                <button\r\n                                  onClick={(e) => {\r\n                                    e.stopPropagation();\r\n                                    handleStatusUpdate(message.id, 'READ');\r\n                                  }}\r\n                                  className=\"p-1.5 rounded-lg text-gray-400 hover:text-primary hover:bg-primary/10\"\r\n                                  title={t('contact.admin.mark_read')}\r\n                                >\r\n                                  <CheckIcon className=\"h-[18px] w-[18px]\" />\r\n                                </button>\r\n                              )}\r\n                              {message.status !== 'ARCHIVED' && (\r\n                                <button\r\n                                  onClick={(e) => {\r\n                                    e.stopPropagation();\r\n                                    handleStatusUpdate(message.id, 'ARCHIVED');\r\n                                  }}\r\n                                  className=\"p-1.5 rounded-lg text-gray-400 hover:text-amber-500 hover:bg-amber-50 dark:hover:bg-amber-900/20\"\r\n                                  title={t('contact.admin.archive')}\r\n                                >\r\n                                  <ArchiveBoxIcon className=\"h-[18px] w-[18px]\" />\r\n                                </button>\r\n                              )}\r\n                              {canDelete && (\r\n                                <button\r\n                                  onClick={(e) => {\r\n                                    e.stopPropagation();\r\n                                    handleDelete(message);\r\n                                  }}\r\n                                  className=\"p-1.5 rounded-lg text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20\"\r\n                                  title={t('delete')}\r\n                                >\r\n                                  <TrashIcon className=\"h-[18px] w-[18px]\" />\r\n                                </button>\r\n                              )}\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    );\r\n                  })}\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        ) : (\r\n          /* Table View */\r\n          <div className=\"bg-white dark:bg-gray-800 rounded-2xl shadow-theme-sm border border-gray-100 dark:border-gray-700 overflow-hidden\">\r\n            <div className=\"overflow-x-auto\">\r\n              <table className=\"min-w-full\">\r\n                <thead>\r\n                  <tr className=\"bg-gray-50 dark:bg-gray-700/50 border-b border-gray-100 dark:border-gray-700\">\r\n                    <th className=\"px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider\">{t('name')}</th>\r\n                    <th className=\"px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider\">{t('contact.detail.email')}</th>\r\n                    <th className=\"px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider\">{t('contact.detail.message')}</th>\r\n                    <th className=\"px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider\">{t('contact.detail.ticket')}</th>\r\n                    <th className=\"px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider\">{t('status')}</th>\r\n                    <th className=\"px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider\">{t('contact.detail.received')}</th>\r\n                    <th className=\"px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider\">{t('actions')}</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody className=\"divide-y divide-gray-100 dark:divide-gray-700\">\r\n                  {filteredMessages.map((message) => {\r\n                    const config = statusConfig[message.status];\r\n                    return (\r\n                      <tr\r\n                        key={message.id}\r\n                        className=\"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors cursor-pointer\"\r\n                        onClick={() => handleView(message)}\r\n                      >\r\n                        <td className=\"px-6 py-4\">\r\n                          <div className=\"flex items-center gap-3\">\r\n                            <div className={`w-9 h-9 rounded-lg bg-gradient-to-br ${config.gradient} flex items-center justify-center`}>\r\n                              <config.Icon className=\"h-4 w-4 text-white\" />\r\n                            </div>\r\n                            <p className=\"font-medium text-gray-900 dark:text-white\">{message.name}</p>\r\n                          </div>\r\n                        </td>\r\n                        <td className=\"px-6 py-4\">\r\n                          <a\r\n                            href={`mailto:${message.email}`}\r\n                            onClick={(e) => e.stopPropagation()}\r\n                            className=\"text-sm text-primary hover:underline\"\r\n                          >\r\n                            {message.email}\r\n                          </a>\r\n                        </td>\r\n                        <td className=\"px-6 py-4 max-w-xs\">\r\n                          <p className=\"text-sm text-gray-600 dark:text-gray-300 line-clamp-2\">{message.message}</p>\r\n                        </td>\r\n                        <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                          {message.ticket ? (\r\n                            <Link\r\n                              href={`/tickets/${message.ticket.id}`}\r\n                              onClick={(e) => e.stopPropagation()}\r\n                              className=\"text-sm text-primary hover:underline\"\r\n                            >\r\n                              {message.ticket.ticketNumber}\r\n                            </Link>\r\n                          ) : (\r\n                            <span className=\"text-sm text-gray-400\">-</span>\r\n                          )}\r\n                        </td>\r\n                        <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                          <ContactMessageStatusBadge status={message.status} />\r\n                        </td>\r\n                        <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                          <p className=\"text-sm text-gray-600 dark:text-gray-300\">{format(new Date(message.createdAt), 'PP')}</p>\r\n                          <p className=\"text-xs text-gray-500\">{format(new Date(message.createdAt), 'p')}</p>\r\n                        </td>\r\n                        <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                          <div className=\"flex items-center gap-1\">\r\n                            <button\r\n                              onClick={(e) => {\r\n                                e.stopPropagation();\r\n                                handleView(message);\r\n                              }}\r\n                              className=\"p-2 rounded-lg text-gray-400 hover:text-primary hover:bg-primary/10 transition-colors\"\r\n                              title={t('contact.admin.view')}\r\n                            >\r\n                              <EyeIcon className=\"h-5 w-5\" />\r\n                            </button>\r\n                            {message.status === 'NEW' && (\r\n                              <button\r\n                                onClick={(e) => {\r\n                                  e.stopPropagation();\r\n                                  handleStatusUpdate(message.id, 'READ');\r\n                                }}\r\n                                className=\"p-2 rounded-lg text-gray-400 hover:text-primary hover:bg-primary/10 transition-colors\"\r\n                                title={t('contact.admin.mark_read')}\r\n                              >\r\n                                <CheckIcon className=\"h-5 w-5\" />\r\n                              </button>\r\n                            )}\r\n                            {canDelete && (\r\n                              <button\r\n                                onClick={(e) => {\r\n                                  e.stopPropagation();\r\n                                  handleDelete(message);\r\n                                }}\r\n                                className=\"p-2 rounded-lg text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors\"\r\n                                title={t('delete')}\r\n                              >\r\n                                <TrashIcon className=\"h-5 w-5\" />\r\n                              </button>\r\n                            )}\r\n                          </div>\r\n                        </td>\r\n                      </tr>\r\n                    );\r\n                  })}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Detail Modal */}\r\n        <ContactMessageDetailModal\r\n          isOpen={isModalOpen}\r\n          onClose={handleModalClose}\r\n          message={selectedMessage}\r\n          onUpdate={handleModalClose}\r\n          canDelete={canDelete}\r\n        />\r\n\r\n        {/* Delete Confirmation Dialog */}\r\n        {canDelete && messageToDelete && (\r\n          <ConfirmDialog\r\n            open={deleteConfirmOpen}\r\n            onOpenChange={setDeleteConfirmOpen}\r\n            title={t('contact.delete.confirmTitle')}\r\n            description={t('contact.delete.confirmDescription').replace('{name}', messageToDelete.name)}\r\n            confirmText={t('delete')}\r\n            cancelText={t('cancel')}\r\n            variant=\"destructive\"\r\n            onConfirm={confirmDelete}\r\n            isLoading={isDeleting}\r\n          />\r\n        )}\r\n\r\n        {/* Empty Inbox Confirmation Dialog */}\r\n        {canDelete && (\r\n          <ConfirmDialog\r\n            open={emptyInboxConfirmOpen}\r\n            onOpenChange={setEmptyInboxConfirmOpen}\r\n            title={t('contact.empty.confirmTitle')}\r\n            description={t('contact.empty.confirmDescription').replace('{count}', messages.length.toString())}\r\n            confirmText={t('contact.empty.inbox')}\r\n            cancelText={t('cancel')}\r\n            variant=\"destructive\"\r\n            onConfirm={confirmEmptyInbox}\r\n            isLoading={isDeleting}\r\n          />\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\contact\\inbox-icon.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\customers\\__tests__\\customer-select.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\customers\\customer-contact-actions.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\customers\\customer-profile-button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\customers\\customer-profile-modal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\customers\\customer-search.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\customers\\customer-select.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\customers\\customers-page-client.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\customers\\new-customer-modal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\dashboard\\dashboard-header.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\dashboard\\dashboard-hero.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\dashboard\\dashboard-quick-actions.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\dashboard\\dashboard-ticket-header.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\dashboard\\dashboard-ticket-table.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\dashboard\\date-range-picker.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\dashboard\\quick-actions-bar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\dashboard\\sales-chart.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\dashboard\\tickets-section.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\finance\\ApproveReturnModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\finance\\ExpenseFormModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\finance\\InventoryAdjustmentFormModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\finance\\PartFormModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\finance\\SupplierFormModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\inventory\\image-cropper.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":292,"column":17,"nodeType":"JSXOpeningElement","endLine":303,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useRef, useCallback, useEffect } from 'react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { useLanguage } from '@/contexts/language-context';\r\nimport {\r\n    ScissorsIcon,\r\n    QuestionMarkCircleIcon,\r\n    CheckIcon,\r\n    ArrowsPointingOutIcon,\r\n    XMarkIcon,\r\n} from '@heroicons/react/24/outline';\r\n\r\ninterface ImageCropperProps {\r\n    imageData: string;\r\n    onCrop: (croppedImage: string) => void;\r\n    onCancel: () => void;\r\n}\r\n\r\ninterface CropArea {\r\n    x: number;\r\n    y: number;\r\n    width: number;\r\n    height: number;\r\n}\r\n\r\nexport function ImageCropper({ imageData, onCrop, onCancel }: ImageCropperProps) {\r\n    const { t } = useLanguage();\r\n    const containerRef = useRef<HTMLDivElement>(null);\r\n    const imageRef = useRef<HTMLImageElement>(null);\r\n\r\n    const [imageSize, setImageSize] = useState({ width: 0, height: 0 });\r\n    const [containerSize, setContainerSize] = useState({ width: 0, height: 0 });\r\n    const [scale, setScale] = useState(1);\r\n    const [cropArea, setCropArea] = useState<CropArea>({ x: 0, y: 0, width: 0, height: 0 });\r\n    const [isDragging, setIsDragging] = useState(false);\r\n    const [dragType, setDragType] = useState<'move' | 'resize' | null>(null);\r\n    const [dragStart, setDragStart] = useState({ x: 0, y: 0 });\r\n    const [resizeHandle, setResizeHandle] = useState<string | null>(null);\r\n    const [showTips, setShowTips] = useState(false);\r\n\r\n    // Initialize crop area when image loads\r\n    const handleImageLoad = useCallback(() => {\r\n        if (!imageRef.current || !containerRef.current) return;\r\n\r\n        const img = imageRef.current;\r\n        const container = containerRef.current;\r\n\r\n        const containerWidth = container.clientWidth;\r\n        const containerHeight = Math.min(450, window.innerHeight * 0.55);\r\n\r\n        const scaleX = containerWidth / img.naturalWidth;\r\n        const scaleY = containerHeight / img.naturalHeight;\r\n        const newScale = Math.min(scaleX, scaleY, 1);\r\n\r\n        const displayWidth = img.naturalWidth * newScale;\r\n        const displayHeight = img.naturalHeight * newScale;\r\n\r\n        setScale(newScale);\r\n        setImageSize({ width: img.naturalWidth, height: img.naturalHeight });\r\n        setContainerSize({ width: displayWidth, height: displayHeight });\r\n\r\n        // Default crop to center 80% of image\r\n        const padding = 0.1;\r\n        setCropArea({\r\n            x: displayWidth * padding,\r\n            y: displayHeight * padding,\r\n            width: displayWidth * (1 - padding * 2),\r\n            height: displayHeight * (1 - padding * 2),\r\n        });\r\n    }, []);\r\n\r\n    // Mouse/touch event handlers\r\n    const getEventPosition = (e: React.MouseEvent | React.TouchEvent) => {\r\n        const container = containerRef.current;\r\n        if (!container) return { x: 0, y: 0 };\r\n\r\n        const rect = container.getBoundingClientRect();\r\n\r\n        if ('touches' in e) {\r\n            return {\r\n                x: e.touches[0].clientX - rect.left,\r\n                y: e.touches[0].clientY - rect.top,\r\n            };\r\n        }\r\n        return {\r\n            x: e.clientX - rect.left,\r\n            y: e.clientY - rect.top,\r\n        };\r\n    };\r\n\r\n    const handleStart = (e: React.MouseEvent | React.TouchEvent, type: 'move' | 'resize', handle?: string) => {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        const pos = getEventPosition(e);\r\n        setIsDragging(true);\r\n        setDragType(type);\r\n        setDragStart(pos);\r\n        if (handle) setResizeHandle(handle);\r\n    };\r\n\r\n    const handleMove = useCallback((e: MouseEvent | TouchEvent) => {\r\n        if (!isDragging || !dragType) return;\r\n\r\n        const container = containerRef.current;\r\n        if (!container) return;\r\n\r\n        const rect = container.getBoundingClientRect();\r\n        let clientX, clientY;\r\n\r\n        if ('touches' in e) {\r\n            clientX = e.touches[0].clientX;\r\n            clientY = e.touches[0].clientY;\r\n        } else {\r\n            clientX = e.clientX;\r\n            clientY = e.clientY;\r\n        }\r\n\r\n        const currentPos = {\r\n            x: clientX - rect.left,\r\n            y: clientY - rect.top,\r\n        };\r\n\r\n        const deltaX = currentPos.x - dragStart.x;\r\n        const deltaY = currentPos.y - dragStart.y;\r\n\r\n        setCropArea(prev => {\r\n            let newArea = { ...prev };\r\n\r\n            if (dragType === 'move') {\r\n                newArea.x = Math.max(0, Math.min(containerSize.width - prev.width, prev.x + deltaX));\r\n                newArea.y = Math.max(0, Math.min(containerSize.height - prev.height, prev.y + deltaY));\r\n            } else if (dragType === 'resize' && resizeHandle) {\r\n                const minSize = 50;\r\n\r\n                switch (resizeHandle) {\r\n                    case 'nw':\r\n                        newArea.width = Math.max(minSize, prev.width - deltaX);\r\n                        newArea.height = Math.max(minSize, prev.height - deltaY);\r\n                        newArea.x = prev.x + prev.width - newArea.width;\r\n                        newArea.y = prev.y + prev.height - newArea.height;\r\n                        break;\r\n                    case 'ne':\r\n                        newArea.width = Math.max(minSize, prev.width + deltaX);\r\n                        newArea.height = Math.max(minSize, prev.height - deltaY);\r\n                        newArea.y = prev.y + prev.height - newArea.height;\r\n                        break;\r\n                    case 'sw':\r\n                        newArea.width = Math.max(minSize, prev.width - deltaX);\r\n                        newArea.height = Math.max(minSize, prev.height + deltaY);\r\n                        newArea.x = prev.x + prev.width - newArea.width;\r\n                        break;\r\n                    case 'se':\r\n                        newArea.width = Math.max(minSize, prev.width + deltaX);\r\n                        newArea.height = Math.max(minSize, prev.height + deltaY);\r\n                        break;\r\n                    case 'n':\r\n                        newArea.height = Math.max(minSize, prev.height - deltaY);\r\n                        newArea.y = prev.y + prev.height - newArea.height;\r\n                        break;\r\n                    case 's':\r\n                        newArea.height = Math.max(minSize, prev.height + deltaY);\r\n                        break;\r\n                    case 'w':\r\n                        newArea.width = Math.max(minSize, prev.width - deltaX);\r\n                        newArea.x = prev.x + prev.width - newArea.width;\r\n                        break;\r\n                    case 'e':\r\n                        newArea.width = Math.max(minSize, prev.width + deltaX);\r\n                        break;\r\n                }\r\n\r\n                // Keep within bounds\r\n                newArea.x = Math.max(0, newArea.x);\r\n                newArea.y = Math.max(0, newArea.y);\r\n                newArea.width = Math.min(containerSize.width - newArea.x, newArea.width);\r\n                newArea.height = Math.min(containerSize.height - newArea.y, newArea.height);\r\n            }\r\n\r\n            return newArea;\r\n        });\r\n\r\n        setDragStart(currentPos);\r\n    }, [isDragging, dragType, dragStart, resizeHandle, containerSize]);\r\n\r\n    const handleEnd = useCallback(() => {\r\n        setIsDragging(false);\r\n        setDragType(null);\r\n        setResizeHandle(null);\r\n    }, []);\r\n\r\n    // Add/remove event listeners\r\n    useEffect(() => {\r\n        if (isDragging) {\r\n            window.addEventListener('mousemove', handleMove);\r\n            window.addEventListener('mouseup', handleEnd);\r\n            window.addEventListener('touchmove', handleMove);\r\n            window.addEventListener('touchend', handleEnd);\r\n        }\r\n        return () => {\r\n            window.removeEventListener('mousemove', handleMove);\r\n            window.removeEventListener('mouseup', handleEnd);\r\n            window.removeEventListener('touchmove', handleMove);\r\n            window.removeEventListener('touchend', handleEnd);\r\n        };\r\n    }, [isDragging, handleMove, handleEnd]);\r\n\r\n    // Perform crop\r\n    const performCrop = () => {\r\n        if (!imageRef.current) return;\r\n\r\n        const canvas = document.createElement('canvas');\r\n        const ctx = canvas.getContext('2d');\r\n        if (!ctx) return;\r\n\r\n        const x = cropArea.x / scale;\r\n        const y = cropArea.y / scale;\r\n        const width = cropArea.width / scale;\r\n        const height = cropArea.height / scale;\r\n\r\n        canvas.width = width;\r\n        canvas.height = height;\r\n\r\n        ctx.drawImage(\r\n            imageRef.current,\r\n            x, y, width, height,\r\n            0, 0, width, height\r\n        );\r\n\r\n        const croppedImage = canvas.toDataURL('image/jpeg', 0.9);\r\n        onCrop(croppedImage);\r\n    };\r\n\r\n    // Corner handle styles\r\n    const cornerStyle = (position: string): React.CSSProperties => {\r\n        const size = 16;\r\n        const base: React.CSSProperties = {\r\n            position: 'absolute',\r\n            width: size,\r\n            height: size,\r\n            backgroundColor: '#3b82f6',\r\n            borderRadius: 3,\r\n            zIndex: 20,\r\n            touchAction: 'none',\r\n        };\r\n\r\n        switch (position) {\r\n            case 'nw': return { ...base, top: -size / 2, left: -size / 2, cursor: 'nw-resize' };\r\n            case 'ne': return { ...base, top: -size / 2, right: -size / 2, cursor: 'ne-resize' };\r\n            case 'sw': return { ...base, bottom: -size / 2, left: -size / 2, cursor: 'sw-resize' };\r\n            case 'se': return { ...base, bottom: -size / 2, right: -size / 2, cursor: 'se-resize' };\r\n            default: return base;\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-3\">\r\n            {/* Minimal header with collapsible tips */}\r\n            <div className=\"flex items-center justify-between\">\r\n                <div className=\"flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300\">\r\n                    <ScissorsIcon className=\"h-5 w-5 text-blue-500\" />\r\n                    <span>{t('receiptScanner.cropTitle') || 'Select parts area'}</span>\r\n                </div>\r\n                <button\r\n                    onClick={() => setShowTips(!showTips)}\r\n                    className=\"text-xs text-gray-500 hover:text-blue-500 flex items-center gap-1\"\r\n                >\r\n                    <QuestionMarkCircleIcon className=\"h-4 w-4\" />\r\n                    {showTips ? (t('hideTips') || 'Hide tips') : (t('tips') || 'Tips')}\r\n                </button>\r\n            </div>\r\n\r\n            {/* Collapsible tips */}\r\n            {showTips && (\r\n                <div className=\"text-xs bg-gray-50 dark:bg-gray-800 p-3 rounded-lg text-gray-600 dark:text-gray-400 space-y-1\">\r\n                    <p>Ô£ô <span className=\"text-green-600\">{t('include') || 'Include'}:</span> {t('receiptScanner.cropInclude') || 'Part names, quantities, prices'}</p>\r\n                    <p>Ô£ù <span className=\"text-red-500\">{t('exclude') || 'Exclude'}:</span> {t('receiptScanner.cropExclude') || 'Headers, footers, payment info'}</p>\r\n                </div>\r\n            )}\r\n\r\n            {/* Image with crop overlay */}\r\n            <div\r\n                ref={containerRef}\r\n                className=\"relative mx-auto bg-gray-900 rounded-lg overflow-hidden select-none\"\r\n                style={{\r\n                    width: containerSize.width || '100%',\r\n                    height: containerSize.height || 'auto',\r\n                }}\r\n            >\r\n                {/* Original Image */}\r\n                <img\r\n                    ref={imageRef}\r\n                    src={imageData}\r\n                    alt=\"Receipt\"\r\n                    onLoad={handleImageLoad}\r\n                    className=\"block\"\r\n                    style={{\r\n                        width: containerSize.width || 'auto',\r\n                        height: containerSize.height || 'auto',\r\n                    }}\r\n                    draggable={false}\r\n                />\r\n\r\n                {/* Dark overlay outside crop area */}\r\n                <div\r\n                    className=\"absolute inset-0 pointer-events-none\"\r\n                    style={{\r\n                        background: `linear-gradient(to right, \r\n                            rgba(0,0,0,0.6) ${cropArea.x}px, \r\n                            transparent ${cropArea.x}px, \r\n                            transparent ${cropArea.x + cropArea.width}px, \r\n                            rgba(0,0,0,0.6) ${cropArea.x + cropArea.width}px\r\n                        )`,\r\n                    }}\r\n                />\r\n                <div\r\n                    className=\"absolute pointer-events-none\"\r\n                    style={{\r\n                        left: cropArea.x,\r\n                        top: 0,\r\n                        width: cropArea.width,\r\n                        height: cropArea.y,\r\n                        backgroundColor: 'rgba(0,0,0,0.6)',\r\n                    }}\r\n                />\r\n                <div\r\n                    className=\"absolute pointer-events-none\"\r\n                    style={{\r\n                        left: cropArea.x,\r\n                        top: cropArea.y + cropArea.height,\r\n                        width: cropArea.width,\r\n                        height: containerSize.height - cropArea.y - cropArea.height,\r\n                        backgroundColor: 'rgba(0,0,0,0.6)',\r\n                    }}\r\n                />\r\n\r\n                {/* Crop selection box */}\r\n                <div\r\n                    className=\"absolute border-2 border-blue-500 bg-transparent cursor-move\"\r\n                    style={{\r\n                        left: cropArea.x,\r\n                        top: cropArea.y,\r\n                        width: cropArea.width,\r\n                        height: cropArea.height,\r\n                        touchAction: 'none',\r\n                    }}\r\n                    onMouseDown={(e) => handleStart(e, 'move')}\r\n                    onTouchStart={(e) => handleStart(e, 'move')}\r\n                >\r\n                    {/* Grid lines */}\r\n                    <div className=\"absolute inset-0 pointer-events-none\">\r\n                        <div className=\"absolute top-1/3 left-0 right-0 h-px bg-white/30\" />\r\n                        <div className=\"absolute top-2/3 left-0 right-0 h-px bg-white/30\" />\r\n                        <div className=\"absolute left-1/3 top-0 bottom-0 w-px bg-white/30\" />\r\n                        <div className=\"absolute left-2/3 top-0 bottom-0 w-px bg-white/30\" />\r\n                    </div>\r\n\r\n                    {/* Only corner handles for cleaner look */}\r\n                    {['nw', 'ne', 'sw', 'se'].map((handle) => (\r\n                        <div\r\n                            key={handle}\r\n                            style={cornerStyle(handle)}\r\n                            onMouseDown={(e) => handleStart(e, 'resize', handle)}\r\n                            onTouchStart={(e) => handleStart(e, 'resize', handle)}\r\n                        />\r\n                    ))}\r\n                </div>\r\n\r\n                {/* Size indicator - bottom of image */}\r\n                <div className=\"absolute bottom-2 left-1/2 transform -translate-x-1/2 bg-black/70 text-white text-xs px-2 py-1 rounded\">\r\n                    {Math.round(cropArea.width / scale)} ├ù {Math.round(cropArea.height / scale)}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Action buttons - consistent styling */}\r\n            <div className=\"flex gap-2\">\r\n                <Button onClick={performCrop} className=\"flex-1 h-10\">\r\n                    <CheckIcon className=\"h-[18px] w-[18px] mr-1.5\" />\r\n                    {t('receiptScanner.cropAndScan') || 'Crop & Scan'}\r\n                </Button>\r\n                <Button variant=\"outline\" onClick={() => onCrop(imageData)} className=\"h-10 px-4\">\r\n                    <ArrowsPointingOutIcon className=\"h-[18px] w-[18px]\" />\r\n                </Button>\r\n                <Button variant=\"ghost\" onClick={onCancel} className=\"h-10 px-4\">\r\n                    <XMarkIcon className=\"h-[18px] w-[18px]\" />\r\n                </Button>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\inventory\\parts-stock-page-client.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\inventory\\parts-stock-search.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\inventory\\receipt-scanner.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'suppliers.length'. Either include it or remove the dependency array.","line":120,"column":8,"nodeType":"ArrayExpression","endLine":120,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [scanResult, suppliers.length]","fix":{"range":[4272,4284],"text":"[scanResult, suppliers.length]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useRef, useCallback, useEffect } from 'react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { useToast } from '@/components/ui/use-toast';\r\nimport { useLanguage } from '@/contexts/language-context';\r\nimport { Input } from '@/components/ui/input';\r\nimport { ImageCropper } from './image-cropper';\r\nimport {\r\n    DocumentMagnifyingGlassIcon,\r\n    ExclamationCircleIcon,\r\n    WifiIcon,\r\n    CameraIcon,\r\n    ArrowUpTrayIcon,\r\n    BuildingStorefrontIcon,\r\n    XMarkIcon,\r\n    CheckCircleIcon,\r\n    PlusCircleIcon,\r\n    TrashIcon,\r\n    ExclamationTriangleIcon,\r\n    CubeIcon,\r\n} from '@heroicons/react/24/outline';\r\n\r\ninterface ExtractedPart {\r\n    name: string;\r\n    quantity: number;\r\n    unitPrice: number;\r\n    sku?: string;\r\n    matchedPartId: string | null;\r\n    matchedPartName?: string;\r\n    matchConfidence: number;\r\n    matchType: 'exact' | 'sku' | 'fuzzy' | 'none';\r\n}\r\n\r\ninterface ExtractedSupplier {\r\n    name?: string;\r\n    phone?: string;\r\n    email?: string;\r\n    address?: string;\r\n}\r\n\r\ninterface ScanResult {\r\n    extractedParts: ExtractedPart[];\r\n    matched: ExtractedPart[];\r\n    unmatched: ExtractedPart[];\r\n    supplier?: ExtractedSupplier;\r\n    invoiceNumber?: string;\r\n    date?: string;\r\n    total?: number;\r\n    mode?: string;\r\n}\r\n\r\ninterface ReceiptScannerProps {\r\n    onComplete?: () => void;\r\n}\r\n\r\ntype ScanMode = 'tesseract' | 'ocrspace' | 'vision';\r\n\r\nexport function ReceiptScanner({ onComplete }: ReceiptScannerProps) {\r\n    const { t } = useLanguage();\r\n    const { toast } = useToast();\r\n    const fileInputRef = useRef<HTMLInputElement>(null);\r\n    const videoRef = useRef<HTMLVideoElement>(null);\r\n\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [ocrProgress, setOcrProgress] = useState(0);\r\n    const [loadingMessage, setLoadingMessage] = useState('');\r\n    const [error, setError] = useState<{ message: string; retryable: boolean } | null>(null);\r\n    const [scanResult, setScanResult] = useState<ScanResult | null>(null);\r\n    const [editableParts, setEditableParts] = useState<ExtractedPart[]>([]);\r\n    const [showCamera, setShowCamera] = useState(false);\r\n    const [stream, setStream] = useState<MediaStream | null>(null);\r\n    const [isConfirming, setIsConfirming] = useState(false);\r\n    const [scanMode, setScanMode] = useState<ScanMode>('tesseract');\r\n    const [capturedImage, setCapturedImage] = useState<string | null>(null);\r\n    const [showCropper, setShowCropper] = useState(false);\r\n    const [saveSupplier, setSaveSupplier] = useState(true);\r\n    const [duplicateWarning, setDuplicateWarning] = useState<{\r\n        show: boolean;\r\n        message: string;\r\n        type: 'invoice' | 'content';\r\n        existingRecord?: { scannedAt: string; supplierName?: string; invoiceNumber?: string };\r\n    } | null>(null);\r\n\r\n    // Supplier selection\r\n    const [suppliers, setSuppliers] = useState<{ id: string; name: string }[]>([]);\r\n    const [selectedSupplierId, setSelectedSupplierId] = useState<string>('');\r\n    const [showNewSupplier, setShowNewSupplier] = useState(false);\r\n    const [newSupplierName, setNewSupplierName] = useState('');\r\n\r\n    // Load scan mode from settings\r\n    useEffect(() => {\r\n        const loadSettings = async () => {\r\n            try {\r\n                const res = await fetch('/api/settings/ai-vision');\r\n                if (res.ok) {\r\n                    const data = await res.json();\r\n                    setScanMode(data.scanMode || 'tesseract');\r\n                }\r\n            } catch (error) {\r\n                console.error('Failed to load scan mode');\r\n            }\r\n        };\r\n        loadSettings();\r\n    }, []);\r\n\r\n    // Load suppliers when scan results appear (for manual selection)\r\n    useEffect(() => {\r\n        if (scanResult && suppliers.length === 0) {\r\n            fetch('/api/suppliers')\r\n                .then(res => res.json())\r\n                .then(data => {\r\n                    if (Array.isArray(data)) {\r\n                        setSuppliers(data.map((s: any) => ({ id: s.id, name: s.name })));\r\n                    }\r\n                })\r\n                .catch(() => { });\r\n        }\r\n    }, [scanResult]);\r\n\r\n    // Check online status with state to track changes\r\n    const [isOnline, setIsOnline] = useState(true);\r\n\r\n    useEffect(() => {\r\n        // Initial check\r\n        setIsOnline(typeof navigator !== 'undefined' ? navigator.onLine : true);\r\n\r\n        // Listen for online/offline events\r\n        const handleOnline = () => setIsOnline(true);\r\n        const handleOffline = () => setIsOnline(false);\r\n\r\n        window.addEventListener('online', handleOnline);\r\n        window.addEventListener('offline', handleOffline);\r\n\r\n        return () => {\r\n            window.removeEventListener('online', handleOnline);\r\n            window.removeEventListener('offline', handleOffline);\r\n        };\r\n    }, []);\r\n\r\n    // Connect stream to video element when both are available\r\n    useEffect(() => {\r\n        if (stream && videoRef.current && showCamera) {\r\n            videoRef.current.srcObject = stream;\r\n            videoRef.current.play().catch(console.error);\r\n        }\r\n    }, [stream, showCamera]);\r\n\r\n    // For Tesseract mode, only need online for parsing (not for OCR or image capture)\r\n    const requiresOnlineForStart = scanMode !== 'tesseract';\r\n\r\n    // Start camera stream\r\n    const startCamera = async () => {\r\n        try {\r\n            setError(null);\r\n\r\n            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {\r\n                setError({ message: t('receiptScanner.cameraNotSupported') || 'Camera not supported on this device', retryable: false });\r\n                return;\r\n            }\r\n\r\n            const mediaStream = await navigator.mediaDevices.getUserMedia({\r\n                video: { facingMode: 'environment' }\r\n            });\r\n\r\n            setStream(mediaStream);\r\n            setShowCamera(true);\r\n\r\n            if (videoRef.current) {\r\n                videoRef.current.srcObject = mediaStream;\r\n            }\r\n        } catch (err: any) {\r\n            console.error('Camera error:', err);\r\n\r\n            if (err.name === 'NotFoundError' || err.name === 'DevicesNotFoundError') {\r\n                setError({ message: t('receiptScanner.cameraNotFound') || 'No camera detected on this device', retryable: false });\r\n            } else if (err.name === 'NotAllowedError' || err.name === 'PermissionDeniedError') {\r\n                setError({ message: t('receiptScanner.cameraPermissionDenied') || 'Camera access denied. Please allow camera access', retryable: true });\r\n            } else if (err.name === 'NotReadableError' || err.name === 'TrackStartError') {\r\n                setError({ message: t('receiptScanner.cameraInUse') || 'Camera is being used by another app', retryable: true });\r\n            } else {\r\n                setError({ message: t('receiptScanner.cameraError') || 'Failed to access camera', retryable: true });\r\n            }\r\n        }\r\n    };\r\n\r\n    // Stop camera stream\r\n    const stopCamera = useCallback(() => {\r\n        if (stream) {\r\n            stream.getTracks().forEach(track => track.stop());\r\n            setStream(null);\r\n        }\r\n        setShowCamera(false);\r\n    }, [stream]);\r\n\r\n    // Capture photo from camera\r\n    const capturePhoto = () => {\r\n        if (!videoRef.current) return;\r\n\r\n        const canvas = document.createElement('canvas');\r\n        canvas.width = videoRef.current.videoWidth;\r\n        canvas.height = videoRef.current.videoHeight;\r\n\r\n        const ctx = canvas.getContext('2d');\r\n        if (!ctx) return;\r\n\r\n        ctx.drawImage(videoRef.current, 0, 0);\r\n        const imageData = canvas.toDataURL('image/jpeg', 0.9);\r\n\r\n        stopCamera();\r\n\r\n        // Show cropper instead of directly processing\r\n        setCapturedImage(imageData);\r\n        setShowCropper(true);\r\n    };\r\n\r\n    // Handle file upload\r\n    const handleFileUpload = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const file = e.target.files?.[0];\r\n        if (!file) return;\r\n\r\n        const reader = new FileReader();\r\n        reader.onload = (event) => {\r\n            const imageData = event.target?.result as string;\r\n            // Show cropper instead of directly processing\r\n            setCapturedImage(imageData);\r\n            setShowCropper(true);\r\n        };\r\n        reader.readAsDataURL(file);\r\n    };\r\n\r\n    // Handle cropped image\r\n    const handleCrop = (croppedImage: string) => {\r\n        setShowCropper(false);\r\n        setCapturedImage(null);\r\n        processImage(croppedImage);\r\n    };\r\n\r\n    // Cancel cropping\r\n    const handleCancelCrop = () => {\r\n        setShowCropper(false);\r\n        setCapturedImage(null);\r\n        if (fileInputRef.current) {\r\n            fileInputRef.current.value = '';\r\n        }\r\n    };\r\n\r\n    // Perform Tesseract OCR in browser\r\n    const performTesseractOCR = async (imageData: string): Promise<string> => {\r\n        setLoadingMessage(t('receiptScanner.loadingOcr') || 'Loading OCR engine...');\r\n        setOcrProgress(0);\r\n\r\n        // Dynamic import of Tesseract.js\r\n        const Tesseract = await import('tesseract.js');\r\n\r\n        setLoadingMessage(t('receiptScanner.extractingText') || 'Extracting text from image...');\r\n\r\n        const result = await Tesseract.recognize(\r\n            imageData,\r\n            'eng+ara+fra', // Support English, Arabic, French\r\n            {\r\n                logger: (m) => {\r\n                    if (m.status === 'recognizing text') {\r\n                        setOcrProgress(Math.round(m.progress * 100));\r\n                    } else if (m.status === 'loading language traineddata') {\r\n                        setLoadingMessage('Loading language data...');\r\n                    }\r\n                },\r\n            }\r\n        );\r\n\r\n        return result.data.text;\r\n    };\r\n\r\n    // Process image through API\r\n    const processImage = async (imageData: string) => {\r\n        // Check if online is required (not for Tesseract OCR step, but for AI parsing)\r\n        if (requiresOnlineForStart && !isOnline) {\r\n            setError({ message: t('receiptScanner.noInternet') || 'Internet connection required', retryable: true });\r\n            return;\r\n        }\r\n\r\n        setIsLoading(true);\r\n        setError(null);\r\n        setScanResult(null);\r\n        setOcrProgress(0);\r\n\r\n        try {\r\n            let ocrText: string | undefined;\r\n\r\n            // For Tesseract mode, do OCR in browser first\r\n            if (scanMode === 'tesseract') {\r\n                setLoadingMessage(t('receiptScanner.runningLocalOcr') || 'Running local OCR...');\r\n                ocrText = await performTesseractOCR(imageData);\r\n\r\n                if (!ocrText.trim()) {\r\n                    setError({ message: t('receiptScanner.ocrFailed') || 'Could not extract text from image. Please try a clearer photo.', retryable: true });\r\n                    setIsLoading(false);\r\n                    return;\r\n                }\r\n\r\n                // Check if online for AI parsing\r\n                if (!isOnline) {\r\n                    setError({ message: t('receiptScanner.internetForParsing') || 'Internet required to parse extracted text', retryable: true });\r\n                    setIsLoading(false);\r\n                    return;\r\n                }\r\n            }\r\n\r\n            setLoadingMessage(t('receiptScanner.analyzing') || 'Analyzing receipt with AI...');\r\n\r\n            // Build request body\r\n            const requestBody: any = {\r\n                mode: scanMode,\r\n            };\r\n\r\n            if (scanMode === 'tesseract') {\r\n                // For Tesseract, send pre-extracted text\r\n                requestBody.ocrText = ocrText;\r\n                requestBody.image = ''; // Not needed\r\n            } else {\r\n                // For other modes, send image\r\n                requestBody.image = imageData;\r\n            }\r\n\r\n            const response = await fetch('/api/v2/receipt-scanner', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify(requestBody),\r\n            });\r\n\r\n            const data = await response.json();\r\n\r\n            if (!response.ok) {\r\n                setError({\r\n                    message: data.error || t('receiptScanner.processFailed') || 'Failed to process receipt',\r\n                    retryable: data.retryable ?? true\r\n                });\r\n                return;\r\n            }\r\n\r\n            setScanResult(data);\r\n            setEditableParts(data.extractedParts);\r\n        } catch (err) {\r\n            console.error('Scan error:', err);\r\n            setError({ message: t('receiptScanner.networkError') || 'Network error - check your connection', retryable: true });\r\n        } finally {\r\n            setIsLoading(false);\r\n            setLoadingMessage('');\r\n            setOcrProgress(0);\r\n        }\r\n    };\r\n\r\n    // Update editable part\r\n    const updatePart = (index: number, field: keyof ExtractedPart, value: any) => {\r\n        setEditableParts(prev => {\r\n            const updated = [...prev];\r\n            updated[index] = { ...updated[index], [field]: value };\r\n            return updated;\r\n        });\r\n    };\r\n\r\n    // Remove part from list\r\n    const removePart = (index: number) => {\r\n        setEditableParts(prev => prev.filter((_, i) => i !== index));\r\n    };\r\n\r\n    // Confirm and add parts to inventory\r\n    const confirmParts = async () => {\r\n        if (editableParts.length === 0) {\r\n            toast({\r\n                title: t('error'),\r\n                description: t('receiptScanner.noPartsToAdd') || 'No parts to add',\r\n                variant: 'destructive',\r\n            });\r\n            return;\r\n        }\r\n\r\n        setIsConfirming(true);\r\n\r\n        try {\r\n            // Determine supplier to use\r\n            let supplierData = undefined;\r\n            if (showNewSupplier && newSupplierName.trim()) {\r\n                // User entered a new supplier name\r\n                supplierData = { name: newSupplierName.trim() };\r\n            } else if (selectedSupplierId) {\r\n                // User selected an existing supplier - send the ID\r\n                const selected = suppliers.find(s => s.id === selectedSupplierId);\r\n                if (selected) {\r\n                    supplierData = { name: selected.name, existingId: selectedSupplierId };\r\n                }\r\n            } else if (saveSupplier && scanResult?.supplier) {\r\n                // Use extracted supplier\r\n                supplierData = scanResult.supplier;\r\n            }\r\n\r\n            const confirmData = {\r\n                action: 'confirm',\r\n                parts: editableParts.map(p => ({\r\n                    name: p.name,\r\n                    quantity: p.quantity,\r\n                    unitPrice: p.unitPrice,\r\n                    sku: p.sku,\r\n                    matchedPartId: p.matchedPartId,\r\n                })),\r\n                supplier: supplierData,\r\n                invoiceNumber: scanResult?.invoiceNumber,\r\n                date: scanResult?.date,\r\n                total: scanResult?.total,\r\n                forceAdd: duplicateWarning?.show ? true : false,\r\n            };\r\n\r\n            const response = await fetch('/api/v2/receipt-scanner', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify(confirmData),\r\n            });\r\n\r\n            const data = await response.json();\r\n\r\n            // Handle duplicate detection\r\n            if (response.status === 409 && data.duplicate) {\r\n                setDuplicateWarning({\r\n                    show: true,\r\n                    message: data.message,\r\n                    type: data.duplicateType,\r\n                    existingRecord: data.existingRecord,\r\n                });\r\n                setIsConfirming(false);\r\n                return;\r\n            }\r\n\r\n            if (!response.ok) {\r\n                throw new Error(data.error || 'Failed to add parts');\r\n            }\r\n\r\n            toast({\r\n                title: t('success'),\r\n                description: t('receiptScanner.successMessage', { updated: data.updated, created: data.created }) || `${data.updated} parts updated, ${data.created} new parts created`,\r\n            });\r\n\r\n            // Reset state\r\n            setScanResult(null);\r\n            setEditableParts([]);\r\n            setDuplicateWarning(null);\r\n            onComplete?.();\r\n        } catch (err: any) {\r\n            toast({\r\n                title: t('error'),\r\n                description: err.message || t('receiptScanner.addFailed') || 'Failed to add parts to inventory',\r\n                variant: 'destructive',\r\n            });\r\n        } finally {\r\n            setIsConfirming(false);\r\n        }\r\n    };\r\n\r\n    // Reset scanner\r\n    const reset = () => {\r\n        stopCamera();\r\n        setScanResult(null);\r\n        setEditableParts([]);\r\n        setError(null);\r\n        setOcrProgress(0);\r\n        setLoadingMessage('');\r\n        setShowCropper(false);\r\n        setCapturedImage(null);\r\n        if (fileInputRef.current) {\r\n            fileInputRef.current.value = '';\r\n        }\r\n    };\r\n\r\n    const getModeLabel = () => {\r\n        switch (scanMode) {\r\n            case 'tesseract': return t('receiptScanner.mode.tesseract') || '­ƒåô Free (Tesseract)';\r\n            case 'ocrspace': return t('receiptScanner.mode.ocrspace') || 'Ôÿü´©Å OCR.space';\r\n            case 'vision': return t('receiptScanner.mode.vision') || '­ƒö« AI Vision';\r\n            default: return scanMode;\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Card className=\"w-full\">\r\n            <CardHeader>\r\n                <CardTitle className=\"flex items-center justify-between\">\r\n                    <div className=\"flex items-center gap-2\">\r\n                        <DocumentMagnifyingGlassIcon className=\"h-5 w-5\" />\r\n                        {t('receiptScanner.title') || 'Receipt Scanner'}\r\n                    </div>\r\n                    <span className=\"text-xs font-normal px-2 py-1 bg-gray-100 dark:bg-gray-800 rounded-full\">\r\n                        {getModeLabel()}\r\n                    </span>\r\n                </CardTitle>\r\n                <CardDescription>\r\n                    {t('receiptScanner.description') || 'Scan supplier invoices to automatically add parts to inventory'}\r\n                </CardDescription>\r\n            </CardHeader>\r\n            <CardContent className=\"space-y-4\">\r\n                {/* Error Display */}\r\n                {error && (\r\n                    <div className=\"bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-400 p-4 rounded-lg flex items-center justify-between\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <ExclamationCircleIcon className=\"h-5 w-5\" />\r\n                            <span>{error.message}</span>\r\n                        </div>\r\n                        {error.retryable && (\r\n                            <Button variant=\"outline\" size=\"sm\" onClick={reset}>\r\n                                {t('retry') || 'Retry'}\r\n                            </Button>\r\n                        )}\r\n                    </div>\r\n                )}\r\n\r\n                {/* Offline Warning (only if requires online for start) */}\r\n                {!isOnline && requiresOnlineForStart && (\r\n                    <div className=\"bg-yellow-50 dark:bg-yellow-900/20 text-yellow-700 dark:text-yellow-400 p-4 rounded-lg flex items-center gap-2\">\r\n                        <WifiIcon className=\"h-5 w-5\" />\r\n                        <span>{t('receiptScanner.noInternet') || 'Internet connection required'}</span>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Camera View */}\r\n                {showCamera && (\r\n                    <div className=\"relative\">\r\n                        <video\r\n                            ref={videoRef}\r\n                            autoPlay\r\n                            playsInline\r\n                            className=\"w-full rounded-lg bg-black\"\r\n                        />\r\n                        <div className=\"absolute bottom-4 left-0 right-0 flex justify-center gap-4\">\r\n                            <Button onClick={capturePhoto} size=\"lg\">\r\n                                <CameraIcon className=\"h-5 w-5 mr-2\" />\r\n                                {t('capture') || 'Capture'}\r\n                            </Button>\r\n                            <Button onClick={stopCamera} variant=\"outline\" size=\"lg\">\r\n                                {t('cancel') || 'Cancel'}\r\n                            </Button>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Image Cropper */}\r\n                {showCropper && capturedImage && (\r\n                    <ImageCropper\r\n                        imageData={capturedImage}\r\n                        onCrop={handleCrop}\r\n                        onCancel={handleCancelCrop}\r\n                    />\r\n                )}\r\n\r\n                {/* Input Options - always allow photo/upload, online check happens on process */}\r\n                {!showCamera && !showCropper && !scanResult && !isLoading && (\r\n                    <div className=\"flex flex-col sm:flex-row gap-4\">\r\n                        <Button\r\n                            onClick={startCamera}\r\n                            className=\"flex-1\"\r\n                        >\r\n                            <CameraIcon className=\"h-5 w-5 mr-2\" />\r\n                            {t('receiptScanner.takePhoto') || 'Take Photo'}\r\n                        </Button>\r\n                        <div className=\"relative flex-1\">\r\n                            <input\r\n                                ref={fileInputRef}\r\n                                type=\"file\"\r\n                                accept=\"image/*\"\r\n                                onChange={handleFileUpload}\r\n                                className=\"absolute inset-0 opacity-0 cursor-pointer\"\r\n                            />\r\n                            <Button\r\n                                variant=\"outline\"\r\n                                className=\"w-full\"\r\n                            >\r\n                                <ArrowUpTrayIcon className=\"h-5 w-5 mr-2\" />\r\n                                {t('receiptScanner.uploadImage') || 'Upload Image'}\r\n                            </Button>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Loading State */}\r\n                {isLoading && (\r\n                    <div className=\"flex flex-col items-center justify-center py-12 space-y-4\">\r\n                        <div className=\"relative\">\r\n                            <div className=\"animate-spin rounded-full h-16 w-16 border-4 border-primary border-t-transparent\"></div>\r\n                            {ocrProgress > 0 && (\r\n                                <div className=\"absolute inset-0 flex items-center justify-center\">\r\n                                    <span className=\"text-sm font-medium\">{ocrProgress}%</span>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                        <p className=\"text-gray-600 dark:text-gray-400\">\r\n                            {loadingMessage || t('receiptScanner.processing') || 'Processing receipt...'}\r\n                        </p>\r\n                        {scanMode === 'tesseract' && ocrProgress > 0 && (\r\n                            <div className=\"w-full max-w-xs bg-gray-200 dark:bg-gray-700 rounded-full h-2\">\r\n                                <div\r\n                                    className=\"bg-primary h-2 rounded-full transition-all duration-300\"\r\n                                    style={{ width: `${ocrProgress}%` }}\r\n                                />\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                )}\r\n\r\n                {/* Scan Results */}\r\n                {scanResult && editableParts.length > 0 && (\r\n                    <div className=\"space-y-4\">\r\n                        {/* Supplier & Invoice Info */}\r\n                        <div className=\"bg-gray-50 dark:bg-gray-800 p-3 rounded-lg text-sm space-y-3\">\r\n                            {/* Supplier Row */}\r\n                            <div className=\"flex items-center gap-2\">\r\n                                <BuildingStorefrontIcon className=\"h-5 w-5 text-gray-500\" />\r\n                                {!showNewSupplier ? (\r\n                                    <select\r\n                                        value={selectedSupplierId || (scanResult.supplier?.name ? 'extracted' : '')}\r\n                                        onChange={(e) => {\r\n                                            if (e.target.value === 'new') {\r\n                                                setShowNewSupplier(true);\r\n                                                setSelectedSupplierId('');\r\n                                            } else if (e.target.value === 'extracted') {\r\n                                                setSelectedSupplierId('');\r\n                                                setSaveSupplier(true);\r\n                                            } else {\r\n                                                setSelectedSupplierId(e.target.value);\r\n                                                setSaveSupplier(false);\r\n                                            }\r\n                                        }}\r\n                                        className=\"flex-1 text-sm px-2 py-1.5 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700\"\r\n                                    >\r\n                                        {scanResult.supplier?.name && (\r\n                                            <option value=\"extracted\">\r\n                                                {scanResult.supplier.name} ({t('receiptScanner.detected') || 'detected'})\r\n                                            </option>\r\n                                        )}\r\n                                        <option value=\"\">{t('receiptScanner.noSupplier') || 'No supplier'}</option>\r\n                                        {suppliers.length > 0 && (\r\n                                            <optgroup label={t('receiptScanner.existingSuppliers') || 'Existing Suppliers'}>\r\n                                                {suppliers.map(s => (\r\n                                                    <option key={s.id} value={s.id}>{s.name}</option>\r\n                                                ))}\r\n                                            </optgroup>\r\n                                        )}\r\n                                        <option value=\"new\">{t('receiptScanner.addNewSupplier') || '+ Add new supplier...'}</option>\r\n                                    </select>\r\n                                ) : (\r\n                                    <div className=\"flex-1 flex gap-2\">\r\n                                        <input\r\n                                            type=\"text\"\r\n                                            value={newSupplierName}\r\n                                            onChange={(e) => setNewSupplierName(e.target.value)}\r\n                                            placeholder={t('receiptScanner.supplierNamePlaceholder') || 'Supplier name'}\r\n                                            className=\"flex-1 text-sm px-2 py-1.5 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700\"\r\n                                            autoFocus\r\n                                        />\r\n                                        <button\r\n                                            onClick={() => {\r\n                                                setShowNewSupplier(false);\r\n                                                setNewSupplierName('');\r\n                                            }}\r\n                                            className=\"text-gray-400 hover:text-gray-600\"\r\n                                        >\r\n                                            <XMarkIcon className=\"h-4 w-4\" />\r\n                                        </button>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n\r\n                            {/* Invoice details row */}\r\n                            {(scanResult.invoiceNumber || scanResult.date || scanResult.total) && (\r\n                                <div className=\"flex flex-wrap gap-3 text-xs text-gray-600 dark:text-gray-400 pt-2 border-t border-gray-200 dark:border-gray-700\">\r\n                                    {scanResult.invoiceNumber && <span>{t('receiptScanner.invoice') || 'Invoice'}: {scanResult.invoiceNumber}</span>}\r\n                                    {scanResult.date && <span>{t('receiptScanner.date') || 'Date'}: {scanResult.date}</span>}\r\n                                    {scanResult.total && <span>{t('receiptScanner.total') || 'Total'}: ${scanResult.total.toFixed(2)}</span>}\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* Parts Table */}\r\n                        <div className=\"overflow-x-auto\">\r\n                            <table className=\"w-full text-sm\">\r\n                                <thead>\r\n                                    <tr className=\"border-b border-gray-200 dark:border-gray-700\">\r\n                                        <th className=\"text-left py-2 px-2\">{t('name') || 'Name'}</th>\r\n                                        <th className=\"text-center py-2 px-2\">{t('quantity') || 'Qty'}</th>\r\n                                        <th className=\"text-right py-2 px-2\">{t('price') || 'Price'}</th>\r\n                                        <th className=\"text-center py-2 px-2\">{t('match') || 'Match'}</th>\r\n                                        <th className=\"text-center py-2 px-2\"></th>\r\n                                    </tr>\r\n                                </thead>\r\n                                <tbody>\r\n                                    {editableParts.map((part, index) => (\r\n                                        <tr key={index} className=\"border-b border-gray-100 dark:border-gray-800\">\r\n                                            <td className=\"py-2 px-2\">\r\n                                                <Input\r\n                                                    value={part.name}\r\n                                                    onChange={(e) => updatePart(index, 'name', e.target.value)}\r\n                                                    className=\"h-8 text-sm\"\r\n                                                />\r\n                                            </td>\r\n                                            <td className=\"py-2 px-2 w-20\">\r\n                                                <Input\r\n                                                    type=\"number\"\r\n                                                    min={1}\r\n                                                    value={part.quantity}\r\n                                                    onChange={(e) => updatePart(index, 'quantity', parseInt(e.target.value) || 1)}\r\n                                                    className=\"h-8 text-sm text-center\"\r\n                                                />\r\n                                            </td>\r\n                                            <td className=\"py-2 px-2 w-24\">\r\n                                                <Input\r\n                                                    type=\"number\"\r\n                                                    step=\"0.01\"\r\n                                                    min={0}\r\n                                                    value={part.unitPrice}\r\n                                                    onChange={(e) => updatePart(index, 'unitPrice', parseFloat(e.target.value) || 0)}\r\n                                                    className=\"h-8 text-sm text-right\"\r\n                                                />\r\n                                            </td>\r\n                                            <td className=\"py-2 px-2 text-center\">\r\n                                                {part.matchedPartId ? (\r\n                                                    <span className=\"inline-flex items-center gap-1 text-green-600 dark:text-green-400\">\r\n                                                        <CheckCircleIcon className=\"h-4 w-4\" />\r\n                                                        <span className=\"text-xs\">{part.matchConfidence}%</span>\r\n                                                    </span>\r\n                                                ) : (\r\n                                                    <span className=\"inline-flex items-center gap-1 text-yellow-600 dark:text-yellow-400\">\r\n                                                        <PlusCircleIcon className=\"h-4 w-4\" />\r\n                                                        <span className=\"text-xs\">{t('new') || 'New'}</span>\r\n                                                    </span>\r\n                                                )}\r\n                                            </td>\r\n                                            <td className=\"py-2 px-2 text-center\">\r\n                                                <Button\r\n                                                    variant=\"ghost\"\r\n                                                    size=\"sm\"\r\n                                                    onClick={() => removePart(index)}\r\n                                                    className=\"h-8 w-8 p-0 text-red-500 hover:text-red-700\"\r\n                                                >\r\n                                                    <TrashIcon className=\"h-4 w-4\" />\r\n                                                </Button>\r\n                                            </td>\r\n                                        </tr>\r\n                                    ))}\r\n                                </tbody>\r\n                            </table>\r\n                        </div>\r\n\r\n                        {/* Summary */}\r\n                        <div className=\"flex items-center justify-between text-sm text-gray-600 dark:text-gray-400\">\r\n                            <span>\r\n                                {scanResult.matched.length} {t('receiptScanner.matched') || 'matched'}, {scanResult.unmatched.length} {t('receiptScanner.newParts') || 'new parts'}\r\n                            </span>\r\n                            <span className=\"font-medium\">\r\n                                {t('receiptScanner.total') || 'Total'}: ${editableParts.reduce((sum, p) => sum + (p.quantity * p.unitPrice), 0).toFixed(2)}\r\n                            </span>\r\n                        </div>\r\n\r\n                        {/* Duplicate Warning */}\r\n                        {duplicateWarning?.show && (\r\n                            <div className=\"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 p-4 rounded-lg\">\r\n                                <div className=\"flex items-start gap-3\">\r\n                                    <ExclamationTriangleIcon className=\"h-5 w-5 text-amber-500\" />\r\n                                    <div className=\"flex-1\">\r\n                                        <p className=\"font-medium text-amber-700 dark:text-amber-300\">\r\n                                            {duplicateWarning.type === 'invoice' ? (t('receiptScanner.duplicateInvoice') || 'Duplicate Invoice') : (t('receiptScanner.similarReceipt') || 'Similar Receipt Detected')}\r\n                                        </p>\r\n                                        <p className=\"text-sm text-amber-600 dark:text-amber-400 mt-1\">\r\n                                            {duplicateWarning.message}\r\n                                        </p>\r\n                                        {duplicateWarning.existingRecord && (\r\n                                            <p className=\"text-xs text-gray-500 mt-2\">\r\n                                                {duplicateWarning.existingRecord.supplierName && (\r\n                                                    <span>Supplier: {duplicateWarning.existingRecord.supplierName} ÔÇó </span>\r\n                                                )}\r\n                                                Scanned: {new Date(duplicateWarning.existingRecord.scannedAt).toLocaleDateString()}\r\n                                            </p>\r\n                                        )}\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"flex gap-2 mt-3\">\r\n                                    <Button\r\n                                        size=\"sm\"\r\n                                        variant=\"outline\"\r\n                                        onClick={confirmParts}\r\n                                        disabled={isConfirming}\r\n                                        className=\"flex-1\"\r\n                                    >\r\n                                        {isConfirming ? (t('receiptScanner.adding') || 'Adding...') : (t('receiptScanner.addAnyway') || 'Add Anyway')}\r\n                                    </Button>\r\n                                    <Button\r\n                                        size=\"sm\"\r\n                                        variant=\"ghost\"\r\n                                        onClick={() => setDuplicateWarning(null)}\r\n                                    >\r\n                                        Cancel\r\n                                    </Button>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* Actions */}\r\n                        {!duplicateWarning?.show && (\r\n                            <div className=\"flex gap-3\">\r\n                                <Button\r\n                                    onClick={confirmParts}\r\n                                    disabled={isConfirming || editableParts.length === 0}\r\n                                    className=\"flex-1\"\r\n                                >\r\n                                    {isConfirming ? (\r\n                                        <>\r\n                                            <span className=\"animate-spin mr-2\">ÔÅ│</span>\r\n                                            {t('processing') || 'Processing...'}\r\n                                        </>\r\n                                    ) : (\r\n                                        <>\r\n                                            <CubeIcon className=\"h-5 w-5 mr-2\" />\r\n                                            {t('receiptScanner.addToInventory') || 'Add to Inventory'}\r\n                                        </>\r\n                                    )}\r\n                                </Button>\r\n                                <Button variant=\"outline\" onClick={reset}>\r\n                                    {t('cancel') || 'Cancel'}\r\n                                </Button>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                )}\r\n\r\n                {/* No Parts Found */}\r\n                {scanResult && editableParts.length === 0 && (\r\n                    <div className=\"text-center py-8 text-gray-500\">\r\n                        <CubeIcon className=\"h-10 w-10 mx-auto mb-2\" />\r\n                        <p>{t('receiptScanner.noPartsFound') || 'No parts found in this receipt'}</p>\r\n                        <Button variant=\"outline\" onClick={reset} className=\"mt-4\">\r\n                            {t('tryAgain') || 'Try Again'}\r\n                        </Button>\r\n                    </div>\r\n                )}\r\n            </CardContent>\r\n        </Card >\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\layout\\app-version.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\layout\\language-switcher.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\layout\\main-layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\layout\\page-header.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\layout\\search-bars.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\layout\\sidebar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\layout\\top-header.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\layout\\translated-card-title.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\layout\\user-profile-dropdown.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\notifications\\notifications-bell.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\notifications\\notifications-dropdown.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\notifications\\notifications-list.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\providers.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\providers\\i18n-provider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\returns\\create-return-modal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\settings\\AIVisionSettingsTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\settings\\BrandingSettingsTab.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":73,"column":33,"nodeType":"JSXOpeningElement","endLine":77,"endColumn":35},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":122,"column":33,"nodeType":"JSXOpeningElement","endLine":126,"endColumn":35},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":171,"column":33,"nodeType":"JSXOpeningElement","endLine":175,"endColumn":35},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":220,"column":33,"nodeType":"JSXOpeningElement","endLine":224,"endColumn":35}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useRef } from 'react';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { useLanguage } from '@/contexts/language-context';\r\nimport { PhotoIcon, XMarkIcon, SwatchIcon } from '@heroicons/react/24/outline';\r\n\r\ninterface BrandingSettingsTabProps {\r\n    settings: Record<string, string>;\r\n    onSettingChange: (key: string, value: string) => void;\r\n    onSave: () => void;\r\n    isSaving: boolean;\r\n    onUpload: (type: 'logo' | 'favicon' | 'background' | 'track_image', file: File) => Promise<void>;\r\n    onRemove: (type: 'logo' | 'favicon' | 'background' | 'track_image') => void;\r\n    isUploading: Record<string, boolean>;\r\n}\r\n\r\nexport function BrandingSettingsTab({\r\n    settings,\r\n    onSettingChange,\r\n    onSave,\r\n    isSaving,\r\n    onUpload,\r\n    onRemove,\r\n    isUploading,\r\n}: BrandingSettingsTabProps) {\r\n    const { t } = useLanguage();\r\n    const logoInputRef = useRef<HTMLInputElement>(null);\r\n    const faviconInputRef = useRef<HTMLInputElement>(null);\r\n    const backgroundInputRef = useRef<HTMLInputElement>(null);\r\n    const trackImageInputRef = useRef<HTMLInputElement>(null);\r\n\r\n    const handleFileChange = async (type: 'logo' | 'favicon' | 'background' | 'track_image', e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const file = e.target.files?.[0];\r\n        if (file) {\r\n            await onUpload(type, file);\r\n            e.target.value = '';\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Header Card */}\r\n            <Card className=\"overflow-hidden border-0 bg-gradient-to-r from-pink-500/10 via-rose-500/10 to-red-500/10\">\r\n                <CardHeader className=\"pb-4\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <div className=\"p-2.5 rounded-xl bg-gradient-to-br from-pink-500 to-rose-600 text-white shadow-lg shadow-pink-500/25\">\r\n                            <SwatchIcon className=\"w-6 h-6\" />\r\n                        </div>\r\n                        <div>\r\n                            <CardTitle className=\"text-xl\">{t('settings.branding.title') || 'Branding Settings'}</CardTitle>\r\n                            <CardDescription>\r\n                                {t('settings.branding.description') || 'Customize your company logo, colors, and visual identity'}\r\n                            </CardDescription>\r\n                        </div>\r\n                    </div>\r\n                </CardHeader>\r\n            </Card>\r\n\r\n            {/* Company Logo */}\r\n            <Card>\r\n                <CardHeader>\r\n                    <CardTitle>{t('companyLogo')}</CardTitle>\r\n                    <CardDescription>{t('uploadYourCompanyLogo')}</CardDescription>\r\n                </CardHeader>\r\n                <CardContent className=\"space-y-4\">\r\n                    <div className=\"flex items-center gap-4\">\r\n                        {settings.company_logo ? (\r\n                            <div className=\"relative\">\r\n                                <img\r\n                                    src={settings.company_logo}\r\n                                    alt=\"Company Logo\"\r\n                                    className=\"h-20 w-20 object-contain border border-gray-300 dark:border-gray-600 rounded\"\r\n                                />\r\n                                <button\r\n                                    onClick={() => onRemove('logo')}\r\n                                    className=\"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600\"\r\n                                >\r\n                                    <XMarkIcon className=\"h-4 w-4\" />\r\n                                </button>\r\n                            </div>\r\n                        ) : (\r\n                            <div className=\"h-20 w-20 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded flex items-center justify-center\">\r\n                                <PhotoIcon className=\"h-8 w-8 text-gray-400\" />\r\n                            </div>\r\n                        )}\r\n                        <div>\r\n                            <input\r\n                                ref={logoInputRef}\r\n                                type=\"file\"\r\n                                accept=\"image/*\"\r\n                                onChange={(e) => handleFileChange('logo', e)}\r\n                                className=\"hidden\"\r\n                            />\r\n                            <Button\r\n                                type=\"button\"\r\n                                variant=\"outline\"\r\n                                onClick={() => logoInputRef.current?.click()}\r\n                                disabled={isUploading.logo}\r\n                            >\r\n                                {isUploading.logo ? t('uploading') : settings.company_logo ? t('changeLogo') : t('uploadLogo')}\r\n                            </Button>\r\n                            <p className=\"text-xs text-gray-500 mt-1\">Max 5MB. Recommended: 200x200px</p>\r\n                        </div>\r\n                    </div>\r\n                </CardContent>\r\n            </Card>\r\n\r\n            {/* Favicon */}\r\n            <Card>\r\n                <CardHeader>\r\n                    <CardTitle>{t('companyFavicon') || 'Favicon'}</CardTitle>\r\n                    <CardDescription>{t('uploadYourCompanyFavicon') || 'Browser tab icon'}</CardDescription>\r\n                </CardHeader>\r\n                <CardContent className=\"space-y-4\">\r\n                    <div className=\"flex items-center gap-4\">\r\n                        {settings.company_favicon ? (\r\n                            <div className=\"relative\">\r\n                                <img\r\n                                    src={settings.company_favicon}\r\n                                    alt=\"Favicon\"\r\n                                    className=\"h-16 w-16 object-contain border border-gray-300 dark:border-gray-600 rounded\"\r\n                                />\r\n                                <button\r\n                                    onClick={() => onRemove('favicon')}\r\n                                    className=\"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600\"\r\n                                >\r\n                                    <XMarkIcon className=\"h-4 w-4\" />\r\n                                </button>\r\n                            </div>\r\n                        ) : (\r\n                            <div className=\"h-16 w-16 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded flex items-center justify-center\">\r\n                                <PhotoIcon className=\"h-6 w-6 text-gray-400\" />\r\n                            </div>\r\n                        )}\r\n                        <div>\r\n                            <input\r\n                                ref={faviconInputRef}\r\n                                type=\"file\"\r\n                                accept=\"image/*\"\r\n                                onChange={(e) => handleFileChange('favicon', e)}\r\n                                className=\"hidden\"\r\n                            />\r\n                            <Button\r\n                                type=\"button\"\r\n                                variant=\"outline\"\r\n                                onClick={() => faviconInputRef.current?.click()}\r\n                                disabled={isUploading.favicon}\r\n                            >\r\n                                {isUploading.favicon ? t('uploading') : settings.company_favicon ? t('changeFavicon') : t('uploadFavicon')}\r\n                            </Button>\r\n                            <p className=\"text-xs text-gray-500 mt-1\">Recommended: 32x32px or 64x64px</p>\r\n                        </div>\r\n                    </div>\r\n                </CardContent>\r\n            </Card>\r\n\r\n            {/* Login Background */}\r\n            <Card>\r\n                <CardHeader>\r\n                    <CardTitle>{t('loginPageBackground')}</CardTitle>\r\n                    <CardDescription>{t('customizeLoginBackground')}</CardDescription>\r\n                </CardHeader>\r\n                <CardContent className=\"space-y-4\">\r\n                    <div className=\"flex items-center gap-4\">\r\n                        {settings.login_background_image ? (\r\n                            <div className=\"relative\">\r\n                                <img\r\n                                    src={settings.login_background_image}\r\n                                    alt=\"Background\"\r\n                                    className=\"h-32 w-48 object-cover border border-gray-300 dark:border-gray-600 rounded\"\r\n                                />\r\n                                <button\r\n                                    onClick={() => onRemove('background')}\r\n                                    className=\"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600\"\r\n                                >\r\n                                    <XMarkIcon className=\"h-4 w-4\" />\r\n                                </button>\r\n                            </div>\r\n                        ) : (\r\n                            <div className=\"h-32 w-48 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded flex items-center justify-center\">\r\n                                <PhotoIcon className=\"h-8 w-8 text-gray-400\" />\r\n                            </div>\r\n                        )}\r\n                        <div>\r\n                            <input\r\n                                ref={backgroundInputRef}\r\n                                type=\"file\"\r\n                                accept=\"image/*\"\r\n                                onChange={(e) => handleFileChange('background', e)}\r\n                                className=\"hidden\"\r\n                            />\r\n                            <Button\r\n                                type=\"button\"\r\n                                variant=\"outline\"\r\n                                onClick={() => backgroundInputRef.current?.click()}\r\n                                disabled={isUploading.background}\r\n                            >\r\n                                {isUploading.background ? t('uploading') : t('uploadImage')}\r\n                            </Button>\r\n                            <p className=\"text-xs text-gray-500 mt-1\">Recommended: 1920x1080px</p>\r\n                        </div>\r\n                    </div>\r\n                </CardContent>\r\n            </Card>\r\n\r\n            {/* Track Page Background */}\r\n            <Card>\r\n                <CardHeader>\r\n                    <CardTitle>{t('settings.branding.defaultTrackImage')}</CardTitle>\r\n                    <CardDescription>Upload a background image for the public tracking page.</CardDescription>\r\n                </CardHeader>\r\n                <CardContent className=\"space-y-4\">\r\n                    <div className=\"flex items-center gap-4\">\r\n                        {settings.default_track_image ? (\r\n                            <div className=\"relative\">\r\n                                <img\r\n                                    src={settings.default_track_image}\r\n                                    alt=\"Track Background\"\r\n                                    className=\"h-32 w-48 object-cover border border-gray-300 dark:border-gray-600 rounded\"\r\n                                />\r\n                                <button\r\n                                    onClick={() => onRemove('track_image')}\r\n                                    className=\"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600\"\r\n                                >\r\n                                    <XMarkIcon className=\"h-4 w-4\" />\r\n                                </button>\r\n                            </div>\r\n                        ) : (\r\n                            <div className=\"h-32 w-48 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded flex items-center justify-center\">\r\n                                <PhotoIcon className=\"h-8 w-8 text-gray-400\" />\r\n                            </div>\r\n                        )}\r\n                        <div>\r\n                            <input\r\n                                ref={trackImageInputRef}\r\n                                type=\"file\"\r\n                                accept=\"image/*\"\r\n                                onChange={(e) => handleFileChange('track_image', e)}\r\n                                className=\"hidden\"\r\n                            />\r\n                            <Button\r\n                                type=\"button\"\r\n                                variant=\"outline\"\r\n                                onClick={() => trackImageInputRef.current?.click()}\r\n                                disabled={isUploading.track_image}\r\n                            >\r\n                                {isUploading.track_image ? t('uploading') : settings.default_track_image ? t('changeImage') : t('uploadImage')}\r\n                            </Button>\r\n                            <p className=\"text-xs text-gray-500 mt-1\">Max 5MB</p>\r\n                        </div>\r\n                    </div>\r\n                </CardContent>\r\n            </Card>\r\n\r\n            {/* Brand Colors */}\r\n            <Card>\r\n                <CardHeader>\r\n                    <CardTitle>{t('settings.brandColors') || 'Brand Colors'}</CardTitle>\r\n                    <CardDescription>{t('settings.brandColorsDescription') || 'Customize your brand colors'}</CardDescription>\r\n                </CardHeader>\r\n                <CardContent className=\"space-y-4\">\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                        <div className=\"space-y-2\">\r\n                            <Label htmlFor=\"primary_color\">{t('settings.primaryColor') || 'Primary Color'}</Label>\r\n                            <div className=\"flex items-center gap-2\">\r\n                                <input\r\n                                    type=\"color\"\r\n                                    id=\"primary_color\"\r\n                                    value={settings.primary_color || '#3B82F6'}\r\n                                    onChange={(e) => onSettingChange('primary_color', e.target.value)}\r\n                                    className=\"h-10 w-16 rounded border border-gray-300 cursor-pointer\"\r\n                                />\r\n                                <Input\r\n                                    value={settings.primary_color || '#3B82F6'}\r\n                                    onChange={(e) => onSettingChange('primary_color', e.target.value)}\r\n                                    placeholder=\"#3B82F6\"\r\n                                    className=\"flex-1\"\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"space-y-2\">\r\n                            <Label htmlFor=\"secondary_color\">{t('settings.secondaryColor') || 'Secondary Color'}</Label>\r\n                            <div className=\"flex items-center gap-2\">\r\n                                <input\r\n                                    type=\"color\"\r\n                                    id=\"secondary_color\"\r\n                                    value={settings.secondary_color || '#1E40AF'}\r\n                                    onChange={(e) => onSettingChange('secondary_color', e.target.value)}\r\n                                    className=\"h-10 w-16 rounded border border-gray-300 cursor-pointer\"\r\n                                />\r\n                                <Input\r\n                                    value={settings.secondary_color || '#1E40AF'}\r\n                                    onChange={(e) => onSettingChange('secondary_color', e.target.value)}\r\n                                    placeholder=\"#1E40AF\"\r\n                                    className=\"flex-1\"\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </CardContent>\r\n            </Card>\r\n\r\n            <Button onClick={onSave} disabled={isSaving} className=\"w-full sm:w-auto\">\r\n                {isSaving ? t('loading') : t('saveSettings')}\r\n            </Button>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\settings\\DatabaseSettingsTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\settings\\FactoryResetTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\settings\\FinanceSettingsTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\settings\\GeneralSettingsTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\settings\\InventorySettingsTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\settings\\PermissionsSettingsTab.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'onSettingChange'. Either include it or remove the dependency array. If 'onSettingChange' changes too often, find the parent component that defines it and wrap that definition in useCallback.","line":128,"column":8,"nodeType":"ArrayExpression","endLine":128,"endColumn":26,"suggestions":[{"desc":"Update the dependencies array to be: [onSettingChange, staffPermissions]","fix":{"range":[3789,3807],"text":"[onSettingChange, staffPermissions]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { useLanguage } from '@/contexts/language-context';\r\nimport { useToast } from '@/components/ui/use-toast';\r\nimport { ShieldCheckIcon, UsersIcon } from '@heroicons/react/24/outline';\r\n\r\ninterface PermissionsSettingsTabProps {\r\n    settings: Record<string, string>;\r\n    onSettingChange: (key: string, value: string) => void;\r\n    onSave: () => void;\r\n    isSaving: boolean;\r\n}\r\n\r\n// Define all app features and their permission options\r\nconst FEATURES = [\r\n    {\r\n        id: 'dashboard',\r\n        name: 'Dashboard',\r\n        description: 'View dashboard and analytics',\r\n        adminOnly: false\r\n    },\r\n    {\r\n        id: 'tickets',\r\n        name: 'Tickets',\r\n        description: 'Manage repair tickets',\r\n        permissions: ['view', 'create', 'edit', 'delete', 'change_status', 'change_price']\r\n    },\r\n    {\r\n        id: 'customers',\r\n        name: 'Customers',\r\n        description: 'Manage customer records',\r\n        permissions: ['view', 'create', 'edit', 'delete']\r\n    },\r\n    {\r\n        id: 'inventory',\r\n        name: 'Inventory',\r\n        description: 'Manage parts and stock',\r\n        permissions: ['view', 'create', 'edit', 'delete', 'adjust_stock']\r\n    },\r\n    {\r\n        id: 'suppliers',\r\n        name: 'Suppliers',\r\n        description: 'Manage supplier information',\r\n        permissions: ['view', 'create', 'edit', 'delete']\r\n    },\r\n    {\r\n        id: 'finance',\r\n        name: 'Finance',\r\n        description: 'View financial reports and expenses',\r\n        permissions: ['view', 'create_expense', 'view_reports']\r\n    },\r\n    {\r\n        id: 'returns',\r\n        name: 'Returns',\r\n        description: 'Process returns and refunds',\r\n        permissions: ['view', 'create', 'approve', 'reject']\r\n    },\r\n    {\r\n        id: 'payments',\r\n        name: 'Payments',\r\n        description: 'Record and manage payments',\r\n        permissions: ['view', 'create', 'refund']\r\n    },\r\n    {\r\n        id: 'notifications',\r\n        name: 'Notifications',\r\n        description: 'View and manage notifications',\r\n        adminOnly: false\r\n    },\r\n    {\r\n        id: 'settings',\r\n        name: 'Settings',\r\n        description: 'Access system settings',\r\n        adminOnly: true\r\n    },\r\n    {\r\n        id: 'users',\r\n        name: 'User Management',\r\n        description: 'Manage user accounts',\r\n        adminOnly: true\r\n    },\r\n];\r\n\r\nconst PERMISSION_LABELS: Record<string, string> = {\r\n    view: 'View',\r\n    create: 'Create',\r\n    edit: 'Edit',\r\n    delete: 'Delete',\r\n    change_status: 'Change Status',\r\n    change_price: 'Change Price',\r\n    adjust_stock: 'Adjust Stock',\r\n    create_expense: 'Create Expense',\r\n    view_reports: 'View Reports',\r\n    approve: 'Approve',\r\n    reject: 'Reject',\r\n    refund: 'Process Refund',\r\n};\r\n\r\nexport function PermissionsSettingsTab({\r\n    settings,\r\n    onSettingChange,\r\n    onSave,\r\n    isSaving,\r\n}: PermissionsSettingsTabProps) {\r\n    const { t } = useLanguage();\r\n    const { toast } = useToast();\r\n\r\n    // Parse permissions from settings\r\n    const getPermissions = (role: 'STAFF' | 'ADMIN'): Record<string, string[]> => {\r\n        const key = `permissions_${role.toLowerCase()}`;\r\n        try {\r\n            return JSON.parse(settings[key] || '{}');\r\n        } catch {\r\n            return {};\r\n        }\r\n    };\r\n\r\n    const [staffPermissions, setStaffPermissions] = useState<Record<string, string[]>>(\r\n        getPermissions('STAFF')\r\n    );\r\n\r\n    // Update settings when permissions change\r\n    useEffect(() => {\r\n        onSettingChange('permissions_staff', JSON.stringify(staffPermissions));\r\n    }, [staffPermissions]);\r\n\r\n    const togglePermission = (featureId: string, permission: string) => {\r\n        setStaffPermissions(prev => {\r\n            const current = prev[featureId] || [];\r\n            const updated = current.includes(permission)\r\n                ? current.filter(p => p !== permission)\r\n                : [...current, permission];\r\n            return { ...prev, [featureId]: updated };\r\n        });\r\n    };\r\n\r\n    const toggleAllPermissions = (featureId: string, permissions: string[]) => {\r\n        setStaffPermissions(prev => {\r\n            const current = prev[featureId] || [];\r\n            const allSelected = permissions.every(p => current.includes(p));\r\n            return {\r\n                ...prev,\r\n                [featureId]: allSelected ? [] : [...permissions]\r\n            };\r\n        });\r\n    };\r\n\r\n    const hasPermission = (featureId: string, permission: string): boolean => {\r\n        return (staffPermissions[featureId] || []).includes(permission);\r\n    };\r\n\r\n    const hasAllPermissions = (featureId: string, permissions: string[]): boolean => {\r\n        const current = staffPermissions[featureId] || [];\r\n        return permissions.every(p => current.includes(p));\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Header Card */}\r\n            <Card className=\"overflow-hidden border-0 bg-gradient-to-r from-purple-500/10 via-fuchsia-500/10 to-pink-500/10\">\r\n                <CardHeader className=\"pb-4\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <div className=\"p-2.5 rounded-xl bg-gradient-to-br from-purple-500 to-fuchsia-600 text-white shadow-lg shadow-purple-500/25\">\r\n                            <ShieldCheckIcon className=\"w-6 h-6\" />\r\n                        </div>\r\n                        <div>\r\n                            <CardTitle className=\"text-xl\">{t('settings.permissions.title') || 'Role Permissions'}</CardTitle>\r\n                            <CardDescription>\r\n                                {t('settings.permissions.description') || 'Configure what Staff users can access. Admins have full access to all features.'}\r\n                            </CardDescription>\r\n                        </div>\r\n                    </div>\r\n                </CardHeader>\r\n            </Card>\r\n\r\n            {/* Overview */}\r\n            <Card>\r\n                <CardContent className=\"pt-6\">\r\n                    <div className=\"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg\">\r\n                        <p className=\"text-sm text-blue-800 dark:text-blue-200\">\r\n                            <strong>Admin</strong> users always have full access to all features. Configure permissions below for <strong>Staff</strong> users.\r\n                        </p>\r\n                    </div>\r\n                </CardContent>\r\n            </Card>\r\n\r\n            {/* Staff Permissions */}\r\n            <Card>\r\n                <CardHeader>\r\n                    <CardTitle className=\"flex items-center gap-2\">\r\n                        <UsersIcon className=\"h-5 w-5\" />\r\n                        {t('settings.permissions.staffPermissions') || 'Staff Permissions'}\r\n                    </CardTitle>\r\n                </CardHeader>\r\n                <CardContent className=\"space-y-4\">\r\n                    {FEATURES.map((feature) => (\r\n                        <div\r\n                            key={feature.id}\r\n                            className=\"p-4 border border-gray-200 dark:border-gray-700 rounded-lg\"\r\n                        >\r\n                            <div className=\"flex items-start justify-between mb-3\">\r\n                                <div>\r\n                                    <h4 className=\"font-medium\">{feature.name}</h4>\r\n                                    <p className=\"text-sm text-gray-500 dark:text-gray-400\">{feature.description}</p>\r\n                                </div>\r\n                                {feature.adminOnly && (\r\n                                    <span className=\"px-2 py-1 text-xs font-medium bg-purple-100 text-purple-700 dark:bg-purple-900 dark:text-purple-300 rounded\">\r\n                                        Admin Only\r\n                                    </span>\r\n                                )}\r\n                            </div>\r\n\r\n                            {feature.adminOnly ? (\r\n                                <p className=\"text-sm text-gray-500 italic\">\r\n                                    This feature is restricted to Admins only\r\n                                </p>\r\n                            ) : feature.permissions ? (\r\n                                <div className=\"space-y-2\">\r\n                                    <div className=\"flex items-center gap-2 mb-2\">\r\n                                        <button\r\n                                            type=\"button\"\r\n                                            onClick={() => toggleAllPermissions(feature.id, feature.permissions!)}\r\n                                            className={`px-2 py-1 text-xs rounded transition-colors ${hasAllPermissions(feature.id, feature.permissions!)\r\n                                                ? 'bg-primary-100 text-primary-700 dark:bg-primary-900 dark:text-primary-300'\r\n                                                : 'bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-300'\r\n                                                }`}\r\n                                        >\r\n                                            {hasAllPermissions(feature.id, feature.permissions!)\r\n                                                ? 'Deselect All'\r\n                                                : 'Select All'}\r\n                                        </button>\r\n                                    </div>\r\n                                    <div className=\"flex flex-wrap gap-2\">\r\n                                        {feature.permissions.map((permission) => (\r\n                                            <button\r\n                                                key={permission}\r\n                                                type=\"button\"\r\n                                                onClick={() => togglePermission(feature.id, permission)}\r\n                                                className={`px-3 py-1.5 rounded-md text-sm font-medium transition-colors ${hasPermission(feature.id, permission)\r\n                                                    ? 'bg-primary-500 text-white'\r\n                                                    : 'bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300'\r\n                                                    }`}\r\n                                            >\r\n                                                {PERMISSION_LABELS[permission] || permission}\r\n                                            </button>\r\n                                        ))}\r\n                                    </div>\r\n                                </div>\r\n                            ) : (\r\n                                <div className=\"flex items-center gap-2\">\r\n                                    <button\r\n                                        type=\"button\"\r\n                                        onClick={() => togglePermission(feature.id, 'access')}\r\n                                        className={`px-3 py-1.5 rounded-md text-sm font-medium transition-colors ${hasPermission(feature.id, 'access')\r\n                                            ? 'bg-primary-500 text-white'\r\n                                            : 'bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300'\r\n                                            }`}\r\n                                    >\r\n                                        {hasPermission(feature.id, 'access') ? 'Access Granted' : 'No Access'}\r\n                                    </button>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    ))}\r\n                </CardContent>\r\n            </Card>\r\n\r\n            {/* Quick Presets */}\r\n            <Card>\r\n                <CardHeader>\r\n                    <CardTitle>{t('settings.permissions.presets') || 'Permission Presets'}</CardTitle>\r\n                    <CardDescription>\r\n                        {t('settings.permissions.presetsDescription') || 'Quick permission templates'}\r\n                    </CardDescription>\r\n                </CardHeader>\r\n                <CardContent className=\"space-y-4\">\r\n                    <div className=\"flex flex-wrap gap-3\">\r\n                        <Button\r\n                            variant=\"outline\"\r\n                            onClick={() => {\r\n                                // Minimal: view only\r\n                                const minimal: Record<string, string[]> = {\r\n                                    dashboard: ['access'],\r\n                                    tickets: ['view'],\r\n                                    customers: ['view'],\r\n                                    inventory: ['view'],\r\n                                    notifications: ['access'],\r\n                                };\r\n                                setStaffPermissions(minimal);\r\n                                toast({ title: t('success'), description: 'Applied Minimal (View Only) preset' });\r\n                            }}\r\n                        >\r\n                            Minimal (View Only)\r\n                        </Button>\r\n                        <Button\r\n                            variant=\"outline\"\r\n                            onClick={() => {\r\n                                // Standard: view + create + edit\r\n                                const standard: Record<string, string[]> = {\r\n                                    dashboard: ['access'],\r\n                                    tickets: ['view', 'create', 'edit', 'change_status'],\r\n                                    customers: ['view', 'create', 'edit'],\r\n                                    inventory: ['view'],\r\n                                    suppliers: ['view'],\r\n                                    notifications: ['access'],\r\n                                    payments: ['view', 'create'],\r\n                                };\r\n                                setStaffPermissions(standard);\r\n                                toast({ title: t('success'), description: 'Applied Standard preset' });\r\n                            }}\r\n                        >\r\n                            Standard\r\n                        </Button>\r\n                        <Button\r\n                            variant=\"outline\"\r\n                            onClick={() => {\r\n                                // Full Staff: everything except admin-only\r\n                                const full: Record<string, string[]> = {\r\n                                    dashboard: ['access'],\r\n                                    tickets: ['view', 'create', 'edit', 'delete', 'change_status', 'change_price'],\r\n                                    customers: ['view', 'create', 'edit', 'delete'],\r\n                                    inventory: ['view', 'create', 'edit', 'delete', 'adjust_stock'],\r\n                                    suppliers: ['view', 'create', 'edit', 'delete'],\r\n                                    finance: ['view', 'create_expense', 'view_reports'],\r\n                                    returns: ['view', 'create', 'approve', 'reject'],\r\n                                    payments: ['view', 'create', 'refund'],\r\n                                    notifications: ['access'],\r\n                                };\r\n                                setStaffPermissions(full);\r\n                                toast({ title: t('success'), description: 'Applied Full Access preset' });\r\n                            }}\r\n                        >\r\n                            Full Access\r\n                        </Button>\r\n                    </div>\r\n                </CardContent>\r\n            </Card>\r\n\r\n            <Button onClick={onSave} disabled={isSaving} className=\"w-full sm:w-auto\">\r\n                {isSaving ? t('loading') : t('saveSettings')}\r\n            </Button>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\settings\\PrintSettingsTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\settings\\SecuritySettingsTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\settings\\SettingsTabNav.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\settings\\TicketSettingsTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\settings\\TrackingSettingsTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\settings\\WarrantySettingsTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\settings\\email-settings-tab.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadSettings'. Either include it or remove the dependency array.","line":54,"column":8,"nodeType":"ArrayExpression","endLine":54,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [loadSettings]","fix":{"range":[2131,2133],"text":"[loadSettings]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useForm } from 'react-hook-form';\r\nimport { zodResolver } from '@hookform/resolvers/zod';\r\nimport { z } from 'zod';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Switch } from '@/components/ui/switch';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { useToast } from '@/components/ui/use-toast';\r\nimport { ArrowPathIcon, EnvelopeIcon, PaperAirplaneIcon } from '@heroicons/react/24/outline';\r\nimport { useLanguage } from '@/contexts/language-context';\r\n\r\n\r\n\r\nexport function EmailSettingsTab() {\r\n    const { toast } = useToast();\r\n    const [loading, setLoading] = useState(false);\r\n    const [testing, setTesting] = useState(false);\r\n    const [configured, setConfigured] = useState(false);\r\n    const { t } = useLanguage();\r\n\r\n    const schema = z.object({\r\n        smtpHost: z.string().min(1, t('settings.email.validation.host')),\r\n        smtpPort: z.coerce.number().int().min(1).max(65535),\r\n        smtpSecure: z.boolean(),\r\n        smtpUser: z.string().email(t('settings.email.validation.email')),\r\n        smtpPassword: z.string().min(1, t('settings.email.validation.password')),\r\n        fromEmail: z.string().email(t('settings.email.validation.email')),\r\n        fromName: z.string().min(1, t('settings.email.validation.fromName')),\r\n        replyToEmail: z.string().email().optional().or(z.literal(''))\r\n    });\r\n\r\n    type EmailSettingsFormData = z.infer<typeof schema>;\r\n\r\n    const { register, handleSubmit, formState: { errors }, reset, setValue, watch } = useForm<EmailSettingsFormData>({\r\n        resolver: zodResolver(schema),\r\n        defaultValues: {\r\n            smtpHost: '',\r\n            smtpPort: 587,\r\n            smtpSecure: false,\r\n            smtpUser: '',\r\n            smtpPassword: '',\r\n            fromEmail: '',\r\n            fromName: 'RepairFlow',\r\n            replyToEmail: ''\r\n        }\r\n    });\r\n\r\n    useEffect(() => {\r\n        loadSettings();\r\n    }, []);\r\n\r\n    const loadSettings = async () => {\r\n        try {\r\n            const res = await fetch('/api/settings/email');\r\n            const data = await res.json();\r\n\r\n            if (data.configured && data.settings) {\r\n                setConfigured(true);\r\n                reset({\r\n                    smtpHost: data.settings.smtpHost,\r\n                    smtpPort: data.settings.smtpPort,\r\n                    smtpSecure: data.settings.smtpSecure,\r\n                    smtpUser: data.settings.smtpUser,\r\n                    smtpPassword: '', // Don't populate password\r\n                    fromEmail: data.settings.fromEmail,\r\n                    fromName: data.settings.fromName,\r\n                    replyToEmail: data.settings.replyToEmail || ''\r\n                });\r\n            }\r\n        } catch (error) {\r\n            toast({ title: t('error'), description: t('settings.email.loadError'), variant: 'destructive' });\r\n        }\r\n    };\r\n\r\n    const onSubmit = async (data: EmailSettingsFormData) => {\r\n        setLoading(true);\r\n        try {\r\n            const res = await fetch('/api/settings/email', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify(data)\r\n            });\r\n\r\n            if (!res.ok) {\r\n                const error = await res.json();\r\n                throw new Error(error.error || t('settings.email.error'));\r\n            }\r\n\r\n            toast({ title: t('success'), description: t('settings.email.success') });\r\n            setConfigured(true);\r\n        } catch (error: any) {\r\n            toast({ title: t('error'), description: error.message, variant: 'destructive' });\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const sendTestEmail = async () => {\r\n        setTesting(true);\r\n        try {\r\n            const res = await fetch('/api/settings/email/test', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({})\r\n            });\r\n\r\n            if (!res.ok) throw new Error(t('settings.email.testError'));\r\n\r\n            toast({ title: t('success'), description: t('settings.email.testSuccess') });\r\n        } catch (error) {\r\n            toast({ title: t('error'), description: t('settings.email.testError'), variant: 'destructive' });\r\n        } finally {\r\n            setTesting(false);\r\n        }\r\n    };\r\n\r\n    const smtpSecure = watch('smtpSecure');\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Header Card */}\r\n            <Card className=\"overflow-hidden border-0 bg-gradient-to-r from-blue-500/10 via-cyan-500/10 to-teal-500/10\">\r\n                <CardHeader className=\"pb-4\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <div className=\"p-2.5 rounded-xl bg-gradient-to-br from-blue-500 to-cyan-600 text-white shadow-lg shadow-blue-500/25\">\r\n                            <EnvelopeIcon className=\"w-6 h-6\" />\r\n                        </div>\r\n                        <div>\r\n                            <CardTitle className=\"text-xl\">{t('settings.email.title') || 'Email Settings'}</CardTitle>\r\n                            <CardDescription>\r\n                                {t('settings.email.description') || 'Configure SMTP settings for sending emails from RepairFlow'}\r\n                            </CardDescription>\r\n                        </div>\r\n                    </div>\r\n                </CardHeader>\r\n            </Card>\r\n\r\n            <Card>\r\n                <CardHeader>\r\n                    <CardTitle className=\"flex items-center gap-2\">\r\n                        <EnvelopeIcon className=\"h-5 w-5\" />\r\n                        {t('settings.email.smtpServer')}\r\n                    </CardTitle>\r\n                </CardHeader>\r\n                <CardContent>\r\n                    <form onSubmit={handleSubmit(onSubmit)} className=\"space-y-6\">\r\n                        {/* SMTP Server Settings */}\r\n                        <div className=\"space-y-4\">\r\n                            <h3 className=\"text-lg font-semibold\">{t('settings.email.smtpServer')}</h3>\r\n\r\n                            <div className=\"grid grid-cols-2 gap-4\">\r\n                                <div>\r\n                                    <Label htmlFor=\"smtpHost\">{t('settings.email.host')} *</Label>\r\n                                    <Input\r\n                                        id=\"smtpHost\"\r\n                                        {...register('smtpHost')}\r\n                                        placeholder=\"smtp.gmail.com\"\r\n                                    />\r\n                                    {errors.smtpHost && (\r\n                                        <p className=\"text-sm text-red-500 mt-1\">{errors.smtpHost.message}</p>\r\n                                    )}\r\n                                </div>\r\n\r\n                                <div>\r\n                                    <Label htmlFor=\"smtpPort\">{t('settings.email.port')} *</Label>\r\n                                    <Input\r\n                                        id=\"smtpPort\"\r\n                                        type=\"number\"\r\n                                        {...register('smtpPort')}\r\n                                        placeholder=\"587\"\r\n                                    />\r\n                                    {errors.smtpPort && (\r\n                                        <p className=\"text-sm text-red-500 mt-1\">{errors.smtpPort.message}</p>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"space-y-2\">\r\n                                <div className=\"flex items-center gap-2\">\r\n                                    <Switch\r\n                                        id=\"smtpSecure\"\r\n                                        checked={smtpSecure}\r\n                                        onCheckedChange={(checked) => setValue('smtpSecure', checked)}\r\n                                    />\r\n                                    <Label htmlFor=\"smtpSecure\">{t('settings.email.useTls')}</Label>\r\n                                </div>\r\n                                <p className=\"text-sm text-muted-foreground ml-8\">\r\n                                    Port 587 uses STARTTLS (turn this OFF). Port 465 uses implicit TLS (turn this ON).\r\n                                </p>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Authentication */}\r\n                        <div className=\"space-y-4\">\r\n                            <h3 className=\"text-lg font-semibold\">{t('settings.email.authentication')}</h3>\r\n\r\n                            <div>\r\n                                <Label htmlFor=\"smtpUser\">{t('settings.email.username')} *</Label>\r\n                                <Input\r\n                                    id=\"smtpUser\"\r\n                                    type=\"email\"\r\n                                    {...register('smtpUser')}\r\n                                    placeholder=\"your-email@gmail.com\"\r\n                                />\r\n                                {errors.smtpUser && (\r\n                                    <p className=\"text-sm text-red-500 mt-1\">{errors.smtpUser.message}</p>\r\n                                )}\r\n                            </div>\r\n\r\n                            <div>\r\n                                <Label htmlFor=\"smtpPassword\">{t('settings.email.password')} *</Label>\r\n                                <Input\r\n                                    id=\"smtpPassword\"\r\n                                    type=\"password\"\r\n                                    {...register('smtpPassword')}\r\n                                    placeholder={configured ? 'ÔÇóÔÇóÔÇóÔÇóÔÇóÔÇóÔÇóÔÇó' : 'Enter password'}\r\n                                />\r\n                                {errors.smtpPassword && (\r\n                                    <p className=\"text-sm text-red-500 mt-1\">{errors.smtpPassword.message}</p>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Email Defaults */}\r\n                        <div className=\"space-y-4\">\r\n                            <h3 className=\"text-lg font-semibold\">{t('settings.email.defaults')}</h3>\r\n\r\n                            <div className=\"grid grid-cols-2 gap-4\">\r\n                                <div>\r\n                                    <Label htmlFor=\"fromEmail\">{t('settings.email.fromEmail')} *</Label>\r\n                                    <Input\r\n                                        id=\"fromEmail\"\r\n                                        type=\"email\"\r\n                                        {...register('fromEmail')}\r\n                                        placeholder=\"noreply@repairflow.com\"\r\n                                    />\r\n                                    {errors.fromEmail && (\r\n                                        <p className=\"text-sm text-red-500 mt-1\">{errors.fromEmail.message}</p>\r\n                                    )}\r\n                                </div>\r\n\r\n                                <div>\r\n                                    <Label htmlFor=\"fromName\">{t('settings.email.fromName')} *</Label>\r\n                                    <Input\r\n                                        id=\"fromName\"\r\n                                        {...register('fromName')}\r\n                                        placeholder=\"RepairFlow\"\r\n                                    />\r\n                                    {errors.fromName && (\r\n                                        <p className=\"text-sm text-red-500 mt-1\">{errors.fromName.message}</p>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div>\r\n                                <Label htmlFor=\"replyToEmail\">{t('settings.email.replyTo')}</Label>\r\n                                <Input\r\n                                    id=\"replyToEmail\"\r\n                                    type=\"email\"\r\n                                    {...register('replyToEmail')}\r\n                                    placeholder=\"support@repairflow.com\"\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Action Buttons */}\r\n                        <div className=\"flex gap-3 pt-4\">\r\n                            <Button type=\"submit\" disabled={loading}>\r\n                                {loading && <ArrowPathIcon className=\"mr-2 h-4 w-4 animate-spin\" />}\r\n                                {configured ? t('settings.email.update') : t('settings.email.save')}\r\n                            </Button>\r\n\r\n                            {configured && (\r\n                                <Button\r\n                                    type=\"button\"\r\n                                    variant=\"outline\"\r\n                                    onClick={sendTestEmail}\r\n                                    disabled={testing}\r\n                                >\r\n                                    {testing ? (\r\n                                        <ArrowPathIcon className=\"mr-2 h-4 w-4 animate-spin\" />\r\n                                    ) : (\r\n                                        <PaperAirplaneIcon className=\"mr-2 h-4 w-4\" />\r\n                                    )}\r\n                                    {t('settings.email.sendTest')}\r\n                                </Button>\r\n                            )}\r\n                        </div>\r\n                    </form>\r\n\r\n                    {/* Common SMTP Providers Help */}\r\n                    <div className=\"mt-8 p-4 bg-muted rounded-lg\">\r\n                        <h4 className=\"font-semibold mb-2\">{t('settings.email.providers.title')}</h4>\r\n                        <ul className=\"text-sm space-y-1 text-muted-foreground\">\r\n                            <li><strong>{t('settings.email.providers.gmail')}</strong></li>\r\n                            <li><strong>{t('settings.email.providers.outlook')}</strong></li>\r\n                            <li><strong>{t('settings.email.providers.sendgrid')}</strong></li>\r\n                            <li><strong>{t('settings.email.providers.mailgun')}</strong></li>\r\n                        </ul>\r\n                    </div>\r\n                </CardContent>\r\n            </Card>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\settings\\notification-preferences.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchPreferences'. Either include it or remove the dependency array.","line":52,"column":6,"nodeType":"ArrayExpression","endLine":52,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchPreferences]","fix":{"range":[1816,1818],"text":"[fetchPreferences]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { useToast } from '@/components/ui/use-toast';\r\nimport { useLanguage } from '@/contexts/language-context';\r\nimport { useSession } from 'next-auth/react';\r\nimport { BellIcon } from '@heroicons/react/24/outline';\r\n\r\ninterface NotificationPreference {\r\n  id?: string;\r\n  entityType: string;\r\n  action: string;\r\n  enabled: boolean;\r\n}\r\n\r\n// Entity types with translation keys\r\nconst ENTITY_TYPES = [\r\n  { value: 'customer', labelKey: 'customer' },\r\n  { value: 'ticket', labelKey: 'ticket' },\r\n  { value: 'payment', labelKey: 'payment' },\r\n  { value: 'charge', labelKey: 'charge' },\r\n  { value: 'repairjob', labelKey: 'repairJob' },\r\n  { value: 'part', labelKey: 'part' },\r\n  { value: 'supplier', labelKey: 'supplier' },\r\n];\r\n\r\n// Actions with translation keys\r\nconst ACTIONS = [\r\n  { value: 'created', labelKey: 'created' },\r\n  { value: 'updated', labelKey: 'updated' },\r\n  { value: 'deleted', labelKey: 'deleted' },\r\n  { value: 'status_changed', labelKey: 'statusChanged' },\r\n  { value: 'assigned', labelKey: 'assigned' },\r\n  { value: 'completed', labelKey: 'completed' },\r\n  { value: 'used', labelKey: 'used' },\r\n  { value: 'removed', labelKey: 'removed' },\r\n  { value: 'added', labelKey: 'added' },\r\n];\r\n\r\nexport function NotificationPreferences() {\r\n  const { toast } = useToast();\r\n  const { t } = useLanguage();\r\n  const { data: session } = useSession();\r\n  const [preferences, setPreferences] = useState<NotificationPreference[]>([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [isSaving, setIsSaving] = useState(false);\r\n\r\n  useEffect(() => {\r\n    fetchPreferences();\r\n  }, []);\r\n\r\n  const fetchPreferences = async () => {\r\n    if (!session?.user?.id) return;\r\n\r\n    setIsLoading(true);\r\n    try {\r\n      const response = await fetch(`/api/notifications/preferences`);\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setPreferences(data.preferences || []);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching preferences:', error);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const togglePreference = (entityType: string, action: string) => {\r\n    setPreferences((prev) => {\r\n      const existing = prev.find(\r\n        (p) => p.entityType === entityType && p.action === action\r\n      );\r\n\r\n      if (existing) {\r\n        return prev.map((p) =>\r\n          p.entityType === entityType && p.action === action\r\n            ? { ...p, enabled: !p.enabled }\r\n            : p\r\n        );\r\n      } else {\r\n        return [...prev, { entityType, action, enabled: false }];\r\n      }\r\n    });\r\n  };\r\n\r\n  const getPreference = (entityType: string, action: string): boolean => {\r\n    const pref = preferences.find(\r\n      (p) => p.entityType === entityType && p.action === action\r\n    );\r\n    return pref ? pref.enabled : true; // Default to enabled\r\n  };\r\n\r\n  const savePreferences = async () => {\r\n    if (!session?.user?.id) return;\r\n\r\n    setIsSaving(true);\r\n    try {\r\n      const response = await fetch('/api/notifications/preferences', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ preferences }),\r\n      });\r\n\r\n      if (response.ok) {\r\n        toast({\r\n          title: t('success'),\r\n          description: t('notificationPreferencesSaved'),\r\n        });\r\n        await fetchPreferences();\r\n      } else {\r\n        throw new Error('Failed to save preferences');\r\n      }\r\n    } catch (error) {\r\n      toast({\r\n        title: t('error'),\r\n        description: t('failedToSaveNotificationPreferences'),\r\n        variant: 'destructive',\r\n      });\r\n    } finally {\r\n      setIsSaving(false);\r\n    }\r\n  };\r\n\r\n  if (isLoading) {\r\n    return <div className=\"text-center py-8\">{t('loadingPreferences')}</div>;\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Header Card */}\r\n      <Card className=\"overflow-hidden border-0 bg-gradient-to-r from-orange-500/10 via-amber-500/10 to-yellow-500/10\">\r\n        <CardHeader className=\"pb-4\">\r\n          <div className=\"flex items-center gap-3\">\r\n            <div className=\"p-2.5 rounded-xl bg-gradient-to-br from-orange-500 to-amber-600 text-white shadow-lg shadow-orange-500/25\">\r\n              <BellIcon className=\"w-6 h-6\" />\r\n            </div>\r\n            <div>\r\n              <CardTitle className=\"text-xl\">{t('settings.notifications.title') || 'Notification Preferences'}</CardTitle>\r\n              <CardDescription>\r\n                {t('settings.notifications.description') || 'Choose which notifications you want to receive'}\r\n              </CardDescription>\r\n            </div>\r\n          </div>\r\n        </CardHeader>\r\n      </Card>\r\n\r\n      <Card>\r\n        <CardContent className=\"pt-6 space-y-6\">\r\n          {ENTITY_TYPES.map((entity) => (\r\n            <div key={entity.value} className=\"space-y-3\">\r\n              <h3 className=\"font-semibold text-lg\">{t(entity.labelKey)}</h3>\r\n              <div className=\"grid grid-cols-2 md:grid-cols-3 gap-3\">\r\n                {ACTIONS.filter((action) => {\r\n                  // Filter actions based on entity type\r\n                  if (entity.value === 'customer' || entity.value === 'supplier') {\r\n                    return ['created', 'updated', 'deleted'].includes(action.value);\r\n                  }\r\n                  if (entity.value === 'ticket') {\r\n                    return ['created', 'updated', 'status_changed', 'deleted'].includes(action.value);\r\n                  }\r\n                  if (entity.value === 'payment') {\r\n                    return ['created'].includes(action.value);\r\n                  }\r\n                  if (entity.value === 'charge') {\r\n                    return ['added', 'removed'].includes(action.value);\r\n                  }\r\n                  if (entity.value === 'repairjob') {\r\n                    return ['assigned', 'completed', 'updated'].includes(action.value);\r\n                  }\r\n                  if (entity.value === 'part') {\r\n                    return ['used', 'removed'].includes(action.value);\r\n                  }\r\n                  return false;\r\n                }).map((action) => (\r\n                  <label\r\n                    key={`${entity.value}-${action.value}`}\r\n                    className=\"flex items-center space-x-2 p-3 border rounded-lg cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800\"\r\n                  >\r\n                    <input\r\n                      type=\"checkbox\"\r\n                      checked={getPreference(entity.value, action.value)}\r\n                      onChange={() => togglePreference(entity.value, action.value)}\r\n                      className=\"rounded\"\r\n                    />\r\n                    <span className=\"text-sm\">{t(action.labelKey)}</span>\r\n                  </label>\r\n                ))}\r\n              </div>\r\n            </div>\r\n          ))}\r\n\r\n          <div className=\"pt-4 border-t\">\r\n            <Button onClick={savePreferences} disabled={isSaving}>\r\n              {isSaving ? t('saving') : t('savePreferences')}\r\n            </Button>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n    </div>\r\n  );\r\n}\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\settings\\settings-client.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'TABS', 'editingUser', and 'users'. Either include them or remove the dependency array.","line":144,"column":6,"nodeType":"ArrayExpression","endLine":144,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [TABS, editingUser, users, users.length]","fix":{"range":[6792,6806],"text":"[TABS, editingUser, users, users.length]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"´╗┐'use client';\r\n\r\nimport { useState, useRef, useEffect } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { useToast } from '@/components/ui/use-toast';\r\nimport { PencilIcon, TrashIcon, ClockIcon, UsersIcon } from '@heroicons/react/24/outline';\r\nimport { format } from 'date-fns';\r\nimport { ConfirmDialog } from '@/components/ui/confirm-dialog';\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogFooter,\r\n  DialogHeader,\r\n  DialogTitle,\r\n} from '@/components/ui/dialog';\r\nimport { useSession } from 'next-auth/react';\r\nimport { useLanguage } from '@/contexts/language-context';\r\nimport { useSettings } from '@/contexts/settings-context';\r\n\r\n// Import all tab components\r\nimport { SettingsTabNav, SettingsTab, SETTINGS_ICONS } from './SettingsTabNav';\r\nimport { GeneralSettingsTab } from './GeneralSettingsTab';\r\nimport { BrandingSettingsTab } from './BrandingSettingsTab';\r\nimport { TicketSettingsTab } from './TicketSettingsTab';\r\nimport { WarrantySettingsTab } from './WarrantySettingsTab';\r\nimport { InventorySettingsTab } from './InventorySettingsTab';\r\nimport { FinanceSettingsTab } from './FinanceSettingsTab';\r\nimport { PrintSettingsTab } from './PrintSettingsTab';\r\nimport { TrackingSettingsTab } from './TrackingSettingsTab';\r\nimport { SecuritySettingsTab } from './SecuritySettingsTab';\r\nimport { DatabaseSettingsTab } from './DatabaseSettingsTab';\r\nimport { PermissionsSettingsTab } from './PermissionsSettingsTab';\r\nimport { SMSTemplatesManager } from './sms-templates-manager';\r\nimport { ThemeCustomizer } from './theme-customizer';\r\nimport { NotificationPreferences } from './notification-preferences';\r\nimport { EmailSettingsTab } from './email-settings-tab';\r\nimport { AIVisionSettingsTab } from './AIVisionSettingsTab';\r\nimport { FactoryResetTab } from './FactoryResetTab';\r\n\r\nexport function SettingsClient({\r\n  initialSettings,\r\n  initialUsers,\r\n}: {\r\n  initialSettings: Record<string, string>;\r\n  initialUsers: any[];\r\n}) {\r\n  const router = useRouter();\r\n  const { toast } = useToast();\r\n  const { t } = useLanguage();\r\n  const { refreshSettings } = useSettings();\r\n  const { data: session } = useSession();\r\n\r\n  // Define all tabs with Heroicons\r\n  const TABS: SettingsTab[] = [\r\n    { id: 'general', label: t('generalSettings'), icon: SETTINGS_ICONS.general },\r\n    { id: 'branding', label: t('branding'), icon: SETTINGS_ICONS.branding },\r\n    { id: 'tickets', label: t('tickets') || 'Tickets', icon: SETTINGS_ICONS.tickets },\r\n    { id: 'warranty', label: t('settings.warranty') || 'Warranty & Returns', icon: SETTINGS_ICONS.warranty },\r\n    { id: 'inventory', label: t('inventory') || 'Inventory', icon: SETTINGS_ICONS.inventory },\r\n    { id: 'finance', label: t('finance') || 'Finance', icon: SETTINGS_ICONS.finance },\r\n    { id: 'print', label: t('settings.print') || 'Print & Invoice', icon: SETTINGS_ICONS.print },\r\n    { id: 'sms', label: t('smsTemplates'), icon: SETTINGS_ICONS.sms },\r\n    { id: 'email', label: t('email') || 'Email', icon: SETTINGS_ICONS.email },\r\n    { id: 'notifications', label: t('notifications') || 'Notifications', icon: SETTINGS_ICONS.notifications },\r\n    { id: 'tracking', label: t('settings.tracking') || 'Public Tracking', icon: SETTINGS_ICONS.tracking },\r\n    { id: 'security', label: t('settings.security') || 'Security', icon: SETTINGS_ICONS.security },\r\n    { id: 'ai_vision', label: t('settings.aiVision') || 'AI Vision', icon: SETTINGS_ICONS.ai_vision },\r\n    { id: 'appearance', label: t('appearance'), icon: SETTINGS_ICONS.appearance },\r\n    { id: 'permissions', label: t('settings.permissions') || 'Permissions', icon: SETTINGS_ICONS.permissions, adminOnly: true },\r\n    { id: 'database', label: t('settings.database') || 'Database', icon: SETTINGS_ICONS.database, adminOnly: true },\r\n    { id: 'users', label: t('userManagement'), icon: SETTINGS_ICONS.users, adminOnly: true },\r\n    { id: 'factory_reset', label: t('settings.tab.factoryReset') || 'Factory Reset', icon: SETTINGS_ICONS.factory_reset, adminOnly: true },\r\n  ];\r\n\r\n  // State\r\n  const [activeTab, setActiveTab] = useState('general');\r\n  const [settings, setSettings] = useState<Record<string, string>>({\r\n    ...initialSettings,\r\n    auto_mark_tickets_as_paid: initialSettings.auto_mark_tickets_as_paid ?? 'false',\r\n  });\r\n  const [users, setUsers] = useState(initialUsers);\r\n  const [isSaving, setIsSaving] = useState(false);\r\n  const [isUploadingLogo, setIsUploadingLogo] = useState(false);\r\n  const [isUploadingFavicon, setIsUploadingFavicon] = useState(false);\r\n  const [isUploadingBackground, setIsUploadingBackground] = useState(false);\r\n  const [isUploadingTrackImage, setIsUploadingTrackImage] = useState(false);\r\n\r\n  // User management state\r\n  const [showNewUser, setShowNewUser] = useState(false);\r\n  const [newUser, setNewUser] = useState({\r\n    username: '',\r\n    email: '',\r\n    password: '',\r\n    name: '',\r\n    role: 'STAFF' as 'ADMIN' | 'STAFF',\r\n  });\r\n  const [editingUser, setEditingUser] = useState<any>(null);\r\n  const [editUserData, setEditUserData] = useState({\r\n    username: '',\r\n    email: '',\r\n    password: '',\r\n    name: '',\r\n    role: 'STAFF' as 'ADMIN' | 'STAFF',\r\n  });\r\n  const [isDeleting, setIsDeleting] = useState<string | null>(null);\r\n  const [deleteUserConfirmOpen, setDeleteUserConfirmOpen] = useState(false);\r\n  const [userToDelete, setUserToDelete] = useState<string | null>(null);\r\n  const [showLoginLogs, setShowLoginLogs] = useState(false);\r\n  const [selectedUserForLogs, setSelectedUserForLogs] = useState<any>(null);\r\n  const [loginLogs, setLoginLogs] = useState<any[]>([]);\r\n  const [isLoadingLogs, setIsLoadingLogs] = useState(false);\r\n\r\n  // Handle URL parameters for tab selection\r\n  useEffect(() => {\r\n    if (typeof window !== 'undefined') {\r\n      const params = new URLSearchParams(window.location.search);\r\n      const tab = params.get('tab');\r\n      const editUserId = params.get('editUser');\r\n\r\n      if (tab && TABS.find(t => t.id === tab)) {\r\n        setActiveTab(tab);\r\n      }\r\n\r\n      if (editUserId && users.length > 0) {\r\n        const userToEdit = users.find(u => u.id === editUserId);\r\n        if (userToEdit && !editingUser) {\r\n          setEditingUser(userToEdit);\r\n          setEditUserData({\r\n            username: userToEdit.username,\r\n            email: userToEdit.email || '',\r\n            password: '',\r\n            name: userToEdit.name || '',\r\n            role: userToEdit.role,\r\n          });\r\n          window.history.replaceState({}, '', '/settings?tab=users');\r\n        }\r\n      }\r\n    }\r\n  }, [users.length]);\r\n\r\n  // Setting change handler\r\n  const handleSettingChange = (key: string, value: string) => {\r\n    setSettings(prev => ({ ...prev, [key]: value }));\r\n  };\r\n\r\n  // Save settings\r\n  const handleSaveSettings = async () => {\r\n    setIsSaving(true);\r\n    try {\r\n      const response = await fetch('/api/settings', {\r\n        method: 'PUT',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(settings),\r\n      });\r\n\r\n      if (!response.ok) throw new Error('Failed to save settings');\r\n\r\n      toast({\r\n        title: t('success'),\r\n        description: t('settingsSavedSuccessfully'),\r\n      });\r\n\r\n      if (settings.company_name || settings.company_logo) {\r\n        await refreshSettings();\r\n      }\r\n      router.refresh();\r\n    } catch (error) {\r\n      toast({\r\n        title: t('error'),\r\n        description: t('failedToSaveSettings'),\r\n      });\r\n    } finally {\r\n      setIsSaving(false);\r\n    }\r\n  };\r\n\r\n  // File upload handler\r\n  const handleUpload = async (type: 'logo' | 'favicon' | 'background' | 'track_image', file: File) => {\r\n    const setUploading = {\r\n      logo: setIsUploadingLogo,\r\n      favicon: setIsUploadingFavicon,\r\n      background: setIsUploadingBackground,\r\n      track_image: setIsUploadingTrackImage,\r\n    }[type];\r\n\r\n    const settingKey = {\r\n      logo: 'company_logo',\r\n      favicon: 'company_favicon',\r\n      background: 'login_background_image',\r\n      track_image: 'default_track_image',\r\n    }[type];\r\n\r\n    setUploading(true);\r\n    try {\r\n      const formData = new FormData();\r\n      formData.append('file', file);\r\n      formData.append('type', type);\r\n\r\n      const response = await fetch('/api/settings/upload', {\r\n        method: 'POST',\r\n        body: formData,\r\n      });\r\n\r\n      if (!response.ok) throw new Error(`Failed to upload ${type}`);\r\n\r\n      const data = await response.json();\r\n      setSettings(prev => ({ ...prev, [settingKey]: data.url }));\r\n\r\n      toast({\r\n        title: t('success'),\r\n        description: `${type.charAt(0).toUpperCase() + type.slice(1)} uploaded successfully`,\r\n      });\r\n\r\n      if (type === 'logo' || type === 'favicon') {\r\n        await refreshSettings();\r\n      }\r\n      router.refresh();\r\n    } catch (error) {\r\n      toast({\r\n        title: t('error'),\r\n        description: `Failed to upload ${type}`,\r\n      });\r\n    } finally {\r\n      setUploading(false);\r\n    }\r\n  };\r\n\r\n  // Remove file handler\r\n  const handleRemove = async (type: 'logo' | 'favicon' | 'background' | 'track_image') => {\r\n    const settingKey = {\r\n      logo: 'company_logo',\r\n      favicon: 'company_favicon',\r\n      background: 'login_background_image',\r\n      track_image: 'default_track_image',\r\n    }[type];\r\n\r\n    setSettings(prev => ({ ...prev, [settingKey]: '' }));\r\n\r\n    try {\r\n      await fetch('/api/settings', {\r\n        method: 'PUT',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ ...settings, [settingKey]: '' }),\r\n      });\r\n\r\n      if (type === 'logo' || type === 'favicon') {\r\n        await refreshSettings();\r\n      }\r\n      router.refresh();\r\n    } catch (error) {\r\n      toast({\r\n        title: t('error'),\r\n        description: `Failed to remove ${type}`,\r\n      });\r\n    }\r\n  };\r\n\r\n  // User management handlers\r\n  const handleCreateUser = async () => {\r\n    try {\r\n      const response = await fetch('/api/users', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(newUser),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        const error = await response.json();\r\n        if (error.details && Array.isArray(error.details)) {\r\n          const errorMessages = error.details.map((err: any) =>\r\n            err.path && err.message ? `${err.path.join('.')}: ${err.message}` : err.message || 'Validation error'\r\n          ).join('\\n');\r\n          throw new Error(errorMessages);\r\n        }\r\n        throw new Error(error.error || 'Failed to create user');\r\n      }\r\n\r\n      const createdUser = await response.json();\r\n      setUsers([...users, createdUser]);\r\n      setShowNewUser(false);\r\n      setNewUser({ username: '', email: '', password: '', name: '', role: 'STAFF' });\r\n      toast({ title: t('success'), description: t('userCreatedSuccessfully') });\r\n      router.refresh();\r\n    } catch (error: any) {\r\n      toast({ title: t('error'), description: error.message || t('failedToCreateUser') });\r\n    }\r\n  };\r\n\r\n  const handleEditUser = (user: any) => {\r\n    setEditingUser(user);\r\n    setEditUserData({\r\n      username: user.username,\r\n      email: user.email || '',\r\n      password: '',\r\n      name: user.name || '',\r\n      role: user.role,\r\n    });\r\n  };\r\n\r\n  const handleUpdateUser = async () => {\r\n    if (!editingUser) return;\r\n\r\n    try {\r\n      const updateData: any = {\r\n        username: editUserData.username,\r\n        email: editUserData.email,\r\n        name: editUserData.name,\r\n        role: editUserData.role,\r\n      };\r\n\r\n      if (editUserData.password.trim()) {\r\n        updateData.password = editUserData.password;\r\n      }\r\n\r\n      const response = await fetch(`/api/users/${editingUser.id}`, {\r\n        method: 'PUT',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(updateData),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        const error = await response.json();\r\n        if (error.details && Array.isArray(error.details)) {\r\n          const errorMessages = error.details.map((err: any) =>\r\n            err.path && err.message ? `${err.path.join('.')}: ${err.message}` : err.message || 'Validation error'\r\n          ).join('\\n');\r\n          throw new Error(errorMessages);\r\n        }\r\n        throw new Error(error.error || 'Failed to update user');\r\n      }\r\n\r\n      const updatedUser = await response.json();\r\n      setUsers(users.map(u => u.id === updatedUser.id ? updatedUser : u));\r\n      setEditingUser(null);\r\n      setEditUserData({ username: '', email: '', password: '', name: '', role: 'STAFF' });\r\n      toast({ title: t('success'), description: t('userUpdatedSuccessfully') });\r\n\r\n      if (session?.user?.id === updatedUser.id) {\r\n        router.refresh();\r\n        setTimeout(() => window.location.reload(), 500);\r\n      } else {\r\n        router.refresh();\r\n      }\r\n    } catch (error: any) {\r\n      toast({ title: t('error'), description: error.message || t('failedToUpdateUser') });\r\n    }\r\n  };\r\n\r\n  const handleViewLoginLogs = async (user: any) => {\r\n    setSelectedUserForLogs(user);\r\n    setShowLoginLogs(true);\r\n    setIsLoadingLogs(true);\r\n\r\n    try {\r\n      const response = await fetch(`/api/users/${user.id}/login-logs`);\r\n      if (!response.ok) throw new Error('Failed to fetch login logs');\r\n      const logs = await response.json();\r\n      setLoginLogs(logs);\r\n    } catch (error) {\r\n      toast({ title: t('error'), description: t('failedToFetchLoginLogs') });\r\n    } finally {\r\n      setIsLoadingLogs(false);\r\n    }\r\n  };\r\n\r\n  const handleDeleteUser = (userId: string) => {\r\n    setUserToDelete(userId);\r\n    setDeleteUserConfirmOpen(true);\r\n  };\r\n\r\n  const confirmDeleteUser = async () => {\r\n    if (!userToDelete) return;\r\n\r\n    setIsDeleting(userToDelete);\r\n    try {\r\n      const response = await fetch(`/api/users/${userToDelete}`, { method: 'DELETE' });\r\n\r\n      if (!response.ok) {\r\n        const error = await response.json();\r\n        throw new Error(error.error || 'Failed to delete user');\r\n      }\r\n\r\n      setUsers(users.filter(u => u.id !== userToDelete));\r\n      toast({ title: t('success'), description: t('userDeletedSuccessfully') });\r\n      router.refresh();\r\n    } catch (error: any) {\r\n      toast({ title: t('error'), description: error.message || t('failedToDeleteUser') });\r\n    } finally {\r\n      setIsDeleting(null);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex flex-col lg:flex-row gap-8\">\r\n      {/* Sidebar Navigation */}\r\n      <SettingsTabNav\r\n        tabs={TABS}\r\n        activeTab={activeTab}\r\n        onTabChange={setActiveTab}\r\n      />\r\n\r\n      {/* Tab Content */}\r\n      <div className=\"flex-1 min-w-0\">\r\n        {/* General Settings */}\r\n        {activeTab === 'general' && (\r\n          <GeneralSettingsTab\r\n            settings={settings}\r\n            onSettingChange={handleSettingChange}\r\n            onSave={handleSaveSettings}\r\n            isSaving={isSaving}\r\n          />\r\n        )}\r\n\r\n        {/* Branding */}\r\n        {activeTab === 'branding' && (\r\n          <BrandingSettingsTab\r\n            settings={settings}\r\n            onSettingChange={handleSettingChange}\r\n            onSave={handleSaveSettings}\r\n            isSaving={isSaving}\r\n            onUpload={handleUpload}\r\n            onRemove={handleRemove}\r\n            isUploading={{\r\n              logo: isUploadingLogo,\r\n              favicon: isUploadingFavicon,\r\n              background: isUploadingBackground,\r\n              track_image: isUploadingTrackImage,\r\n            }}\r\n          />\r\n        )}\r\n\r\n        {/* Tickets */}\r\n        {activeTab === 'tickets' && (\r\n          <TicketSettingsTab\r\n            settings={settings}\r\n            onSettingChange={handleSettingChange}\r\n            onSave={handleSaveSettings}\r\n            isSaving={isSaving}\r\n          />\r\n        )}\r\n\r\n        {/* Warranty & Returns */}\r\n        {activeTab === 'warranty' && (\r\n          <WarrantySettingsTab\r\n            settings={settings}\r\n            onSettingChange={handleSettingChange}\r\n            onSave={handleSaveSettings}\r\n            isSaving={isSaving}\r\n          />\r\n        )}\r\n\r\n        {/* Inventory */}\r\n        {activeTab === 'inventory' && (\r\n          <InventorySettingsTab\r\n            settings={settings}\r\n            onSettingChange={handleSettingChange}\r\n            onSave={handleSaveSettings}\r\n            isSaving={isSaving}\r\n          />\r\n        )}\r\n\r\n        {/* Finance */}\r\n        {activeTab === 'finance' && (\r\n          <FinanceSettingsTab\r\n            settings={settings}\r\n            onSettingChange={handleSettingChange}\r\n            onSave={handleSaveSettings}\r\n            isSaving={isSaving}\r\n          />\r\n        )}\r\n\r\n        {/* Print & Invoice */}\r\n        {activeTab === 'print' && (\r\n          <PrintSettingsTab\r\n            settings={settings}\r\n            onSettingChange={handleSettingChange}\r\n            onSave={handleSaveSettings}\r\n            isSaving={isSaving}\r\n          />\r\n        )}\r\n\r\n        {/* SMS Templates */}\r\n        {activeTab === 'sms' && <SMSTemplatesManager />}\r\n\r\n        {/* Email */}\r\n        {activeTab === 'email' && <EmailSettingsTab />}\r\n\r\n        {/* Notifications */}\r\n        {activeTab === 'notifications' && <NotificationPreferences />}\r\n\r\n        {/* Public Tracking */}\r\n        {activeTab === 'tracking' && (\r\n          <TrackingSettingsTab\r\n            settings={settings}\r\n            onSettingChange={handleSettingChange}\r\n            onSave={handleSaveSettings}\r\n            isSaving={isSaving}\r\n          />\r\n        )}\r\n\r\n        {/* Security */}\r\n        {activeTab === 'security' && (\r\n          <SecuritySettingsTab\r\n            settings={settings}\r\n            onSettingChange={handleSettingChange}\r\n            onSave={handleSaveSettings}\r\n            isSaving={isSaving}\r\n          />\r\n        )}\r\n\r\n        {/* Permissions */}\r\n        {activeTab === 'permissions' && (\r\n          <PermissionsSettingsTab\r\n            settings={settings}\r\n            onSettingChange={handleSettingChange}\r\n            onSave={handleSaveSettings}\r\n            isSaving={isSaving}\r\n          />\r\n        )}\r\n\r\n        {/* Database */}\r\n        {activeTab === 'database' && (\r\n          <DatabaseSettingsTab\r\n            settings={settings}\r\n            onSettingChange={handleSettingChange}\r\n          />\r\n        )}\r\n\r\n        {/* Appearance */}\r\n        {activeTab === 'appearance' && (\r\n          <div className=\"space-y-6\">\r\n            <ThemeCustomizer />\r\n          </div>\r\n        )}\r\n\r\n        {/* AI Vision */}\r\n        {activeTab === 'ai_vision' && <AIVisionSettingsTab />}\r\n\r\n        {/* Factory Reset */}\r\n        {activeTab === 'factory_reset' && <FactoryResetTab />}\r\n\r\n        {/* User Management */}\r\n        {activeTab === 'users' && (\r\n          <div className=\"space-y-6\">\r\n            {/* Header Card */}\r\n            <Card className=\"overflow-hidden border-0 bg-gradient-to-r from-indigo-500/10 via-blue-500/10 to-cyan-500/10\">\r\n              <CardHeader className=\"pb-4\">\r\n                <div className=\"flex items-center gap-3\">\r\n                  <div className=\"p-2.5 rounded-xl bg-gradient-to-br from-indigo-500 to-blue-600 text-white shadow-lg shadow-indigo-500/25\">\r\n                    <UsersIcon className=\"w-6 h-6\" />\r\n                  </div>\r\n                  <div>\r\n                    <CardTitle className=\"text-xl\">{t('settings.users.title') || 'User Management'}</CardTitle>\r\n                    <CardDescription>\r\n                      {t('settings.users.description') || 'Manage staff and administrator accounts'}\r\n                    </CardDescription>\r\n                  </div>\r\n                </div>\r\n              </CardHeader>\r\n            </Card>\r\n\r\n            <Card>\r\n              <CardHeader>\r\n                <div className=\"flex items-center justify-end\">\r\n                  <Button onClick={() => setShowNewUser(true)} variant=\"outline\">\r\n                    {t('addUser')}\r\n                  </Button>\r\n                </div>\r\n              </CardHeader>\r\n              <CardContent className=\"space-y-4\">\r\n                <div className=\"space-y-2\">\r\n                  {users.map((user) => (\r\n                    <div\r\n                      key={user.id}\r\n                      className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between p-4 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg hover:shadow-soft transition-all gap-3\"\r\n                    >\r\n                      <div className=\"flex-1 min-w-0\">\r\n                        <div className=\"flex items-center gap-2 flex-wrap\">\r\n                          <p className=\"font-semibold text-gray-900 dark:text-gray-100 truncate\">{user.name || user.username}</p>\r\n                          <span className={`px-2.5 py-1 text-xs font-semibold rounded-full whitespace-nowrap ${user.role === 'ADMIN'\r\n                            ? 'bg-gradient-to-r from-blue-100 to-purple-100 text-blue-700 dark:from-blue-900 dark:to-purple-900 dark:text-blue-300'\r\n                            : 'bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300'\r\n                            }`}>\r\n                            {user.role}\r\n                          </span>\r\n                        </div>\r\n                        <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-1 truncate\">\r\n                          {user.username} ÔÇó {user.email || t('noEmail')}\r\n                        </p>\r\n                      </div>\r\n                      <div className=\"flex flex-wrap items-center gap-2\">\r\n                        <Button\r\n                          variant=\"outline\"\r\n                          size=\"sm\"\r\n                          onClick={() => handleViewLoginLogs(user)}\r\n                          className=\"flex items-center gap-1.5 flex-1 sm:flex-none justify-center\"\r\n                        >\r\n                          <ClockIcon className=\"h-4 w-4\" />\r\n                          <span className=\"hidden sm:inline\">{t('loginLogs')}</span>\r\n                          <span className=\"sm:hidden\">Logs</span>\r\n                        </Button>\r\n                        <Button\r\n                          variant=\"outline\"\r\n                          size=\"sm\"\r\n                          onClick={() => handleEditUser(user)}\r\n                          className=\"flex items-center gap-1.5 flex-1 sm:flex-none justify-center\"\r\n                        >\r\n                          <PencilIcon className=\"h-4 w-4\" />\r\n                          {t('edit')}\r\n                        </Button>\r\n                        <Button\r\n                          variant=\"outline\"\r\n                          size=\"sm\"\r\n                          onClick={() => handleDeleteUser(user.id)}\r\n                          disabled={isDeleting === user.id || user.id === session?.user?.id}\r\n                          className=\"flex items-center gap-1.5 text-red-600 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-950 flex-1 sm:flex-none justify-center\"\r\n                        >\r\n                          <TrashIcon className=\"h-4 w-4\" />\r\n                          {isDeleting === user.id ? t('deleting') : t('delete')}\r\n                        </Button>\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* New User Dialog */}\r\n      <Dialog open={showNewUser} onOpenChange={(open) => !open && setShowNewUser(false)}>\r\n        <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\r\n          <DialogHeader>\r\n            <DialogTitle>{t('createNewUser')}</DialogTitle>\r\n            <DialogDescription>{t('addNewStaffMember')}</DialogDescription>\r\n          </DialogHeader>\r\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4 py-4\">\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"new_username\">{t('username')} *</Label>\r\n              <Input\r\n                id=\"new_username\"\r\n                value={newUser.username}\r\n                onChange={(e) => setNewUser({ ...newUser, username: e.target.value })}\r\n                placeholder=\"johndoe\"\r\n              />\r\n            </div>\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"new_email\">{t('customerEmail')}</Label>\r\n              <Input\r\n                id=\"new_email\"\r\n                type=\"email\"\r\n                value={newUser.email}\r\n                onChange={(e) => setNewUser({ ...newUser, email: e.target.value })}\r\n                placeholder=\"john@example.com\"\r\n              />\r\n            </div>\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"new_password\">{t('password')} *</Label>\r\n              <Input\r\n                id=\"new_password\"\r\n                type=\"password\"\r\n                value={newUser.password}\r\n                onChange={(e) => setNewUser({ ...newUser, password: e.target.value })}\r\n                placeholder=\"Minimum 10 characters\"\r\n                minLength={10}\r\n              />\r\n              <p className=\"text-xs text-gray-500\">Password must be at least 10 characters long</p>\r\n            </div>\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"new_name\">{t('customerName')}</Label>\r\n              <Input\r\n                id=\"new_name\"\r\n                value={newUser.name}\r\n                onChange={(e) => setNewUser({ ...newUser, name: e.target.value })}\r\n                placeholder=\"John Doe\"\r\n              />\r\n            </div>\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"new_role\">{t('role')} *</Label>\r\n              <select\r\n                id=\"new_role\"\r\n                value={newUser.role}\r\n                onChange={(e) => setNewUser({ ...newUser, role: e.target.value as 'ADMIN' | 'STAFF' })}\r\n                className=\"flex h-10 w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 px-3 py-2 text-sm\"\r\n              >\r\n                <option value=\"STAFF\">{t('staff')}</option>\r\n                <option value=\"ADMIN\">{t('admin')}</option>\r\n              </select>\r\n            </div>\r\n          </div>\r\n          <DialogFooter>\r\n            <Button variant=\"outline\" onClick={() => setShowNewUser(false)}>{t('cancel')}</Button>\r\n            <Button onClick={handleCreateUser} disabled={!newUser.username || !newUser.password}>\r\n              {t('createUser') || 'Create User'}\r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/* Edit User Dialog */}\r\n      <Dialog open={!!editingUser} onOpenChange={(open) => !open && setEditingUser(null)}>\r\n        <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\r\n          <DialogHeader>\r\n            <DialogTitle>{t('editUser')}</DialogTitle>\r\n            <DialogDescription>{t('updateUserInformation')}</DialogDescription>\r\n          </DialogHeader>\r\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4 py-4\">\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"edit_username\">{t('username')} *</Label>\r\n              <Input\r\n                id=\"edit_username\"\r\n                value={editUserData.username}\r\n                onChange={(e) => setEditUserData({ ...editUserData, username: e.target.value })}\r\n              />\r\n            </div>\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"edit_email\">{t('customerEmail')}</Label>\r\n              <Input\r\n                id=\"edit_email\"\r\n                type=\"email\"\r\n                value={editUserData.email}\r\n                onChange={(e) => setEditUserData({ ...editUserData, email: e.target.value })}\r\n              />\r\n            </div>\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"edit_password\">{t('newPassword')}</Label>\r\n              <Input\r\n                id=\"edit_password\"\r\n                type=\"password\"\r\n                value={editUserData.password}\r\n                onChange={(e) => setEditUserData({ ...editUserData, password: e.target.value })}\r\n                placeholder=\"Leave blank to keep current password\"\r\n                minLength={10}\r\n              />\r\n              <p className=\"text-xs text-gray-500\">If changing, password must be at least 10 characters long</p>\r\n            </div>\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"edit_name\">{t('customerName')}</Label>\r\n              <Input\r\n                id=\"edit_name\"\r\n                value={editUserData.name}\r\n                onChange={(e) => setEditUserData({ ...editUserData, name: e.target.value })}\r\n              />\r\n            </div>\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"edit_role\">{t('role')} *</Label>\r\n              <select\r\n                id=\"edit_role\"\r\n                value={editUserData.role}\r\n                onChange={(e) => setEditUserData({ ...editUserData, role: e.target.value as 'ADMIN' | 'STAFF' })}\r\n                className=\"flex h-10 w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 px-3 py-2 text-sm\"\r\n              >\r\n                <option value=\"STAFF\">{t('staff')}</option>\r\n                <option value=\"ADMIN\">{t('admin')}</option>\r\n              </select>\r\n            </div>\r\n          </div>\r\n          <DialogFooter>\r\n            <Button variant=\"outline\" onClick={() => setEditingUser(null)}>{t('cancel')}</Button>\r\n            <Button onClick={handleUpdateUser} disabled={!editUserData.username}>\r\n              {t('updateUser') || 'Update User'}\r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/* Delete User Confirmation */}\r\n      <ConfirmDialog\r\n        open={deleteUserConfirmOpen}\r\n        onOpenChange={setDeleteUserConfirmOpen}\r\n        title={t('deleteUser')}\r\n        description={t('deleteUserConfirmation')}\r\n        confirmText={t('delete')}\r\n        cancelText={t('cancel')}\r\n        variant=\"destructive\"\r\n        onConfirm={confirmDeleteUser}\r\n      />\r\n\r\n      {/* Login Logs Dialog */}\r\n      <Dialog open={showLoginLogs} onOpenChange={(open) => !open && setShowLoginLogs(false)}>\r\n        <DialogContent className=\"max-w-4xl max-h-[80vh] overflow-y-auto\">\r\n          <DialogHeader>\r\n            <DialogTitle>\r\n              {t('loginLogs')} - {selectedUserForLogs?.name || selectedUserForLogs?.username}\r\n            </DialogTitle>\r\n            <DialogDescription>{t('viewLoginHistory')}</DialogDescription>\r\n          </DialogHeader>\r\n          <div className=\"mt-4\">\r\n            {isLoadingLogs ? (\r\n              <div className=\"text-center py-8 text-gray-500\">{t('loading')}</div>\r\n            ) : loginLogs.length === 0 ? (\r\n              <div className=\"text-center py-8 text-gray-500\">{t('noLoginLogsFound')}</div>\r\n            ) : (\r\n              <div className=\"space-y-2\">\r\n                <div className=\"grid grid-cols-4 gap-4 pb-2 border-b font-semibold text-sm text-gray-700 dark:text-gray-300\">\r\n                  <div>{t('dateAndTime')}</div>\r\n                  <div>{t('status')}</div>\r\n                  <div>{t('ipAddress')}</div>\r\n                  <div>{t('userAgent')}</div>\r\n                </div>\r\n                {loginLogs.map((log) => (\r\n                  <div key={log.id} className=\"grid grid-cols-4 gap-4 py-2 border-b text-sm hover:bg-gray-50 dark:hover:bg-gray-800\">\r\n                    <div className=\"text-gray-700 dark:text-gray-300\">\r\n                      {format(new Date(log.createdAt), 'MMM dd, yyyy HH:mm:ss')}\r\n                    </div>\r\n                    <div>\r\n                      <span className={`px-2 py-1 text-xs rounded-full ${log.success\r\n                        ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200'\r\n                        : 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200'\r\n                        }`}>\r\n                        {log.success ? t('success') : t('failed')}\r\n                      </span>\r\n                    </div>\r\n                    <div className=\"text-gray-600 dark:text-gray-400 font-mono text-xs\">{log.ipAddress || 'N/A'}</div>\r\n                    <div className=\"text-gray-600 dark:text-gray-400 text-xs truncate\" title={log.userAgent || 'N/A'}>\r\n                      {log.userAgent || 'N/A'}\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            )}\r\n          </div>\r\n          <DialogFooter>\r\n            <Button onClick={() => setShowLoginLogs(false)} variant=\"outline\">{t('close')}</Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\settings\\sms-templates-manager.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\settings\\theme-customizer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\setup\\setup-language-switcher.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\sms\\sms-sender.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchPorts'. Either include it or remove the dependency array.","line":70,"column":6,"nodeType":"ArrayExpression","endLine":70,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [fetchPorts, language]","fix":{"range":[2483,2493],"text":"[fetchPorts, language]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\suppliers\\supplier-search.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\suppliers\\suppliers-page-client.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\theme-provider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\tickets\\add-parts-modal.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":606,"column":62,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[22165,22167],"text":" &quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[22165,22167],"text":" &ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[22165,22167],"text":" &#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[22165,22167],"text":" &rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":606,"column":75,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[22179,22200],"text":"&quot;\r\n                  "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[22179,22200],"text":"&ldquo;\r\n                  "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[22179,22200],"text":"&#34;\r\n                  "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[22179,22200],"text":"&rdquo;\r\n                  "},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useLanguage } from '@/contexts/language-context';\r\nimport { useToast } from '@/components/ui/use-toast';\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogFooter,\r\n  DialogHeader,\r\n  DialogTitle,\r\n} from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport {\r\n  PlusCircleIcon,\r\n  XMarkIcon,\r\n  ArrowPathIcon,\r\n  CheckIcon,\r\n  MagnifyingGlassIcon,\r\n  PlusIcon,\r\n  CheckCircleIcon,\r\n  LightBulbIcon,\r\n  CubeIcon,\r\n  ShoppingCartIcon,\r\n} from '@heroicons/react/24/outline';\r\n\r\ninterface Supplier {\r\n  id: string;\r\n  name: string;\r\n}\r\n\r\ninterface Part {\r\n  id: string;\r\n  name: string;\r\n  sku: string;\r\n  quantity: number;\r\n  unitPrice: number;\r\n  supplier: {\r\n    id: string;\r\n    name: string;\r\n  } | null;\r\n}\r\n\r\ninterface SelectedPart {\r\n  partId: string;\r\n  quantity: number;\r\n  part: Part;\r\n}\r\n\r\ninterface AddPartsModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  ticketId: string;\r\n  onSuccess: () => void;\r\n  existingParts?: Array<{\r\n    id: string;\r\n    partId: string;\r\n    quantity: number;\r\n    part: Part;\r\n  }>;\r\n  ticketStatus?: string;\r\n  deviceName?: string; // Device name for smart suggestions\r\n}\r\n\r\nexport function AddPartsModal({\r\n  isOpen,\r\n  onClose,\r\n  ticketId,\r\n  onSuccess,\r\n  existingParts = [],\r\n  ticketStatus,\r\n  deviceName,\r\n}: AddPartsModalProps) {\r\n  const { t } = useLanguage();\r\n  const { toast } = useToast();\r\n  const [parts, setParts] = useState<Part[]>([]);\r\n  const [loadingParts, setLoadingParts] = useState(true);\r\n  const [selectedParts, setSelectedParts] = useState<SelectedPart[]>([]);\r\n  const [isSaving, setIsSaving] = useState(false);\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [changeToWaiting, setChangeToWaiting] = useState(ticketStatus === 'IN_PROGRESS');\r\n\r\n  // Inline form state\r\n  const [showInlineForm, setShowInlineForm] = useState(false);\r\n  const [suppliers, setSuppliers] = useState<Supplier[]>([]);\r\n  const [loadingSuppliers, setLoadingSuppliers] = useState(false);\r\n  const [isCreatingPart, setIsCreatingPart] = useState(false);\r\n  const [formError, setFormError] = useState('');\r\n  const [newPartForm, setNewPartForm] = useState({\r\n    name: '',\r\n    sku: '',\r\n    description: '',\r\n    quantity: '0',\r\n    reorderLevel: '1',\r\n    unitPrice: '0',\r\n    supplierId: '',\r\n  });\r\n\r\n  const generateSKU = (): string => {\r\n    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';\r\n    let sku = '';\r\n    for (let i = 0; i < 8; i++) {\r\n      sku += chars.charAt(Math.floor(Math.random() * chars.length));\r\n    }\r\n    return sku;\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (isOpen) {\r\n      fetchParts();\r\n      const initialSelected = existingParts.map(tp => ({\r\n        partId: tp.partId,\r\n        quantity: tp.quantity,\r\n        part: tp.part,\r\n      }));\r\n      setSelectedParts(initialSelected);\r\n    }\r\n  }, [isOpen, existingParts]);\r\n\r\n  const fetchParts = async (): Promise<Part[]> => {\r\n    setLoadingParts(true);\r\n    try {\r\n      const response = await fetch('/api/parts');\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setParts(data);\r\n        return data;\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching parts:', error);\r\n    } finally {\r\n      setLoadingParts(false);\r\n    }\r\n    return [];\r\n  };\r\n\r\n  const fetchSuppliers = async () => {\r\n    if (suppliers.length > 0) return;\r\n    setLoadingSuppliers(true);\r\n    try {\r\n      const response = await fetch('/api/suppliers');\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setSuppliers(data);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching suppliers:', error);\r\n    } finally {\r\n      setLoadingSuppliers(false);\r\n    }\r\n  };\r\n\r\n  const handleOpenInlineForm = () => {\r\n    setShowInlineForm(true);\r\n    setFormError('');\r\n    setNewPartForm({\r\n      name: '',\r\n      sku: generateSKU(),\r\n      description: '',\r\n      quantity: '0',\r\n      reorderLevel: '1',\r\n      unitPrice: '0',\r\n      supplierId: '',\r\n    });\r\n    fetchSuppliers();\r\n  };\r\n\r\n  const handleCloseInlineForm = () => {\r\n    setShowInlineForm(false);\r\n    setFormError('');\r\n  };\r\n\r\n  const handleCreatePart = async () => {\r\n    setFormError('');\r\n    setIsCreatingPart(true);\r\n\r\n    try {\r\n      const response = await fetch('/api/parts', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          name: newPartForm.name.trim(),\r\n          sku: newPartForm.sku.trim(),\r\n          description: newPartForm.description.trim() || undefined,\r\n          quantity: parseInt(newPartForm.quantity) || 0,\r\n          reorderLevel: parseInt(newPartForm.reorderLevel) || 1,\r\n          unitPrice: parseFloat(newPartForm.unitPrice) || 0,\r\n          supplierId: newPartForm.supplierId || undefined,\r\n        }),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        const data = await response.json();\r\n        if (data.details) {\r\n          const errorMessages = data.details.map((err: any) =>\r\n            `${err.path.join('.')}: ${err.message}`\r\n          ).join(', ');\r\n          throw new Error(errorMessages);\r\n        }\r\n        throw new Error(data.error || 'Failed to create part');\r\n      }\r\n\r\n      const createdPart = await response.json();\r\n      const updatedParts = await fetchParts();\r\n\r\n      const newPart = updatedParts.find(p => p.id === createdPart.id);\r\n      if (newPart) {\r\n        setSelectedParts(prev => {\r\n          const existing = prev.find(sp => sp.partId === newPart.id);\r\n          if (existing) {\r\n            return prev.map(sp =>\r\n              sp.partId === newPart.id ? { ...sp, quantity: sp.quantity + 1 } : sp\r\n            );\r\n          }\r\n          return [...prev, { partId: newPart.id, quantity: 1, part: newPart }];\r\n        });\r\n      }\r\n\r\n      toast({\r\n        title: t('success'),\r\n        description: t('partCreated') || 'Part created successfully',\r\n      });\r\n\r\n      handleCloseInlineForm();\r\n    } catch (error: any) {\r\n      console.error('Error creating part:', error);\r\n      setFormError(error.message || 'An error occurred');\r\n    } finally {\r\n      setIsCreatingPart(false);\r\n    }\r\n  };\r\n\r\n  // Get suggested parts based on device name\r\n  const suggestedParts = deviceName\r\n    ? parts.filter(part => {\r\n      const deviceWords = deviceName.toLowerCase().split(/\\s+/);\r\n      const partName = part.name.toLowerCase();\r\n      // Match if part name contains any significant word from device name\r\n      return deviceWords.some(word => word.length > 2 && partName.includes(word));\r\n    }).slice(0, 3) // Limit to 3 suggestions\r\n    : [];\r\n\r\n  // Search results (only show when searching)\r\n  const searchResults = searchQuery\r\n    ? parts.filter(part => {\r\n      const query = searchQuery.toLowerCase();\r\n      return (\r\n        part.name.toLowerCase().includes(query) ||\r\n        part.sku.toLowerCase().includes(query) ||\r\n        part.supplier?.name.toLowerCase().includes(query)\r\n      );\r\n    })\r\n    : [];\r\n\r\n  const addPart = (part: Part) => {\r\n    const existing = selectedParts.find(sp => sp.partId === part.id);\r\n    if (existing) {\r\n      setSelectedParts(selectedParts.map(sp =>\r\n        sp.partId === part.id\r\n          ? { ...sp, quantity: sp.quantity + 1 }\r\n          : sp\r\n      ));\r\n    } else {\r\n      setSelectedParts([...selectedParts, {\r\n        partId: part.id,\r\n        quantity: 1,\r\n        part,\r\n      }]);\r\n    }\r\n  };\r\n\r\n  const removePart = (partId: string) => {\r\n    setSelectedParts(selectedParts.filter(sp => sp.partId !== partId));\r\n  };\r\n\r\n  const updateQuantity = (partId: string, quantity: number) => {\r\n    if (quantity <= 0) {\r\n      removePart(partId);\r\n      return;\r\n    }\r\n    setSelectedParts(selectedParts.map(sp =>\r\n      sp.partId === partId\r\n        ? { ...sp, quantity }\r\n        : sp\r\n    ));\r\n  };\r\n\r\n  const handleSave = async () => {\r\n    setIsSaving(true);\r\n    try {\r\n      for (const selectedPart of selectedParts) {\r\n        const existingSelected = existingParts.find(ep => ep.partId === selectedPart.partId);\r\n\r\n        if (existingSelected && existingSelected.quantity !== selectedPart.quantity) {\r\n          await fetch(`/api/tickets/${ticketId}/parts?ticketPartId=${existingSelected.id}`, {\r\n            method: 'DELETE',\r\n          });\r\n        }\r\n\r\n        if (!existingSelected || existingSelected.quantity !== selectedPart.quantity) {\r\n          const response = await fetch(`/api/tickets/${ticketId}/parts`, {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({\r\n              partId: selectedPart.partId,\r\n              quantity: selectedPart.quantity,\r\n            }),\r\n          });\r\n\r\n          if (!response.ok) {\r\n            const error = await response.json();\r\n            throw new Error(error.error || 'Failed to add part');\r\n          }\r\n        }\r\n      }\r\n\r\n      for (const existingPart of existingParts) {\r\n        if (!selectedParts.find(sp => sp.partId === existingPart.partId)) {\r\n          await fetch(`/api/tickets/${ticketId}/parts?ticketPartId=${existingPart.id}`, {\r\n            method: 'DELETE',\r\n          });\r\n        }\r\n      }\r\n\r\n      toast({\r\n        title: t('success'),\r\n        description: t('partsAddedToTicket') || 'Parts added to ticket successfully',\r\n      });\r\n\r\n      if (changeToWaiting && ticketStatus === 'IN_PROGRESS') {\r\n        try {\r\n          await fetch(`/api/tickets/${ticketId}`, {\r\n            method: 'PATCH',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({ status: 'WAITING_FOR_PARTS' }),\r\n          });\r\n        } catch (e) {\r\n          console.error('Failed to update status:', e);\r\n        }\r\n      }\r\n\r\n      onSuccess();\r\n      onClose();\r\n    } catch (error: any) {\r\n      toast({\r\n        title: t('error'),\r\n        description: error.message || t('failedToAddParts') || 'Failed to add parts',\r\n        variant: 'destructive',\r\n      });\r\n    } finally {\r\n      setIsSaving(false);\r\n    }\r\n  };\r\n\r\n  const totalCost = selectedParts.reduce((sum, sp) => {\r\n    return sum + (sp.part.unitPrice * sp.quantity);\r\n  }, 0);\r\n\r\n  const isPartSelected = (partId: string) => selectedParts.some(sp => sp.partId === partId);\r\n\r\n  return (\r\n    <Dialog open={isOpen} onOpenChange={onClose}>\r\n      <DialogContent className=\"max-w-2xl max-h-[85vh] overflow-y-auto\">\r\n        <DialogHeader>\r\n          <DialogTitle>{t('addPartsToTicket') || 'Add Parts to Ticket'}</DialogTitle>\r\n          <DialogDescription>\r\n            {t('selectPartsUsedInRepair') || 'Select parts used in the repair process'}\r\n          </DialogDescription>\r\n        </DialogHeader>\r\n\r\n        <div className=\"space-y-4\">\r\n          {/* Inline Create Part Form */}\r\n          {showInlineForm && (\r\n            <div className=\"border border-primary/50 rounded-lg bg-primary/5 p-4 space-y-3\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <h4 className=\"font-medium text-sm flex items-center gap-2\">\r\n                  <PlusCircleIcon className=\"h-[18px] w-[18px] text-primary\" />\r\n                  {t('createNewPart') || 'Create New Part'}\r\n                </h4>\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={handleCloseInlineForm}\r\n                  className=\"text-muted-foreground hover:text-foreground\"\r\n                >\r\n                  <XMarkIcon className=\"h-4 w-4\" />\r\n                </button>\r\n              </div>\r\n\r\n              {formError && (\r\n                <div className=\"p-2 bg-error/10 text-error text-sm rounded\">\r\n                  {formError}\r\n                </div>\r\n              )}\r\n\r\n              <div className=\"grid grid-cols-2 gap-3\">\r\n                <div>\r\n                  <label className=\"block text-xs font-medium text-muted-foreground mb-1\">\r\n                    {t('partName') || 'Part Name'} *\r\n                  </label>\r\n                  <input\r\n                    type=\"text\"\r\n                    required\r\n                    value={newPartForm.name}\r\n                    onChange={(e) => setNewPartForm({ ...newPartForm, name: e.target.value })}\r\n                    placeholder={t('enterPartName') || 'e.g., iPhone 14 Screen'}\r\n                    className=\"w-full px-3 py-2 text-sm border border-input rounded-lg bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary\"\r\n                  />\r\n                </div>\r\n\r\n                <div>\r\n                  <div className=\"flex items-center justify-between mb-1\">\r\n                    <label className=\"text-xs font-medium text-muted-foreground\">\r\n                      {t('sku') || 'SKU'} *\r\n                    </label>\r\n                    <button\r\n                      type=\"button\"\r\n                      onClick={() => setNewPartForm({ ...newPartForm, sku: generateSKU() })}\r\n                      className=\"text-primary text-xs hover:underline flex items-center gap-0.5\"\r\n                    >\r\n                      <ArrowPathIcon className=\"h-3 w-3\" />\r\n                      {t('regenerate') || 'Regenerate'}\r\n                    </button>\r\n                  </div>\r\n                  <input\r\n                    type=\"text\"\r\n                    required\r\n                    maxLength={8}\r\n                    value={newPartForm.sku}\r\n                    onChange={(e) => setNewPartForm({ ...newPartForm, sku: e.target.value.toUpperCase().slice(0, 8) })}\r\n                    className=\"w-full px-3 py-2 text-sm border border-input rounded-lg bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary font-mono\"\r\n                  />\r\n                </div>\r\n\r\n                <div>\r\n                  <label className=\"block text-xs font-medium text-muted-foreground mb-1\">\r\n                    {t('initialQuantity') || 'Initial Quantity'} *\r\n                  </label>\r\n                  <input\r\n                    type=\"number\"\r\n                    required\r\n                    min=\"0\"\r\n                    value={newPartForm.quantity}\r\n                    onChange={(e) => setNewPartForm({ ...newPartForm, quantity: e.target.value })}\r\n                    className=\"w-full px-3 py-2 text-sm border border-input rounded-lg bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary\"\r\n                  />\r\n                </div>\r\n\r\n                <div>\r\n                  <label className=\"block text-xs font-medium text-muted-foreground mb-1\">\r\n                    {t('unitPrice') || 'Unit Price'} *\r\n                  </label>\r\n                  <div className=\"relative\">\r\n                    <span className=\"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground text-sm\">$</span>\r\n                    <input\r\n                      type=\"number\"\r\n                      required\r\n                      step=\"0.01\"\r\n                      min=\"0\"\r\n                      value={newPartForm.unitPrice}\r\n                      onChange={(e) => setNewPartForm({ ...newPartForm, unitPrice: e.target.value })}\r\n                      placeholder=\"0.00\"\r\n                      className=\"w-full pl-7 pr-3 py-2 text-sm border border-input rounded-lg bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"col-span-2\">\r\n                  <label className=\"block text-xs font-medium text-muted-foreground mb-1\">\r\n                    {t('supplier') || 'Supplier'}\r\n                  </label>\r\n                  {loadingSuppliers ? (\r\n                    <div className=\"px-3 py-2 text-sm text-muted-foreground text-center border border-input rounded-lg\">\r\n                      {t('loading') || 'Loading...'}\r\n                    </div>\r\n                  ) : (\r\n                    <select\r\n                      value={newPartForm.supplierId}\r\n                      onChange={(e) => setNewPartForm({ ...newPartForm, supplierId: e.target.value })}\r\n                      className=\"w-full px-3 py-2 text-sm border border-input rounded-lg bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary\"\r\n                    >\r\n                      <option value=\"\">{t('noSupplier') || 'No Supplier'}</option>\r\n                      {suppliers.map((supplier) => (\r\n                        <option key={supplier.id} value={supplier.id}>\r\n                          {supplier.name}\r\n                        </option>\r\n                      ))}\r\n                    </select>\r\n                  )}\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"flex gap-2 pt-2\">\r\n                <Button\r\n                  type=\"button\"\r\n                  variant=\"outline\"\r\n                  size=\"sm\"\r\n                  onClick={handleCloseInlineForm}\r\n                  disabled={isCreatingPart}\r\n                >\r\n                  {t('cancel') || 'Cancel'}\r\n                </Button>\r\n                <Button\r\n                  type=\"button\"\r\n                  size=\"sm\"\r\n                  onClick={handleCreatePart}\r\n                  disabled={isCreatingPart || !newPartForm.name.trim() || !newPartForm.sku.trim()}\r\n                >\r\n                  {isCreatingPart ? (\r\n                    <>\r\n                      <ArrowPathIcon className=\"h-4 w-4 mr-1 animate-spin\" />\r\n                      {t('creating') || 'Creating...'}\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      <CheckIcon className=\"h-4 w-4 mr-1\" />\r\n                      {t('createAndSelect') || 'Create & Select'}\r\n                    </>\r\n                  )}\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Search Bar with Create Button */}\r\n          <div className=\"flex gap-2\">\r\n            <div className=\"relative flex-1\">\r\n              <MagnifyingGlassIcon className=\"h-[18px] w-[18px] absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground\" />\r\n              <input\r\n                type=\"text\"\r\n                value={searchQuery}\r\n                onChange={(e) => setSearchQuery(e.target.value)}\r\n                placeholder={t('searchParts') || 'Search parts by name, SKU, or supplier...'}\r\n                className=\"w-full pl-10 pr-4 py-2 border border-input rounded-lg bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary\"\r\n              />\r\n            </div>\r\n            {!showInlineForm && (\r\n              <Button\r\n                type=\"button\"\r\n                variant=\"outline\"\r\n                onClick={handleOpenInlineForm}\r\n              >\r\n                <PlusIcon className=\"h-4 w-4 mr-1\" />\r\n                {t('createNew') || 'Create New'}\r\n              </Button>\r\n            )}\r\n          </div>\r\n\r\n          {/* Content Grid */}\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n            {/* Left: Search Results or Suggestions */}\r\n            <div>\r\n              {/* Show search results when searching */}\r\n              {searchQuery ? (\r\n                <>\r\n                  <h3 className=\"font-medium text-sm mb-2 text-muted-foreground\">\r\n                    {t('searchResults') || 'Search Results'} ({searchResults.length})\r\n                  </h3>\r\n                  <div className=\"border border-border rounded-lg max-h-[300px] overflow-y-auto\">\r\n                    {loadingParts ? (\r\n                      <div className=\"p-4 text-center text-muted-foreground\">\r\n                        <ArrowPathIcon className=\"h-5 w-5 animate-spin mx-auto\" />\r\n                      </div>\r\n                    ) : searchResults.length === 0 ? (\r\n                      <div className=\"p-4 text-center text-muted-foreground text-sm\">\r\n                        {t('noPartsFound') || 'No parts found'}\r\n                      </div>\r\n                    ) : (\r\n                      <div className=\"divide-y divide-border\">\r\n                        {searchResults.map(part => (\r\n                          <div\r\n                            key={part.id}\r\n                            className={`p-3 cursor-pointer flex items-center justify-between transition-colors ${isPartSelected(part.id)\r\n                              ? 'bg-primary/10'\r\n                              : 'hover:bg-muted/50'\r\n                              }`}\r\n                            onClick={() => addPart(part)}\r\n                          >\r\n                            <div className=\"flex-1 min-w-0\">\r\n                              <p className=\"font-medium text-sm truncate\">{part.name}</p>\r\n                              <p className=\"text-xs text-muted-foreground font-mono\">\r\n                                {part.sku} {part.supplier && `ÔÇó ${part.supplier.name}`}\r\n                              </p>\r\n                              <p className=\"text-xs text-muted-foreground\">\r\n                                {t('stock')}: {part.quantity} ÔÇó ${part.unitPrice.toFixed(2)}\r\n                              </p>\r\n                            </div>\r\n                            {isPartSelected(part.id) ? (\r\n                              <CheckCircleIcon className=\"h-[18px] w-[18px] text-primary ml-2\" />\r\n                            ) : (\r\n                              <PlusCircleIcon className=\"h-[18px] w-[18px] text-primary ml-2\" />\r\n                            )}\r\n                          </div>\r\n                        ))}\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                </>\r\n              ) : suggestedParts.length > 0 ? (\r\n                /* Show suggestions when not searching and device name matches */\r\n                <>\r\n                  <h3 className=\"font-medium text-sm mb-2 text-muted-foreground flex items-center gap-1\">\r\n                    <LightBulbIcon className=\"h-4 w-4 text-amber-500\" />\r\n                    {t('suggestedParts') || 'Suggested for'} \"{deviceName}\"\r\n                  </h3>\r\n                  <div className=\"border border-border rounded-lg\">\r\n                    <div className=\"divide-y divide-border\">\r\n                      {suggestedParts.map(part => (\r\n                        <div\r\n                          key={part.id}\r\n                          className={`p-3 cursor-pointer flex items-center justify-between transition-colors ${isPartSelected(part.id)\r\n                            ? 'bg-primary/10'\r\n                            : 'hover:bg-muted/50'\r\n                            }`}\r\n                          onClick={() => addPart(part)}\r\n                        >\r\n                          <div className=\"flex-1 min-w-0\">\r\n                            <p className=\"font-medium text-sm truncate\">{part.name}</p>\r\n                            <p className=\"text-xs text-muted-foreground\">\r\n                              ${part.unitPrice.toFixed(2)} ÔÇó {t('stock')}: {part.quantity}\r\n                            </p>\r\n                          </div>\r\n                          {isPartSelected(part.id) ? (\r\n                            <CheckCircleIcon className=\"h-[18px] w-[18px] text-primary ml-2\" />\r\n                          ) : (\r\n                            <PlusCircleIcon className=\"h-[18px] w-[18px] text-primary ml-2\" />\r\n                          )}\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n                  <p className=\"text-xs text-muted-foreground mt-2\">\r\n                    {t('searchForMore') || 'Use search to find more parts'}\r\n                  </p>\r\n                </>\r\n              ) : (\r\n                /* Empty state when no search and no suggestions */\r\n                <div className=\"border border-dashed border-border rounded-lg p-6 text-center\">\r\n                  <CubeIcon className=\"h-8 w-8 text-muted-foreground mx-auto mb-2\" />\r\n                  <p className=\"text-sm text-muted-foreground\">\r\n                    {t('searchToFindParts') || 'Search to find parts or create a new one'}\r\n                  </p>\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            {/* Right: Selected Parts */}\r\n            <div>\r\n              <h3 className=\"font-medium text-sm mb-2 text-muted-foreground\">\r\n                {t('selectedParts') || 'Selected Parts'} ({selectedParts.length})\r\n              </h3>\r\n              <div className=\"border border-border rounded-lg max-h-[300px] overflow-y-auto\">\r\n                {selectedParts.length === 0 ? (\r\n                  <div className=\"p-6 text-center text-muted-foreground text-sm\">\r\n                    <ShoppingCartIcon className=\"h-6 w-6 mx-auto mb-1\" />\r\n                    <p>{t('noPartsSelected') || 'No parts selected'}</p>\r\n                  </div>\r\n                ) : (\r\n                  <div className=\"divide-y divide-border\">\r\n                    {selectedParts.map(selectedPart => {\r\n                      const part = selectedPart.part;\r\n                      return (\r\n                        <div key={selectedPart.partId} className=\"p-3\">\r\n                          <div className=\"flex items-start justify-between mb-2\">\r\n                            <div className=\"flex-1 min-w-0\">\r\n                              <p className=\"font-medium text-sm truncate\">{part.name}</p>\r\n                              <p className=\"text-xs text-muted-foreground font-mono\">{part.sku}</p>\r\n                            </div>\r\n                            <button\r\n                              type=\"button\"\r\n                              onClick={() => removePart(selectedPart.partId)}\r\n                              className=\"text-error hover:text-error/80 ml-2\"\r\n                            >\r\n                              <XMarkIcon className=\"h-4 w-4\" />\r\n                            </button>\r\n                          </div>\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <label className=\"text-xs text-muted-foreground\">{t('qty') || 'Qty'}:</label>\r\n                            <input\r\n                              type=\"number\"\r\n                              min=\"1\"\r\n                              value={selectedPart.quantity}\r\n                              onChange={(e) => updateQuantity(selectedPart.partId, parseInt(e.target.value) || 1)}\r\n                              className=\"w-16 px-2 py-1 border border-input rounded text-sm bg-background text-foreground text-center\"\r\n                            />\r\n                            <span className=\"text-sm font-medium ml-auto\">\r\n                              ${(part.unitPrice * selectedPart.quantity).toFixed(2)}\r\n                            </span>\r\n                          </div>\r\n                        </div>\r\n                      );\r\n                    })}\r\n                  </div>\r\n                )}\r\n              </div>\r\n              {selectedParts.length > 0 && (\r\n                <div className=\"mt-2 p-3 bg-muted rounded-lg\">\r\n                  <div className=\"flex justify-between items-center\">\r\n                    <span className=\"font-medium\">{t('total') || 'Total'}:</span>\r\n                    <span className=\"font-bold text-lg\">${totalCost.toFixed(2)}</span>\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Status change option */}\r\n        {ticketStatus === 'IN_PROGRESS' && selectedParts.length > 0 && (\r\n          <div className=\"flex items-center gap-2 p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg\">\r\n            <input\r\n              type=\"checkbox\"\r\n              id=\"change-to-waiting\"\r\n              checked={changeToWaiting}\r\n              onChange={(e) => setChangeToWaiting(e.target.checked)}\r\n              className=\"w-4 h-4 text-primary-600 rounded border-gray-300 focus:ring-primary-500\"\r\n            />\r\n            <label htmlFor=\"change-to-waiting\" className=\"text-sm text-blue-800 dark:text-blue-200\">\r\n              {t('markAsWaitingForParts') || 'Mark ticket as \"Waiting for Parts\"'}\r\n            </label>\r\n          </div>\r\n        )}\r\n\r\n        <DialogFooter>\r\n          <Button variant=\"outline\" onClick={onClose} disabled={isSaving}>\r\n            {t('cancel')}\r\n          </Button>\r\n          <Button onClick={handleSave} disabled={isSaving}>\r\n            {isSaving ? (\r\n              <>\r\n                <ArrowPathIcon className=\"h-5 w-5 mr-2 animate-spin\" />\r\n                {t('saving') || 'Saving...'}\r\n              </>\r\n            ) : (\r\n              t('save') || 'Save'\r\n            )}\r\n          </Button>\r\n        </DialogFooter>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\tickets\\completion-sms-prompt.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\tickets\\device-autocomplete.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\tickets\\device-issue-autocomplete.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\tickets\\device-photos.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":44,"column":17,"nodeType":"JSXOpeningElement","endLine":48,"endColumn":19},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":60,"column":17,"nodeType":"JSXOpeningElement","endLine":64,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState } from 'react';\r\nimport { ImageModal } from './image-modal';\r\nimport { useLanguage } from '@/contexts/language-context';\r\n\r\ninterface DevicePhotosProps {\r\n  frontImage?: string | null;\r\n  backImage?: string | null;\r\n}\r\n\r\nexport function DevicePhotos({ frontImage, backImage }: DevicePhotosProps) {\r\n  const { t } = useLanguage();\r\n  const [modalImage, setModalImage] = useState<string | null>(null);\r\n  const [modalTitle, setModalTitle] = useState('');\r\n\r\n  const openModal = (imageSrc: string, title: string) => {\r\n    setModalImage(imageSrc);\r\n    setModalTitle(title);\r\n  };\r\n\r\n  const closeModal = () => {\r\n    setModalImage(null);\r\n    setModalTitle('');\r\n  };\r\n\r\n  if (!frontImage && !backImage) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <div>\r\n        <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-2\">{t('devicePhotos')}</p>\r\n        <div className=\"grid grid-cols-2 gap-4\">\r\n          {frontImage && (\r\n            <div>\r\n              <p className=\"text-xs text-gray-500 mb-1\">{t('front')}</p>\r\n              <button\r\n                type=\"button\"\r\n                onClick={() => openModal(frontImage, t('deviceFront'))}\r\n                className=\"w-full cursor-pointer hover:opacity-90 transition-opacity\"\r\n              >\r\n                <img\r\n                  src={frontImage}\r\n                  alt={t('deviceFront')}\r\n                  className=\"w-full h-48 object-contain border rounded bg-gray-50 dark:bg-gray-800 hover:border-primary-500 transition-colors\"\r\n                />\r\n              </button>\r\n            </div>\r\n          )}\r\n          {backImage && (\r\n            <div>\r\n              <p className=\"text-xs text-gray-500 mb-1\">{t('back')}</p>\r\n              <button\r\n                type=\"button\"\r\n                onClick={() => openModal(backImage, t('deviceBack'))}\r\n                className=\"w-full cursor-pointer hover:opacity-90 transition-opacity\"\r\n              >\r\n                <img\r\n                  src={backImage}\r\n                  alt={t('deviceBack')}\r\n                  className=\"w-full h-48 object-contain border rounded bg-gray-50 dark:bg-gray-800 hover:border-primary-500 transition-colors\"\r\n                />\r\n              </button>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {modalImage && (\r\n        <ImageModal\r\n          isOpen={!!modalImage}\r\n          onClose={closeModal}\r\n          imageSrc={modalImage}\r\n          title={modalTitle}\r\n        />\r\n      )}\r\n    </>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\tickets\\image-crop.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":116,"column":15,"nodeType":"JSXOpeningElement","endLine":122,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useRef, useEffect } from 'react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport ReactCrop, { Crop, PixelCrop, makeAspectCrop, centerCrop } from 'react-image-crop';\r\nimport 'react-image-crop/dist/ReactCrop.css';\r\nimport { useLanguage } from '@/contexts/language-context';\r\n\r\ninterface ImageCropProps {\r\n  imageSrc: string;\r\n  onCropComplete: (croppedImage: string) => void;\r\n  onCancel: () => void;\r\n}\r\n\r\nexport default function ImageCrop({ imageSrc, onCropComplete, onCancel }: ImageCropProps) {\r\n  const { t } = useLanguage();\r\n  const [crop, setCrop] = useState<Crop>();\r\n  const [completedCrop, setCompletedCrop] = useState<PixelCrop>();\r\n  const imgRef = useRef<HTMLImageElement>(null);\r\n  const canvasRef = useRef<HTMLCanvasElement>(null);\r\n\r\n  useEffect(() => {\r\n    if (imgRef.current) {\r\n      const { width, height } = imgRef.current;\r\n      const crop = makeAspectCrop(\r\n        {\r\n          unit: '%',\r\n          width: 90,\r\n        },\r\n        16 / 9,\r\n        width,\r\n        height\r\n      );\r\n      setCrop(centerCrop(crop, width, height));\r\n    }\r\n  }, []);\r\n\r\n  const onImageLoad = (e: React.SyntheticEvent<HTMLImageElement>) => {\r\n    const { width, height } = e.currentTarget;\r\n    const crop = makeAspectCrop(\r\n      {\r\n        unit: '%',\r\n        width: 90,\r\n      },\r\n      16 / 9,\r\n      width,\r\n      height\r\n    );\r\n    setCrop(centerCrop(crop, width, height));\r\n  };\r\n\r\n  const getCroppedImg = (image: HTMLImageElement, crop: PixelCrop): Promise<string> => {\r\n    const canvas = document.createElement('canvas');\r\n    const scaleX = image.naturalWidth / image.width;\r\n    const scaleY = image.naturalHeight / image.height;\r\n    canvas.width = crop.width * scaleX;\r\n    canvas.height = crop.height * scaleY;\r\n    const ctx = canvas.getContext('2d');\r\n\r\n    if (!ctx) {\r\n      throw new Error('No 2d context');\r\n    }\r\n\r\n    ctx.drawImage(\r\n      image,\r\n      crop.x * scaleX,\r\n      crop.y * scaleY,\r\n      crop.width * scaleX,\r\n      crop.height * scaleY,\r\n      0,\r\n      0,\r\n      crop.width * scaleX,\r\n      crop.height * scaleY\r\n    );\r\n\r\n    return new Promise((resolve) => {\r\n      canvas.toBlob(\r\n        (blob) => {\r\n          if (!blob) {\r\n            resolve('');\r\n            return;\r\n          }\r\n          const reader = new FileReader();\r\n          reader.onloadend = () => resolve(reader.result as string);\r\n          reader.readAsDataURL(blob);\r\n        },\r\n        'image/jpeg',\r\n        0.9\r\n      );\r\n    });\r\n  };\r\n\r\n  const handleCrop = async () => {\r\n    if (imgRef.current && completedCrop) {\r\n      const croppedImage = await getCroppedImg(imgRef.current, completedCrop);\r\n      onCropComplete(croppedImage);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-[9999] flex items-center justify-center bg-black/80 backdrop-blur-sm\">\r\n      <Card className=\"max-w-2xl w-full m-4 bg-white dark:bg-gray-900 rounded-lg shadow-2xl\">\r\n        <CardHeader>\r\n          <CardTitle>{t('cropImage')}</CardTitle>\r\n        </CardHeader>\r\n        <CardContent className=\"space-y-4\">\r\n          <div className=\"flex justify-center\">\r\n            <ReactCrop\r\n              crop={crop}\r\n              onChange={(c) => setCrop(c)}\r\n              onComplete={(c) => setCompletedCrop(c)}\r\n              aspect={undefined}\r\n              minWidth={100}\r\n            >\r\n              <img\r\n                ref={imgRef}\r\n                src={imageSrc}\r\n                alt=\"Crop\"\r\n                onLoad={onImageLoad}\r\n                className=\"max-h-[60vh]\"\r\n              />\r\n            </ReactCrop>\r\n          </div>\r\n          <div className=\"flex gap-2 justify-end pb-4\">\r\n            <Button type=\"button\" onClick={onCancel} variant=\"outline\">\r\n              {t('cancel')}\r\n            </Button>\r\n            <Button type=\"button\" onClick={handleCrop} disabled={!completedCrop}>\r\n              {t('applyCrop')}\r\n            </Button>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\tickets\\image-modal.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":28,"column":11,"nodeType":"JSXOpeningElement","endLine":32,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { XMarkIcon } from '@heroicons/react/24/outline';\r\nimport { Button } from '@/components/ui/button';\r\n\r\ninterface ImageModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  imageSrc: string;\r\n  title: string;\r\n}\r\n\r\nexport function ImageModal({ isOpen, onClose, imageSrc, title }: ImageModalProps) {\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-[9999] flex items-center justify-center bg-black/90 backdrop-blur-sm\">\r\n      <div className=\"relative w-full h-full flex items-center justify-center p-4\">\r\n        <button\r\n          type=\"button\"\r\n          onClick={onClose}\r\n          className=\"absolute top-4 right-4 z-10 text-white hover:text-gray-300 transition-colors\"\r\n          aria-label=\"Close\"\r\n        >\r\n          <XMarkIcon className=\"h-8 w-8\" />\r\n        </button>\r\n        <div className=\"relative max-w-7xl max-h-full w-full h-full flex items-center justify-center\">\r\n          <img\r\n            src={imageSrc}\r\n            alt={title}\r\n            className=\"max-w-full max-h-full object-contain\"\r\n          />\r\n          <div className=\"absolute bottom-4 left-1/2 transform -translate-x-1/2 bg-black/50 text-white px-4 py-2 rounded-lg\">\r\n            <p className=\"text-sm font-medium\">{title}</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\tickets\\image-upload.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":202,"column":17,"nodeType":"JSXOpeningElement","endLine":206,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useRef } from 'react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Card, CardContent } from '@/components/ui/card';\r\nimport { CameraIcon, PhotoIcon, XMarkIcon } from '@heroicons/react/24/outline';\r\nimport ImageCrop from './image-crop';\r\nimport { ImageModal } from './image-modal';\r\nimport { useLanguage } from '@/contexts/language-context';\r\n\r\ninterface ImageUploadProps {\r\n  label: string;\r\n  value?: string;\r\n  onChange: (base64: string) => void;\r\n  onRemove: () => void;\r\n  onCropComplete?: () => void;\r\n}\r\n\r\nexport function ImageUpload({ label, value, onChange, onRemove, onCropComplete }: ImageUploadProps) {\r\n  const { t } = useLanguage();\r\n  const [showCrop, setShowCrop] = useState(false);\r\n  const [imageSrc, setImageSrc] = useState<string | null>(null);\r\n  const [showCamera, setShowCamera] = useState(false);\r\n  const [showImageModal, setShowImageModal] = useState(false);\r\n  const fileInputRef = useRef<HTMLInputElement>(null);\r\n  const cameraInputRef = useRef<HTMLInputElement>(null);\r\n  const videoRef = useRef<HTMLVideoElement>(null);\r\n  const streamRef = useRef<MediaStream | null>(null);\r\n\r\n  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (file) {\r\n      const reader = new FileReader();\r\n      reader.onload = () => {\r\n        setImageSrc(reader.result as string);\r\n        setShowCrop(true);\r\n      };\r\n      reader.readAsDataURL(file);\r\n    }\r\n  };\r\n\r\n  const handleCameraCapture = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (file) {\r\n      const reader = new FileReader();\r\n      reader.onload = () => {\r\n        setImageSrc(reader.result as string);\r\n        setShowCrop(true);\r\n      };\r\n      reader.readAsDataURL(file);\r\n    }\r\n  };\r\n\r\n  const handleCropComplete = (croppedImage: string) => {\r\n    // Ensure the cropped image is properly saved\r\n    if (croppedImage && croppedImage.length > 0) {\r\n      onChange(croppedImage);\r\n      setShowCrop(false);\r\n      setImageSrc(null);\r\n      if (fileInputRef.current) fileInputRef.current.value = '';\r\n      if (cameraInputRef.current) cameraInputRef.current.value = '';\r\n      // Call optional callback after crop is complete\r\n      if (onCropComplete) {\r\n        // Small delay to ensure state is updated\r\n        setTimeout(() => {\r\n          onCropComplete();\r\n        }, 100);\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleCropCancel = () => {\r\n    setShowCrop(false);\r\n    setImageSrc(null);\r\n    if (fileInputRef.current) fileInputRef.current.value = '';\r\n    if (cameraInputRef.current) cameraInputRef.current.value = '';\r\n  };\r\n\r\n  const startCamera = async () => {\r\n    try {\r\n      let stream: MediaStream;\r\n      try {\r\n        // First try to get the environment camera\r\n        stream = await navigator.mediaDevices.getUserMedia({\r\n          video: { facingMode: 'environment' },\r\n        });\r\n      } catch (err) {\r\n        // If that fails (e.g. no environment camera), try any available video device\r\n        console.log('Environment camera not found or access denied, trying fallback to any video device...');\r\n        stream = await navigator.mediaDevices.getUserMedia({\r\n          video: true,\r\n        });\r\n      }\r\n\r\n      streamRef.current = stream;\r\n      setShowCamera(true);\r\n      // Wait for next tick to ensure video element is rendered\r\n      setTimeout(() => {\r\n        if (videoRef.current) {\r\n          videoRef.current.srcObject = stream;\r\n          videoRef.current.play().catch((err) => {\r\n            console.error('Error playing video:', err);\r\n          });\r\n        }\r\n      }, 100);\r\n    } catch (error) {\r\n      console.error('Error accessing camera:', error);\r\n      // Fallback to file input with capture attribute\r\n      if (cameraInputRef.current) {\r\n        cameraInputRef.current.click();\r\n      }\r\n    }\r\n  };\r\n\r\n  const stopCamera = () => {\r\n    if (streamRef.current) {\r\n      streamRef.current.getTracks().forEach((track) => track.stop());\r\n      streamRef.current = null;\r\n    }\r\n    setShowCamera(false);\r\n  };\r\n\r\n  const capturePhoto = () => {\r\n    if (videoRef.current) {\r\n      const canvas = document.createElement('canvas');\r\n      canvas.width = videoRef.current.videoWidth;\r\n      canvas.height = videoRef.current.videoHeight;\r\n      const ctx = canvas.getContext('2d');\r\n      if (ctx) {\r\n        ctx.drawImage(videoRef.current, 0, 0);\r\n        const imageData = canvas.toDataURL('image/png');\r\n        setImageSrc(imageData);\r\n        setShowCrop(true);\r\n        stopCamera();\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleMainClick = () => {\r\n    // Try to use MediaDevices API first (works on both mobile and desktop)\r\n    if (navigator.mediaDevices && typeof navigator.mediaDevices.getUserMedia === 'function') {\r\n      startCamera();\r\n    } else {\r\n      // Fallback to file input with capture attribute\r\n      if (cameraInputRef.current) {\r\n        cameraInputRef.current.click();\r\n      }\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-2\">\r\n      <Label>{label}</Label>\r\n      <div className=\"flex gap-2\">\r\n        <input\r\n          ref={fileInputRef}\r\n          type=\"file\"\r\n          accept=\"image/*\"\r\n          onChange={handleFileSelect}\r\n          className=\"hidden\"\r\n          id={`file-${label.toLowerCase().replace(/\\s+/g, '-')}`}\r\n        />\r\n        <input\r\n          ref={cameraInputRef}\r\n          type=\"file\"\r\n          accept=\"image/*\"\r\n          capture=\"environment\"\r\n          onChange={handleCameraCapture}\r\n          className=\"hidden\"\r\n          id={`camera-${label.toLowerCase().replace(/\\s+/g, '-')}`}\r\n        />\r\n        <Button\r\n          type=\"button\"\r\n          variant=\"outline\"\r\n          size=\"sm\"\r\n          onClick={handleMainClick}\r\n        >\r\n          <CameraIcon className=\"h-4 w-4 mr-2\" />\r\n          {t('takePhoto')}\r\n        </Button>\r\n        <Button\r\n          type=\"button\"\r\n          variant=\"outline\"\r\n          size=\"sm\"\r\n          onClick={() => fileInputRef.current?.click()}\r\n        >\r\n          <PhotoIcon className=\"h-4 w-4 mr-2\" />\r\n          {t('uploadFile')}\r\n        </Button>\r\n      </div>\r\n\r\n      {value && (\r\n        <Card>\r\n          <CardContent className=\"pt-4\">\r\n            <div className=\"relative\">\r\n              <button\r\n                type=\"button\"\r\n                onClick={() => setShowImageModal(true)}\r\n                className=\"w-full cursor-pointer hover:opacity-90 transition-opacity\"\r\n              >\r\n                <img\r\n                  src={value}\r\n                  alt={label}\r\n                  className=\"w-full h-48 object-contain rounded border\"\r\n                />\r\n              </button>\r\n              <Button\r\n                type=\"button\"\r\n                variant=\"ghost\"\r\n                size=\"sm\"\r\n                onClick={onRemove}\r\n                className=\"absolute top-2 right-2\"\r\n              >\r\n                <XMarkIcon className=\"h-4 w-4\" />\r\n              </Button>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      {showImageModal && value && (\r\n        <ImageModal\r\n          isOpen={showImageModal}\r\n          onClose={() => setShowImageModal(false)}\r\n          imageSrc={value}\r\n          title={label}\r\n        />\r\n      )}\r\n\r\n      {showCamera && (\r\n        <div className=\"fixed inset-0 z-[9999] flex items-center justify-center bg-black/90 backdrop-blur-sm\">\r\n          <div className=\"relative w-full max-w-2xl mx-4\">\r\n            <div className=\"bg-black rounded-lg overflow-hidden\">\r\n              <video\r\n                ref={videoRef}\r\n                autoPlay\r\n                playsInline\r\n                muted\r\n                className=\"w-full h-auto max-h-[70vh] object-contain\"\r\n                style={{ display: 'block' }}\r\n              />\r\n              <div className=\"flex gap-2 p-4 justify-center bg-gray-900\">\r\n                <Button\r\n                  type=\"button\"\r\n                  onClick={capturePhoto}\r\n                  className=\"bg-primary-600 hover:bg-primary-700 text-white\"\r\n                  size=\"lg\"\r\n                >\r\n                  <CameraIcon className=\"h-5 w-5 mr-2\" />\r\n                  {t('capturePhoto')}\r\n                </Button>\r\n                <Button\r\n                  type=\"button\"\r\n                  variant=\"outline\"\r\n                  onClick={stopCamera}\r\n                  size=\"lg\"\r\n                  className=\"bg-white/10 hover:bg-white/20 text-white border-white/20\"\r\n                >\r\n                  {t('cancel')}\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {showCrop && imageSrc && (\r\n        <ImageCrop\r\n          imageSrc={imageSrc}\r\n          onCropComplete={handleCropComplete}\r\n          onCancel={handleCropCancel}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\tickets\\new-ticket-modal.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchCustomers'. Either include it or remove the dependency array.","line":113,"column":6,"nodeType":"ArrayExpression","endLine":113,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [fetchCustomers, isOpen]","fix":{"range":[4094,4102],"text":"[fetchCustomers, isOpen]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useForm, Controller } from 'react-hook-form';\r\nimport { zodResolver } from '@hookform/resolvers/zod';\r\nimport { z } from 'zod';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input, Textarea } from '@/components/ui/input';\r\nimport { useToast } from '@/components/ui/use-toast';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { useLanguage } from '@/contexts/language-context';\r\nimport { ImageUpload } from '@/components/tickets/image-upload';\r\nimport { DeviceAutocomplete } from '@/components/tickets/device-autocomplete';\r\nimport { DeviceIssueAutocomplete } from '@/components/tickets/device-issue-autocomplete';\r\nimport { NewCustomerModal } from '@/components/customers/new-customer-modal';\r\nimport { CustomerSelect } from '@/components/customers/customer-select';\r\nimport { getCurrencySymbol } from '@/lib/currency';\r\nimport { ArrowPathIcon } from '@heroicons/react/24/outline';\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogFooter,\r\n  DialogHeader,\r\n  DialogTitle,\r\n} from '@/components/ui/dialog';\r\n\r\nconst createTicketSchema = (t: (key: string) => string) => z.object({\r\n  customerId: z.string().min(1, t('customerRequired')),\r\n  deviceBrand: z.string().min(1, t('deviceBrandRequired')),\r\n  deviceModel: z.string().min(1, t('deviceModelRequired')),\r\n  deviceIssue: z.string().min(1, t('deviceIssueRequired')),\r\n  priority: z.enum(['LOW', 'MEDIUM', 'HIGH', 'URGENT']),\r\n  estimatedPrice: z.string().refine((val) => !isNaN(parseFloat(val)) && parseFloat(val) >= 0, {\r\n    message: t('validPriceRequired'),\r\n  }),\r\n  assignedToId: z.string().optional(),\r\n  warrantyDays: z.string().optional().refine((val) => !val || (!isNaN(parseInt(val)) && parseInt(val) >= 0), {\r\n    message: t('validWarrantyDaysRequired'),\r\n  }),\r\n  warrantyText: z.string().optional(),\r\n  notes: z.string().optional(),\r\n});\r\n\r\ninterface NewTicketModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onSuccess: () => void;\r\n}\r\n\r\nexport function NewTicketModal({ isOpen, onClose, onSuccess }: NewTicketModalProps) {\r\n  const { toast } = useToast();\r\n  const { t } = useLanguage();\r\n  const [customers, setCustomers] = useState<any[]>([]);\r\n  const [staffUsers, setStaffUsers] = useState<any[]>([]);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [showNewCustomerModal, setShowNewCustomerModal] = useState(false);\r\n  const [frontImage, setFrontImage] = useState<string>('');\r\n  const [backImage, setBackImage] = useState<string>('');\r\n  const [deviceBrand, setDeviceBrand] = useState('');\r\n  const [deviceModel, setDeviceModel] = useState('');\r\n  const [currencySymbol, setCurrencySymbol] = useState('$');\r\n\r\n  const ticketSchema = createTicketSchema(t);\r\n  type TicketFormData = z.infer<typeof ticketSchema>;\r\n\r\n  const {\r\n    register,\r\n    handleSubmit,\r\n    control,\r\n    formState: { errors },\r\n    setValue,\r\n    watch,\r\n    trigger,\r\n    reset,\r\n  } = useForm<TicketFormData>({\r\n    resolver: zodResolver(ticketSchema),\r\n    defaultValues: {\r\n      priority: 'MEDIUM',\r\n      estimatedPrice: '0',\r\n    },\r\n    mode: 'onChange',\r\n  });\r\n\r\n  const fetchCustomers = () => {\r\n    fetch('/api/customers')\r\n      .then((res) => res.json())\r\n      .then((data) => {\r\n        setCustomers(data);\r\n        // Set walking-customer as default if it exists\r\n        const walkingCustomer = data.find((c: any) =>\r\n          c.id === 'walking-customer' ||\r\n          c.name.toLowerCase() === 'walking-customer' ||\r\n          c.name === 'walking-customer'\r\n        );\r\n        if (walkingCustomer) {\r\n          const currentCustomerId = watch('customerId');\r\n          if (!currentCustomerId) {\r\n            setValue('customerId', walkingCustomer.id);\r\n            trigger('customerId');\r\n          }\r\n        }\r\n      })\r\n      .catch((err) => console.error('Error fetching customers:', err));\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (isOpen) {\r\n      fetchCustomers();\r\n      fetchStaffUsers();\r\n      fetchCurrency();\r\n    }\r\n  }, [isOpen]);\r\n\r\n  const fetchCurrency = () => {\r\n    fetch('/api/settings/public')\r\n      .then((res) => res.json())\r\n      .then((data) => {\r\n        const currency = data.currency || 'USD';\r\n        setCurrencySymbol(getCurrencySymbol(currency));\r\n      })\r\n      .catch((err) => {\r\n        console.error('Error fetching currency:', err);\r\n        setCurrencySymbol('$');\r\n      });\r\n  };\r\n\r\n  const fetchStaffUsers = () => {\r\n    fetch('/api/users/staff')\r\n      .then((res) => res.json())\r\n      .then((data) => setStaffUsers(data))\r\n      .catch((err) => console.error('Error fetching staff users:', err));\r\n  };\r\n\r\n  const handleCustomerCreated = (customerId: string) => {\r\n    fetchCustomers();\r\n    setValue('customerId', customerId);\r\n  };\r\n\r\n  useEffect(() => {\r\n    setValue('deviceBrand', deviceBrand);\r\n  }, [deviceBrand, setValue]);\r\n\r\n  useEffect(() => {\r\n    setValue('deviceModel', deviceModel);\r\n  }, [deviceModel, setValue]);\r\n\r\n  const onSubmit = async (data: TicketFormData) => {\r\n    setIsLoading(true);\r\n    try {\r\n      const response = await fetch('/api/tickets', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          customerId: data.customerId,\r\n          deviceBrand: data.deviceBrand,\r\n          deviceModel: data.deviceModel,\r\n          deviceIssue: data.deviceIssue,\r\n          priority: data.priority,\r\n          estimatedPrice: parseFloat(data.estimatedPrice),\r\n          warrantyDays: data.warrantyDays && data.warrantyDays.trim() !== '' ? parseInt(data.warrantyDays) : undefined,\r\n          warrantyText: data.warrantyText || undefined,\r\n          assignedToId: data.assignedToId && data.assignedToId.trim() !== '' ? data.assignedToId : undefined,\r\n          notes: data.notes || undefined,\r\n          deviceConditionFront: frontImage && frontImage.trim() !== '' ? frontImage : undefined,\r\n          deviceConditionBack: backImage && backImage.trim() !== '' ? backImage : undefined,\r\n        }),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        const errorData = await response.json().catch(() => ({ error: 'Failed to create ticket' }));\r\n        const errorMessage = errorData.details\r\n          ? errorData.details.map((e: any) => `${e.path.join('.')}: ${e.message}`).join(', ')\r\n          : errorData.error || 'Failed to create ticket';\r\n        throw new Error(errorMessage);\r\n      }\r\n\r\n      const ticket = await response.json();\r\n      toast({\r\n        title: t('success'),\r\n        description: t('ticketCreated'),\r\n      });\r\n      reset();\r\n      setFrontImage('');\r\n      setBackImage('');\r\n      setDeviceBrand('');\r\n      setDeviceModel('');\r\n      onSuccess();\r\n      onClose();\r\n    } catch (error: any) {\r\n      console.error('Error creating ticket:', error);\r\n      toast({\r\n        title: t('error'),\r\n        description: error.message || t('ticketCreateFailed'),\r\n      });\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <Dialog open={isOpen} onOpenChange={onClose}>\r\n        <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\r\n          <DialogHeader>\r\n            <DialogTitle>{t('createNewTicket')}</DialogTitle>\r\n            <DialogDescription>{t('createNewRepairTicket')}</DialogDescription>\r\n          </DialogHeader>\r\n\r\n          <form onSubmit={handleSubmit(onSubmit)}>\r\n            <div className=\"space-y-6 py-4\">\r\n              <div className=\"flex gap-2 items-start\">\r\n                <div className=\"flex-1\">\r\n                  <Controller\r\n                    name=\"customerId\"\r\n                    control={control}\r\n                    rules={{ required: t('customerRequired') }}\r\n                    render={({ field, fieldState }) => (\r\n                      <CustomerSelect\r\n                        customers={customers}\r\n                        value={field.value || ''}\r\n                        onChange={field.onChange}\r\n                        error={fieldState.error?.message}\r\n                      />\r\n                    )}\r\n                  />\r\n                </div>\r\n                <Button\r\n                  type=\"button\"\r\n                  variant=\"outline\"\r\n                  onClick={() => setShowNewCustomerModal(true)}\r\n                  className=\"mt-0 h-auto py-3 text-base\"\r\n                >\r\n                  {t('newCustomer')}\r\n                </Button>\r\n              </div>\r\n\r\n              <DeviceAutocomplete\r\n                brand={deviceBrand}\r\n                model={deviceModel}\r\n                onBrandChange={setDeviceBrand}\r\n                onModelChange={setDeviceModel}\r\n                brandError={errors.deviceBrand?.message}\r\n                modelError={errors.deviceModel?.message}\r\n              />\r\n\r\n              <Controller\r\n                name=\"deviceIssue\"\r\n                control={control}\r\n                rules={{ required: t('deviceIssueRequired') }}\r\n                render={({ field, fieldState }) => (\r\n                  <DeviceIssueAutocomplete\r\n                    value={field.value || ''}\r\n                    onChange={field.onChange}\r\n                    error={fieldState.error?.message}\r\n                  />\r\n                )}\r\n              />\r\n\r\n              <div className=\"grid grid-cols-2 gap-4\">\r\n                <ImageUpload\r\n                  label={t('deviceFrontPhoto')}\r\n                  value={frontImage}\r\n                  onChange={setFrontImage}\r\n                  onRemove={() => setFrontImage('')}\r\n                />\r\n                <ImageUpload\r\n                  label={t('deviceBackPhoto')}\r\n                  value={backImage}\r\n                  onChange={setBackImage}\r\n                  onRemove={() => setBackImage('')}\r\n                />\r\n              </div>\r\n\r\n              <div className=\"grid grid-cols-2 gap-4\">\r\n                <Controller\r\n                  name=\"priority\"\r\n                  control={control}\r\n                  render={({ field, fieldState }) => (\r\n                    <Select value={field.value || 'MEDIUM'} onValueChange={field.onChange}>\r\n                      <SelectTrigger\r\n                        label={t('priority')}\r\n                        error={!!fieldState.error}\r\n                        id=\"modal-ticket-priority\"\r\n                      >\r\n                        <SelectValue placeholder={t('selectPriority')} />\r\n                      </SelectTrigger>\r\n                      <SelectContent>\r\n                        <SelectItem value=\"LOW\">{t('low')}</SelectItem>\r\n                        <SelectItem value=\"MEDIUM\">{t('medium')}</SelectItem>\r\n                        <SelectItem value=\"HIGH\">{t('high')}</SelectItem>\r\n                        <SelectItem value=\"URGENT\">{t('urgent')}</SelectItem>\r\n                      </SelectContent>\r\n                    </Select>\r\n                  )}\r\n                />\r\n\r\n                <Input\r\n                  id=\"modal-ticket-estimatedPrice\"\r\n                  label={`${t('estimatedPrice')} (${currencySymbol})`}\r\n                  errorText={errors.estimatedPrice?.message}\r\n                  type=\"number\"\r\n                  step=\"0.01\"\r\n                  required\r\n                  {...register('estimatedPrice')}\r\n                  placeholder=\"0.00\"\r\n                />\r\n              </div>\r\n\r\n              <Controller\r\n                name=\"assignedToId\"\r\n                control={control}\r\n                render={({ field, fieldState }) => (\r\n                  <Select\r\n                    value={field.value || undefined}\r\n                    onValueChange={(value) => {\r\n                      field.onChange(value === 'unassigned' ? undefined : value);\r\n                    }}\r\n                  >\r\n                    <SelectTrigger\r\n                      label={t('assignToOptional')}\r\n                      error={!!fieldState.error}\r\n                      id=\"modal-ticket-assignedToId\"\r\n                    >\r\n                      <SelectValue placeholder={t('unassigned')} />\r\n                    </SelectTrigger>\r\n                    <SelectContent>\r\n                      <SelectItem value=\"unassigned\">{t('unassigned')}</SelectItem>\r\n                      {staffUsers.map((user) => (\r\n                        <SelectItem key={user.id} value={user.id}>\r\n                          {user.name || user.username} ({user.role})\r\n                        </SelectItem>\r\n                      ))}\r\n                    </SelectContent>\r\n                  </Select>\r\n                )}\r\n              />\r\n\r\n              <div className=\"grid grid-cols-2 gap-4\">\r\n                <Input\r\n                  id=\"modal-ticket-warrantyDays\"\r\n                  label={`${t('warrantyDays')} (${t('optional')})`}\r\n                  errorText={errors.warrantyDays?.message}\r\n                  type=\"number\"\r\n                  min=\"0\"\r\n                  {...register('warrantyDays')}\r\n                  placeholder=\"e.g., 30, 90, 180\"\r\n                />\r\n\r\n                <Input\r\n                  id=\"modal-ticket-warrantyText\"\r\n                  label={`${t('warrantyText')} (${t('optional')})`}\r\n                  errorText={errors.warrantyText?.message}\r\n                  {...register('warrantyText')}\r\n                  placeholder=\"e.g., 30 days warranty on parts and labor\"\r\n                />\r\n              </div>\r\n\r\n              <Textarea\r\n                id=\"modal-ticket-notes\"\r\n                label={t('notes')}\r\n                errorText={errors.notes?.message}\r\n                rows={3}\r\n                {...register('notes')}\r\n                placeholder={t('customers.placeholder.notes')}\r\n              />\r\n            </div>\r\n\r\n            <DialogFooter className=\"gap-3\">\r\n              <Button type=\"button\" variant=\"outline\" onClick={onClose}>\r\n                {t('cancel')}\r\n              </Button>\r\n              <Button type=\"submit\" disabled={isLoading}>\r\n                {isLoading ? (\r\n                  <span className=\"flex items-center gap-2\">\r\n                    <ArrowPathIcon className=\"h-4 w-4 animate-spin\" />\r\n                    {t('creating')}\r\n                  </span>\r\n                ) : (\r\n                  t('createTicket')\r\n                )}\r\n              </Button>\r\n            </DialogFooter>\r\n          </form>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      <NewCustomerModal\r\n        isOpen={showNewCustomerModal}\r\n        onClose={() => setShowNewCustomerModal(false)}\r\n        onSuccess={handleCustomerCreated}\r\n      />\r\n    </>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\tickets\\new-ticket-wizard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\tickets\\no-tickets-found.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\tickets\\price-adjustment.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\tickets\\receipt-template.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\tickets\\return-handler.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\tickets\\status-progress-bar.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'executeTransition'. Either include it or remove the dependency array.","line":312,"column":8,"nodeType":"ArrayExpression","endLine":312,"endColumn":150,"suggestions":[{"desc":"Update the dependencies array to be: [isUpdating, isTerminal, ticket.status, getModalForStatus, checkTransition, executeTransition, onOpenPartsModal, onOpenPaymentModal, onOpenReturnModal, toast, t]","fix":{"range":[10275,10417],"text":"[isUpdating, isTerminal, ticket.status, getModalForStatus, checkTransition, executeTransition, onOpenPartsModal, onOpenPaymentModal, onOpenReturnModal, toast, t]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'executeTransition'. Either include it or remove the dependency array.","line":369,"column":8,"nodeType":"ArrayExpression","endLine":369,"endColumn":35,"suggestions":[{"desc":"Update the dependencies array to be: [checkTransition, executeTransition, t, toast]","fix":{"range":[12292,12319],"text":"[checkTransition, executeTransition, t, toast]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useMemo, useCallback, useEffect } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { useToast } from '@/components/ui/use-toast';\r\nimport { useLanguage } from '@/contexts/language-context';\r\nimport {\r\n    TicketStatus,\r\n    getAllowedTransitionsForRole,\r\n    canTransition,\r\n    hasPermission,\r\n} from '@/lib/ticket-lifecycle';\r\nimport {\r\n    InboxIcon,\r\n    WrenchScrewdriverIcon,\r\n    ClockIcon,\r\n    CheckCircleIcon,\r\n    ShieldCheckIcon,\r\n    XCircleIcon,\r\n    ArrowUturnLeftIcon,\r\n    CheckIcon,\r\n    MinusIcon,\r\n    ExclamationTriangleIcon,\r\n    BanknotesIcon,\r\n    PlusCircleIcon,\r\n    PencilIcon,\r\n    PlayIcon,\r\n    ChatBubbleLeftIcon,\r\n    XMarkIcon,\r\n    InformationCircleIcon,\r\n    ArrowPathIcon,\r\n} from '@heroicons/react/24/outline';\r\n\r\n\r\n// Extended ticket type for full functionality\r\ninterface TicketPart {\r\n    id: string;\r\n    partId: string;\r\n    quantity: number;\r\n    part: {\r\n        id: string;\r\n        name: string;\r\n        sku: string;\r\n        unitPrice: number;\r\n    };\r\n}\r\n\r\ninterface StatusProgressBarProps {\r\n    ticket: {\r\n        id: string;\r\n        ticketNumber: string;\r\n        status: string;\r\n        paid: boolean;\r\n        finalPrice: number | null;\r\n        estimatedPrice: number;\r\n        outstandingAmount?: number;\r\n        totalPaid?: number;\r\n        customer: {\r\n            name: string;\r\n            phone: string;\r\n        };\r\n        parts?: TicketPart[];\r\n        returns?: any[];\r\n        trackingCode: string;\r\n    };\r\n    userRole: string;\r\n    onStatusChange?: () => void;\r\n    // Modal callbacks - parent controls modal rendering\r\n    onOpenPartsModal?: () => void;\r\n    onOpenPaymentModal?: () => void;\r\n    onOpenReturnModal?: () => void;\r\n    onOpenSMSPrompt?: () => void;\r\n}\r\n\r\n// Define the 5-step progress flow with Heroicon components\r\nconst PROGRESS_STEPS = [\r\n    {\r\n        status: TicketStatus.RECEIVED,\r\n        Icon: InboxIcon,\r\n        label: 'received',\r\n        description: 'Device received',\r\n    },\r\n    {\r\n        status: TicketStatus.IN_PROGRESS,\r\n        Icon: WrenchScrewdriverIcon,\r\n        label: 'inProgress',\r\n        description: 'Repair in progress',\r\n    },\r\n    {\r\n        status: TicketStatus.WAITING_FOR_PARTS,\r\n        Icon: ClockIcon,\r\n        label: 'waitingForParts',\r\n        description: 'Awaiting parts',\r\n    },\r\n    {\r\n        status: TicketStatus.REPAIRED,\r\n        Icon: CheckCircleIcon,\r\n        label: 'repaired',\r\n        description: 'Repair complete',\r\n    },\r\n    {\r\n        status: TicketStatus.COMPLETED,\r\n        Icon: ShieldCheckIcon,\r\n        label: 'completed',\r\n        description: 'Delivered to customer',\r\n    },\r\n];\r\n\r\n// Terminal states\r\nconst TERMINAL_STATES = [TicketStatus.CANCELLED, TicketStatus.RETURNED];\r\n\r\n// Modal trigger mapping\r\ntype ModalType = 'parts' | 'payment' | 'return' | 'cancel' | null;\r\n\r\nconst STATUS_MODAL_MAP: Record<string, ModalType> = {\r\n    [TicketStatus.IN_PROGRESS]: 'parts',\r\n    [TicketStatus.WAITING_FOR_PARTS]: 'parts',\r\n    [TicketStatus.REPAIRED]: 'payment',\r\n    [TicketStatus.COMPLETED]: 'return',\r\n};\r\n\r\nexport function StatusProgressBar({\r\n    ticket,\r\n    userRole,\r\n    onStatusChange,\r\n    onOpenPartsModal,\r\n    onOpenPaymentModal,\r\n    onOpenReturnModal,\r\n    onOpenSMSPrompt,\r\n}: StatusProgressBarProps) {\r\n    const router = useRouter();\r\n    const { toast } = useToast();\r\n    const { t } = useLanguage();\r\n\r\n    const [isUpdating, setIsUpdating] = useState(false);\r\n    const [cancelReason, setCancelReason] = useState('');\r\n    const [showCancelModal, setShowCancelModal] = useState(false);\r\n    const [justUpdated, setJustUpdated] = useState(false);\r\n\r\n    // Reset animation after a delay\r\n    useEffect(() => {\r\n        if (justUpdated) {\r\n            const timer = setTimeout(() => setJustUpdated(false), 3000);\r\n            return () => clearTimeout(timer);\r\n        }\r\n    }, [justUpdated]);\r\n\r\n    // Calculate outstanding amount\r\n    const outstandingAmount = useMemo(() => {\r\n        if (ticket.outstandingAmount !== undefined) return ticket.outstandingAmount;\r\n        const finalPrice = ticket.finalPrice ?? ticket.estimatedPrice;\r\n        const totalPaid = ticket.totalPaid ?? (ticket.paid ? finalPrice : 0);\r\n        return Math.max(0, finalPrice - totalPaid);\r\n    }, [ticket]);\r\n\r\n    // Check if payment is due\r\n    const isPaymentDue = outstandingAmount > 0;\r\n\r\n    // Check if parts are linked\r\n    const hasParts = (ticket.parts?.length ?? 0) > 0;\r\n\r\n    // Check if in terminal state\r\n    const isTerminal = TERMINAL_STATES.includes(ticket.status as any);\r\n\r\n    // Role checks for UI restrictions\r\n    const isAdmin = userRole === 'ADMIN';\r\n    const isTechnician = userRole === 'TECHNICIAN';\r\n\r\n    // Get current step index - handle flow where WAITING_FOR_PARTS can be skipped\r\n    const currentStepIndex = useMemo(() => {\r\n        const idx = PROGRESS_STEPS.findIndex(s => s.status === ticket.status);\r\n        return idx >= 0 ? idx : 0;\r\n    }, [ticket.status]);\r\n\r\n    // Get progress percentage for the connecting line\r\n    const progressPercentage = useMemo(() => {\r\n        // Skip WAITING_FOR_PARTS in calculation if we went directly to REPAIRED\r\n        if (ticket.status === TicketStatus.REPAIRED || ticket.status === TicketStatus.COMPLETED) {\r\n            // If no parts, we skipped WAITING_FOR_PARTS\r\n            const actualSteps = hasParts ? currentStepIndex : currentStepIndex - 1;\r\n            const totalSteps = hasParts ? PROGRESS_STEPS.length - 1 : PROGRESS_STEPS.length - 2;\r\n            return (actualSteps / totalSteps) * 100;\r\n        }\r\n        return (currentStepIndex / (PROGRESS_STEPS.length - 1)) * 100;\r\n    }, [currentStepIndex, ticket.status, hasParts]);\r\n\r\n    // Get allowed transitions for current user\r\n    const allowedTransitions = useMemo(() => {\r\n        return getAllowedTransitionsForRole(ticket.status, userRole);\r\n    }, [ticket.status, userRole]);\r\n\r\n    // Check if a transition is valid\r\n    const checkTransition = useCallback((targetStatus: string) => {\r\n        return canTransition({\r\n            current: ticket.status as any,\r\n            target: targetStatus as any,\r\n            role: userRole,\r\n            paymentStatus: {\r\n                paid: ticket.paid,\r\n                outstandingAmount,\r\n            },\r\n        });\r\n    }, [ticket.status, ticket.paid, outstandingAmount, userRole]);\r\n\r\n    // Get step visual state\r\n    const getStepState = useCallback((stepIndex: number, stepStatus: string) => {\r\n        if (isTerminal) return 'terminal';\r\n\r\n        // Special case: When COMPLETED, all steps show as completed\r\n        if (ticket.status === TicketStatus.COMPLETED) {\r\n            // WAITING_FOR_PARTS might have been skipped\r\n            if (stepStatus === TicketStatus.WAITING_FOR_PARTS && !hasParts) {\r\n                return 'skipped';\r\n            }\r\n            return 'completed';\r\n        }\r\n\r\n        // Check if this step was completed\r\n        if (stepIndex < currentStepIndex) {\r\n            // Special case: WAITING_FOR_PARTS was skipped\r\n            if (stepStatus === TicketStatus.WAITING_FOR_PARTS && !hasParts &&\r\n                (ticket.status === TicketStatus.REPAIRED || ticket.status === TicketStatus.COMPLETED)) {\r\n                return 'skipped';\r\n            }\r\n            return 'completed';\r\n        }\r\n\r\n        // Current step\r\n        if (stepStatus === ticket.status) {\r\n            // Show warning indicator if payment is due on REPAIRED\r\n            if (stepStatus === TicketStatus.REPAIRED && isPaymentDue) {\r\n                return 'current-warning';\r\n            }\r\n            return 'current';\r\n        }\r\n\r\n        // Check if clickable\r\n        const result = checkTransition(stepStatus);\r\n        if (result.allowed) return 'available';\r\n\r\n        return 'locked';\r\n    }, [currentStepIndex, ticket.status, isTerminal, hasParts, isPaymentDue, checkTransition]);\r\n\r\n    // Determine which modal to open for a status click/re-click\r\n    const getModalForStatus = useCallback((status: string, isReClick: boolean): ModalType => {\r\n        if (status === TicketStatus.CANCELLED) return 'cancel';\r\n\r\n        // Re-click opens modal for current status\r\n        if (isReClick) {\r\n            return STATUS_MODAL_MAP[status] || null;\r\n        }\r\n\r\n        // Forward click: WAITING_FOR_PARTS opens parts modal\r\n        if (status === TicketStatus.WAITING_FOR_PARTS) return 'parts';\r\n\r\n        // COMPLETED requires payment check\r\n        if (status === TicketStatus.COMPLETED && isPaymentDue) return 'payment';\r\n\r\n        return null;\r\n    }, [isPaymentDue]);\r\n\r\n    // Handle step click/re-click\r\n    const handleStepClick = useCallback(async (stepStatus: string) => {\r\n        if (isUpdating || isTerminal) return;\r\n\r\n        const isReClick = stepStatus === ticket.status;\r\n        const modalType = getModalForStatus(stepStatus, isReClick);\r\n\r\n        // Handle re-click behavior - open corresponding modal\r\n        if (isReClick) {\r\n            switch (modalType) {\r\n                case 'parts':\r\n                    onOpenPartsModal?.();\r\n                    return;\r\n                case 'payment':\r\n                    onOpenPaymentModal?.();\r\n                    return;\r\n                case 'return':\r\n                    onOpenReturnModal?.();\r\n                    return;\r\n                default:\r\n                    return; // No modal for this status\r\n            }\r\n        }\r\n\r\n        // Forward click - check if allowed\r\n        const result = checkTransition(stepStatus);\r\n        if (!result.allowed) {\r\n            toast({\r\n                title: t('error'),\r\n                description: result.reason || t('transitionNotAllowed'),\r\n                variant: 'destructive',\r\n            });\r\n            return;\r\n        }\r\n\r\n        // Open modal if needed before transition\r\n        switch (modalType) {\r\n            case 'cancel':\r\n                setShowCancelModal(true);\r\n                return;\r\n            case 'parts':\r\n                onOpenPartsModal?.();\r\n                return;\r\n            case 'payment':\r\n                onOpenPaymentModal?.();\r\n                return;\r\n        }\r\n\r\n        // Direct transition without modal\r\n        await executeTransition(stepStatus);\r\n    }, [ticket.status, isUpdating, isTerminal, getModalForStatus, checkTransition, onOpenPartsModal, onOpenPaymentModal, onOpenReturnModal, toast, t]);\r\n\r\n    // Execute status transition\r\n    const executeTransition = async (targetStatus: string, notes?: string) => {\r\n        setIsUpdating(true);\r\n\r\n        try {\r\n            const response = await fetch(`/api/tickets/${ticket.id}`, {\r\n                method: 'PATCH',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({\r\n                    status: targetStatus,\r\n                    statusNotes: notes || undefined,\r\n                }),\r\n            });\r\n\r\n            const data = await response.json();\r\n\r\n            if (!response.ok) {\r\n                throw new Error(data.error || 'Failed to update status');\r\n            }\r\n\r\n            toast({\r\n                title: t('success'),\r\n                description: t('ticketStatusUpdated'),\r\n            });\r\n\r\n            setShowCancelModal(false);\r\n            setCancelReason('');\r\n            setJustUpdated(true);\r\n\r\n            onStatusChange?.();\r\n            router.refresh();\r\n        } catch (error) {\r\n            toast({\r\n                title: t('error'),\r\n                description: error instanceof Error ? error.message : t('failedToUpdateTicketStatus'),\r\n                variant: 'destructive',\r\n            });\r\n        } finally {\r\n            setIsUpdating(false);\r\n        }\r\n    };\r\n\r\n    // Handle \"No Parts Required\" skip\r\n    const handleSkipParts = useCallback(async () => {\r\n        // Transition directly to REPAIRED\r\n        const result = checkTransition(TicketStatus.REPAIRED);\r\n        if (result.allowed) {\r\n            await executeTransition(TicketStatus.REPAIRED, t('ticket.noPartsRequired'));\r\n        } else {\r\n            toast({\r\n                title: t('error'),\r\n                description: result.reason || t('transitionNotAllowed'),\r\n                variant: 'destructive',\r\n            });\r\n        }\r\n    }, [checkTransition, toast, t]);\r\n\r\n    // Handle cancel confirmation\r\n    const handleCancelConfirm = () => {\r\n        if (!cancelReason.trim()) {\r\n            toast({\r\n                title: t('error'),\r\n                description: t('cancelReasonRequired'),\r\n                variant: 'destructive',\r\n            });\r\n            return;\r\n        }\r\n        executeTransition(TicketStatus.CANCELLED, cancelReason);\r\n    };\r\n\r\n    // Get tooltip for step\r\n    const getStepTooltip = (step: typeof PROGRESS_STEPS[0], stepState: string) => {\r\n        if (stepState === 'completed') return `Ô£ô ${t(step.label) || step.description}`;\r\n        if (stepState === 'skipped') return t('ticket.skippedNoParts');\r\n        if (stepState === 'current') return t('currentStatus');\r\n        if (stepState === 'current-warning') return t('paymentRequiredToComplete');\r\n        if (stepState === 'available') return t('clickToAdvance');\r\n        if (stepState === 'locked') {\r\n            // Show role-specific message for TECHNICIAN trying to access COMPLETED\r\n            if (step.status === TicketStatus.COMPLETED && isTechnician) {\r\n                return t('staffOnlyAction');\r\n            }\r\n            if (step.status === TicketStatus.COMPLETED && isPaymentDue) {\r\n                return t('paymentRequiredToComplete');\r\n            }\r\n            return t('stepLocked');\r\n        }\r\n        return step.description;\r\n    };\r\n\r\n    // Get step circle classes\r\n    const getStepClasses = (stepState: string) => {\r\n        const base = 'relative z-10 flex items-center justify-center w-12 h-12 rounded-full border-2 transition-all duration-300';\r\n\r\n        switch (stepState) {\r\n            case 'completed':\r\n                return `${base} bg-green-500 border-green-500 text-white`;\r\n            case 'skipped':\r\n                return `${base} bg-gray-200 dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-400 dark:text-gray-500`;\r\n            case 'current':\r\n                return `${base} bg-primary-500 border-primary-500 text-white ring-4 ring-primary-100 dark:ring-primary-900 cursor-pointer`;\r\n            case 'current-warning':\r\n                return `${base} bg-amber-500 border-amber-500 text-white ring-4 ring-amber-100 dark:ring-amber-900 cursor-pointer`;\r\n            case 'available':\r\n                return `${base} bg-white dark:bg-gray-800 border-primary-400 dark:border-primary-500 text-primary-600 dark:text-primary-400 hover:bg-primary-50 dark:hover:bg-primary-900/30 cursor-pointer hover:scale-110 ${justUpdated ? 'animate-pulse ring-2 ring-primary-400 ring-offset-2 dark:ring-offset-gray-900' : ''}`;\r\n            case 'terminal':\r\n                return `${base} bg-gray-100 dark:bg-gray-800 border-gray-300 dark:border-gray-600 text-gray-400`;\r\n            default:\r\n                return `${base} bg-gray-100 dark:bg-gray-800 border-gray-300 dark:border-gray-600 text-gray-400 dark:text-gray-500`;\r\n        }\r\n    };\r\n\r\n    // Get step icon\r\n    const getStepIcon = (step: typeof PROGRESS_STEPS[0], stepState: string) => {\r\n        if (stepState === 'completed') return CheckIcon;\r\n        if (stepState === 'skipped') return MinusIcon;\r\n        if (stepState === 'current-warning') return ExclamationTriangleIcon;\r\n        return step.Icon;\r\n    };\r\n\r\n    // Format status label\r\n    const formatStatus = (key: string) => {\r\n        return t(key) || key.replace(/_/g, ' ').split(' ').map(s => s.charAt(0).toUpperCase() + s.slice(1).toLowerCase()).join(' ');\r\n    };\r\n\r\n    return (\r\n        <div className=\"w-full space-y-4\">\r\n            {/* Terminal State Banner */}\r\n            {isTerminal && (\r\n                <div className={`flex items-center justify-center gap-2 px-4 py-3 rounded-lg ${ticket.status === TicketStatus.CANCELLED\r\n                    ? 'bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300 border border-red-200 dark:border-red-800'\r\n                    : 'bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 border border-purple-200 dark:border-purple-800'\r\n                    }`}>\r\n                    {ticket.status === TicketStatus.CANCELLED ? (\r\n                        <XCircleIcon className=\"h-5 w-5\" />\r\n                    ) : (\r\n                        <ArrowUturnLeftIcon className=\"h-5 w-5\" />\r\n                    )}\r\n                    <span className=\"font-medium uppercase tracking-wide text-sm\">\r\n                        {formatStatus(ticket.status.toLowerCase().replace(/_/g, ''))}\r\n                    </span>\r\n                    <span className=\"text-sm opacity-75\">ÔÇö {t('ticketTerminalState')}</span>\r\n                </div>\r\n            )}\r\n\r\n            {/* Progress Bar - Responsive: vertical on mobile, horizontal on desktop */}\r\n            {!isTerminal && (\r\n                <div className=\"relative pb-2\">\r\n                    {/* Desktop: Horizontal Connection Line Background */}\r\n                    <div className=\"hidden md:block absolute top-6 left-6 right-6 h-0.5 bg-gray-200 dark:bg-gray-700\" />\r\n\r\n                    {/* Desktop: Horizontal Connection Line Progress */}\r\n                    <div\r\n                        className=\"hidden md:block absolute top-6 left-6 h-0.5 bg-primary-500 transition-all duration-500\"\r\n                        style={{ width: `calc(${progressPercentage}% - 3rem)` }}\r\n                    />\r\n\r\n                    {/* Mobile: Vertical Connection Line Background */}\r\n                    <div className=\"md:hidden absolute top-0 bottom-0 left-6 w-0.5 bg-gray-200 dark:bg-gray-700\" />\r\n\r\n                    {/* Mobile: Vertical Connection Line Progress */}\r\n                    <div\r\n                        className=\"md:hidden absolute top-0 left-6 w-0.5 bg-primary-500 transition-all duration-500\"\r\n                        style={{ height: `calc(${progressPercentage}%)` }}\r\n                    />\r\n\r\n                    {/* Steps - Responsive flex direction */}\r\n                    <div className=\"relative flex flex-col md:flex-row md:justify-between gap-4 md:gap-0\">\r\n                        {PROGRESS_STEPS.map((step, index) => {\r\n                            const stepState = getStepState(index, step.status);\r\n                            const isClickable = stepState === 'available' || stepState === 'current' || stepState === 'current-warning';\r\n\r\n                            return (\r\n                                <div\r\n                                    key={step.status}\r\n                                    className=\"flex items-center md:flex-col md:items-center group gap-3 md:gap-0\"\r\n                                >\r\n                                    {/* Step Circle */}\r\n                                    <button\r\n                                        onClick={() => handleStepClick(step.status)}\r\n                                        disabled={isUpdating || (!isClickable && stepState !== 'completed')}\r\n                                        title={getStepTooltip(step, stepState)}\r\n                                        className={`${getStepClasses(stepState)} ${isUpdating ? 'opacity-50 cursor-wait' : ''} shrink-0`}\r\n                                    >\r\n                                        {(() => {\r\n                                            const StepIcon = getStepIcon(step, stepState);\r\n                                            return <StepIcon className=\"h-5 w-5\" />;\r\n                                        })()}\r\n\r\n                                        {/* Parts count badge - positioned on circle */}\r\n                                        {step.status === TicketStatus.WAITING_FOR_PARTS && hasParts && (\r\n                                            <span className=\"absolute -top-1 -right-1 bg-orange-500 text-white text-xs w-5 h-5 rounded-full flex items-center justify-center font-bold\">\r\n                                                {ticket.parts?.length}\r\n                                            </span>\r\n                                        )}\r\n                                    </button>\r\n\r\n                                    {/* Step Content - Label and indicators */}\r\n                                    <div className=\"flex flex-col md:items-center\">\r\n                                        {/* Step Label */}\r\n                                        <span className={`md:mt-2 text-sm md:text-xs font-medium md:text-center md:max-w-[70px] leading-tight ${stepState === 'current' || stepState === 'current-warning'\r\n                                            ? 'text-primary-600 dark:text-primary-400'\r\n                                            : stepState === 'completed'\r\n                                                ? 'text-green-600 dark:text-green-400'\r\n                                                : stepState === 'skipped'\r\n                                                    ? 'text-gray-400 dark:text-gray-500 line-through'\r\n                                                    : 'text-gray-500 dark:text-gray-400'\r\n                                            }`}>\r\n                                            {formatStatus(step.label)}\r\n                                        </span>\r\n\r\n                                        {/* Mobile: Step description */}\r\n                                        <span className=\"md:hidden text-xs text-gray-400 dark:text-gray-500\">\r\n                                            {step.description}\r\n                                        </span>\r\n\r\n                                        {/* Payment due indicator on REPAIRED */}\r\n                                        {step.status === TicketStatus.REPAIRED && stepState === 'current-warning' && (\r\n                                            <span className=\"text-xs text-amber-600 dark:text-amber-400 whitespace-nowrap font-medium mt-0.5\">\r\n                                                ${outstandingAmount.toFixed(0)} {t('due')}\r\n                                            </span>\r\n                                        )}\r\n                                    </div>\r\n\r\n                                    {/* Desktop: Tooltip on hover */}\r\n                                    <div className=\"hidden md:block absolute -top-8 opacity-0 group-hover:opacity-100 transition-opacity bg-gray-900 dark:bg-gray-100 text-white dark:text-gray-900 text-xs px-2 py-1 rounded whitespace-nowrap pointer-events-none z-20\">\r\n                                        {getStepTooltip(step, stepState)}\r\n                                    </div>\r\n                                </div>\r\n                            );\r\n                        })}\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Payment Warning Banner */}\r\n            {ticket.status === TicketStatus.REPAIRED && isPaymentDue && (\r\n                <div className=\"flex items-center gap-3 p-3 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg\">\r\n                    <BanknotesIcon className=\"h-6 w-6 text-amber-600 dark:text-amber-400\" />\r\n                    <div className=\"flex-1\">\r\n                        <p className=\"text-sm font-medium text-amber-800 dark:text-amber-200\">\r\n                            {t('outstandingBalance')}: ${outstandingAmount.toFixed(2)}\r\n                        </p>\r\n                        <p className=\"text-xs text-amber-700 dark:text-amber-300\">\r\n                            {t('paymentRequiredMessage')}\r\n                        </p>\r\n                    </div>\r\n                    <button\r\n                        onClick={() => onOpenPaymentModal?.()}\r\n                        className=\"px-3 py-1.5 text-sm font-medium text-white bg-amber-600 hover:bg-amber-700 rounded-md transition-colors\"\r\n                    >\r\n                        {t('collectPayment')}\r\n                    </button>\r\n                </div>\r\n            )}\r\n\r\n            {/* Action Bar */}\r\n            <div className=\"flex flex-wrap items-center justify-center gap-2 pt-3 border-t border-gray-100 dark:border-gray-800\">\r\n\r\n                {/* Current status-specific actions */}\r\n                {ticket.status === TicketStatus.IN_PROGRESS && (\r\n                    <>\r\n                        <button\r\n                            onClick={() => onOpenPartsModal?.()}\r\n                            className=\"inline-flex items-center gap-1 px-3 py-1.5 text-sm font-medium text-orange-700 dark:text-orange-300 bg-orange-50 dark:bg-orange-900/30 hover:bg-orange-100 dark:hover:bg-orange-900/50 rounded-md transition-colors\"\r\n                        >\r\n                            <PlusCircleIcon className=\"h-4 w-4\" />\r\n                            {t('addParts')}\r\n                        </button>\r\n                        <button\r\n                            onClick={handleSkipParts}\r\n                            disabled={isUpdating}\r\n                            className=\"inline-flex items-center gap-1 px-3 py-1.5 text-sm font-medium text-green-700 dark:text-green-300 bg-green-50 dark:bg-green-900/30 hover:bg-green-100 dark:hover:bg-green-900/50 rounded-md transition-colors\"\r\n                        >\r\n                            <CheckCircleIcon className=\"h-4 w-4\" />\r\n                            {t('markRepaired')}\r\n                        </button>\r\n                    </>\r\n                )}\r\n\r\n                {ticket.status === TicketStatus.WAITING_FOR_PARTS && (\r\n                    <>\r\n                        <button\r\n                            onClick={() => onOpenPartsModal?.()}\r\n                            className=\"inline-flex items-center gap-1 px-3 py-1.5 text-sm font-medium text-orange-700 dark:text-orange-300 bg-orange-50 dark:bg-orange-900/30 hover:bg-orange-100 dark:hover:bg-orange-900/50 rounded-md transition-colors\"\r\n                        >\r\n                            <PencilIcon className=\"h-4 w-4\" />\r\n                            {t('manageParts')}\r\n                        </button>\r\n                        <button\r\n                            onClick={() => handleStepClick(TicketStatus.IN_PROGRESS)}\r\n                            disabled={isUpdating}\r\n                            className=\"inline-flex items-center gap-1 px-3 py-1.5 text-sm font-medium text-blue-700 dark:text-blue-300 bg-blue-50 dark:bg-blue-900/30 hover:bg-blue-100 dark:hover:bg-blue-900/50 rounded-md transition-colors\"\r\n                        >\r\n                            <PlayIcon className=\"h-4 w-4\" />\r\n                            {t('resumeWork')}\r\n                        </button>\r\n                        <button\r\n                            onClick={() => handleStepClick(TicketStatus.REPAIRED)}\r\n                            disabled={isUpdating}\r\n                            className=\"inline-flex items-center gap-1 px-3 py-1.5 text-sm font-medium text-green-700 dark:text-green-300 bg-green-50 dark:bg-green-900/30 hover:bg-green-100 dark:hover:bg-green-900/50 rounded-md transition-colors\"\r\n                        >\r\n                            <CheckCircleIcon className=\"h-4 w-4\" />\r\n                            {t('partsInstalledComplete')}\r\n                        </button>\r\n                    </>\r\n                )}\r\n\r\n                {ticket.status === TicketStatus.REPAIRED && (\r\n                    <>\r\n                        {isPaymentDue ? (\r\n                            <button\r\n                                onClick={() => onOpenPaymentModal?.()}\r\n                                className=\"inline-flex items-center gap-1 px-3 py-1.5 text-sm font-medium text-amber-700 dark:text-amber-300 bg-amber-50 dark:bg-amber-900/30 hover:bg-amber-100 dark:hover:bg-amber-900/50 rounded-md transition-colors\"\r\n                            >\r\n                                <BanknotesIcon className=\"h-4 w-4\" />\r\n                                {t('collectPayment')}\r\n                            </button>\r\n                        ) : (\r\n                            <button\r\n                                onClick={() => handleStepClick(TicketStatus.COMPLETED)}\r\n                                disabled={isUpdating}\r\n                                className=\"inline-flex items-center gap-1 px-3 py-1.5 text-sm font-medium text-green-700 dark:text-green-300 bg-green-50 dark:bg-green-900/30 hover:bg-green-100 dark:hover:bg-green-900/50 rounded-md transition-colors\"\r\n                            >\r\n                                <CheckCircleIcon className=\"h-4 w-4\" />\r\n                                {t('markCompleted')}\r\n                            </button>\r\n                        )}\r\n                    </>\r\n                )}\r\n\r\n                {ticket.status === TicketStatus.COMPLETED && (\r\n                    <>\r\n                        <button\r\n                            onClick={() => onOpenSMSPrompt?.()}\r\n                            className=\"inline-flex items-center gap-1 px-3 py-1.5 text-sm font-medium text-blue-700 dark:text-blue-300 bg-blue-50 dark:bg-blue-900/30 hover:bg-blue-100 dark:hover:bg-blue-900/50 rounded-md transition-colors\"\r\n                        >\r\n                            <ChatBubbleLeftIcon className=\"h-4 w-4\" />\r\n                            {t('sendSms')}\r\n                        </button>\r\n                        <button\r\n                            onClick={() => onOpenReturnModal?.()}\r\n                            className=\"inline-flex items-center gap-1 px-3 py-1.5 text-sm font-medium text-purple-700 dark:text-purple-300 bg-purple-50 dark:bg-purple-900/30 hover:bg-purple-100 dark:hover:bg-purple-900/50 rounded-md transition-colors\"\r\n                        >\r\n                            <ArrowUturnLeftIcon className=\"h-4 w-4\" />\r\n                            {t('initiateReturn')}\r\n                        </button>\r\n                    </>\r\n                )}\r\n\r\n                {/* Cancel option - available for all roles */}\r\n                {!isTerminal && ticket.status !== TicketStatus.COMPLETED && (\r\n                    <button\r\n                        onClick={() => setShowCancelModal(true)}\r\n                        disabled={isUpdating}\r\n                        className=\"inline-flex items-center gap-1 px-3 py-1.5 text-sm font-medium text-red-700 dark:text-red-300 bg-red-50 dark:bg-red-900/30 hover:bg-red-100 dark:hover:bg-red-900/50 rounded-md transition-colors\"\r\n                    >\r\n                        <XMarkIcon className=\"h-4 w-4\" />\r\n                        {t('cancel')}\r\n                    </button>\r\n                )}\r\n            </div>\r\n\r\n            {/* Cancel Confirmation Modal */}\r\n            {showCancelModal && (\r\n                <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\">\r\n                    <div className=\"bg-white dark:bg-gray-900 rounded-lg p-6 max-w-md w-full mx-4 shadow-xl\">\r\n                        <h3 className=\"text-lg font-semibold mb-2\">\r\n                            {t('cancelTicket')}\r\n                        </h3>\r\n                        <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-4\">\r\n                            {t('cancelReasonPrompt')}\r\n                        </p>\r\n\r\n                        <textarea\r\n                            value={cancelReason}\r\n                            onChange={(e) => setCancelReason(e.target.value)}\r\n                            placeholder={t('cancelReasonPlaceholder')}\r\n                            className=\"w-full h-24 p-3 border border-gray-300 dark:border-gray-700 rounded-lg bg-white dark:bg-gray-800 text-sm resize-none focus:outline-none focus:ring-2 focus:ring-primary-500\"\r\n                            autoFocus\r\n                        />\r\n\r\n                        <div className=\"flex items-center gap-2 mt-4 p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg\">\r\n                            <InformationCircleIcon className=\"h-4 w-4 text-amber-600 dark:text-amber-400 flex-shrink-0\" />\r\n                            <p className=\"text-xs text-amber-700 dark:text-amber-300\">\r\n                                {t('refundWarningForCancelled')}\r\n                            </p>\r\n                        </div>\r\n\r\n                        <div className=\"flex justify-end gap-2 mt-4\">\r\n                            <button\r\n                                onClick={() => {\r\n                                    setShowCancelModal(false);\r\n                                    setCancelReason('');\r\n                                }}\r\n                                disabled={isUpdating}\r\n                                className=\"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md transition-colors\"\r\n                            >\r\n                                {t('goBack')}\r\n                            </button>\r\n                            <button\r\n                                onClick={handleCancelConfirm}\r\n                                disabled={isUpdating || !cancelReason.trim()}\r\n                                className=\"px-4 py-2 text-sm font-medium text-white bg-red-600 hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed rounded-md transition-colors flex items-center\"\r\n                            >\r\n                                {isUpdating ? (\r\n                                    <>\r\n                                        <ArrowPathIcon className=\"h-4 w-4 animate-spin mr-2\" />\r\n                                        {t('cancelling')}\r\n                                    </>\r\n                                ) : (\r\n                                    t('confirmCancel')\r\n                                )}\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\tickets\\ticket-assignment.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\tickets\\ticket-chat-button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\tickets\\ticket-detail-header.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\tickets\\ticket-details-client.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\tickets\\ticket-filters.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\tickets\\ticket-label-40x20.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\tickets\\ticket-main-content.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\tickets\\ticket-payment-modal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\tickets\\ticket-print-buttons.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\tickets\\ticket-print-context.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\tickets\\ticket-search.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\tickets\\ticket-sidebar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\tickets\\ticket-status-badge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\tickets\\tickets-list-header.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\tickets\\tickets-page-client.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\tickets\\tickets-table.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\tickets\\wizard\\step-customer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\tickets\\wizard\\step-device-detection.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'detectionStatus' and 'runAIDetection'. Either include them or remove the dependency array.","line":120,"column":6,"nodeType":"ArrayExpression","endLine":120,"endColumn":46,"suggestions":[{"desc":"Update the dependencies array to be: [data.backImage, isOnline, aiConfigured, detectionStatus, runAIDetection]","fix":{"range":[4459,4499],"text":"[data.backImage, isOnline, aiConfigured, detectionStatus, runAIDetection]"}}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":474,"column":17,"nodeType":"JSXOpeningElement","endLine":478,"endColumn":19},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":616,"column":19,"nodeType":"JSXOpeningElement","endLine":620,"endColumn":21},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":717,"column":39,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[27378,27380],"text":" &quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[27378,27380],"text":" &ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[27378,27380],"text":" &#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[27378,27380],"text":" &rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":717,"column":52,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[27392,27411],"text":"&quot;\r\n                "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[27392,27411],"text":"&ldquo;\r\n                "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[27392,27411],"text":"&#34;\r\n                "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[27392,27411],"text":"&rdquo;\r\n                "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":760,"column":39,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[29228,29230],"text":" &quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[29228,29230],"text":" &ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[29228,29230],"text":" &#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[29228,29230],"text":" &rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":760,"column":52,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[29242,29261],"text":"&quot;\r\n                "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[29242,29261],"text":"&ldquo;\r\n                "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[29242,29261],"text":"&#34;\r\n                "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[29242,29261],"text":"&rdquo;\r\n                "},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect, useRef } from 'react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Card, CardContent } from '@/components/ui/card';\r\nimport { useToast } from '@/components/ui/use-toast';\r\nimport { useLanguage } from '@/contexts/language-context';\r\nimport { DeviceData } from '../new-ticket-wizard';\r\nimport { DEVICE_BRANDS, DEVICE_MODELS } from '@/lib/device-brands';\r\nimport { getAllBrands, getAllModels, addCustomBrand, addCustomModel } from '@/lib/device-storage';\r\nimport ImageCrop from '../image-crop';\r\nimport {\r\n  CameraIcon,\r\n  PhotoIcon,\r\n  XMarkIcon,\r\n  SparklesIcon,\r\n  ArrowPathIcon,\r\n  ExclamationTriangleIcon,\r\n  CheckCircleIcon,\r\n  PlusIcon,\r\n  WifiIcon,\r\n  DevicePhoneMobileIcon,\r\n  ChevronDownIcon,\r\n  ChevronUpIcon,\r\n} from '@heroicons/react/24/outline';\r\n\r\ninterface StepDeviceDetectionProps {\r\n  data: DeviceData;\r\n  onChange: (data: DeviceData) => void;\r\n}\r\n\r\ntype DetectionStatus = 'idle' | 'detecting' | 'success' | 'error';\r\n\r\nexport function StepDeviceDetection({ data, onChange }: StepDeviceDetectionProps) {\r\n  const { t } = useLanguage();\r\n  const { toast } = useToast();\r\n  const [isOnline, setIsOnline] = useState(true);\r\n  const [aiConfigured, setAiConfigured] = useState<boolean | null>(null);\r\n  const [detectionStatus, setDetectionStatus] = useState<DetectionStatus>('idle');\r\n  const [detectionError, setDetectionError] = useState<string>('');\r\n  const [confidence, setConfidence] = useState<number>(0);\r\n  const [showFrontPhoto, setShowFrontPhoto] = useState(false);\r\n\r\n  // Image capture state\r\n  const [showCrop, setShowCrop] = useState<'front' | 'back' | null>(null);\r\n  const [imageSrc, setImageSrc] = useState<string | null>(null);\r\n  const [showCamera, setShowCamera] = useState<'front' | 'back' | null>(null);\r\n  const videoRef = useRef<HTMLVideoElement>(null);\r\n  const streamRef = useRef<MediaStream | null>(null);\r\n  const frontInputRef = useRef<HTMLInputElement>(null);\r\n  const backInputRef = useRef<HTMLInputElement>(null);\r\n  const frontCameraRef = useRef<HTMLInputElement>(null);\r\n  const backCameraRef = useRef<HTMLInputElement>(null);\r\n\r\n  // Autocomplete state\r\n  const [showBrandDropdown, setShowBrandDropdown] = useState(false);\r\n  const [showModelDropdown, setShowModelDropdown] = useState(false);\r\n  const [filteredBrands, setFilteredBrands] = useState<string[]>([]);\r\n  const [filteredModels, setFilteredModels] = useState<string[]>([]);\r\n  const [showAddBrand, setShowAddBrand] = useState(false);\r\n  const [showAddModel, setShowAddModel] = useState(false);\r\n  const dropdownRef = useRef<HTMLDivElement>(null);\r\n\r\n  // Check online status and AI configuration\r\n  useEffect(() => {\r\n    setIsOnline(navigator.onLine);\r\n\r\n    const handleOnline = () => setIsOnline(true);\r\n    const handleOffline = () => setIsOnline(false);\r\n\r\n    window.addEventListener('online', handleOnline);\r\n    window.addEventListener('offline', handleOffline);\r\n\r\n    // Check AI configuration\r\n    fetch('/api/ai/detect-device')\r\n      .then(res => res.json())\r\n      .then(data => setAiConfigured(data.configured))\r\n      .catch(() => setAiConfigured(false));\r\n\r\n    return () => {\r\n      window.removeEventListener('online', handleOnline);\r\n      window.removeEventListener('offline', handleOffline);\r\n    };\r\n  }, []);\r\n\r\n  // Initialize brands\r\n  useEffect(() => {\r\n    setFilteredBrands(getAllBrands(DEVICE_BRANDS));\r\n  }, []);\r\n\r\n  // Update models when brand changes\r\n  useEffect(() => {\r\n    if (data.brand) {\r\n      const defaultModels = DEVICE_MODELS[data.brand] || [];\r\n      setFilteredModels(getAllModels(data.brand, defaultModels));\r\n    } else {\r\n      setFilteredModels([]);\r\n    }\r\n  }, [data.brand]);\r\n\r\n  // Click outside handler for dropdowns\r\n  useEffect(() => {\r\n    const handleClickOutside = (event: MouseEvent) => {\r\n      if (dropdownRef.current && !dropdownRef.current.contains(event.target as Node)) {\r\n        setShowBrandDropdown(false);\r\n        setShowModelDropdown(false);\r\n      }\r\n    };\r\n    document.addEventListener('mousedown', handleClickOutside);\r\n    return () => document.removeEventListener('mousedown', handleClickOutside);\r\n  }, []);\r\n\r\n  // Trigger AI detection when back image is available\r\n  useEffect(() => {\r\n    if (data.backImage && isOnline && aiConfigured && detectionStatus === 'idle') {\r\n      runAIDetection();\r\n    }\r\n  }, [data.backImage, isOnline, aiConfigured]);\r\n\r\n  const runAIDetection = async () => {\r\n    if (!data.backImage) return;\r\n\r\n    setDetectionStatus('detecting');\r\n    setDetectionError('');\r\n\r\n    try {\r\n      // Only send the back image for AI detection\r\n      const images = [data.backImage];\r\n\r\n      const response = await fetch('/api/ai/detect-device', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          images,\r\n          brandHint: data.brand || undefined, // Send brand as hint if already selected\r\n        }),\r\n      });\r\n\r\n      const result = await response.json();\r\n\r\n      if (!response.ok) {\r\n        throw new Error(result.error || 'Detection failed');\r\n      }\r\n\r\n      if (result.brand && result.model) {\r\n        onChange({\r\n          ...data,\r\n          brand: result.brand,\r\n          model: result.model,\r\n          color: result.color || data.color,\r\n        });\r\n        setConfidence(result.confidence || 0);\r\n        setDetectionStatus('success');\r\n        toast({\r\n          title: t('deviceDetected'),\r\n          description: `${result.brand} ${result.model}${result.color ? ` (${result.color})` : ''}`,\r\n        });\r\n      } else if (result.brand || result.model) {\r\n        // Partial detection\r\n        onChange({\r\n          ...data,\r\n          brand: result.brand || data.brand,\r\n          model: result.model || data.model,\r\n          color: result.color || data.color,\r\n        });\r\n        setConfidence(result.confidence || 0);\r\n        setDetectionStatus('success');\r\n        toast({\r\n          title: t('partialDetection') || 'Partial Detection',\r\n          description: t('completeManually') || 'Please complete missing fields manually',\r\n        });\r\n      } else {\r\n        setDetectionStatus('error');\r\n        const errorMsg = t('detectionFailed');\r\n        setDetectionError(errorMsg);\r\n        toast({\r\n          title: t('detectionFailed'),\r\n          description: t('enterManually'),\r\n          variant: 'destructive',\r\n        });\r\n      }\r\n    } catch (error: any) {\r\n      console.error('AI detection error:', error);\r\n      setDetectionStatus('error');\r\n      const errorMsg = error.message || t('detectionFailed');\r\n      setDetectionError(errorMsg);\r\n      toast({\r\n        title: t('detectionFailed'),\r\n        description: errorMsg + '. ' + t('enterManually'),\r\n        variant: 'destructive',\r\n      });\r\n    }\r\n  };\r\n\r\n  // File/Camera handlers\r\n  const handleFileSelect = (type: 'front' | 'back') => (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (file) {\r\n      const reader = new FileReader();\r\n      reader.onload = () => {\r\n        setImageSrc(reader.result as string);\r\n        setShowCrop(type);\r\n      };\r\n      reader.readAsDataURL(file);\r\n    }\r\n  };\r\n\r\n  const handleCropComplete = (croppedImage: string) => {\r\n    if (showCrop === 'front') {\r\n      onChange({ ...data, frontImage: croppedImage });\r\n    } else if (showCrop === 'back') {\r\n      onChange({ ...data, backImage: croppedImage });\r\n    }\r\n    setShowCrop(null);\r\n    setImageSrc(null);\r\n    // Reset detection status to allow re-detection when back photo changes\r\n    if (showCrop === 'back' && detectionStatus !== 'idle') {\r\n      setDetectionStatus('idle');\r\n    }\r\n  };\r\n\r\n  const handleCropCancel = () => {\r\n    setShowCrop(null);\r\n    setImageSrc(null);\r\n  };\r\n\r\n  const removeImage = (type: 'front' | 'back') => {\r\n    if (type === 'front') {\r\n      onChange({ ...data, frontImage: '' });\r\n    } else {\r\n      onChange({ ...data, backImage: '' });\r\n    }\r\n    if (type === 'back') {\r\n      setDetectionStatus('idle');\r\n    }\r\n  };\r\n\r\n  // Camera handling\r\n  const startCamera = async (type: 'front' | 'back') => {\r\n    // Check if camera API is available (requires HTTPS or localhost)\r\n    if (!navigator.mediaDevices || typeof navigator.mediaDevices.getUserMedia !== 'function') {\r\n      console.warn('Camera API not available - falling back to file input');\r\n      if (type === 'front') {\r\n        frontCameraRef.current?.click();\r\n      } else {\r\n        backCameraRef.current?.click();\r\n      }\r\n      return;\r\n    }\r\n\r\n    try {\r\n      let stream: MediaStream;\r\n      try {\r\n        stream = await navigator.mediaDevices.getUserMedia({\r\n          video: { facingMode: 'environment' },\r\n        });\r\n      } catch {\r\n        stream = await navigator.mediaDevices.getUserMedia({ video: true });\r\n      }\r\n\r\n      streamRef.current = stream;\r\n      setShowCamera(type);\r\n      setTimeout(() => {\r\n        if (videoRef.current) {\r\n          videoRef.current.srcObject = stream;\r\n          videoRef.current.play().catch(console.error);\r\n        }\r\n      }, 100);\r\n    } catch (error) {\r\n      console.error('Camera error:', error);\r\n      if (type === 'front') {\r\n        frontCameraRef.current?.click();\r\n      } else {\r\n        backCameraRef.current?.click();\r\n      }\r\n    }\r\n  };\r\n\r\n  const stopCamera = () => {\r\n    if (streamRef.current) {\r\n      streamRef.current.getTracks().forEach((track) => track.stop());\r\n      streamRef.current = null;\r\n    }\r\n    setShowCamera(null);\r\n  };\r\n\r\n  const capturePhoto = () => {\r\n    if (videoRef.current && showCamera) {\r\n      const canvas = document.createElement('canvas');\r\n      canvas.width = videoRef.current.videoWidth;\r\n      canvas.height = videoRef.current.videoHeight;\r\n      const ctx = canvas.getContext('2d');\r\n      if (ctx) {\r\n        ctx.drawImage(videoRef.current, 0, 0);\r\n        const imageData = canvas.toDataURL('image/png');\r\n        setImageSrc(imageData);\r\n        setShowCrop(showCamera);\r\n        stopCamera();\r\n      }\r\n    }\r\n  };\r\n\r\n  // Brand/Model autocomplete handlers\r\n  const handleBrandInput = (value: string) => {\r\n    onChange({ ...data, brand: value, model: '' });\r\n    if (value) {\r\n      const allBrands = getAllBrands(DEVICE_BRANDS);\r\n      const filtered = allBrands.filter((b) =>\r\n        b.toLowerCase().includes(value.toLowerCase())\r\n      );\r\n      setFilteredBrands(filtered);\r\n      const exactMatch = allBrands.some((b) => b.toLowerCase() === value.toLowerCase());\r\n      setShowAddBrand(!exactMatch && value.trim().length > 0);\r\n      setShowBrandDropdown(true);\r\n    } else {\r\n      setFilteredBrands(getAllBrands(DEVICE_BRANDS));\r\n      setShowAddBrand(false);\r\n      setShowBrandDropdown(false);\r\n    }\r\n  };\r\n\r\n  const handleModelInput = (value: string) => {\r\n    onChange({ ...data, model: value });\r\n    if (value && data.brand) {\r\n      const defaultModels = DEVICE_MODELS[data.brand] || [];\r\n      const allModels = getAllModels(data.brand, defaultModels);\r\n      const filtered = allModels.filter((m) =>\r\n        m.toLowerCase().includes(value.toLowerCase())\r\n      );\r\n      setFilteredModels(filtered);\r\n      const exactMatch = allModels.some((m) => m.toLowerCase() === value.toLowerCase());\r\n      setShowAddModel(!exactMatch && value.trim().length > 0);\r\n      setShowModelDropdown(true);\r\n    } else {\r\n      setShowModelDropdown(false);\r\n      setShowAddModel(false);\r\n    }\r\n  };\r\n\r\n  const selectBrand = (selectedBrand: string) => {\r\n    onChange({ ...data, brand: selectedBrand, model: '' });\r\n    setShowBrandDropdown(false);\r\n    setShowAddBrand(false);\r\n  };\r\n\r\n  const selectModel = (selectedModel: string) => {\r\n    onChange({ ...data, model: selectedModel });\r\n    setShowModelDropdown(false);\r\n    setShowAddModel(false);\r\n  };\r\n\r\n  const handleAddBrand = () => {\r\n    const newBrand = data.brand.trim();\r\n    if (newBrand) {\r\n      addCustomBrand(newBrand);\r\n      selectBrand(newBrand);\r\n      setFilteredBrands(getAllBrands(DEVICE_BRANDS));\r\n    }\r\n  };\r\n\r\n  const handleAddModel = () => {\r\n    const newModel = data.model.trim();\r\n    if (newModel && data.brand) {\r\n      addCustomModel(data.brand, newModel);\r\n      selectModel(newModel);\r\n      const defaultModels = DEVICE_MODELS[data.brand] || [];\r\n      setFilteredModels(getAllModels(data.brand, defaultModels));\r\n    }\r\n  };\r\n\r\n  const showAIFeatures = isOnline && aiConfigured;\r\n\r\n  return (\r\n    <div className=\"space-y-5\">\r\n      {/* Offline/No AI Warning */}\r\n      {!isOnline && (\r\n        <div className=\"flex items-center gap-3 p-3 rounded-lg bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800\">\r\n          <WifiIcon className=\"w-5 h-5 text-amber-600 dark:text-amber-400 shrink-0\" />\r\n          <p className=\"text-sm text-amber-700 dark:text-amber-300\">\r\n            {t('offlineMode')} - {t('manualEntryOnly')}\r\n          </p>\r\n        </div>\r\n      )}\r\n\r\n      {isOnline && aiConfigured === false && (\r\n        <div className=\"flex items-center gap-3 p-3 rounded-lg bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800\">\r\n          <SparklesIcon className=\"w-5 h-5 text-blue-600 dark:text-blue-400 shrink-0\" />\r\n          <p className=\"text-sm text-blue-700 dark:text-blue-300\">\r\n            {t('aiNotConfigured')} - {t('manualEntryOnly')}\r\n          </p>\r\n        </div>\r\n      )}\r\n\r\n      {/* Brand Selection - First for better AI detection */}\r\n      {showAIFeatures && (\r\n        <Card className=\"border-primary/20 bg-primary/5\">\r\n          <CardContent className=\"p-4\">\r\n            <div className=\"flex items-start gap-3\">\r\n              <div className=\"w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center shrink-0\">\r\n                <DevicePhoneMobileIcon className=\"w-5 h-5 text-primary\" />\r\n              </div>\r\n              <div className=\"flex-1 min-w-0\">\r\n                <p className=\"text-sm font-medium mb-1\">{t('knowTheBrand') || 'Know the brand?'}</p>\r\n                <p className=\"text-xs text-muted-foreground mb-3\">\r\n                  {t('brandHintHelps') || 'Selecting the brand first helps AI identify the exact model more accurately'}\r\n                </p>\r\n                <div className=\"relative\" ref={dropdownRef}>\r\n                  <Input\r\n                    id=\"brandHint\"\r\n                    value={data.brand}\r\n                    onChange={(e) => handleBrandInput(e.target.value)}\r\n                    onFocus={() => {\r\n                      if (data.brand) {\r\n                        handleBrandInput(data.brand);\r\n                      } else {\r\n                        setShowBrandDropdown(true);\r\n                      }\r\n                    }}\r\n                    placeholder={t('selectBrandOptional') || 'Select brand (optional)'}\r\n                    autoComplete=\"off\"\r\n                    className=\"text-sm\"\r\n                  />\r\n                  {showBrandDropdown && (filteredBrands.length > 0 || showAddBrand) && (\r\n                    <div className=\"absolute z-50 w-full mt-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-md shadow-lg max-h-48 overflow-auto\">\r\n                      {filteredBrands.slice(0, 10).map((b) => (\r\n                        <button\r\n                          key={b}\r\n                          type=\"button\"\r\n                          onClick={() => selectBrand(b)}\r\n                          className=\"w-full text-left px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 text-sm\"\r\n                        >\r\n                          {b}\r\n                        </button>\r\n                      ))}\r\n                      {showAddBrand && (\r\n                        <button\r\n                          type=\"button\"\r\n                          onClick={handleAddBrand}\r\n                          className=\"w-full text-left px-3 py-2 hover:bg-primary-100 dark:hover:bg-primary-900 text-sm text-primary-600 dark:text-primary-400 font-medium border-t border-gray-300 dark:border-gray-700 flex items-center gap-2\"\r\n                        >\r\n                          <PlusIcon className=\"h-4 w-4\" />\r\n                          {t('addAsNewBrand', { brand: data.brand })}\r\n                        </button>\r\n                      )}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      {/* Back Photo - Primary for AI Detection */}\r\n      <div>\r\n        <div className=\"flex items-center justify-between mb-3\">\r\n          <Label className=\"text-sm font-medium flex items-center gap-2\">\r\n            <span className=\"w-6 h-6 rounded-full bg-primary text-white text-xs flex items-center justify-center font-bold\">1</span>\r\n            {t('deviceBackPhoto')}\r\n            {showAIFeatures && (\r\n              <span className=\"text-xs font-normal text-primary bg-primary/10 px-2 py-0.5 rounded-full\">\r\n                {t('forAIDetection') || 'For AI'}\r\n              </span>\r\n            )}\r\n          </Label>\r\n        </div>\r\n\r\n        <Card className=\"overflow-hidden border-2 border-dashed border-primary/30 hover:border-primary/50 transition-colors\">\r\n          <CardContent className=\"p-3 sm:p-4\">\r\n            {data.backImage ? (\r\n              <div className=\"relative\">\r\n                <img\r\n                  src={data.backImage}\r\n                  alt={t('deviceBack')}\r\n                  className=\"w-full h-40 sm:h-52 object-contain rounded border bg-gray-50 dark:bg-gray-800\"\r\n                />\r\n                <Button\r\n                  type=\"button\"\r\n                  variant=\"ghost\"\r\n                  size=\"sm\"\r\n                  onClick={() => removeImage('back')}\r\n                  className=\"absolute top-2 right-2 bg-white/80 dark:bg-gray-900/80 h-8 w-8 p-0\"\r\n                >\r\n                  <XMarkIcon className=\"h-4 w-4\" />\r\n                </Button>\r\n              </div>\r\n            ) : (\r\n              <div className=\"h-40 sm:h-52 rounded-lg flex flex-col items-center justify-center gap-3 bg-gray-50/50 dark:bg-gray-800/30\">\r\n                <div className=\"w-16 h-16 rounded-2xl bg-primary/10 flex items-center justify-center\">\r\n                  <CameraIcon className=\"w-8 h-8 text-primary\" />\r\n                </div>\r\n                <p className=\"text-sm text-center text-muted-foreground px-4\">\r\n                  {t('captureBackPhoto') || 'Take a photo of the device back for AI detection'}\r\n                </p>\r\n                <div className=\"flex flex-col sm:flex-row gap-2\">\r\n                  <Button\r\n                    type=\"button\"\r\n                    onClick={() => startCamera('back')}\r\n                    className=\"text-sm\"\r\n                  >\r\n                    <CameraIcon className=\"h-4 w-4 mr-2\" />\r\n                    {t('takePhoto')}\r\n                  </Button>\r\n                  <Button\r\n                    type=\"button\"\r\n                    variant=\"outline\"\r\n                    onClick={() => backInputRef.current?.click()}\r\n                    className=\"text-sm\"\r\n                  >\r\n                    <PhotoIcon className=\"h-4 w-4 mr-2\" />\r\n                    {t('uploadFile')}\r\n                  </Button>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            <input\r\n              ref={backInputRef}\r\n              type=\"file\"\r\n              accept=\"image/*\"\r\n              onChange={handleFileSelect('back')}\r\n              className=\"hidden\"\r\n            />\r\n            <input\r\n              ref={backCameraRef}\r\n              type=\"file\"\r\n              accept=\"image/*\"\r\n              capture=\"environment\"\r\n              onChange={handleFileSelect('back')}\r\n              className=\"hidden\"\r\n            />\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      {/* AI Detection Status */}\r\n      {showAIFeatures && data.backImage && (\r\n        <div className=\"flex items-center gap-3 p-3 rounded-lg bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700\">\r\n          {detectionStatus === 'detecting' && (\r\n            <>\r\n              <ArrowPathIcon className=\"w-5 h-5 text-primary-600 animate-spin shrink-0\" />\r\n              <span className=\"text-sm text-gray-700 dark:text-gray-300\">\r\n                {t('detectingDevice')}...\r\n              </span>\r\n            </>\r\n          )}\r\n\r\n          {detectionStatus === 'success' && (\r\n            <>\r\n              <CheckCircleIcon className=\"w-5 h-5 text-green-600 shrink-0\" />\r\n              <span className=\"text-sm text-green-700 dark:text-green-400 flex-1\">\r\n                {t('deviceDetected')} ({confidence}% {t('confidence')})\r\n              </span>\r\n              <Button\r\n                type=\"button\"\r\n                variant=\"ghost\"\r\n                size=\"sm\"\r\n                onClick={() => { setDetectionStatus('idle'); runAIDetection(); }}\r\n                className=\"h-8\"\r\n              >\r\n                <ArrowPathIcon className=\"w-4 h-4\" />\r\n              </Button>\r\n            </>\r\n          )}\r\n\r\n          {detectionStatus === 'error' && (\r\n            <>\r\n              <ExclamationTriangleIcon className=\"w-5 h-5 text-amber-600 shrink-0\" />\r\n              <span className=\"text-sm text-amber-700 dark:text-amber-400 flex-1 line-clamp-1\">\r\n                {detectionError}\r\n              </span>\r\n              <Button\r\n                type=\"button\"\r\n                variant=\"ghost\"\r\n                size=\"sm\"\r\n                onClick={() => { setDetectionStatus('idle'); runAIDetection(); }}\r\n                className=\"h-8\"\r\n              >\r\n                <ArrowPathIcon className=\"w-4 h-4 mr-1\" />\r\n                <span className=\"hidden sm:inline\">{t('retry') || 'Retry'}</span>\r\n              </Button>\r\n            </>\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      {/* Front Photo - Optional for Documentation */}\r\n      <div>\r\n        <button\r\n          type=\"button\"\r\n          onClick={() => setShowFrontPhoto(!showFrontPhoto)}\r\n          className=\"flex items-center gap-2 text-sm text-muted-foreground hover:text-foreground transition-colors mb-2\"\r\n        >\r\n          {showFrontPhoto ? (\r\n            <ChevronUpIcon className=\"w-4 h-4\" />\r\n          ) : (\r\n            <ChevronDownIcon className=\"w-4 h-4\" />\r\n          )}\r\n          <span className=\"w-5 h-5 rounded-full bg-gray-200 dark:bg-gray-700 text-xs flex items-center justify-center font-medium\">2</span>\r\n          {t('deviceFrontPhoto')}\r\n          <span className=\"text-xs opacity-60\">({t('optional')})</span>\r\n          {data.frontImage && <CheckCircleIcon className=\"w-4 h-4 text-green-500\" />}\r\n        </button>\r\n\r\n        {showFrontPhoto && (\r\n          <Card className=\"overflow-hidden\">\r\n            <CardContent className=\"p-3 sm:p-4\">\r\n              <p className=\"text-xs text-muted-foreground mb-3\">\r\n                {t('frontPhotoForDocs') || 'Front photo is for condition records only, not used for AI detection'}\r\n              </p>\r\n\r\n              {data.frontImage ? (\r\n                <div className=\"relative\">\r\n                  <img\r\n                    src={data.frontImage}\r\n                    alt={t('deviceFront')}\r\n                    className=\"w-full h-32 sm:h-40 object-contain rounded border bg-gray-50 dark:bg-gray-800\"\r\n                  />\r\n                  <Button\r\n                    type=\"button\"\r\n                    variant=\"ghost\"\r\n                    size=\"sm\"\r\n                    onClick={() => removeImage('front')}\r\n                    className=\"absolute top-2 right-2 bg-white/80 dark:bg-gray-900/80 h-8 w-8 p-0\"\r\n                  >\r\n                    <XMarkIcon className=\"h-4 w-4\" />\r\n                  </Button>\r\n                </div>\r\n              ) : (\r\n                <div className=\"h-28 border-2 border-dashed border-gray-200 dark:border-gray-700 rounded-lg flex flex-col items-center justify-center gap-2 bg-gray-50/50 dark:bg-gray-800/30\">\r\n                  <div className=\"flex gap-2\">\r\n                    <Button\r\n                      type=\"button\"\r\n                      variant=\"outline\"\r\n                      size=\"sm\"\r\n                      onClick={() => startCamera('front')}\r\n                      className=\"text-xs\"\r\n                    >\r\n                      <CameraIcon className=\"h-4 w-4 mr-1\" />\r\n                      {t('takePhoto')}\r\n                    </Button>\r\n                    <Button\r\n                      type=\"button\"\r\n                      variant=\"outline\"\r\n                      size=\"sm\"\r\n                      onClick={() => frontInputRef.current?.click()}\r\n                      className=\"text-xs\"\r\n                    >\r\n                      <PhotoIcon className=\"h-4 w-4 mr-1\" />\r\n                      {t('upload') || 'Upload'}\r\n                    </Button>\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              <input\r\n                ref={frontInputRef}\r\n                type=\"file\"\r\n                accept=\"image/*\"\r\n                onChange={handleFileSelect('front')}\r\n                className=\"hidden\"\r\n              />\r\n              <input\r\n                ref={frontCameraRef}\r\n                type=\"file\"\r\n                accept=\"image/*\"\r\n                capture=\"environment\"\r\n                onChange={handleFileSelect('front')}\r\n                className=\"hidden\"\r\n              />\r\n            </CardContent>\r\n          </Card>\r\n        )}\r\n      </div>\r\n\r\n      {/* Device Info Form */}\r\n      <div className=\"grid grid-cols-2 sm:grid-cols-3 gap-3 sm:gap-4\">\r\n        {/* Brand */}\r\n        <div className=\"relative\">\r\n          <Label htmlFor=\"deviceBrand\" className=\"text-sm\">{t('deviceBrand')} *</Label>\r\n          <Input\r\n            id=\"deviceBrand\"\r\n            value={data.brand}\r\n            onChange={(e) => handleBrandInput(e.target.value)}\r\n            onFocus={() => {\r\n              if (data.brand) {\r\n                handleBrandInput(data.brand);\r\n              } else {\r\n                setShowBrandDropdown(true);\r\n              }\r\n            }}\r\n            placeholder={t('deviceBrandPlaceholder')}\r\n            autoComplete=\"off\"\r\n            className=\"text-sm\"\r\n          />\r\n          {showBrandDropdown && (filteredBrands.length > 0 || showAddBrand) && (\r\n            <div className=\"absolute z-50 w-full mt-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-md shadow-lg max-h-48 overflow-auto\">\r\n              {filteredBrands.slice(0, 8).map((b) => (\r\n                <button\r\n                  key={b}\r\n                  type=\"button\"\r\n                  onClick={() => selectBrand(b)}\r\n                  className=\"w-full text-left px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 text-sm\"\r\n                >\r\n                  {b}\r\n                </button>\r\n              ))}\r\n              {showAddBrand && (\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={handleAddBrand}\r\n                  className=\"w-full text-left px-3 py-2 hover:bg-primary-100 dark:hover:bg-primary-900 text-sm text-primary-600 dark:text-primary-400 font-medium border-t border-gray-300 dark:border-gray-700 flex items-center gap-2\"\r\n                >\r\n                  <PlusIcon className=\"h-4 w-4\" />\r\n                  {t('add') || 'Add'} \"{data.brand}\"\r\n                </button>\r\n              )}\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Model */}\r\n        <div className=\"relative\">\r\n          <Label htmlFor=\"deviceModel\" className=\"text-sm\">{t('deviceModel')} *</Label>\r\n          <Input\r\n            id=\"deviceModel\"\r\n            value={data.model}\r\n            onChange={(e) => handleModelInput(e.target.value)}\r\n            onFocus={() => {\r\n              if (data.brand && data.model) {\r\n                handleModelInput(data.model);\r\n              }\r\n            }}\r\n            placeholder={t('deviceModelPlaceholder')}\r\n            disabled={!data.brand}\r\n            autoComplete=\"off\"\r\n            className=\"text-sm\"\r\n          />\r\n          {showModelDropdown && (filteredModels.length > 0 || showAddModel) && (\r\n            <div className=\"absolute z-50 w-full mt-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-md shadow-lg max-h-48 overflow-auto\">\r\n              {filteredModels.slice(0, 8).map((m) => (\r\n                <button\r\n                  key={m}\r\n                  type=\"button\"\r\n                  onClick={() => selectModel(m)}\r\n                  className=\"w-full text-left px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 text-sm\"\r\n                >\r\n                  {m}\r\n                </button>\r\n              ))}\r\n              {showAddModel && (\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={handleAddModel}\r\n                  className=\"w-full text-left px-3 py-2 hover:bg-primary-100 dark:hover:bg-primary-900 text-sm text-primary-600 dark:text-primary-400 font-medium border-t border-gray-300 dark:border-gray-700 flex items-center gap-2\"\r\n                >\r\n                  <PlusIcon className=\"h-4 w-4\" />\r\n                  {t('add') || 'Add'} \"{data.model}\"\r\n                </button>\r\n              )}\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Color */}\r\n        <div className=\"col-span-2 sm:col-span-1\">\r\n          <Label htmlFor=\"deviceColor\" className=\"text-sm\">{t('deviceColor')}</Label>\r\n          <Input\r\n            id=\"deviceColor\"\r\n            value={data.color}\r\n            onChange={(e) => onChange({ ...data, color: e.target.value })}\r\n            placeholder={t('deviceColorPlaceholder')}\r\n            autoComplete=\"off\"\r\n            className=\"text-sm\"\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n      {/* Camera Modal */}\r\n      {showCamera && (\r\n        <div className=\"fixed inset-0 z-[9999] flex items-center justify-center bg-black/90 backdrop-blur-sm\">\r\n          <div className=\"relative w-full max-w-2xl mx-4\">\r\n            <div className=\"bg-black rounded-lg overflow-hidden\">\r\n              <video\r\n                ref={videoRef}\r\n                autoPlay\r\n                playsInline\r\n                muted\r\n                className=\"w-full h-auto max-h-[70vh] object-contain\"\r\n              />\r\n              <div className=\"flex gap-2 p-4 justify-center bg-gray-900\">\r\n                <Button\r\n                  type=\"button\"\r\n                  onClick={capturePhoto}\r\n                  className=\"bg-primary-600 hover:bg-primary-700 text-white\"\r\n                  size=\"lg\"\r\n                >\r\n                  <CameraIcon className=\"h-5 w-5 mr-2\" />\r\n                  {t('capturePhoto')}\r\n                </Button>\r\n                <Button\r\n                  type=\"button\"\r\n                  variant=\"outline\"\r\n                  onClick={stopCamera}\r\n                  size=\"lg\"\r\n                  className=\"bg-white/10 hover:bg-white/20 text-white border-white/20\"\r\n                >\r\n                  {t('cancel')}\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Image Crop Modal */}\r\n      {showCrop && imageSrc && (\r\n        <ImageCrop\r\n          imageSrc={imageSrc}\r\n          onCropComplete={handleCropComplete}\r\n          onCancel={handleCropCancel}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\tickets\\wizard\\step-ticket-details.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\track\\contact-form.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\track\\contact-support-modal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\track\\satisfaction-rating-modal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\track\\track-content.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'handleTrack' and 'searchParams'. Either include them or remove the dependency array.","line":230,"column":6,"nodeType":"ArrayExpression","endLine":230,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [handleTrack, searchParams]","fix":{"range":[7135,7137],"text":"[handleTrack, searchParams]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect, useRef } from 'react';\r\nimport { useSearchParams, useRouter } from 'next/navigation';\r\nimport { useLanguage } from '@/contexts/language-context';\r\n\r\n// New modular components\r\nimport { TrackHeader } from '@/components/track/track-header';\r\nimport { TrackFooter } from '@/components/track/track-footer';\r\nimport { TrackForm } from '@/components/track/track-form';\r\nimport { TrackHero } from '@/components/track/track-hero';\r\nimport { TrackSummary } from '@/components/track/track-summary';\r\nimport { TrackDevice } from '@/components/track/track-device';\r\nimport { TrackTimeline } from '@/components/track/track-timeline';\r\nimport { ContactSupportModal } from '@/components/track/contact-support-modal';\r\nimport { SatisfactionRatingModal } from '@/components/track/satisfaction-rating-modal';\r\nimport { EnvelopeIcon } from '@heroicons/react/24/outline';\r\n\r\ninterface TicketData {\r\n  id: string;\r\n  ticketNumber: string;\r\n  trackingCode: string;\r\n  status: string;\r\n  progress: number;\r\n  deviceBrand: string;\r\n  deviceModel: string;\r\n  deviceIssue: string;\r\n  deviceConditionFront?: string;\r\n  deviceConditionBack?: string;\r\n  priority: string;\r\n  estimatedPrice: number;\r\n  finalPrice?: number;\r\n  createdAt: string;\r\n  completedAt?: string;\r\n  estimatedCompletion?: string;\r\n  warrantyDays?: number;\r\n  warrantyText?: string;\r\n  statusHistory: Array<{\r\n    id: string;\r\n    status: string;\r\n    notes?: string;\r\n    createdAt: string;\r\n  }>;\r\n  customer: {\r\n    name: string;\r\n    email: string;\r\n    phone: string | null;\r\n  };\r\n  satisfactionRating?: {\r\n    id: string;\r\n    rating: number;\r\n    comment: string | null;\r\n    phoneNumber: string | null;\r\n    verifiedBy: string;\r\n    createdAt: string;\r\n  } | null;\r\n  canSubmitRating?: boolean;\r\n}\r\n\r\ninterface SocialMedia {\r\n  facebook_url: string;\r\n  youtube_url: string;\r\n  instagram_url: string;\r\n  linkedin_url: string;\r\n  twitter_url: string;\r\n}\r\n\r\ninterface CompanyInfo {\r\n  storeName: string;\r\n  logo: string;\r\n  address: string;\r\n  phone: string;\r\n  email: string;\r\n}\r\n\r\nexport function TrackContent() {\r\n  const searchParams = useSearchParams();\r\n  const router = useRouter();\r\n  const { t, language } = useLanguage();\r\n\r\n  // State\r\n  const [ticket, setTicket] = useState<TicketData | null>(null);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [rateLimitError, setRateLimitError] = useState<{ retryAfter: number } | null>(null);\r\n  const [isContactModalOpen, setIsContactModalOpen] = useState(false);\r\n  const [isSatisfactionModalOpen, setIsSatisfactionModalOpen] = useState(false);\r\n\r\n  const [socialMedia, setSocialMedia] = useState<SocialMedia>({\r\n    facebook_url: '',\r\n    youtube_url: '',\r\n    instagram_url: '',\r\n    linkedin_url: '',\r\n    twitter_url: '',\r\n  });\r\n\r\n  const [companyInfo, setCompanyInfo] = useState<CompanyInfo>({\r\n    storeName: 'RepairFlow',\r\n    logo: '/default-logo.png',\r\n    address: '',\r\n    phone: '',\r\n    email: '',\r\n  });\r\n\r\n  const pollingIntervalRef = useRef<NodeJS.Timeout | null>(null);\r\n\r\n  // Fetch public settings\r\n  useEffect(() => {\r\n    fetch('/api/settings/public')\r\n      .then((res) => res.json())\r\n      .then((data) => {\r\n        setSocialMedia({\r\n          facebook_url: data.facebook_url || '',\r\n          youtube_url: data.youtube_url || '',\r\n          instagram_url: data.instagram_url || '',\r\n          linkedin_url: data.linkedin_url || '',\r\n          twitter_url: data.twitter_url || '',\r\n        });\r\n\r\n        let logoPath = '/default-logo.png';\r\n        if (data.company_logo) {\r\n          logoPath = data.company_logo.startsWith('http')\r\n            ? data.company_logo\r\n            : data.company_logo.startsWith('/')\r\n              ? data.company_logo\r\n              : `/${data.company_logo}`;\r\n        }\r\n\r\n        setCompanyInfo({\r\n          storeName: data.company_name || data.store_name || 'RepairFlow',\r\n          logo: logoPath,\r\n          address: data.address || '',\r\n          phone: data.company_phone || data.phone || '',\r\n          email: data.email || '',\r\n        });\r\n      })\r\n      .catch(console.error);\r\n  }, []);\r\n\r\n  // Handle tracking\r\n  const handleTrack = async (ticketNumber: string, trackingCode: string) => {\r\n    if (!ticketNumber || !trackingCode) {\r\n      setError(t('unableToLocateTicket'));\r\n      return;\r\n    }\r\n\r\n    setIsLoading(true);\r\n    setError(null);\r\n    setRateLimitError(null);\r\n    setTicket(null);\r\n\r\n    try {\r\n      const response = await fetch(\r\n        `/api/track?ticket=${encodeURIComponent(ticketNumber)}&code=${encodeURIComponent(trackingCode)}`\r\n      );\r\n      const data = await response.json();\r\n\r\n      if (!response.ok) {\r\n        if (response.status === 429) {\r\n          setRateLimitError({ retryAfter: data.retryAfter || 300 });\r\n          setError(t('tooManyAttempts').replace('{minutes}', Math.ceil((data.retryAfter || 300) / 60).toString()));\r\n        } else {\r\n          setError(data.error || t('unableToLocateTicket'));\r\n        }\r\n        return;\r\n      }\r\n\r\n      setTicket(data);\r\n      setError(null);\r\n\r\n      // Update URL without reload\r\n      const newUrl = `/track?ticket=${encodeURIComponent(ticketNumber)}&code=${encodeURIComponent(trackingCode)}`;\r\n      router.replace(newUrl, { scroll: false });\r\n\r\n      // Start polling for updates (only if not terminal status)\r\n      if (!['COMPLETED', 'CANCELLED', 'RETURNED'].includes(data.status)) {\r\n        startPolling(ticketNumber, trackingCode);\r\n      }\r\n    } catch (err) {\r\n      setError(t('unableToLocateTicket'));\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  // Polling for real-time updates\r\n  const startPolling = (ticketNum: string, code: string) => {\r\n    if (pollingIntervalRef.current) {\r\n      clearInterval(pollingIntervalRef.current);\r\n    }\r\n\r\n    pollingIntervalRef.current = setInterval(() => {\r\n      if (document.visibilityState === 'visible') {\r\n        fetch(`/api/track?ticket=${encodeURIComponent(ticketNum)}&code=${encodeURIComponent(code)}`)\r\n          .then(async (res) => {\r\n            if (res.ok) {\r\n              const data = await res.json();\r\n              if (data) {\r\n                setTicket(data);\r\n                if (['COMPLETED', 'CANCELLED', 'RETURNED'].includes(data.status)) {\r\n                  if (pollingIntervalRef.current) {\r\n                    clearInterval(pollingIntervalRef.current);\r\n                    pollingIntervalRef.current = null;\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          })\r\n          .catch(console.error);\r\n      }\r\n    }, 30000);\r\n  };\r\n\r\n  // Cleanup polling on unmount\r\n  useEffect(() => {\r\n    return () => {\r\n      if (pollingIntervalRef.current) {\r\n        clearInterval(pollingIntervalRef.current);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  // Read from URL params on mount\r\n  useEffect(() => {\r\n    const ticketFromUrl = searchParams.get('ticket');\r\n    const codeFromUrl = searchParams.get('code');\r\n    if (ticketFromUrl && codeFromUrl) {\r\n      handleTrack(ticketFromUrl.toUpperCase(), codeFromUrl.toUpperCase());\r\n    }\r\n  }, []);\r\n\r\n  return (\r\n    <div\r\n      className=\"min-h-screen flex flex-col bg-gradient-to-br from-gray-50 via-white to-gray-100 dark:from-slate-900 dark:via-slate-900 dark:to-slate-800\"\r\n      dir={language === 'ar' ? 'rtl' : 'ltr'}\r\n    >\r\n      {/* Header */}\r\n      <TrackHeader logo={companyInfo.logo} storeName={companyInfo.storeName} />\r\n\r\n      {/* Main Content */}\r\n      <main className=\"flex-1 container mx-auto px-4 py-8 max-w-2xl\">\r\n        {!ticket ? (\r\n          /* Tracking Form */\r\n          <div className=\"flex flex-col items-center justify-center min-h-[60vh]\">\r\n            <TrackForm\r\n              onSubmit={handleTrack}\r\n              isLoading={isLoading}\r\n              error={error}\r\n              rateLimitError={rateLimitError}\r\n              initialTicket={searchParams.get('ticket') || ''}\r\n              initialCode={searchParams.get('code') || ''}\r\n            />\r\n\r\n            {/* Contact Support Link */}\r\n            <div className=\"mt-8 text-center\">\r\n              <p className=\"text-sm text-gray-500 dark:text-gray-400 mb-3\">\r\n                {t('contact.form.description')}\r\n              </p>\r\n              <button\r\n                onClick={() => setIsContactModalOpen(true)}\r\n                className=\"inline-flex items-center gap-2 px-4 py-2.5 rounded-xl bg-white dark:bg-slate-800 border border-gray-200 dark:border-slate-700 text-gray-700 dark:text-gray-200 font-medium text-sm hover:bg-gray-50 dark:hover:bg-slate-700 transition-colors shadow-sm\"\r\n              >\r\n                <EnvelopeIcon className=\"w-4 h-4\" />\r\n                {t('contactSupport')}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        ) : (\r\n          /* Ticket Details */\r\n          <div className=\"space-y-6\">\r\n            {/* Status Hero */}\r\n            <TrackHero\r\n              status={ticket.status}\r\n              progress={ticket.progress}\r\n              ticketNumber={ticket.ticketNumber}\r\n              estimatedCompletion={ticket.estimatedCompletion}\r\n              priority={ticket.priority}\r\n            />\r\n\r\n            {/* Summary & Actions */}\r\n            <TrackSummary\r\n              ticketNumber={ticket.ticketNumber}\r\n              trackingCode={ticket.trackingCode}\r\n              createdAt={ticket.createdAt}\r\n              completedAt={ticket.completedAt}\r\n              warrantyDays={ticket.warrantyDays}\r\n              warrantyText={ticket.warrantyText}\r\n              status={ticket.status}\r\n              onContactSupport={() => setIsContactModalOpen(true)}\r\n              onRateService={() => setIsSatisfactionModalOpen(true)}\r\n              canRate={ticket.canSubmitRating || false}\r\n            />\r\n\r\n            {/* Device Details (Collapsible) */}\r\n            <TrackDevice\r\n              brand={ticket.deviceBrand}\r\n              model={ticket.deviceModel}\r\n              issue={ticket.deviceIssue}\r\n              conditionFront={ticket.deviceConditionFront}\r\n              conditionBack={ticket.deviceConditionBack}\r\n            />\r\n\r\n            {/* Status Timeline */}\r\n            <TrackTimeline\r\n              history={ticket.statusHistory}\r\n              currentStatus={ticket.status}\r\n            />\r\n          </div>\r\n        )}\r\n      </main>\r\n\r\n      {/* Footer */}\r\n      <TrackFooter\r\n        storeName={companyInfo.storeName}\r\n        logo={companyInfo.logo}\r\n        address={companyInfo.address}\r\n        phone={companyInfo.phone}\r\n        email={companyInfo.email}\r\n        socialMedia={socialMedia}\r\n      />\r\n\r\n      {/* Modals */}\r\n      <ContactSupportModal\r\n        open={isContactModalOpen}\r\n        onOpenChange={setIsContactModalOpen}\r\n        customerData={ticket ? {\r\n          name: ticket.customer.name,\r\n          email: ticket.customer.email,\r\n          phone: ticket.customer.phone,\r\n        } : undefined}\r\n      />\r\n\r\n      {ticket && (ticket.status === 'COMPLETED' || ticket.status === 'REPAIRED') && (\r\n        <SatisfactionRatingModal\r\n          open={isSatisfactionModalOpen}\r\n          onOpenChange={setIsSatisfactionModalOpen}\r\n          ticketId={ticket.id}\r\n          ticketNumber={ticket.ticketNumber}\r\n          trackingCode={ticket.trackingCode}\r\n          customerName={ticket.customer.name}\r\n          customerEmail={ticket.customer.email}\r\n          canSubmitRating={ticket.canSubmitRating || false}\r\n          existingRating={ticket.satisfactionRating || null}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\track\\track-device.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":87,"column":45,"nodeType":"JSXOpeningElement","endLine":91,"endColumn":47},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":103,"column":45,"nodeType":"JSXOpeningElement","endLine":107,"endColumn":47},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":127,"column":21,"nodeType":"JSXOpeningElement","endLine":132,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState } from 'react';\r\nimport { useLanguage } from '@/contexts/language-context';\r\nimport {\r\n    DevicePhoneMobileIcon,\r\n    WrenchScrewdriverIcon,\r\n    ChevronDownIcon,\r\n    XMarkIcon,\r\n} from '@heroicons/react/24/outline';\r\n\r\ninterface TrackDeviceProps {\r\n    brand: string;\r\n    model: string;\r\n    issue: string;\r\n    conditionFront?: string | null;\r\n    conditionBack?: string | null;\r\n}\r\n\r\nexport function TrackDevice({ brand, model, issue, conditionFront, conditionBack }: TrackDeviceProps) {\r\n    const { t, language } = useLanguage();\r\n    const [isExpanded, setIsExpanded] = useState(false);\r\n    const [lightboxImage, setLightboxImage] = useState<string | null>(null);\r\n\r\n    const hasPhotos = conditionFront || conditionBack;\r\n\r\n    return (\r\n        <>\r\n            <div className=\"rounded-2xl bg-white dark:bg-slate-800/50 border border-gray-100 dark:border-slate-700/50 overflow-hidden backdrop-blur-sm\">\r\n                {/* Header - Always visible */}\r\n                <button\r\n                    onClick={() => setIsExpanded(!isExpanded)}\r\n                    className=\"w-full flex items-center justify-between p-4 hover:bg-gray-50 dark:hover:bg-slate-700/50 transition-colors\"\r\n                >\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <div className=\"w-10 h-10 rounded-xl bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center\">\r\n                            <DevicePhoneMobileIcon className=\"w-5 h-5 text-white\" />\r\n                        </div>\r\n                        <div className=\"text-left\">\r\n                            <h3 className=\"font-semibold text-gray-900 dark:text-white\">\r\n                                {brand} {model}\r\n                            </h3>\r\n                            <p className=\"text-sm text-gray-500 dark:text-gray-400\">{t('deviceDetails')}</p>\r\n                        </div>\r\n                    </div>\r\n                    <ChevronDownIcon\r\n                        className={`w-5 h-5 text-gray-400 transition-transform duration-300 ${isExpanded ? 'rotate-180' : ''}`}\r\n                    />\r\n                </button>\r\n\r\n                {/* Expandable Content */}\r\n                <div\r\n                    className={`overflow-hidden transition-all duration-300 ease-out ${isExpanded ? 'max-h-[500px] opacity-100' : 'max-h-0 opacity-0'}`}\r\n                >\r\n                    <div className=\"px-4 pb-4 space-y-4 border-t border-gray-100 dark:border-slate-700/50 pt-4\">\r\n                        {/* Device Info */}\r\n                        <div className=\"grid grid-cols-2 gap-3\">\r\n                            <div className=\"p-3 rounded-xl bg-gray-50 dark:bg-slate-700/50\">\r\n                                <p className=\"text-xs text-gray-500 dark:text-gray-400 mb-1\">{t('deviceBrand')}</p>\r\n                                <p className=\"font-medium text-gray-900 dark:text-white\">{brand}</p>\r\n                            </div>\r\n                            <div className=\"p-3 rounded-xl bg-gray-50 dark:bg-slate-700/50\">\r\n                                <p className=\"text-xs text-gray-500 dark:text-gray-400 mb-1\">{t('deviceModel')}</p>\r\n                                <p className=\"font-medium text-gray-900 dark:text-white\">{model}</p>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Issue */}\r\n                        <div className=\"p-3 rounded-xl bg-gradient-to-br from-amber-50 to-orange-50 dark:from-amber-900/20 dark:to-orange-900/20 border border-amber-100 dark:border-amber-800/50\">\r\n                            <div className=\"flex items-center gap-2 mb-2\">\r\n                                <WrenchScrewdriverIcon className=\"w-4 h-4 text-amber-600 dark:text-amber-400\" />\r\n                                <p className=\"text-xs font-medium text-amber-600 dark:text-amber-400\">{t('reportedIssues')}</p>\r\n                            </div>\r\n                            <p className=\"text-sm text-gray-700 dark:text-gray-200\">{issue}</p>\r\n                        </div>\r\n\r\n                        {/* Condition Photos */}\r\n                        {hasPhotos && (\r\n                            <div>\r\n                                <p className=\"text-xs text-gray-500 dark:text-gray-400 mb-2\">{t('conditionPhotos')}</p>\r\n                                <div className=\"grid grid-cols-2 gap-2\">\r\n                                    {conditionFront && (\r\n                                        <button\r\n                                            onClick={() => setLightboxImage(conditionFront)}\r\n                                            className=\"relative aspect-square rounded-xl overflow-hidden group\"\r\n                                        >\r\n                                            <img\r\n                                                src={conditionFront}\r\n                                                alt={t('beforeRepair')}\r\n                                                className=\"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300\"\r\n                                            />\r\n                                            <div className=\"absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors\" />\r\n                                            <span className=\"absolute bottom-2 left-2 text-xs px-2 py-1 rounded-lg bg-black/50 text-white backdrop-blur-sm\">\r\n                                                {t('beforeRepair')}\r\n                                            </span>\r\n                                        </button>\r\n                                    )}\r\n                                    {conditionBack && (\r\n                                        <button\r\n                                            onClick={() => setLightboxImage(conditionBack)}\r\n                                            className=\"relative aspect-square rounded-xl overflow-hidden group\"\r\n                                        >\r\n                                            <img\r\n                                                src={conditionBack}\r\n                                                alt={t('afterRepair')}\r\n                                                className=\"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300\"\r\n                                            />\r\n                                            <div className=\"absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors\" />\r\n                                            <span className=\"absolute bottom-2 left-2 text-xs px-2 py-1 rounded-lg bg-black/50 text-white backdrop-blur-sm\">\r\n                                                {t('afterRepair')}\r\n                                            </span>\r\n                                        </button>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Lightbox */}\r\n            {lightboxImage && (\r\n                <div\r\n                    className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/90 p-4\"\r\n                    onClick={() => setLightboxImage(null)}\r\n                >\r\n                    <img\r\n                        src={lightboxImage}\r\n                        alt={t('conditionPhotos')}\r\n                        className=\"max-w-full max-h-full object-contain rounded-lg\"\r\n                        onClick={(e) => e.stopPropagation()}\r\n                    />\r\n                    <button\r\n                        onClick={() => setLightboxImage(null)}\r\n                        className={`absolute top-4 p-2 rounded-full bg-white/10 backdrop-blur-sm text-white hover:bg-white/20 transition-colors ${language === 'ar' ? 'left-4' : 'right-4'\r\n                            }`}\r\n                        aria-label={t('close')}\r\n                    >\r\n                        <XMarkIcon className=\"w-6 h-6\" />\r\n                    </button>\r\n                </div>\r\n            )}\r\n        </>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\track\\track-footer.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":43,"column":29,"nodeType":"JSXOpeningElement","endLine":50,"endColumn":31}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useLanguage } from '@/contexts/language-context';\r\nimport { EnvelopeIcon, PhoneIcon, MapPinIcon } from '@heroicons/react/24/outline';\r\n\r\ninterface SocialMedia {\r\n    facebook_url?: string;\r\n    instagram_url?: string;\r\n    youtube_url?: string;\r\n    linkedin_url?: string;\r\n    twitter_url?: string;\r\n}\r\n\r\ninterface TrackFooterProps {\r\n    storeName: string;\r\n    logo: string;\r\n    address?: string;\r\n    phone?: string;\r\n    email?: string;\r\n    socialMedia: SocialMedia;\r\n}\r\n\r\nexport function TrackFooter({\r\n    storeName,\r\n    logo,\r\n    address,\r\n    phone,\r\n    email,\r\n    socialMedia\r\n}: TrackFooterProps) {\r\n    const { t } = useLanguage();\r\n\r\n    const hasSocial = socialMedia.facebook_url || socialMedia.instagram_url ||\r\n        socialMedia.youtube_url || socialMedia.linkedin_url || socialMedia.twitter_url;\r\n\r\n    return (\r\n        <footer className=\"bg-gradient-to-b from-gray-50 to-gray-100 dark:from-slate-900 dark:to-slate-950 border-t border-gray-200 dark:border-slate-800 mt-auto\">\r\n            <div className=\"container mx-auto px-4 py-10\">\r\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-8\">\r\n                    {/* Brand */}\r\n                    <div className=\"space-y-4\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <img\r\n                                src={logo}\r\n                                alt={storeName}\r\n                                className=\"h-10 w-auto object-contain\"\r\n                                onError={(e) => {\r\n                                    e.currentTarget.src = '/default-logo.png';\r\n                                }}\r\n                            />\r\n                            <h3 className=\"text-lg font-bold bg-gradient-to-r from-blue-600 to-purple-600 dark:from-blue-400 dark:to-purple-400 bg-clip-text text-transparent\">\r\n                                {storeName}\r\n                            </h3>\r\n                        </div>\r\n                        <p className=\"text-sm text-gray-500 dark:text-gray-400 max-w-xs\">\r\n                            {t('footer.tagline')}\r\n                        </p>\r\n                    </div>\r\n\r\n                    {/* Contact */}\r\n                    <div className=\"space-y-4\">\r\n                        <h4 className=\"font-semibold text-gray-900 dark:text-white\">\r\n                            {t('contactSupport')}\r\n                        </h4>\r\n                        <div className=\"space-y-3 text-sm\">\r\n                            {email && (\r\n                                <a\r\n                                    href={`mailto:${email}`}\r\n                                    className=\"flex items-center gap-3 text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors group\"\r\n                                >\r\n                                    <div className=\"w-8 h-8 rounded-lg bg-blue-50 dark:bg-blue-900/20 flex items-center justify-center group-hover:bg-blue-100 dark:group-hover:bg-blue-900/30 transition-colors\">\r\n                                        <EnvelopeIcon className=\"w-4 h-4 text-blue-500\" />\r\n                                    </div>\r\n                                    {email}\r\n                                </a>\r\n                            )}\r\n                            {phone && (\r\n                                <a\r\n                                    href={`tel:${phone}`}\r\n                                    className=\"flex items-center gap-3 text-gray-600 dark:text-gray-400 hover:text-green-600 dark:hover:text-green-400 transition-colors group\"\r\n                                >\r\n                                    <div className=\"w-8 h-8 rounded-lg bg-green-50 dark:bg-green-900/20 flex items-center justify-center group-hover:bg-green-100 dark:group-hover:bg-green-900/30 transition-colors\">\r\n                                        <PhoneIcon className=\"w-4 h-4 text-green-500\" />\r\n                                    </div>\r\n                                    {phone}\r\n                                </a>\r\n                            )}\r\n                            {address && (\r\n                                <div className=\"flex items-center gap-3 text-gray-600 dark:text-gray-400\">\r\n                                    <div className=\"w-8 h-8 rounded-lg bg-purple-50 dark:bg-purple-900/20 flex items-center justify-center\">\r\n                                        <MapPinIcon className=\"w-4 h-4 text-purple-500\" />\r\n                                    </div>\r\n                                    <span className=\"line-clamp-2\">{address}</span>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Social */}\r\n                    {hasSocial && (\r\n                        <div className=\"space-y-4\">\r\n                            <h4 className=\"font-semibold text-gray-900 dark:text-white\">\r\n                                {t('footer.followUs')}\r\n                            </h4>\r\n                            <div className=\"flex gap-3\">\r\n                                {socialMedia.facebook_url && (\r\n                                    <a\r\n                                        href={socialMedia.facebook_url}\r\n                                        target=\"_blank\"\r\n                                        rel=\"noopener noreferrer\"\r\n                                        className=\"w-10 h-10 rounded-xl bg-blue-50 dark:bg-blue-900/20 flex items-center justify-center text-blue-600 hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors\"\r\n                                        aria-label=\"Facebook\"\r\n                                    >\r\n                                        <svg className=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                            <path d=\"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z\" />\r\n                                        </svg>\r\n                                    </a>\r\n                                )}\r\n                                {socialMedia.instagram_url && (\r\n                                    <a\r\n                                        href={socialMedia.instagram_url}\r\n                                        target=\"_blank\"\r\n                                        rel=\"noopener noreferrer\"\r\n                                        className=\"w-10 h-10 rounded-xl bg-pink-50 dark:bg-pink-900/20 flex items-center justify-center text-pink-600 hover:bg-pink-100 dark:hover:bg-pink-900/30 transition-colors\"\r\n                                        aria-label=\"Instagram\"\r\n                                    >\r\n                                        <svg className=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                            <path d=\"M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z\" />\r\n                                        </svg>\r\n                                    </a>\r\n                                )}\r\n                                {socialMedia.youtube_url && (\r\n                                    <a\r\n                                        href={socialMedia.youtube_url}\r\n                                        target=\"_blank\"\r\n                                        rel=\"noopener noreferrer\"\r\n                                        className=\"w-10 h-10 rounded-xl bg-red-50 dark:bg-red-900/20 flex items-center justify-center text-red-600 hover:bg-red-100 dark:hover:bg-red-900/30 transition-colors\"\r\n                                        aria-label=\"YouTube\"\r\n                                    >\r\n                                        <svg className=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                            <path d=\"M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z\" />\r\n                                        </svg>\r\n                                    </a>\r\n                                )}\r\n                                {socialMedia.twitter_url && (\r\n                                    <a\r\n                                        href={socialMedia.twitter_url}\r\n                                        target=\"_blank\"\r\n                                        rel=\"noopener noreferrer\"\r\n                                        className=\"w-10 h-10 rounded-xl bg-sky-50 dark:bg-sky-900/20 flex items-center justify-center text-sky-600 hover:bg-sky-100 dark:hover:bg-sky-900/30 transition-colors\"\r\n                                        aria-label=\"Twitter/X\"\r\n                                    >\r\n                                        <svg className=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                            <path d=\"M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z\" />\r\n                                        </svg>\r\n                                    </a>\r\n                                )}\r\n                                {socialMedia.linkedin_url && (\r\n                                    <a\r\n                                        href={socialMedia.linkedin_url}\r\n                                        target=\"_blank\"\r\n                                        rel=\"noopener noreferrer\"\r\n                                        className=\"w-10 h-10 rounded-xl bg-blue-50 dark:bg-blue-900/20 flex items-center justify-center text-blue-700 hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors\"\r\n                                        aria-label=\"LinkedIn\"\r\n                                    >\r\n                                        <svg className=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                            <path d=\"M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z\" />\r\n                                        </svg>\r\n                                    </a>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Copyright */}\r\n                <div className=\"mt-10 pt-6 border-t border-gray-200 dark:border-slate-800 text-center\">\r\n                    <p className=\"text-sm text-gray-500 dark:text-gray-400\">\r\n                        ┬® {new Date().getFullYear()} {storeName}. {t('footer.allRightsReserved')}\r\n                    </p>\r\n                </div>\r\n            </div>\r\n        </footer>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\track\\track-form.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\track\\track-header.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":22,"column":29,"nodeType":"JSXOpeningElement","endLine":29,"endColumn":31}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport Link from 'next/link';\r\nimport { useLanguage } from '@/contexts/language-context';\r\nimport { LanguageSwitcher } from '@/components/layout/language-switcher';\r\n\r\ninterface TrackHeaderProps {\r\n    logo: string;\r\n    storeName: string;\r\n}\r\n\r\nexport function TrackHeader({ logo, storeName }: TrackHeaderProps) {\r\n    const { t } = useLanguage();\r\n\r\n    return (\r\n        <header className=\"sticky top-0 z-50 bg-white/80 dark:bg-slate-900/80 backdrop-blur-xl border-b border-gray-100 dark:border-slate-800\">\r\n            <div className=\"container mx-auto px-4\">\r\n                <div className=\"h-16 flex items-center justify-between\">\r\n                    {/* Logo */}\r\n                    <Link href=\"/\" className=\"flex items-center gap-3 group\">\r\n                        <div className=\"relative\">\r\n                            <img\r\n                                src={logo}\r\n                                alt={storeName}\r\n                                className=\"h-9 w-auto object-contain group-hover:scale-105 transition-transform\"\r\n                                onError={(e) => {\r\n                                    e.currentTarget.src = '/default-logo.png';\r\n                                }}\r\n                            />\r\n                        </div>\r\n                        <span className=\"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 dark:from-blue-400 dark:to-purple-400 bg-clip-text text-transparent hidden sm:block\">\r\n                            {storeName}\r\n                        </span>\r\n                    </Link>\r\n\r\n                    {/* Right side */}\r\n                    <div className=\"flex items-center gap-4\">\r\n                        <Link\r\n                            href=\"/\"\r\n                            className=\"text-sm text-gray-500 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors hidden md:block\"\r\n                        >\r\n                            {t('home')}\r\n                        </Link>\r\n                        <LanguageSwitcher />\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </header>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\track\\track-hero.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\track\\track-summary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\track\\track-timeline.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\ui\\button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\ui\\card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\ui\\confirm-dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\ui\\dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\ui\\input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\ui\\label.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\ui\\select.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\ui\\switch.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\ui\\toast.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\ui\\toaster.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\components\\ui\\use-toast.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\contexts\\language-context.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\contexts\\settings-context.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\lib\\__tests__\\ticket-lifecycle.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\lib\\ai-text-parser.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\lib\\ai-vision.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\lib\\auth.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\lib\\auth.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\lib\\chat\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\lib\\com-port-sms.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\lib\\countries.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\lib\\currencies.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\lib\\currency.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\lib\\device-brands.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\lib\\device-issues.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\lib\\device-storage.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\lib\\email-templates\\password-changed.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\lib\\email-templates\\password-reset.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\lib\\email-templates\\smtp-test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\lib\\email.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\lib\\encryption.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\lib\\events\\emitter.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\lib\\events\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\lib\\features.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\lib\\finance\\unified-finance.service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\lib\\hooks\\useFeatureFlag.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\lib\\i18n-config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\lib\\notifications.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\lib\\notifications\\adapter.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\lib\\notifications\\logger.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\lib\\notifications\\processor.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\lib\\notifications\\recipients.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\lib\\notifications\\templates.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\lib\\ocr-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\lib\\part-matcher.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\lib\\pdf-generator.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\lib\\platform.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\lib\\prisma.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\lib\\rate-limit.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\lib\\server-translation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\lib\\settings.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\lib\\sms-templates.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\lib\\themes.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\lib\\ticket-lifecycle.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\lib\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\lib\\utils\\payment-number.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\lib\\version.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\proxy.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\src\\types\\next-auth.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\ADMIN-PC\\Documents\\Antigravity\\repairflow\\tailwind.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
