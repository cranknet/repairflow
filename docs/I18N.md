# Internationalization (i18n) Setup

This project uses **i18next** with **react-i18next** for internationalization.

## Supported Languages

- ğŸ‡ºğŸ‡¸ **English** (en) - Default
- ğŸ‡¸ğŸ‡¦ **Arabic** (ar) - RTL support
- ğŸ‡«ğŸ‡· **French** (fr)

## File Structure

```
public/locales/
â”œâ”€â”€ en/
â”‚   â””â”€â”€ translation.json     # English translations
â”œâ”€â”€ ar/
â”‚   â””â”€â”€ translation.json     # Arabic translations
â””â”€â”€ fr/
    â””â”€â”€ translation.json     # French translations

src/
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ i18n.ts              # Legacy translations (kept for migration script)
â”‚   â””â”€â”€ i18n-config.ts       # i18next configuration
â”œâ”€â”€ contexts/
â”‚   â””â”€â”€ language-context.tsx # React context for language switching
â””â”€â”€ components/
    â””â”€â”€ providers/
        â””â”€â”€ i18n-provider.tsx # I18next provider wrapper
```

## Usage

### In React Components

```tsx
import { useLanguage } from '@/contexts/language-context';

function MyComponent() {
  const { t, language, setLanguage } = useLanguage();
  
  return (
    <div>
      <h1>{t('dashboard')}</h1>
      <p>{t('welcomeBack')}</p>
      
      {/* With parameters */}
      <p>{t('lowStockAlert', { count: 5 })}</p>
    </div>
  );
}
```

### Outside React (Server Actions, etc.)

```ts
import { getTranslation } from '@/lib/i18n-config';

const message = getTranslation('ticketCreated', 'fr');
```

## npm Scripts

### Check translations (recommended before commit)

```bash
npm run i18n:check        # Check for missing keys (warnings for hardcoded)
npm run i18n:check:strict # Fail on any hardcoded strings
```

### Scan for new translation keys

```bash
npm run i18n:scan
```

This scans all source files for `t('key')` patterns and updates the locale JSON files:
- New keys are added to all locale files
- For English: uses the key as placeholder value
- For other languages: marks as `[TODO_TRANSLATE] key`

### Generate i18n report

```bash
npm run i18n:report
```

Generates detailed reports in `report/` directory showing all hardcoded strings and missing keys.

### Re-migrate translations

```bash
npm run i18n:migrate
```

Re-extracts translations from `src/lib/i18n.ts` to JSON files (useful if legacy translations are updated).

## Automated Checks & Auto-Fix

### Setup Git Pre-commit Hook (Recommended)

To automatically add missing translations before each commit:

```bash
bash scripts/setup-hooks.sh
```

This installs a pre-commit hook that:
1. Scans your code for missing translation keys
2. **Automatically adds them** to all locale files (en, ar, fr)
3. Stages the updated locale files
4. Continues with the commit

To skip the hook temporarily:
```bash
git commit --no-verify
```

### Manual Auto-Fix

Run manually to fix i18n issues:

```bash
npm run i18n:fix        # Interactive mode - asks before fixing
npm run i18n:fix:auto   # Auto mode - fixes missing keys automatically
```

### What Gets Auto-Fixed

| Issue Type | Auto-Fix Behavior |
|------------|-------------------|
| Missing keys | âœ… Added to all locales (en: key value, ar/fr: [TRANSLATE] value) |
| Hardcoded strings | âš ï¸ Only in interactive mode - suggests key names |

### CI/CD Integration

Add to your CI pipeline:

```yaml
# GitHub Actions example
- name: Check i18n
  run: npm run i18n:check:strict
```

## Adding New Translations

1. Add the translation key in your component:
   ```tsx
   const { t } = useLanguage();
   return <h1>{t('myNewKey')}</h1>;
   ```

2. Run the scanner to detect the new key:
   ```bash
   npm run i18n:scan
   ```

3. Update the locale files with actual translations:
   - Edit `public/locales/en/translation.json`
   - Edit `public/locales/ar/translation.json`
   - Edit `public/locales/fr/translation.json`

## Key Naming Conventions

- Use **dot notation** for nested keys: `install.step.welcome`
- Use **camelCase** for single words: `dashboard`, `settings`
- Group related keys by feature: `auth.login.title`, `auth.login.submit`
- Use descriptive names: `failedToUpdateTicketStatus` instead of `error1`

## RTL Support

Arabic (ar) is configured as RTL. The language context automatically:
- Sets `document.documentElement.dir` to 'rtl' or 'ltr'
- Sets `document.documentElement.lang` to the current language

## Configuration

The i18next configuration is in `src/lib/i18n-config.ts`:

- **Fallback language**: English (en)
- **Language detection**: localStorage > navigator > htmlTag
- **Local storage key**: `app_language`
- **Suspense**: Disabled for SSR compatibility
- **Debug mode**: Enabled in development only

## Migration from Legacy i18n

The original translations in `src/lib/i18n.ts` have been migrated to JSON files. 
The legacy file is kept for:
1. Reference during migration
2. The `translations` object used by the migration script

To re-migrate from the legacy file:
```bash
npm run i18n:migrate
```
